<!DOCTYPE html>
<html lang="en,default">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon-32x32-tilt-brush.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-tilt-brush.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-tilt-brush.png">
  <link rel="mask-icon" href="/images/favicon-32x32-tilt-brush.png" color="#222">
  <meta name="google-site-verification" content="ttIkhAIFZQM9Huj8roB0l95ePN2Tv2zv2wRFksi09WA">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noto Serif SC:300,300italic,400,400italic,700,700italic|Pacifico:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Roboto Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="//lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/5.15.2/css/all.min.css">
  <link rel="stylesheet" href="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/fancybox/3.5.7/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"en.imzlp.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false,"width":280},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"manual"},"fancybox":true,"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":false,"nav":null,"activeClass":"valine"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"code_unfold":{"enable":true,"CODE_MAX_HEIGHT":600},"path":"search.xml"};
  </script>

  <meta name="description" content="C++ is the best programming language!">
<meta property="og:type" content="website">
<meta property="og:title" content="C++">
<meta property="og:url" content="https://en.imzlp.com/notes/cpp/index.html">
<meta property="og:site_name" content="Z&#39;s Blog">
<meta property="og:description" content="C++ is the best programming language!">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/picgo/2023/20230710170920.png">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/picgo/2023/20230324200815.png">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/blog/notes/cpp/index/VS/vs-new-data-breakpoint.webp">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/blog/notes/cpp/index/VS/vs-debug-watch-window.webp">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/blog/notes/cpp/index/VS/vs-new-data-breakpoint-specify-address.webp">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/blog/notes/cpp/index/VS/vs-tragger-data-breakpoint.webp">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/blog/notes/cpp/index/VS/disable-optimization.webp">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/blog/notes/cpp/index/VS/vs-environment-var-options.webp">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/blog/notes/cpp/index/VS/vs-set-project-runtime-library-type.webp">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/blog/notes/cpp/index/brace-equal-initializer-diff-mem-initializer.webp">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/blog/notes/cpp/index/VS/vs-customize-file-bar-menu.webp">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/blog/notes/cpp/index/VS/vs-add-file-bar-advanced-save-options.webp">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/blog/notes/cpp/index/VS/vs-file-base-advanced-save-options.webp">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/blog/notes/cpp/index/lambda-expressions-syntex.webp">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/blog/notes/cpp/index/cpp-declara-syntax.webp">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/blog/notes/cpp/index/x32dbg-NoInitCharArray.webp">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/blog/notes/cpp/index/IDA-NoInitCharArray.webp">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/blog/notes/cpp/index/IDA-0xCC-Debug.webp">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/blog/notes/cpp/index/GoogleCppStyleGuide.webp">
<meta property="article:published_time" content="2020-09-30T05:50:33.000Z">
<meta property="article:modified_time" content="2020-09-30T05:50:33.000Z">
<meta property="article:author" content="LIPENGZHA">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img.imzlp.com/imgs/zlp/picgo/2023/20230710170920.png">

<link rel="canonical" href="https://en.imzlp.com/notes/cpp/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>C++ | Z's Blog
</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FDCJ41EFP5"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-FDCJ41EFP5');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.staticfile.org/lxgw-wenkai-screen-webfont/1.7.0/style.min.css" /><!-- hexo injector head_end end --><link rel="alternate" href="/atom.xml" title="Z's Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Z's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        
            
  <li class="menu-item menu-item-notes">

    <a href="/notes/" rel="section"><i class="fa fa-edit fa-fw"></i>Notes</a>

  </li>


      
        
            
  <li class="menu-item menu-item-essay">

    <a href="/essay/" rel="section"><i class="fas fa-feather-alt fa-fw"></i>Essay</a>

  </li>


      
        
            
  <li class="menu-item menu-item-resources">

    <a href="/resources/" rel="section"><i class="fa fa-inbox fa-fw"></i>Resources</a>

  </li>


      
        <li class="menu-item menu-item-friends">

    <a href="/friends/" rel="section"><i class="fas fa-link fa-fw"></i>Friends</a>

  </li>
        
            
  <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About Me</a>

  </li>


      
        <li class="menu-item menu-item-showcase">

    <a href="/showcase/" rel="section"><i class="fa fa-solid fa-trophy fa-fw"></i>ShowCase</a>

  </li>
        <li class="menu-item menu-item-changelog">

    <a href="/changelog/" rel="section"><i class="fa fa-history fa-fw"></i>Site Log</a>

  </li>
        <li class="menu-item menu-item-opensource">

    <a href="/opensource/" rel="section"><i class="fas fa-code-branch fa-fw"></i>Open Source</a>

  </li>
        <li class="menu-item menu-item-uewiki">

    <a href="https://ue5wiki.com/" rel="noopener" target="_blank"><i class="fab fa-wikipedia-w fa-fw"></i>Unreal Wiki</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>



<script type="text/javascript">
  let domain='en.imzlp.com';
  let domain_str = atob(domain);
  let pathname = location.pathname;
  if (domain_str!= location.host.toLowerCase()){
        console.log(`this host is not safe,jump to https://${domain_str}${pathname}`);
        location.href=`https://${domain_str}${pathname}`;
  }
</script>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>
  <div class="l10n-header-widget">
    <script>
      // 获取当前页面的 URL
      const currentUrl = window.location.href;
      // 替换 URL 中的部分内容
      const jumpToL10nLink = currentUrl.replace('en.imzlp.com', 'imzlp.com');
      // 将 jumpToL10nLink 绑定到一个全局变量
      window.jumpToL10nLink = jumpToL10nLink;
    </script>

    <a href="#" class="post-l10n-link" title="切换至中文版本" style="float: left;border-bottom: none;" rel="noopener" target="_blank" onclick="window.open(window.jumpToL10nLink, '_blank'); return false;">
      <i class="fa fa-solid fa-language"></i>
    </a>
  </div>



    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
  

      

        
        <ul id="sub-menu" class="sub-menu menu">
          
            
          
          
              
  <li class="menu-item menu-item-ue5">

    <a href="/notes/ue5/" rel="section"><i class="fas fa-cubes fa-fw"></i>UE5</a>

  </li>


          
          
              
  <li class="menu-item menu-item-gamedev">

    <a href="/notes/gamedev/" rel="section"><i class="fab fa-steam-square fa-fw"></i>GameDev</a>

  </li>


          
          
              
  <li class="menu-item menu-item-cpp">

    <a href="/notes/cpp/" rel="section"><i class="fas fa-keyboard fa-fw"></i>C++</a>

  </li>


          
          
              
  <li class="menu-item menu-item-rust">

    <a href="/notes/rust/" rel="section"><i class="fab fa-rust fa-fw"></i>Rust</a>

  </li>


          
          
              
  <li class="menu-item menu-item-graphics">

    <a href="/notes/graphics/" rel="section"><i class="fas fa-magic fa-fw"></i>Graphics</a>

  </li>


          
          
              
  <li class="menu-item menu-item-vr">

    <a href="/notes/vr/" rel="section"><i class="fas fa-vr-cardboard fa-fw"></i>VR</a>

  </li>


          
          
              
  <li class="menu-item menu-item-computerscience">

    <a href="/notes/computerscience/" rel="section"><i class="fas fa-satellite fa-fw"></i>Computer Science</a>

  </li>


          
          
              
  <li class="menu-item menu-item-linux">

    <a href="/notes/linux/" rel="section"><i class="fab fa-brands fa-linux fa-fw"></i>Linux</a>

  </li>


          
          
              
  <li class="menu-item menu-item-tools">

    <a href="/notes/tools/" rel="section"><i class="fa fa-solid fa-hammer fa-fw"></i>Tools</a>

  </li>


          
          
              
  <li class="menu-item menu-item-tips">

    <a href="/notes/tips/" rel="section"><i class="fa fa-rocket fa-fw"></i>Tips</a>

  </li>


          
        </ul>
        

        

                
                
        
      

      
      

      
      

      
      
  

          <div class="content page posts-expand">
            

    
    
    
    <div class="post-block" lang="en">
      <header class="post-header">
	<h1 class="post-title" itemprop="name headline">C++<a href="https://github.com/imzlp/blog-md/blob/en/notes/cpp/index.md" class="post-edit-link" title="Edit this post" style="float: right;border-bottom: 0px;" rel="noopener" target="_blank"><i class="fa fa-pen-nib"></i></a><a href="https://imzlp.com/notes/cpp/index.html" class="post-l10n-link" title="切换至中文版本" style="float: left;border-bottom: 0px;" rel="noopener" target="_blank"><i class="fa fa-solid fa-language"></i></a>
	</h1>
	<div class="post-meta">
	    <div class="post-description">C++ is the best programming language!</div>
	  
  <ul class="breadcrumb">
          
            <li><a href="/notes/">NOTES</a></li>
          <li>CPP</li>
        
  </ul>

	</div>


</header>

      
      
      
      <div class="post-body">
          <h2 id="Error-of-using-alias-in-friend"><a href="#Error-of-using-alias-in-friend" class="headerlink" title="Error of using alias in friend"></a>Error of using alias in friend</h2><p>The C++ standard requires that the type in the <code>friend</code> declaration must be a class or function, and cannot be a <code>using</code> alias.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Wrong code</span></span><br><span class="line"><span class="keyword">using</span> FPlatformProramMisc = SomeClass;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line">    <span class="keyword">friend</span> FPlatformProramMisc;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>Only a concrete class can be a friend:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SomeClass</span>;</span><br><span class="line"><span class="keyword">using</span> FPlatformProramMisc = SomeClass;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line">    <span class="keyword">friend</span> SomeClass;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Clang-compiles-C-to-WebAssembly"><a href="#Clang-compiles-C-to-WebAssembly" class="headerlink" title="Clang compiles C++ to WebAssembly"></a>Clang compiles C++ to WebAssembly</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">llc --version | grep wasm</span><br><span class="line">clang --target=wasm32 -Wl,--export-all -o hello.easm hello.c</span><br></pre></td></tr></table></figure>

<h2 id="LLVM’s-built-in-IR-interpreter"><a href="#LLVM’s-built-in-IR-interpreter" class="headerlink" title="LLVM’s built-in IR interpreter"></a>LLVM’s built-in IR interpreter</h2><p><code>lli</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lli test.ll</span><br><span class="line"><span class="comment"># Disable JIT execution</span></span><br><span class="line">lli --jit-kind=mcjit --force-interpreter</span><br></pre></td></tr></table></figure>

<h2 id="C-23-The-Next-C-Standard"><a href="#C-23-The-Next-C-Standard" class="headerlink" title="C++23: The Next C++ Standard"></a>C++23: The Next C++ Standard</h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.modernescpp.com/index.php/c-23-the-next-c-standard">C++23: The Next C++ Standard</a></li>
</ul>
<p><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2023/20230710170920.png"></p>
<h2 id="Standalone-Build-of-MinGW-w64-for-Windows"><a href="#Standalone-Build-of-MinGW-w64-for-Windows" class="headerlink" title="Standalone Build of MinGW-w64 for Windows"></a>Standalone Build of MinGW-w64 for Windows</h2><p>You can download it here, directly includes Clang: <a target="_blank" rel="noopener" href="https://winlibs.com/">WinLibs standalone build of GCC and MinGW-w64 for Windows</a></p>
<h2 id="nodiscard"><a href="#nodiscard" class="headerlink" title="[[nodiscard]]"></a>[[nodiscard]]</h2><p><code>[[nodiscard]]</code> is an attribute introduced in C++17 that informs the compiler that a function’s return value should be used; if the return value is ignored, the compiler will issue a warning.</p>
<p>In functions declared with the <code>[[nodiscard]]</code> attribute, if the return value is not used, the compiler will emit a warning to alert developers to check their code logic. This can help developers identify potential errors and improve code maintainability.</p>
<p>Using the <code>[[nodiscard]]</code> attribute can help developers avoid common mistakes such as:</p>
<ul>
<li>  Missing error checks</li>
<li>  Incorrect use of return values</li>
<li>  Ignoring function return values</li>
</ul>
<p>Here is an example using the <code>[[nodiscard]]</code> attribute:</p>
<p><code>[[nodiscard]] int myFunction();</code></p>
<p>In this example, the <code>myFunction()</code> function uses the <code>[[nodiscard]]</code> attribute to declare that its return value should be used. If developers do not make use of the return value, the compiler will issue a warning to alert developers to check if the code is correct.</p>
<p>It is important to note that the <code>[[nodiscard]]</code> attribute is only applicable to function return values and cannot be applied to variables or other types of expressions.</p>
<p><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2023/20230324200815.png"></p>
<h2 id="C99-VAL-are-turing-complete"><a href="#C99-VAL-are-turing-complete" class="headerlink" title="C99 VAL are turing complete"></a>C99 VAL are turing complete</h2><ul>
<li><a target="_blank" rel="noopener" href="https://lemon.rip/w/c99-vla-tricks/">C99 doesn’t need function bodies, or ‘VLAs are Turing complete’</a></li>
</ul>
<h2 id="Disable-specific-numbered-warnings"><a href="#Disable-specific-numbered-warnings" class="headerlink" title="Disable specific numbered warnings"></a>Disable specific numbered warnings</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> <span class="keyword">warning</span>(push)</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> <span class="keyword">warning</span>(disable:4701)</span></span><br><span class="line"> <span class="comment">// warning code</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> <span class="keyword">warning</span>(pop)</span></span><br></pre></td></tr></table></figure>

<h2 id="Why-can’t-a-constructor-take-an-address"><a href="#Why-can’t-a-constructor-take-an-address" class="headerlink" title="Why can’t a constructor take an address?"></a>Why can’t a constructor take an address?</h2><p>C++ provides member pointer operations that can be used to get pointers to data members or member functions:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">A</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">A</span>()&#123;&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">void</span>(A::*func)() = &amp;A::func;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>However, the C++ standard states that addresses cannot be taken for constructors. Why is that?</p>
<p>Is it because constructors have no return value, so they can’t use function pointer syntax? Actually, that’s not the case; the compiler generates a function for the constructor during compilation. For example, in LLVM-IR:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">; Function Attrs: nounwind uwtable</span><br><span class="line">define linkonce_odr <span class="type">void</span> @_ZN1AC2Ev(%<span class="keyword">struct</span>.A* %<span class="keyword">this</span>) unnamed_addr #<span class="number">4</span> comdat align <span class="number">2</span> &#123;</span><br><span class="line">entry:</span><br><span class="line">  %<span class="keyword">this</span>.addr = alloca %<span class="keyword">struct</span>.A*, align <span class="number">8</span></span><br><span class="line">  store %<span class="keyword">struct</span>.A* %<span class="keyword">this</span>, %<span class="keyword">struct</span>.A** %<span class="keyword">this</span>.addr, align <span class="number">8</span></span><br><span class="line">  %this1 = load %<span class="keyword">struct</span>.A*, %<span class="keyword">struct</span>.A** %<span class="keyword">this</span>.addr</span><br><span class="line">  ret <span class="type">void</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This is the same as for regular functions.</p>
<p>However, constructors possess some unique characteristics:</p>
<ol>
<li>No return value at the syntactic level</li>
<li>Objects are in an incomplete state before the constructor executes</li>
</ol>
<p>I suspect that because the object is merely a chaos of memory before execution, it needs to initialize critical information: constructing base class subobjects/polymorphic implementations, etc.</p>
<h2 id="Type-extraction-via-template-specialization"><a href="#Type-extraction-via-template-specialization" class="headerlink" title="Type extraction via template specialization"></a>Type extraction via template specialization</h2><p>In UE, the <code>TStructOpsTypeTraits</code> template extracts the tags of each type in this manner.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">TYPE_NAME</span>&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">TStructOpsTypeTraitsBase</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">enum</span>&#123;</span><br><span class="line">		WithOne = <span class="literal">false</span>,</span><br><span class="line">		WithTwo = <span class="literal">false</span>,</span><br><span class="line">		WithThree = <span class="literal">false</span></span><br><span class="line">	&#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">TYPE_NAME</span>&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">TStructOpsTypeTraits</span>:<span class="keyword">public</span> TStructOpsTypeTraitsBase&lt;TYPE_NAME&gt;&#123;&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">TStructOpsTypeTraits</span>&lt;A&gt;:<span class="keyword">public</span> TStructOpsTypeTraitsBase&lt;A&gt;</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">enum</span>&#123;</span><br><span class="line">		WithThree = <span class="literal">true</span></span><br><span class="line">	&#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, TStructOpsTypeTraits&lt;A&gt;::WithOne ? <span class="string">&quot;true&quot;</span>:<span class="string">&quot;false&quot;</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, TStructOpsTypeTraits&lt;A&gt;::WithTwo ? <span class="string">&quot;true&quot;</span>:<span class="string">&quot;false&quot;</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, TStructOpsTypeTraits&lt;A&gt;::WithThree ? <span class="string">&quot;true&quot;</span>:<span class="string">&quot;false&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Friendship-cannot-be-inherited"><a href="#Friendship-cannot-be-inherited" class="headerlink" title="Friendship cannot be inherited"></a>Friendship cannot be inherited</h2><p>In [ISO/IEC 14882:2014], the standard states that friendship cannot be inherited or transferred:</p>
<blockquote>
<p>Friendship is neither inherited nor transitive.</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> &#123;</span><br><span class="line">	<span class="keyword">friend</span> <span class="keyword">class</span> <span class="title class_">B</span>;</span><br><span class="line">	<span class="type">int</span> a;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span> &#123;</span><br><span class="line">	<span class="keyword">friend</span> <span class="keyword">class</span> <span class="title class_">C</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">C</span> &#123;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">f</span><span class="params">(A* p)</span> </span>&#123;</span><br><span class="line">		p-&gt;a++; <span class="comment">// error: C is not a friend of A</span></span><br><span class="line">		<span class="comment">// despite being a friend of a friend</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">D</span> : <span class="keyword">public</span> B</span><br><span class="line">&#123;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">f</span><span class="params">(A* p)</span> </span>&#123;</span><br><span class="line">		p-&gt;a++; <span class="comment">// error: D is not a friend of A</span></span><br><span class="line">		<span class="comment">// despite being derived from a friend</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="Scoped-enum"><a href="#Scoped-enum" class="headerlink" title="Scoped enum"></a>Scoped enum</h2><p>C++11 introduced the <code>scoped enum</code>:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum class</span> <span class="title class_">EClassEnum</span>&#123;</span><br><span class="line">	A = <span class="number">0</span>,</span><br><span class="line">	B,</span><br><span class="line">	C</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>Why was this syntax introduced? Because prior to C++11, the definitions of enum values were located within the entire enclosing namespace. The C++ standard states:</p>
<blockquote>
<p>[ISO/IEC 14882:2014 §7.2]The enumeration type declared with an enum-key of only enum is an unscoped enumeration, and its enumerators are unscoped enumerators.</p>
</blockquote>
<p>The following code would produce a redefinition error:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">ENormalEnum</span>&#123;</span><br><span class="line">	A = <span class="number">0</span>,</span><br><span class="line">	B,</span><br><span class="line">	C</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">enum class</span> <span class="title class_">EOtherEnum</span>&#123;</span><br><span class="line">	A = <span class="number">0</span>,</span><br><span class="line">	B,</span><br><span class="line">	C</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>Therefore, when writing code, it is common to use a namespace to differentiate:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> ENamespaceEnum</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">enum</span> <span class="title class_">Type</span></span><br><span class="line">  &#123;</span><br><span class="line">    A = <span class="number">0</span>,</span><br><span class="line">    B,</span><br><span class="line">    C</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>Since the values of the <code>Type</code> enumeration are located within the current namespace, they can be used in the following manner:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ENamespaceEnum::A;</span><br><span class="line">ENamespaceEnum::B;</span><br><span class="line">ENamespaceEnum::C;</span><br></pre></td></tr></table></figure>
<p>This is essentially a form of weakly-typed enumeration; the enum itself is not a type. Thus, C++11 introduced the <code>Scoped Enum</code>, which can be understood as a strongly-typed enumeration:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum class</span> <span class="title class_">EScopedEnum</span>&#123;</span><br><span class="line">	A = <span class="number">0</span>,</span><br><span class="line">	B,</span><br><span class="line">	C</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>Using it allows for the same effect as the previously used <code>namespace</code> form.</p>
<p>The values of Scoped Enumeration can also be explicitly converted to integral types:</p>
<blockquote>
<p>[ISO/IEC 14882:2014 §5.2.9]A value of a scoped enumeration type (7.2) can be explicitly converted to an integral type.</p>
</blockquote>
<p>Moreover, if the underlying type of the scoped enum is not explicitly specified, its default underlying type is <code>int</code>:</p>
<blockquote>
<p>[ISO/IEC 14882:2014 §7.2]Each enumeration also has an underlying type. The underlying type can be explicitly speciﬁed using enum-base; if not explicitly speciﬁed, the underlying type of a scoped enumeration type is int.</p>
</blockquote>
<p>In LLVM, the handling of Scoped enums is done in the compiler frontend. The following code generates the IR:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">ENormalEnum</span>&#123;</span><br><span class="line">	A = <span class="number">0</span>,</span><br><span class="line">	B,</span><br><span class="line">	C</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">enum class</span> <span class="title class_">EScopedEnum</span>&#123;</span><br><span class="line">	A = <span class="number">0</span>,</span><br><span class="line">	B,</span><br><span class="line">	C</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;A:%d,B:%d,C:%d\n&quot;</span>, A, B, C);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;A:%d,B:%d,C:%d\n&quot;</span>, EScopedEnum::A, EScopedEnum::B, EScopedEnum::C);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The LLVM-IR for the main function:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">; Function Attrs: uwtable</span><br><span class="line">define i32 @main() #3 &#123;</span><br><span class="line">entry:</span><br><span class="line">  %call = call i32 (i8*, ...) @_Z6printfPKcz(i8* getelementptr inbounds ([16 x i8], [16 x i8]* @.str, i32 0, i32 0), i32 0, i32 1, i32 2)</span><br><span class="line">  %call1 = call i32 (i8*, ...) @_Z6printfPKcz(i8* getelementptr inbounds ([16 x i8], [16 x i8]* @.str, i32 0, i32 0), i32 0, i32 1, i32 2)</span><br><span class="line">  ret i32 0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>No symbol information is retained when generating IR, only constants remain.</p>
<h2 id="LoadLibrary-faild"><a href="#LoadLibrary-faild" class="headerlink" title="LoadLibrary faild"></a>LoadLibrary faild</h2><p><code>GetLastError</code> gets the error code:</p>
<ul>
<li>126: The dependent DLL is not found.</li>
<li>127: The DLL was found, but the required symbol within the DLL is not found, usually indicating a version issue.</li>
<li>193: Invalid DLL file, please check if the DLL file is normal and if x86/x64 match.</li>
</ul>
<h2 id="Attention-when-using-in-Preprocessing"><a href="#Attention-when-using-in-Preprocessing" class="headerlink" title="Attention when using ## in Preprocessing"></a>Attention when using ## in Preprocessing</h2><p>The following code compiles fine with MSVC:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> DEFINE_GAME_EXTENSION_TYPE_VALUE_BY_KEY(ReturnType, InGetFuncName) \</span></span><br><span class="line"><span class="meta">	bool GetGameExtension##ReturnType##ValueByKey(const FString&amp; InKey, ##ReturnType##&amp; OutValue)\</span></span><br><span class="line"><span class="meta">	&#123;\</span></span><br><span class="line"><span class="meta">		bool bLoadIniValueStatus = GConfig-&gt;##InGetFuncName##(\</span></span><br><span class="line"><span class="meta">			GAME_EXTENSION_SETTINGS_SECTION,\</span></span><br><span class="line"><span class="meta">			*InKey,\</span></span><br><span class="line"><span class="meta">			OutValue,\</span></span><br><span class="line"><span class="meta">			GAME_EXTENSION_SETTINGS_INI_FILE\</span></span><br><span class="line"><span class="meta">		);\</span></span><br><span class="line"><span class="meta">		return bLoadIniValueStatus;\</span></span><br><span class="line"><span class="meta">	&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">DEFINE_GAME_EXTENSION_TYPE_VALUE_BY_KEY</span>(FString, GetString);</span><br></pre></td></tr></table></figure>

<p>However, it produces errors in GCC/Clang:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Preprocess.cpp:<span class="number">16</span>:<span class="number">1</span>: error: pasting formed <span class="string">&#x27;,FString&#x27;</span>, <span class="function">an invalid preprocessing token</span></span><br><span class="line"><span class="function"><span class="title">DEFINE_GAME_EXTENSION_TYPE_VALUE_BY_KEY</span><span class="params">(FString, GetString)</span></span>;</span><br><span class="line">^</span><br><span class="line">Preprocess.cpp:<span class="number">5</span>:<span class="number">69</span>: note: expanded from macro <span class="string">&#x27;DEFINE_GAME_EXTENSION_TYPE_VALUE_BY_KEY&#x27;</span></span><br><span class="line">        <span class="type">bool</span> GetGameExtension##ReturnType##<span class="built_in">ValueByKey</span>(<span class="type">const</span> FString&amp; InKey, ##ReturnType##&amp; OutValue)\</span><br><span class="line">                                                                           ^</span><br><span class="line">Preprocess.cpp:<span class="number">16</span>:<span class="number">1</span>: error: pasting formed <span class="string">&#x27;FString&amp;&#x27;</span>, an invalid preprocessing token</span><br><span class="line">Preprocess.cpp:<span class="number">5</span>:<span class="number">81</span>: note: expanded from macro <span class="string">&#x27;DEFINE_GAME_EXTENSION_TYPE_VALUE_BY_KEY&#x27;</span></span><br><span class="line">        <span class="type">bool</span> GetGameExtension##ReturnType##<span class="built_in">ValueByKey</span>(<span class="type">const</span> FString&amp; InKey, ##ReturnType##&amp; OutValue)\</span><br><span class="line">                                                                                       ^</span><br><span class="line">Preprocess.cpp:<span class="number">16</span>:<span class="number">1</span>: error: pasting formed <span class="string">&#x27;-&gt;GetString&#x27;</span>, an invalid preprocessing token</span><br><span class="line">Preprocess.cpp:<span class="number">7</span>:<span class="number">39</span>: note: expanded from macro <span class="string">&#x27;DEFINE_GAME_EXTENSION_TYPE_VALUE_BY_KEY&#x27;</span></span><br><span class="line">                <span class="type">bool</span> bLoadIniValueStatus = GConfig-&gt;##InGetFuncName##(\</span><br><span class="line">                                                    ^</span><br><span class="line">Preprocess.cpp:<span class="number">16</span>:<span class="number">1</span>: error: pasting formed <span class="string">&#x27;GetString(&#x27;</span>, an invalid preprocessing token</span><br><span class="line">Preprocess.cpp:<span class="number">7</span>:<span class="number">54</span>: note: expanded from macro <span class="string">&#x27;DEFINE_GAME_EXTENSION_TYPE_VALUE_BY_KEY&#x27;</span></span><br><span class="line">                <span class="type">bool</span> bLoadIniValueStatus = GConfig-&gt;##InGetFuncName##(\</span><br><span class="line">                                                                   ^</span><br><span class="line"><span class="number">4</span> errors generated.</span><br></pre></td></tr></table></figure>

<p>This is due to GCC/Clang requiring that the result of preprocessing must consist of an <strong>already defined symbol</strong>. MSVC behaves differently in this regard, and the solution is to remove <code>##</code> in places where string concatenation is not occurring:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> DEFINE_GAME_EXTENSION_TYPE_VALUE_BY_KEY(ReturnType, InGetFuncName) \</span></span><br><span class="line"><span class="meta">	bool GetGameExtension##ReturnType##ValueByKey(const FString&amp; InKey, ReturnType&amp; OutValue)\</span></span><br><span class="line"><span class="meta">	&#123;\</span></span><br><span class="line"><span class="meta">		OutValue = ReturnType&#123;&#125;;\</span></span><br><span class="line"><span class="meta">		bool bLoadIniValueStatus = GConfig-&gt;InGetFuncName(\</span></span><br><span class="line"><span class="meta">			GAME_EXTENSION_SETTINGS_SECTION,\</span></span><br><span class="line"><span class="meta">			*InKey,\</span></span><br><span class="line"><span class="meta">			OutValue,\</span></span><br><span class="line"><span class="meta">			GAME_EXTENSION_SETTINGS_INI_FILE\</span></span><br><span class="line"><span class="meta">		);\</span></span><br><span class="line"><span class="meta">		return bLoadIniValueStatus;\</span></span><br><span class="line"><span class="meta">	&#125;</span></span><br></pre></td></tr></table></figure>

<p>Related issues:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/46356185/pasting-formed-an-invalid-processing-token">Pasting formed an invalid processing token ‘.’</a></li>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/50114062/error-pasting-formed-with-invalid-preprocessing-token">Error: Pasting formed with invalid preprocessing token</a></li>
</ul>
<h2 id="Implementation-of-delete-in-C"><a href="#Implementation-of-delete-in-C" class="headerlink" title="Implementation of delete[] in C++"></a>Implementation of delete[] in C++</h2><blockquote>
<p>Note: Different compiler implementations may vary; I’m using Clang 7.0.0 x86_64-w64-windows-gnu.</p>
</blockquote>
<p>In C++, we can allocate memory on the heap using <code>new</code> and <code>new[]</code>. But have you considered the following question:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">IntClass</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="type">int</span> v;</span><br><span class="line">	~<span class="built_in">IntClass</span>()&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	IntClass *i = <span class="keyword">new</span> IntClass[<span class="number">10</span>];</span><br><span class="line"></span><br><span class="line">	<span class="keyword">delete</span>[] i;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Since <code>i</code> is just a regular pointer, it has no type information. So how does <code>delete[]</code> know how much memory to deallocate?</p>
<p>Somewhere, the length information for <code>i</code> must definitely be stored! Let’s summon our IR code:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">; Function Attrs: noinline norecurse optnone uwtable</span><br><span class="line">define dso_local i32 @<span class="built_in">main</span>() #<span class="number">4</span> &#123;</span><br><span class="line">  %<span class="number">1</span> = alloca i32, align <span class="number">4</span></span><br><span class="line">  %<span class="number">2</span> = alloca %<span class="keyword">class</span>.IntClass*, align <span class="number">8</span></span><br><span class="line">  store i32 <span class="number">0</span>, i32* %<span class="number">1</span>, align <span class="number">4</span></span><br><span class="line">  %<span class="number">3</span> = call i8* @_Znay(i64 <span class="number">48</span>) #<span class="number">8</span></span><br><span class="line">  %<span class="number">4</span> = bitcast i8* %<span class="number">3</span> to i64*</span><br><span class="line">  store i64 <span class="number">10</span>, i64* %<span class="number">4</span>, align <span class="number">8</span></span><br><span class="line">  %<span class="number">5</span> = getelementptr inbounds i8, i8* %<span class="number">3</span>, i64 <span class="number">8</span></span><br><span class="line">  %<span class="number">6</span> = bitcast i8* %<span class="number">5</span> to %<span class="keyword">class</span>.IntClass*</span><br><span class="line">  store %<span class="keyword">class</span>.IntClass* %<span class="number">6</span>, %<span class="keyword">class</span>.IntClass** %<span class="number">2</span>, align <span class="number">8</span></span><br><span class="line">  %<span class="number">7</span> = load %<span class="keyword">class</span>.IntClass*, %<span class="keyword">class</span>.IntClass** %<span class="number">2</span>, align <span class="number">8</span></span><br><span class="line">  %<span class="number">8</span> = icmp eq %<span class="keyword">class</span>.IntClass* %<span class="number">7</span>, null</span><br><span class="line">  br i1 %<span class="number">8</span>, label %<span class="number">21</span>, label %<span class="number">9</span></span><br><span class="line"></span><br><span class="line">; &lt;label&gt;:<span class="number">9</span>:                                      ; preds = %<span class="number">0</span></span><br><span class="line">  %<span class="number">10</span> = bitcast %<span class="keyword">class</span>.IntClass* %<span class="number">7</span> to i8*</span><br><span class="line">  %<span class="number">11</span> = getelementptr inbounds i8, i8* %<span class="number">10</span>, i64 <span class="number">-8</span></span><br><span class="line">  %<span class="number">12</span> = bitcast i8* %<span class="number">11</span> to i64*</span><br><span class="line">  %<span class="number">13</span> = load i64, i64* %<span class="number">12</span>, align <span class="number">4</span></span><br><span class="line">  %<span class="number">14</span> = getelementptr inbounds %<span class="keyword">class</span>.IntClass, %<span class="keyword">class</span>.IntClass* %<span class="number">7</span>, i64 %<span class="number">13</span></span><br><span class="line">  %<span class="number">15</span> = icmp eq %<span class="keyword">class</span>.IntClass* %<span class="number">7</span>, %<span class="number">14</span></span><br><span class="line">  br i1 %<span class="number">15</span>, label %<span class="number">20</span>, label %<span class="number">16</span></span><br><span class="line"></span><br><span class="line">; &lt;label&gt;:<span class="number">16</span>:                                     ; preds = %<span class="number">16</span>, %<span class="number">9</span></span><br><span class="line">  %<span class="number">17</span> = phi %<span class="keyword">class</span>.IntClass* [ %<span class="number">14</span>, %<span class="number">9</span> ], [ %<span class="number">18</span>, %<span class="number">16</span> ]</span><br><span class="line">  %<span class="number">18</span> = getelementptr inbounds %<span class="keyword">class</span>.IntClass, %<span class="keyword">class</span>.IntClass* %<span class="number">17</span>, i64 <span class="number">-1</span></span><br><span class="line">  call <span class="type">void</span> @_ZN8IntClassD2Ev(%<span class="keyword">class</span>.IntClass* %<span class="number">18</span>) #<span class="number">3</span></span><br><span class="line">  %<span class="number">19</span> = icmp eq %<span class="keyword">class</span>.IntClass* %<span class="number">18</span>, %<span class="number">7</span></span><br><span class="line">  br i1 %<span class="number">19</span>, label %<span class="number">20</span>, label %<span class="number">16</span></span><br><span class="line"></span><br><span class="line">; &lt;label&gt;:<span class="number">20</span>:                                     ; preds = %<span class="number">16</span>, %<span class="number">9</span></span><br><span class="line">  call <span class="type">void</span> @_ZdaPv(i8* %<span class="number">11</span>) #<span class="number">9</span></span><br><span class="line">  br label %<span class="number">21</span></span><br><span class="line"></span><br><span class="line">; &lt;label&gt;:<span class="number">21</span>:                                     ; preds = %<span class="number">20</span>, %<span class="number">0</span></span><br><span class="line">  ret i32 <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>It can be seen that the compiler allocates 48 bytes of memory for <code>new IntClass[10]</code> via <code>@_Znay(i64 48)</code>.</p>
<p>However, if calculated as <code>sizeof(IntClass)*10</code>, it should have only allocated 40 bytes of memory. The extra 8 bytes are used to store the length information of the array.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">%<span class="number">3</span> = call i8* @_Znay(i64 <span class="number">48</span>) #<span class="number">8</span></span><br><span class="line">%<span class="number">4</span> = bitcast i8* %<span class="number">3</span> to i64*</span><br><span class="line">store i64 <span class="number">10</span>, i64* %<span class="number">4</span>, align <span class="number">8</span></span><br><span class="line">%<span class="number">5</span> = getelementptr inbounds i8, i8* %<span class="number">3</span>, i64 <span class="number">8</span></span><br><span class="line">%<span class="number">6</span> = bitcast i8* %<span class="number">5</span> to %<span class="keyword">class</span>.IntClass*</span><br></pre></td></tr></table></figure>

<p>It shows that the array length is written into the first 8 bytes of the allocated memory, and the real objects start getting allocated after these 8 bytes.</p>
<p>The address we actually get for <code>i</code> is the offset from the 64-bit memory storing the array length, written before the first element.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Each x represents a byte; the memory layout created by new IntClass[10]</span></span><br><span class="line">|xxxxxxxx|xxxx|xxxx|xxxx|xxxx|xxxx|xxxx|xxxx|xxxx|xxxx|xxxx|</span><br></pre></td></tr></table></figure>

<p>Since we’ve identified where it’s stored, we can modify it (prior to modification, calling <code>delete[] i;</code> will invoke the destructor 10 times):</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">IntClass *i = <span class="keyword">new</span> IntClass[<span class="number">10</span>];</span><br><span class="line"><span class="type">int64_t</span> *ArrayLength = (<span class="type">int64_t</span>*)((<span class="type">char</span>*)(i)<span class="number">-8</span>);</span><br><span class="line">*ArrayLength = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">delete</span>[] i;</span><br></pre></td></tr></table></figure>

<p>After the modification, <code>delete[] i;</code> will only call the destructor once, confirming our assumption.</p>
<h2 id="Memory-Breakpoints-in-VS"><a href="#Memory-Breakpoints-in-VS" class="headerlink" title="Memory Breakpoints in VS"></a>Memory Breakpoints in VS</h2><p>In some debugging situations with VS, you may need to know when some objects are modified. If you debug by stepping through one point at a time, it can be inconvenient. In such cases, you can use VS’s <code>Data Breakpoint</code>:</p>
<p>The operation to add a <code>Data Breakpoint</code> is <code>Debug</code>-<code>New BreakPoint</code>-<code>Data Breakpoint</code> (or within the <code>Breakpoint</code> window):</p>
<p><img data-src="https://img.imzlp.com/imgs/zlp/blog/notes/cpp/index/VS/vs-new-data-breakpoint.webp"></p>
<p>You need to enter the memory address to set the breakpoint; you can enter the address expression of the object (<code>&amp;Test</code>), if you want to set a breakpoint for a non-global object, you can input the memory address directly.</p>
<p>To get a memory address for an object, you can add an address expression for that object under <code>Watch</code> (using <code>&amp;ival</code> or <code>&amp;this-&gt;ival</code>):</p>
<p><img data-src="https://img.imzlp.com/imgs/zlp/blog/notes/cpp/index/VS/vs-debug-watch-window.webp"></p>
<p>The <code>Value</code> will give you the memory address of the object.</p>
<p>Once you have the memory address, it can be filled into the <code>Data Breakpoint</code> in the <code>Address</code> section, and you specify the data size (optional 1/2/4/8):</p>
<p><img data-src="https://img.imzlp.com/imgs/zlp/blog/notes/cpp/index/VS/vs-new-data-breakpoint-specify-address.webp"></p>
<p>When the data at that address is modified, it will prompt that the memory breakpoint has been triggered:</p>
<p><img data-src="https://img.imzlp.com/imgs/zlp/blog/notes/cpp/index/VS/vs-tragger-data-breakpoint.webp"></p>
<h2 id="Difference-between-move-and-forward"><a href="#Difference-between-move-and-forward" class="headerlink" title="Difference between move and forward"></a>Difference between move and forward</h2><p><code>std::move</code> and <code>std::forward</code> are both functions defined in <code>&lt;utility&gt;</code>.</p>
<table>
<thead>
<tr>
<th>function</th>
<th>describe</th>
</tr>
</thead>
<tbody><tr>
<td>x2=forward(x)</td>
<td>x2 is an rvalue, x cannot be an lvalue; does not throw an exception</td>
</tr>
<tr>
<td>x2=move(x)</td>
<td>x2 is an rvalue; does not throw an exception</td>
</tr>
<tr>
<td>x2=move_if_noexcept(x)</td>
<td>if x2 is movable, then x2=move(x); else x2=x; does not throw an exception</td>
</tr>
</tbody></table>
<p><code>std::move</code> performs a simple conversion to rvalue:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function">remove_reference&lt;T&gt;&amp;&amp; <span class="title">move</span><span class="params">(T&amp;&amp; t)</span> <span class="keyword">noexcept</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">static_cast</span>&lt;remove_reference&lt;T&gt;&amp;&amp;&gt;(t);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Indeed, <code>move</code> should have been named <code>rvalue</code>; it doesn’t actually move anything; rather, it generates an rvalue from the argument so that the object it points to can be moved.</p>
<p>When we use <code>move</code>, we inform the compiler that this object is no longer to be used in this context, allowing its value to be moved, leaving an empty object. The simplest example is the implementation of <code>swap</code>.</p>
<p><code>std::forward</code> generates an rvalue from an rvalue:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function">T&amp;&amp; <span class="title">forward</span><span class="params">(remove_reference&lt;T&gt;&amp; t)</span> <span class="keyword">noexcept</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">static_cast</span>&lt;T&amp;&amp;&gt;(t);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function">T&amp;&amp; <span class="title">forward</span><span class="params">(remove_reference&lt;T&gt;&amp;&amp; t)</span> <span class="keyword">noexcept</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">static_assert</span>(!is_lvalue_reference&lt;T&gt;,<span class="string">&quot;forward of value&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">static_cast</span>&lt;T&amp;&amp;&gt;(t);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>These two forward functions will always provide the choice between move and forward based on overload resolution. Any lvalue will be handled by the first version, while any rvalue will be handled by the second version.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> i=<span class="number">7</span>;</span><br><span class="line">forward(i); <span class="comment">// Calls the first version</span></span><br><span class="line">forward(<span class="number">7</span>); <span class="comment">// Calls the second version</span></span><br></pre></td></tr></table></figure>

<p>The assertion in the second version prevents the second version from being called with a left value using explicit template arguments.</p>
<p>The typical use of <code>forward</code> is to perfectly forward an argument to another function.</p>
<p>When the system steals the representation of an object through move operations, use <code>move</code>; when you want to forward an object, use <code>forward</code>. Thus, <code>forward</code> is always safe, while <code>move</code> marks <code>x</code> for destruction, so caution should be exercised when using it. After calling <code>std::move(x)</code>, the only valid use of <code>x</code> is for destruction or assignment purposes.</p>
<h2 id="Overloading-Rules-for-rvalue-and-lvalue"><a href="#Overloading-Rules-for-rvalue-and-lvalue" class="headerlink" title="Overloading Rules for rvalue and lvalue"></a>Overloading Rules for rvalue and lvalue</h2><h3 id="Implementing-non-const-lvalue-version"><a href="#Implementing-non-const-lvalue-version" class="headerlink" title="Implementing non-const lvalue version"></a>Implementing non-const lvalue version</h3><p>If a class only implements:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">A</span>(A&amp;)&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>Then the class can only be called with <code>lvalue</code> but not with <code>rvalue</code>. As shown in the following code:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">A</span>()&#123;<span class="built_in">printf</span>(<span class="string">&quot;A();\n&quot;</span>);&#125;</span><br><span class="line">	<span class="built_in">A</span>(A&amp; In)&#123;<span class="built_in">printf</span>(<span class="string">&quot;A(A&amp; In);\n&quot;</span>);&#125;</span><br><span class="line">	~<span class="built_in">A</span>()&#123;<span class="built_in">printf</span>(<span class="string">&quot;~A();\n&quot;</span>);&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	A tmpA;</span><br><span class="line">	A tmpB = std::<span class="built_in">move</span>(tmpA);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The following error will occur:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\visionsmile\Desktop\cpp\rvalue.cpp:31:4: error: no matching constructor <span class="keyword">for</span> initialization of <span class="string">&#x27;A&#x27;</span></span><br><span class="line">        A tmpB = std::move(tmpA);</span><br><span class="line">          ^      ~~~~~~~~~~~~~~~</span><br><span class="line">C:\Users\visionsmile\Desktop\cpp\rvalue.cpp:15:2: note: candidate constructor not viable: expects an l-value <span class="keyword">for</span> 1st argument</span><br><span class="line">        A(A&amp; In)</span><br><span class="line">        ^</span><br><span class="line">C:\Users\visionsmile\Desktop\cpp\rvalue.cpp:12:2: note: candidate constructor not viable: requires 0 arguments, but 1 was provided</span><br><span class="line">        <span class="function"><span class="title">A</span></span>()&#123;</span><br><span class="line">        ^</span><br><span class="line">1 error generated.</span><br></pre></td></tr></table></figure>

<h3 id="Implementing-const-lvalue-version"><a href="#Implementing-const-lvalue-version" class="headerlink" title="Implementing const lvalue version"></a>Implementing const lvalue version</h3><p>If a const version is implemented:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">A</span>(<span class="type">const</span> A&amp; In)&#123;<span class="built_in">printf</span>(<span class="string">&quot;A(const A&amp; In);\n&quot;</span>);&#125;</span><br></pre></td></tr></table></figure>

<p>Then it can be called both with rvalue and with lvalue.</p>
<h3 id="Only-implementing-rvalue-version"><a href="#Only-implementing-rvalue-version" class="headerlink" title="Only implementing rvalue version"></a>Only implementing rvalue version</h3><p>If the class contains only rvalue function versions:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">A</span>(A&amp;&amp; rIn)&#123;<span class="built_in">printf</span>(<span class="string">&quot;A(A&amp;&amp; In);\n&quot;</span>);&#125;</span><br></pre></td></tr></table></figure>

<p>Then it can only be called with rvalue, but not with lvalue.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">A</span>()&#123;<span class="built_in">printf</span>(<span class="string">&quot;A();\n&quot;</span>);&#125;</span><br><span class="line">	<span class="built_in">A</span>(A&amp;&amp; rIn)&#123;<span class="built_in">printf</span>(<span class="string">&quot;A(A&amp;&amp; In);\n&quot;</span>);&#125;</span><br><span class="line">	~<span class="built_in">A</span>()&#123;<span class="built_in">printf</span>(<span class="string">&quot;~A();\n&quot;</span>);&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	A tmpA;</span><br><span class="line">	A tmpB = tmpA;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This will cause the following compile error:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\visionsmile\Desktop\cpp\rvalue.cpp:31:4: error: call to implicitly-deleted copy constructor of <span class="string">&#x27;A&#x27;</span></span><br><span class="line">        A tmpB = tmpA;</span><br><span class="line">          ^      ~~~~</span><br><span class="line">C:\Users\visionsmile\Desktop\cpp\rvalue.cpp:19:2: note: copy constructor is implicitly deleted because <span class="string">&#x27;A&#x27;</span> has a user-declared move constructor</span><br><span class="line">        A(A&amp;&amp; rIn)</span><br><span class="line">        ^</span><br><span class="line">1 error generated.</span><br></pre></td></tr></table></figure>

<h3 id="Having-both-rvalue-and-lvalue-versions"><a href="#Having-both-rvalue-and-lvalue-versions" class="headerlink" title="Having both rvalue and lvalue versions"></a>Having both rvalue and lvalue versions</h3><p>If both rvalue and lvalue versions are provided, it can distinguish capabilities serving <code>rvalue</code> and <code>lvalue</code>.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">A</span>()&#123;<span class="built_in">printf</span>(<span class="string">&quot;A();\n&quot;</span>);&#125;</span><br><span class="line">    <span class="built_in">A</span>(<span class="type">const</span> A&amp; In)&#123;<span class="built_in">printf</span>(<span class="string">&quot;A(const A&amp; In);\n&quot;</span>);&#125;</span><br><span class="line">	<span class="built_in">A</span>(A&amp;&amp; rIn)&#123;<span class="built_in">printf</span>(<span class="string">&quot;A(A&amp;&amp; In);\n&quot;</span>);&#125;</span><br><span class="line">	~<span class="built_in">A</span>()&#123;<span class="built_in">printf</span>(<span class="string">&quot;~A();\n&quot;</span>);&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	A tmpA;</span><br><span class="line">	A tmpB = tmpA;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h3><p>If the class does not provide move semantics and only offers regular copy constructors and copy assignment operators, rvalue references can invoke them.</p>
<p>Therefore, <code>std::move</code> means: call move semantics; otherwise, call copy semantics.</p>
<h2 id="rvalue-and-lvalue"><a href="#rvalue-and-lvalue" class="headerlink" title="rvalue and lvalue"></a>rvalue and lvalue</h2><p>rvalue (left value) refers to an expression of an object. Literally, left value means something that can be on the left side of an assignment operator. However, not all left values can be on the left side of an assignment operator; a left value may also refer to a constant.</p>
<p>To be supplemented.</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://thbecker.net/articles/rvalue_references/section_01.html">C++ Rvalue References Explained</a></li>
</ul>
<h2 id="C-Object-Destruction-Order"><a href="#C-Object-Destruction-Order" class="headerlink" title="C++ Object Destruction Order"></a>C++ Object Destruction Order</h2><p>The C++ standard stipulates that destruction occurs in reverse order of construction.</p>
<blockquote>
<p>[ISO/IEC 14882:2014 § 6.6] On exit from a scope (however accomplished), objects with automatic storage duration (3.7.3) that have been constructed in that scope are destroyed in the reverse order of their construction.</p>
</blockquote>
<ul>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/14688285/c-local-variable-destruction-order">C++ local variable destruction order</a></li>
</ul>
<h2 id="Postfix-amp-and-amp-amp-Modifiers-of-C-Functions"><a href="#Postfix-amp-and-amp-amp-Modifiers-of-C-Functions" class="headerlink" title="Postfix &amp; and &amp;&amp; Modifiers of C++ Functions"></a>Postfix &amp; and &amp;&amp; Modifiers of C++ Functions</h2><p>Consider the following example code:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function">T&amp; <span class="title">Get</span><span class="params">()</span> &amp;</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> value;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">T&amp;&amp; <span class="title">Get</span><span class="params">()</span> &amp;&amp;</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> std::<span class="built_in">move</span>(value);</span><br><span class="line">	&#125;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	T value;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>What is the role of the <code>&amp;</code> and <code>&amp;&amp;</code> modifiers after the <code>A::Get</code> function?</p>
<p>Essentially, these two functions have different return types, but their signatures only differ in return type, and since the signatures of class member functions do not include the return type, this results in a redefinition error. The purpose of these two modifiers is to make their signatures different.</p>
<p>The signature of class member functions consists of:</p>
<ul>
<li>name</li>
<li>parameter type list</li>
<li>the class of which the function is a member</li>
<li>cv-qualifiers (if any)</li>
<li>ref-qualifier (if any)</li>
</ul>
<p>The syntax description for the declaration part can be found in <strong>[ISO/IEC 14882:2014 § 8 Declarators]</strong>.</p>
<h2 id="Static-Linkage-Issue"><a href="#Static-Linkage-Issue" class="headerlink" title="Static Linkage Issue"></a>Static Linkage Issue</h2><p>In <code>global</code>/<code>namespace</code> scope, a static function/variable is available only in the translation unit (translation unit) where it is defined, and is not available in other translation units.</p>
<p>For instance, with three files:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// file.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">func</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// file.cpp</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;file.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">func</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Using the following command to compile:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Note that there are two translation units main.cpp/file.cpp</span></span><br><span class="line">$ clang++ main.cpp file.cpp -o main.exe</span><br></pre></td></tr></table></figure>

<p>A linking error will occur:</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">In file included from main.cpp:2:</span><br><span class="line">./file.h:3:13: warning: function &#x27;func&#x27; has internal linkage but is not defined [-Wundefined-internal]</span><br><span class="line">static void func();</span><br><span class="line">            ^</span><br><span class="line">main.cpp:6:5: note: used here</span><br><span class="line">    func();</span><br><span class="line">    ^</span><br><span class="line">1 warning generated.</span><br><span class="line">C:\Users\imzlp\AppData\Local\Temp\main-70cbfd.o:(.text+0x10): undefined reference to `func()&#x27;</span><br><span class="line">clang++.exe: error: linker command failed with exit code 1 (use -v to see invocation)</span><br></pre></td></tr></table></figure>

<p>This is because <code>func</code> is a <code>static</code> function, and is defined in the translation unit of <code>file.cpp</code>. Due to the <code>internal linkage</code> nature of <code>static</code> objects, the translation unit of <code>main.cpp</code> does not contain the definition of <code>func</code>, hence the linking error.</p>
<p>Knowing the reason, there are two solutions:</p>
<ol>
<li>Remove <code>static</code> from <code>func</code>;</li>
<li>Include the definition of <code>func</code> in all translation units where <code>func</code> is used.</li>
</ol>
<h2 id="Placement-new-Compilation-Errors"><a href="#Placement-new-Compilation-Errors" class="headerlink" title="Placement-new Compilation Errors"></a>Placement-new Compilation Errors</h2><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;operator new&#x27; : function does not take 2 arguments</span><br></pre></td></tr></table></figure>

<p>This error arises because <code>new.h</code> or <code>new</code> has not been included.</p>
<h2 id="The-Next-Big-Thing-C-20"><a href="#The-Next-Big-Thing-C-20" class="headerlink" title="The Next Big Thing: C++20"></a>The Next Big Thing: C++20</h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.linkedin.com/pulse/next-big-thing-c20-rainer-grimm">The Next Big Thing: C++20</a></li>
</ul>
<p>This article briefly introduces the history of C++ standards and trends for new standards.</p>
<h2 id="Variable-Optimized-and-Not-Available"><a href="#Variable-Optimized-and-Not-Available" class="headerlink" title="Variable Optimized and Not Available"></a>Variable Optimized and Not Available</h2><p>In VS debugging, sometimes you may find in the <code>Debug</code> window that <code>the variable has been optimized and is not available</code>, causing you to be unable to see the object’s value. Optimization can be disabled in the project’s settings in VS.<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/notes/cpp/index/VS/disable-optimization.webp"></p>
<h2 id="C5083-Error"><a href="#C5083-Error" class="headerlink" title="C5083 Error"></a>C5083 Error</h2><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">error C5038: data member &#x27;UTcpNetPeer::ConnectionState&#x27; will be initialized after data member &#x27;UTcpNetPeer::OpenedTime&#x27;</span><br><span class="line">error C5038: data member &#x27;UTcpNetPeer::bReceivedHeader&#x27; will be initialized after data member &#x27;UTcpNetPeer::Thread&#x27;</span><br><span class="line">error C5038: data member &#x27;UTcpNetPeer::TotalBytesSent&#x27; will be initialized after data member &#x27;UTcpNetPeer::bRun&#x27;</span><br><span class="line">error C5038: data member &#x27;UTcpNetPeer::RecvMessageDataRemaining&#x27; will be initialized after data member &#x27;UTcpNetPeer::ConnectionRetryTimes&#x27;</span><br><span class="line">error C5038: data member &#x27;UTcpNetPeer::ConnectionRetryTimes&#x27; will be initialized after data member &#x27;UTcpNetPeer::ConnectingTime&#x27;</span><br></pre></td></tr></table></figure>
<p>This shouldn’t be considered an actual error; it’s merely a warning due to UE 4.22’s high warnings level. This warning signifies that the order of initialization of data members in the constructor’s definition is different from that in the declaration, so it is advisable to correct it. However, if the amount of changes required is too large, you can disable warning <code>C5083</code>.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> <span class="keyword">warning</span> (disable:5038)</span></span><br></pre></td></tr></table></figure>

<h2 id="Property-Macros-in-VS"><a href="#Property-Macros-in-VS" class="headerlink" title="Property Macros in VS"></a>Property Macros in VS</h2><p>When configuring include paths or linking libraries in VS, you need to specify the paths, but absolute paths can be cumbersome. You can use property macros in VS for settings. Some common ones include:</p>
<ul>
<li><code>SolutionDir</code>: The path of the solution.</li>
<li><code>ProjectDir</code>: The path of the project.</li>
<li><code>ProjectName</code>: The name of the project.</li>
<li><code>Platform</code>: The platform (x86/x64, etc.)</li>
<li><code>Configuration</code>: The configuration (Debug/Release)</li>
<li><code>RuntimeLibrary</code>: The type of runtime <code>MT</code>/<code>MD</code></li>
<li>You can also include user-defined environment variables in the system, such as <code>$(BOOST)</code>.</li>
</ul>
<p>The usage is <code>$(VAR_NAME)</code>, for example, <code>$(SolutionDir)</code>.<br>Microsoft has a page that lists available property macros in VS: <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/cpp/build/reference/common-macros-for-build-commands-and-properties?view=vs-2019">Common macros for MSBuild commands and properties</a><br>In VS, you can also find the list of supported macros through <code>Project Properties</code>-<code>Configuration Properties</code>-<code>C/C++</code>-<code>General</code>-Edit<code>Additional Include Direcories</code>-<code>Macro</code>:<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/notes/cpp/index/VS/vs-environment-var-options.webp"></p>
<h2 id="Link-Error-When-Using-Win-Libraries-Without-Linking-Library"><a href="#Link-Error-When-Using-Win-Libraries-Without-Linking-Library" class="headerlink" title="Link Error When Using Win Libraries Without Linking Library"></a>Link Error When Using Win Libraries Without Linking Library</h2><p>When using <code>MessageBoxA</code> in the code, a linking error occurs:</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1&gt;------ Build started: Project: ELogging, Configuration: Debug x64 ------</span><br><span class="line">1&gt;   Creating library ..\..\Bin\x64\Debug\ELogging.lib and object ..\..\Bin\x64\Debug\ELogging.exp</span><br><span class="line">1&gt;Logging.obj : error LNK2019: unresolved external symbol __imp_MessageBoxA referenced in function &quot;public: void __cdecl Logging::WriteMsgs(enum LoggingEnum,char *,int,char *)&quot; (?WriteMsgs@Logging@@QEAAXW4LoggingEnum@@PEADH1@Z)</span><br><span class="line">1&gt;..\..\Bin\x64\Debug\ELogging.dll : fatal error LNK1120: 1 unresolved externals</span><br><span class="line">1&gt;Done building project &quot;ELogging.vcxproj&quot; -- FAILED.</span><br></pre></td></tr></table></figure>

<p>It states that the symbol <code>__imp_MessageBoxA</code> used in <code>WriteMsgs</code> is not defined.<br>This symbol is defined in <code>user32.lib</code>, which needs to be added to the project; it was initially thought that all Win libraries’ libs are linked by default, but that isn’t the case.</p>
<p>Related issues: <a target="_blank" rel="noopener" href="https://social.msdn.microsoft.com/Forums/vstudio/en-US/ef029daa-8ef9-46ee-90bd-b9e9516ab53b/junkobj-error-lnk2019-unresolved-external-symbol-impmessageboxa-referenced-in-function-main?forum=vclanguage">junk.obj : error LNK2019: unresolved external symbol __imp_MessageBoxA referenced in function main</a></p>
<h2 id="Link-Error-LINK1112-When-Introducing-External-Libraries"><a href="#Link-Error-LINK1112-When-Introducing-External-Libraries" class="headerlink" title="Link Error LINK1112 When Introducing External Libraries"></a>Link Error LINK1112 When Introducing External Libraries</h2><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">libboost_thread-vc140-mt-gd-1_62.lib(thread.obj) : fatal error LNK1112: module machine type &#x27;x86&#x27; conflicts with target machine type &#x27;x64&#x27;</span><br></pre></td></tr></table></figure>

<p>This error indicates that the target machine for the project being compiled is x64, while the referenced <code>libboost_thread-vc140-mt-gd-1_62.lib</code> is x86, resulting in this error.</p>
<h2 id="LINK2038-Link-Error-When-Importing-External-Libraries"><a href="#LINK2038-Link-Error-When-Importing-External-Libraries" class="headerlink" title="LINK2038 Link Error When Importing External Libraries"></a>LINK2038 Link Error When Importing External Libraries</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2</span>&gt;Generating Code...</span><br><span class="line"><span class="number">2</span>&gt;libboost_system-vc140-mt-gd<span class="number">-1</span>_62.<span class="built_in">lib</span>(error_code.obj) : error LNK2038: mismatch detected <span class="keyword">for</span> <span class="string">&#x27;RuntimeLibrary&#x27;</span>: value <span class="string">&#x27;MDd_DynamicDebug&#x27;</span> doesn<span class="number">&#x27;</span>t match value <span class="string">&#x27;MTd_StaticDebug&#x27;</span> in ELogging.obj</span><br><span class="line"><span class="number">2</span>&gt;libboost_date_time-vc140-mt-gd<span class="number">-1</span>_62.<span class="built_in">lib</span>(greg_month.obj) : error LNK2038: mismatch detected <span class="keyword">for</span> <span class="string">&#x27;RuntimeLibrary&#x27;</span>: value <span class="string">&#x27;MDd_DynamicDebug&#x27;</span> doesn<span class="number">&#x27;</span>t match value <span class="string">&#x27;MTd_StaticDebug&#x27;</span> in ELogging.obj</span><br><span class="line"><span class="number">2</span>&gt;libboost_filesystem-vc140-mt-gd<span class="number">-1</span>_62.<span class="built_in">lib</span>(path_traits.obj) : error LNK2038: mismatch detected <span class="keyword">for</span> <span class="string">&#x27;RuntimeLibrary&#x27;</span>: value <span class="string">&#x27;MDd_DynamicDebug&#x27;</span> doesn<span class="number">&#x27;</span>t match value <span class="string">&#x27;MTd_StaticDebug&#x27;</span> in ELogging.obj</span><br><span class="line"><span class="number">2</span>&gt;libboost_filesystem-vc140-mt-gd<span class="number">-1</span>_62.<span class="built_in">lib</span>(path.obj) : error LNK2038: mismatch detected <span class="keyword">for</span> <span class="string">&#x27;RuntimeLibrary&#x27;</span>: value <span class="string">&#x27;MDd_DynamicDebug&#x27;</span> doesn<span class="number">&#x27;</span>t match value <span class="string">&#x27;MTd_StaticDebug&#x27;</span> in ELogging.obj</span><br><span class="line"><span class="number">2</span>&gt;libboost_filesystem-vc140-mt-gd<span class="number">-1</span>_62.<span class="built_in">lib</span>(operations.obj) : error LNK2038: mismatch detected <span class="keyword">for</span> <span class="string">&#x27;RuntimeLibrary&#x27;</span>: value <span class="string">&#x27;MDd_DynamicDebug&#x27;</span> doesn<span class="number">&#x27;</span>t match value <span class="string">&#x27;MTd_StaticDebug&#x27;</span> in ELogging.obj</span><br><span class="line"><span class="number">2</span>&gt;libboost_filesystem-vc140-mt-gd<span class="number">-1</span>_62.<span class="built_in">lib</span>(codecvt_error_category.obj) : error LNK2038: mismatch detected <span class="keyword">for</span> <span class="string">&#x27;RuntimeLibrary&#x27;</span>: value <span class="string">&#x27;MDd_DynamicDebug&#x27;</span> doesn<span class="number">&#x27;</span>t match value <span class="string">&#x27;MTd_StaticDebug&#x27;</span> in ELogging.obj</span><br><span class="line"><span class="number">2</span>&gt;libboost_filesystem-vc140-mt-gd<span class="number">-1</span>_62.<span class="built_in">lib</span>(windows_file_codecvt.obj) : error LNK2038: mismatch detected <span class="keyword">for</span> <span class="string">&#x27;RuntimeLibrary&#x27;</span>: value <span class="string">&#x27;MDd_DynamicDebug&#x27;</span> doesn<span class="number">&#x27;</span>t match value <span class="string">&#x27;MTd_StaticDebug&#x27;</span> in ELogging.obj</span><br><span class="line"><span class="number">2</span>&gt;libboost_thread-vc140-mt-gd<span class="number">-1</span>_62.<span class="built_in">lib</span>(thread.obj) : error LNK2038: mismatch detected <span class="keyword">for</span> <span class="string">&#x27;RuntimeLibrary&#x27;</span>: value <span class="string">&#x27;MDd_DynamicDebug&#x27;</span> doesn<span class="number">&#x27;</span>t match value <span class="string">&#x27;MTd_StaticDebug&#x27;</span> in ELogging.obj</span><br><span class="line"><span class="number">2</span>&gt;libboost_thread-vc140-mt-gd<span class="number">-1</span>_62.<span class="built_in">lib</span>(tss_pe.obj) : error LNK2038: mismatch detected <span class="keyword">for</span> <span class="string">&#x27;RuntimeLibrary&#x27;</span>: value <span class="string">&#x27;MDd_DynamicDebug&#x27;</span> doesn<span class="number">&#x27;</span>t match value <span class="string">&#x27;MTd_StaticDebug&#x27;</span> in ELogging.obj</span><br><span class="line"><span class="number">2</span>&gt;LINK : fatal error LNK1104: cannot open file <span class="string">&#x27;libboost_date_time-vc140-mt-sgd-1_62.lib&#x27;</span></span><br><span class="line"><span class="number">2</span>&gt;Done building project <span class="string">&quot;ELogging.vcxproj&quot;</span> -- FAILED.</span><br><span class="line">========== Build: <span class="number">1</span> succeeded, <span class="number">1</span> failed, <span class="number">0</span> up-to-date, <span class="number">0</span> skipped ==========</span><br></pre></td></tr></table></figure>

<p>The key point of this error is that the current project’s compiled <code>Runtime Library</code> type is <code>MTd_StaticDebug</code> while the dependent linked library <code>libboost_thread-vc140-mt-gd-1_62.lib</code> is <code>MDd_DynamicDebug</code>, which causes a mismatch during linking:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error LNK2038: mismatch detected <span class="keyword">for</span> <span class="string">&#x27;RuntimeLibrary&#x27;</span>: value <span class="string">&#x27;MDd_DynamicDebug&#x27;</span> doesn<span class="number">&#x27;</span>t match value <span class="string">&#x27;MTd_StaticDebug&#x27;</span> in ELogging.obj</span><br></pre></td></tr></table></figure>

<p>Knowing the issue, the solution is to <strong>make the RuntimeLibrary type of the current compiled project consistent with all dependent lib’s RuntimeLibrary types</strong>.</p>
<p>To modify: <code>Project Properties</code>-<code>Configuration</code>-<code>C/C++</code>-<code>Code Generation</code>-<code>Runtime Library</code>:</p>
<p><img data-src="https://img.imzlp.com/imgs/zlp/blog/notes/cpp/index/VS/vs-set-project-runtime-library-type.webp"></p>
<blockquote>
<p>This is a pitfall; when introducing external Libs, you must clearly understand the types that the project depends on.</p>
</blockquote>
<h2 id="Precompiled-C1010-Error"><a href="#Precompiled-C1010-Error" class="headerlink" title="Precompiled C1010 Error"></a>Precompiled C1010 Error</h2><p>When compiling code, an error occurred in a <code>.cpp</code> file where all the code was commented out:</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fatal error C1010: unexpected end of file while looking for precompiled header. Did you forget to add &#x27;#include &quot;stdafx.h&quot;&#x27; to your source?</span><br></pre></td></tr></table></figure>

<p>This prompts that the precompiled header <code>stdafx.h</code> was not added to the file. Although the error can be reported by including the file, I do not need to include it here.</p>
<p>You can go to <code>Project Properties</code>-<code>C/C++</code>-<code>Precompiled Header</code>, change <code>Precompiled Header</code> to <code>Not Using Precompiled Headers</code>, and recompile. The downside is that precompiled headers cannot be used to speed up compilation.</p>
<blockquote>
<p>Precompiled headers refer to the practice of compiling certain standard headers used in a project (such as Windows.h, Afxwin.h) beforehand, so that during the project’s compilation, this portion does not need to be recompiled and only the precompiled result is used. This can speed up compilation time.</p>
</blockquote>
<blockquote>
<p>The precompiled header file is generated by compiling <code>stdafx.cpp</code>, named after the project. Since the suffix of the precompiled header file is <code>pch</code>, the compiled result file is <code>ProjectName.pch</code>.<br>The compiler uses a header file <code>stdafx.h</code> to utilize the precompiled header file. The name of this header file can be specified in the project’s compilation settings (<code>Project Properties</code>-<code>C/C++</code>-<code>Precompiled Header</code>-<code>Precompiled Header File</code>).<br>The compiler assumes that all code before the directive <code>#include &quot;stdafx.h&quot;</code> is precompiled, skips the <code>#include &quot;stdafx.h&quot;</code> directive, and uses <code>ProjectName.pch</code> to compile all code after this directive. Thus, the first statement of all CPP implementation files is <code>#include &quot;stdafx.h&quot;</code>.</p>
</blockquote>
<h2 id="In-Class-Default-Values-and-Constructor-Initialization-Order"><a href="#In-Class-Default-Values-and-Constructor-Initialization-Order" class="headerlink" title="In-Class Default Values and Constructor Initialization Order"></a>In-Class Default Values and Constructor Initialization Order</h2><p>In C++11, in-class initialization mechanism was introduced:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">A</span>()&#123;&#125;</span><br><span class="line">  </span><br><span class="line"> <span class="keyword">private</span>:</span><br><span class="line">  <span class="comment">// initialized as 10</span></span><br><span class="line">  <span class="comment">// or int ival&#123;10&#125;;</span></span><br><span class="line">  <span class="type">int</span> ival=<span class="number">10</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>However, this introduces a question: if I use both in-class initialization and constructor initialization, what value is actually used?</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">A</span>():<span class="built_in">ival</span>(<span class="number">11</span>)&#123;&#125;</span><br><span class="line">  </span><br><span class="line"> <span class="keyword">private</span>:</span><br><span class="line">  <span class="comment">// initialized as 10</span></span><br><span class="line">  <span class="type">int</span> ival=<span class="number">10</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>What should be the value of <code>ival</code> in the code above?<br>This is clearly answered in the C++ standard:</p>
<blockquote>
<p>[IOS/IEC 14882:2014 §12.6.2.9] If a given non-static data member has both a brace-or-equal-initializer and a mem-initializer, the initialization specified by the mem-initializer is performed, and the non-static data member’s brace-or-equal-initializer is ignored.</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">A</span> &#123;</span><br><span class="line">  <span class="type">int</span> i = /∗ some integer expression with side effects ∗/ ;</span><br><span class="line">  <span class="built_in">A</span>(<span class="type">int</span> arg) : <span class="built_in">i</span>(arg) &#123; &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>The A(int) constructor will simply initialize i to the value of arg, and the side effects in i’s brace-or-equal-initializer will not take place.</p>
</blockquote>
<p>Nonetheless, I wish to analyze how the compiler handles this in practice. In previous articles and notes, I learned that the compiler merges the in-class initialization operation into the constructor, executing after the base class construction, but before the constructor body of itself. I continue to use LLVM-IR code analysis:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">A</span>()&#123;<span class="built_in">printf</span>(<span class="string">&quot;&quot;</span>);&#125;</span><br><span class="line">  </span><br><span class="line"> <span class="keyword">private</span>:</span><br><span class="line">  <span class="comment">// initialized as 10</span></span><br><span class="line">  <span class="type">int</span> ival=<span class="number">10</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>Its constructor’s IR code is as follows:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">; Function Attrs: noinline optnone uwtable</span><br><span class="line">define linkonce_odr dso_local <span class="type">void</span> @_ZN1AC2Ev(%<span class="keyword">class</span>.A*) unnamed_addr #<span class="number">5</span> comdat align <span class="number">2</span> &#123;</span><br><span class="line">  %<span class="number">2</span> = alloca %<span class="keyword">class</span>.A*, align <span class="number">8</span></span><br><span class="line">  store %<span class="keyword">class</span>.A* %<span class="number">0</span>, %<span class="keyword">class</span>.A** %<span class="number">2</span>, align <span class="number">8</span></span><br><span class="line">  %<span class="number">3</span> = load %<span class="keyword">class</span>.A*, %<span class="keyword">class</span>.A** %<span class="number">2</span>, align <span class="number">8</span></span><br><span class="line">  %<span class="number">4</span> = getelementptr inbounds %<span class="keyword">class</span>.A, %<span class="keyword">class</span>.A* %<span class="number">3</span>, i32 <span class="number">0</span>, i32 <span class="number">0</span></span><br><span class="line">  store i32 <span class="number">10</span>, i32* %<span class="number">4</span>, align <span class="number">4</span></span><br><span class="line">  %<span class="number">5</span> = call <span class="built_in">i32</span> (i8*, ...) @_ZL6printfPKcz(i8* getelementptr <span class="built_in">inbounds</span> ([<span class="number">1</span> x i8], [<span class="number">1</span> x i8]* @.str, i32 <span class="number">0</span>, i32 <span class="number">0</span>))</span><br><span class="line">  ret <span class="type">void</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>We can see that it first initializes the <code>this</code> pointer, then uses it to retrieve member <code>ival</code>, and then initializes it (store operation in IR).<br>What if we use the constructor initialization syntax?</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="comment">// initialized as 11</span></span><br><span class="line">  <span class="built_in">A</span>():<span class="built_in">ival</span>(<span class="number">11</span>)&#123;&#125;</span><br><span class="line">  </span><br><span class="line"> <span class="keyword">private</span>:</span><br><span class="line">  <span class="comment">// initialized as 10</span></span><br><span class="line">  <span class="type">int</span> ival=<span class="number">10</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>The actual behavior is that <code>ival</code> is initialized to 11.</p>
<p>Its IR code is:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">; Function Attrs: noinline optnone uwtable</span><br><span class="line">define linkonce_odr dso_local <span class="type">void</span> @_ZN1AC2Ev(%<span class="keyword">class</span>.A*) unnamed_addr #<span class="number">5</span> comdat align <span class="number">2</span> &#123;</span><br><span class="line">  %<span class="number">2</span> = alloca %<span class="keyword">class</span>.A*, align <span class="number">8</span></span><br><span class="line">  store %<span class="keyword">class</span>.A* %<span class="number">0</span>, %<span class="keyword">class</span>.A** %<span class="number">2</span>, align <span class="number">8</span></span><br><span class="line">  %<span class="number">3</span> = load %<span class="keyword">class</span>.A*, %<span class="keyword">class</span>.A** %<span class="number">2</span>, align <span class="number">8</span></span><br><span class="line">  %<span class="number">4</span> = getelementptr inbounds %<span class="keyword">class</span>.A, %<span class="keyword">class</span>.A* %<span class="number">3</span>, i32 <span class="number">0</span>, i32 <span class="number">0</span></span><br><span class="line">  store i32 <span class="number">10</span>, i32* %<span class="number">4</span>, align <span class="number">4</span></span><br><span class="line">  %<span class="number">5</span> = call <span class="built_in">i32</span> (i8*, ...) @_ZL6printfPKcz(i8* getelementptr <span class="built_in">inbounds</span> ([<span class="number">1</span> x i8], [<span class="number">1</span> x i8]* @.str, i32 <span class="number">0</span>, i32 <span class="number">0</span>))</span><br><span class="line">  ret <span class="type">void</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Through a diff analysis, we find that the only difference in IR code between the two versions is the initial value; all other logic is exactly the same:<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/notes/cpp/index/brace-equal-initializer-diff-mem-initializer.webp"></p>
<h2 id="Template-Specialization-for-Variable-Templates"><a href="#Template-Specialization-for-Variable-Templates" class="headerlink" title="Template Specialization for Variable Templates"></a>Template Specialization for Variable Templates</h2><p>Sum:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="type">int</span> EndPoint&gt;</span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">int</span> NUM = NUM&lt;EndPoint<span class="number">-1</span>&gt; + EndPoint;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;&gt;</span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">int</span> NUM&lt;<span class="number">0</span>&gt; = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  cout&lt;&lt;NUM&lt;<span class="number">100</span>&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Fibonacci N-th term:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="type">int</span> EndPoint&gt;</span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">int</span> Fibonacci = Fibonacci&lt;EndPoint<span class="number">-1</span>&gt; + Fibonacci&lt;EndPoint<span class="number">-2</span>&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;&gt;</span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">int</span> Fibonacci&lt;<span class="number">1</span>&gt; = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;&gt;</span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">int</span> Fibonacci&lt;<span class="number">2</span>&gt; = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  cout&lt;&lt;Fibonacci&lt;<span class="number">7</span>&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The maximum supported parameter depends on the compiler’s maximum recursion depth, Clang can specify this with <code>-ftemplate-depth=N</code>.</p>
<blockquote>
<p>note: use -ftemplate-depth=N to increase recursive template instantiation depth</p>
</blockquote>
<h2 id="What-is-the-Object-in-C-C"><a href="#What-is-the-Object-in-C-C" class="headerlink" title="What is the Object in C/C++?"></a>What is the Object in C/C++?</h2><p>First, let’s talk about <strong>object</strong> in C++:<br>In some textbooks, the object in C++ is often portrayed as being object-oriented, where the object refers to class objects. However, the C++ standard defines object not so narrowly; in C++, anything that occupies storage space is an object (with the exception of functions).</p>
<blockquote>
<p><strong>[ISO/IEC 14882:2014 §1.8]</strong> An object is a region of storage. [ Note: A function is not an object, regardless of whether or not it occupies storage in the way that objects do. — end note ] An object is created by a definition (3.1), by a new-expression (5.3.4) or by the implementation (12.2) when needed.</p>
</blockquote>
<p>Some argue that only class objects in C++ are considered objects; this is a narrow perspective. If only class objects can be called objects, how should we describe instances of built-in types? Moreover, a class itself is meant to provide the same operational capabilities as built-in types; unifying the term for entities by calling them <strong>objects</strong> is more appropriate.</p>
<blockquote>
<p><strong>[ISO/IEC 14882:2014 §1.8]</strong> An object can have a name (Clause 3). An object has a storage duration (3.7) which influences its lifetime (3.8). An object has a type (3.9). The term object type refers to the type with which the object is created.</p>
</blockquote>
<p>From the perspective of object-oriented theory’s <strong>encapsulation</strong>, <strong>inheritance</strong>, and <strong>polymorphism</strong>, indeed only class objects qualify as objects in that context. However, the C++ standard’s object model is based on storage and objects (An object is a region of storage).</p>
<p>The concept of <strong>object</strong> in the C language is similar to that in C++, which is also defined as <strong>storage being an object</strong>:</p>
<blockquote>
<p>[ISO/IEC 9899:1999 §3.14] region of data storage in the execution environment, the contents of which can represent values</p>
</blockquote>
<h2 id="Why-C-Templates-Must-Provide-Declarations-and-Definitions"><a href="#Why-C-Templates-Must-Provide-Declarations-and-Definitions" class="headerlink" title="Why C++ Templates Must Provide Declarations and Definitions"></a>Why C++ Templates Must Provide Declarations and Definitions</h2><p>Because using templates in C++ generates new types, and only the translation unit currently using the template will generate these (as the compiler will only deduce templates for the current translation unit). If the declaration and definition of the template are separated and a symbol (type) is produced when using the template, the compiler will seek the definition of that symbol. The challenge arises if the template’s definition is in other translation units, because the compiler cannot reach it. How can a declaration of a symbol generated in one translation unit have the same definition in another translation unit? This is because the compiler can only know the specific location of the template when it uses the exact place to instantiate it with template arguments. The outcome is a linking error.<br>Thus, templates must provide both declarations and definitions to ensure consistent generation of declared and defined symbols from templates (thinking of templates as inline code enhances understanding).</p>
<p>Historically (C++03), C++ allowed separated compilation of templates (using <code>export</code>), but this feature was deprecated after C++11: primarily due to its significant limitations (not unlike normal separated declaration-definition compilation—that still requires code implementation during compilation) and because it was hard to implement (only one compiler, Comeau, has achieved this).</p>
<h2 id="Changing-File-Encoding-in-VS"><a href="#Changing-File-Encoding-in-VS" class="headerlink" title="Changing File Encoding in VS"></a>Changing File Encoding in VS</h2><p>Choose <code>Tools</code>-<code>Customize</code>-<code>Commands</code>:<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/notes/cpp/index/VS/vs-customize-file-bar-menu.webp"><br>In <code>File</code>, add the <code>Advanced Save Options</code> option:<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/notes/cpp/index/VS/vs-add-file-bar-advanced-save-options.webp"><br>Then, opening text files will allow you to see the <code>Advanced Save Options</code> option under the <code>File</code> menu in VS:<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/notes/cpp/index/VS/vs-file-base-advanced-save-options.webp"><br>Or, install the plugin <a target="_blank" rel="noopener" href="https://img.imzlp.com/imgs/zlp/blog/notes/cpp/index/VS/ForceUTF8(NoBOM).vsix">ForceUTF8(NoBOM)</a></p>
<blockquote>
<p>PS: It is best to use Unicode encoding for code to avoid strange compilation errors caused by encoding issues.</p>
</blockquote>
<h2 id="Static-Members-of-C-Template-Specialization-Instances"><a href="#Static-Members-of-C-Template-Specialization-Instances" class="headerlink" title="Static Members of C++ Template Specialization Instances"></a>Static Members of C++ Template Specialization Instances</h2><p>Each <strong>class template specialization instance</strong> derived from a template class has its own separate static members:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">A</span>&#123;</span><br><span class="line">  <span class="type">static</span> T StaticMem;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">T A&lt;T&gt;::StaticMem;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  A&lt;<span class="type">int</span>&gt;::StaticMem=<span class="number">123</span>;</span><br><span class="line">  A&lt;<span class="type">float</span>&gt;::StaticMem=<span class="number">4.56</span>;</span><br><span class="line">  A&lt;<span class="type">char</span>&gt;::StaticMem=<span class="string">&#x27;b&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>[ISO/IEC 14882:2014 § 14.7] Each class template specialization instantiated from a template has its own copy of any static members.</p>
</blockquote>
<h2 id="The-Reason-Why-this-Cannot-Be-Used-as-Default-Parameters-in-Functions"><a href="#The-Reason-Why-this-Cannot-Be-Used-as-Default-Parameters-in-Functions" class="headerlink" title="The Reason Why this Cannot Be Used as Default Parameters in Functions"></a>The Reason Why <code>this</code> Cannot Be Used as Default Parameters in Functions</h2><p><strong>Note: The implementation of member functions (passed this) is Implementation-defined.</strong><br>In a previous article, I mentioned the distinction between C++ member functions and ordinary functions; member functions have an implicit <code>this</code> pointer:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>Their differences are:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// ::func</span><br><span class="line">// name mangling as void @_Z4funcv()</span><br><span class="line">void func()&#123;&#125;</span><br><span class="line">// A::func</span><br><span class="line">// name mangling as void @_ZN1A4funcEv(%class.A* %6)</span><br><span class="line">void func(A*)&#123;&#125;</span><br></pre></td></tr></table></figure>
<p>Essentially, the call to a member function is passing the <strong>address of the current object</strong> as an actual argument to the <strong>function parameter this</strong>.<br>The reason <code>this</code> cannot be used in member function default parameters is that, in C++, the order of evaluation of function parameters is unspecified:</p>
<blockquote>
<p>[<strong>ISO/IEC 14882:2014 §8.3.6.9</strong>] A default argument is evaluated each time the function is called with no argument for the corresponding parameter. The order of evaluation of function arguments is unspecified. Consequently, parameters of a function shall not be used in a default argument, even if they are not evaluated. Parameters of a function declared before a default argument are in scope and can hide namespace and class member names.</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">f</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b = a)</span></span>; <span class="comment">// error: parameter a used as default argument</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">int</span> I;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">g</span><span class="params">(<span class="type">float</span> I, <span class="type">int</span> b = I(<span class="number">2</span>))</span></span>; <span class="comment">// error: parameter I found</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">h</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b = <span class="keyword">sizeof</span>(a))</span></span>; <span class="comment">// error, parameter a used in default argument</span></span><br></pre></td></tr></table></figure>
<p>From the analysis above, we understand that the <code>this</code> pointer is essentially a function parameter. Therefore, if we were to allow <code>this</code> to be a default parameter for a function, it would imply:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">(A* this_copy=<span class="keyword">this</span>)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// Implementation is equivalent to</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">A_func</span><span class="params">(A* <span class="keyword">this</span>,A* this_copy=<span class="keyword">this</span>)</span></span>;</span><br></pre></td></tr></table></figure>
<p>Such syntax would mean that one parameter’s default argument relies on another parameter, and since the order of parameter passing in functions is unspecified, <code>this</code> cannot be used in default arguments.<br>The rules of the standard are interconnected; if a rule applies here, it must also be limited in another context.</p>
<h2 id="Extracting-the-Number-of-Elements-in-an-Array"><a href="#Extracting-the-Number-of-Elements-in-an-Array" class="headerlink" title="Extracting the Number of Elements in an Array"></a>Extracting the Number of Elements in an Array</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> ABSL_ARRAYSIZE(array) (sizeof(ArraySizeHelper(array)))</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T,<span class="type">size_t</span> N&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">ArraySizeHelper</span><span class="params">(<span class="type">const</span> T (&amp;array)[N])</span>-&gt;<span class="title">char</span> <span class="params">(&amp;)</span>[N]</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> array[<span class="number">123</span>];</span><br><span class="line">  std::cout&lt;&lt;<span class="built_in">ABSL_ARRAYSIZE</span>(array)&lt;&lt;std::endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// output: 123</span></span><br></pre></td></tr></table></figure>

<h2 id="Bin2Hex"><a href="#Bin2Hex" class="headerlink" title="Bin2Hex"></a>Bin2Hex</h2><p>I wrote a small tool to convert binary files to hex data by reading the binary file byte by byte and writing it into a string:</p>
<script src="//gist.github.com/9019a284ae9b6cfa1436414e04145d59.js"></script>

<p><a target="_blank" rel="noopener" href="https://img.imzlp.com/imgs/zlp/blog/notes/cpp/index/bin2hex.7z">Download bin2hex</a>, usage is as follows:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># bin2hex.exe FileName</span></span><br><span class="line">$ ./bin2hex.exe Icon.ico</span><br></pre></td></tr></table></figure>
<p>It will generate a file named <code>Icon_ico.h</code> in the current directory, recording the binary data of <code>Icon.ico</code>:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Icon_ico.h</span></span><br><span class="line"><span class="comment">// origin file: Icon.ico</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span></span><br><span class="line">  Icon_ico_data[]=</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x01</span>,<span class="number">0x00</span>,<span class="number">0x0a</span>,<span class="number">0x00</span>,<span class="number">0x10</span>,<span class="number">0x10</span>,<span class="number">0x10</span>,<span class="number">0x00</span>,<span class="number">0x01</span>,<span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x04</span>,<span class="number">0x00</span>,<span class="number">0x28</span>,<span class="number">0x01</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0xa6</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x10</span>,<span class="number">0x10</span>,</span><br><span class="line">    <span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x01</span>,<span class="number">0x00</span>,<span class="number">0x08</span>,<span class="number">0x00</span>,<span class="number">0x68</span>,<span class="number">0x05</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0xce</span>,<span class="number">0x01</span>,</span><br><span class="line">    <span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x10</span>,<span class="number">0x10</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x01</span>,<span class="number">0x00</span>,<span class="number">0x20</span>,<span class="number">0x00</span>,<span class="number">0x68</span>,<span class="number">0x04</span>,</span><br><span class="line">    <span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x36</span>,<span class="number">0x07</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x20</span>,<span class="number">0x20</span>,<span class="number">0x10</span>,<span class="number">0x00</span>,<span class="number">0x01</span>,<span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x04</span>,<span class="number">0x00</span>,<span class="number">0xe8</span>,<span class="number">0x02</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x9e</span>,<span class="number">0x0b</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x20</span>,<span class="number">0x20</span>,</span><br><span class="line">    <span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x01</span>,<span class="number">0x00</span>,<span class="number">0x08</span>,<span class="number">0x00</span>,<span class="number">0xa8</span>,<span class="number">0x08</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x86</span>,<span class="number">0x0e</span>,</span><br><span class="line">    <span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x20</span>,<span class="number">0x20</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x01</span>,<span class="number">0x00</span>,<span class="number">0x20</span>,<span class="number">0x00</span>,<span class="number">0xa8</span>,<span class="number">0x10</span>,</span><br><span class="line">    <span class="comment">// something...</span></span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>
<p>To use it, simply write the data to a file in binary mode for recovery:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// hex2bin.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Icon_ico.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  FILE* loadFP=<span class="built_in">fopen</span>(<span class="string">&quot;Icon.ico&quot;</span>,<span class="string">&quot;wb&quot;</span>);</span><br><span class="line">  <span class="built_in">fwrite</span>(Icon_ico_data,<span class="built_in">sizeof</span>(Icon_ico_data),<span class="number">1</span>,loadFP);</span><br><span class="line">  <span class="built_in">fclose</span>(loadFP);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This method is useful for embedding resources directly into console applications during compilation.</p>
<h2 id="Reading-and-Writing-Binary-Files-in-C"><a href="#Reading-and-Writing-Binary-Files-in-C" class="headerlink" title="Reading and Writing Binary Files in C"></a>Reading and Writing Binary Files in C</h2><p>Reading:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">FILE* fp=<span class="built_in">fopen</span>(rFileName, <span class="string">&quot;rb&quot;</span>);</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> fileItem=<span class="number">0</span>;(fileItem=<span class="built_in">getc</span>(fp))!=EOF;)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%02x&quot;</span>,fileItem);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">fclose</span>(fp);</span><br></pre></td></tr></table></figure>

<p>Writing:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span></span><br><span class="line">  Data[]=</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="number">0x89</span>,<span class="number">0x50</span>,<span class="number">0x4e</span>,<span class="number">0x47</span>,<span class="number">0x0d</span>,<span class="number">0x0a</span>,<span class="number">0x1a</span>,<span class="number">0x0a</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x0d</span>,</span><br><span class="line">    <span class="number">0x49</span>,<span class="number">0x48</span>,<span class="number">0x44</span>,<span class="number">0x52</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x01</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x01</span>,<span class="number">0x00</span>,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;;</span><br><span class="line">FILE* loadFP=<span class="built_in">fopen</span>(wFileName,<span class="string">&quot;wb&quot;</span>);</span><br><span class="line"><span class="built_in">fwrite</span>(Data,<span class="built_in">sizeof</span>(Data),<span class="number">1</span>,loadFP);</span><br><span class="line"><span class="built_in">fclose</span>(loadFP);</span><br></pre></td></tr></table></figure>

<h2 id="GNU-Extension-struct-Initialization-first-…-last"><a href="#GNU-Extension-struct-Initialization-first-…-last" class="headerlink" title="GNU Extension: struct Initialization [first … last]"></a>GNU Extension: struct Initialization [first … last]</h2><p>GNU’s extension supports a syntax for structure initialization (<a target="_blank" rel="noopener" href="https://gcc.gnu.org/onlinedocs/gcc/Designated-Inits.html">Designated-Inits</a>) like this:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> ARRAY_NUM 10</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> &#123;</span> <span class="type">int</span> ival; <span class="type">double</span> dval; &#125; DataList[ARRAY_NUM] = &#123; [<span class="number">0</span> ... ARRAY_NUM<span class="number">-1</span>].ival = <span class="number">2</span> &#125;;</span><br></pre></td></tr></table></figure>
<p>This code means to initialize the <code>ival</code> member of all elements within <code>DataList</code> to 2.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> ARRAY_NUM 5</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">struct</span> &#123; <span class="type">int</span> ival; <span class="type">double</span> dval; &#125; DataList[ARRAY_NUM] = &#123; [<span class="number">0</span> ... ARRAY_NUM<span class="number">-1</span>].ival = <span class="number">2</span> &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> index=<span class="number">0</span>; index&lt;ARRAY_NUM; ++index)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\t&quot;</span>, DataList[index].ival);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// output</span></span><br><span class="line"><span class="number">2</span>       <span class="number">2</span>       <span class="number">2</span>       <span class="number">2</span>       <span class="number">2</span></span><br></pre></td></tr></table></figure>
<p>Though one could also implement it using a loop:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> ARRAY_NUM 5</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> &#123;</span> <span class="type">int</span> ival; <span class="type">double</span> dval; &#125; DataList[ARRAY_NUM];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> index=<span class="number">0</span>; index&lt;ARRAY_NUM; ++index)</span><br><span class="line">    DataList[index].ival = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>However, comparing the assembly code of the two:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">###############################</span><br><span class="line">##define ARRAY_NUM 5</span><br><span class="line">#int main(void)</span><br><span class="line">#&#123;</span><br><span class="line">#  struct &#123; int ival; double dval; &#125; DataList[ARRAY_NUM];</span><br><span class="line">#</span><br><span class="line">#  for(int index=0; index&lt;ARRAY_NUM;++index)</span><br><span class="line">#    DataList[index].ival=2;</span><br><span class="line">#&#125;</span><br><span class="line">###############################</span><br><span class="line">  .text</span><br><span class="line">  .def   main;</span><br><span class="line">  .scl  2;</span><br><span class="line">  .type 32;</span><br><span class="line">  .endef</span><br><span class="line">  .globl  main                    # -- Begin function main</span><br><span class="line">  .p2align  4, 0x90</span><br><span class="line">main:                                   # @main</span><br><span class="line">.seh_proc main</span><br><span class="line"># %bb.0:</span><br><span class="line">  pushq %rbp</span><br><span class="line">  .seh_pushreg 5</span><br><span class="line">  subq  $144, %rsp</span><br><span class="line">  .seh_stackalloc 144</span><br><span class="line">  leaq  128(%rsp), %rbp</span><br><span class="line">  .seh_setframe 5, 128</span><br><span class="line">  .seh_endprologue</span><br><span class="line">  callq __main</span><br><span class="line">  movl  $0, 12(%rbp)</span><br><span class="line">  movl  $0, -84(%rbp)</span><br><span class="line">.LBB0_1:                                # =&gt;This Inner Loop Header: Depth=1</span><br><span class="line">  cmpl  $5, -84(%rbp)</span><br><span class="line">  jge .LBB0_4</span><br><span class="line"># %bb.2:                                #   in Loop: Header=BB0_1 Depth=1</span><br><span class="line">  movslq  -84(%rbp), %rax</span><br><span class="line">  shlq  $4, %rax</span><br><span class="line">  leaq  -80(%rbp), %rcx</span><br><span class="line">  addq  %rax, %rcx</span><br><span class="line">  movl  $2, (%rcx)</span><br><span class="line"># %bb.3:                                #   in Loop: Header=BB0_1 Depth=1</span><br><span class="line">  movl  -84(%rbp), %eax</span><br><span class="line">  addl  $1, %eax</span><br><span class="line">  movl  %eax, -84(%rbp)</span><br><span class="line">  jmp .LBB0_1</span><br><span class="line">.LBB0_4:</span><br><span class="line">  xorl  %eax, %eax</span><br><span class="line">  addq  $144, %rsp</span><br><span class="line">  popq  %rbp</span><br><span class="line">  retq</span><br><span class="line">  .seh_handlerdata</span><br><span class="line">  .text</span><br><span class="line">  .seh_endproc</span><br><span class="line">                                        # -- End function</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">###############################</span><br><span class="line">##define ARRAY_NUM 5</span><br><span class="line">#ifint main(int argc,char* argv[])# &#123;</span><br><span class="line">#  struct &#123; int ival; double dval; &#125; DataList[ARRAY_NUM] = &#123; [0 ... ARRAY_NUM-1].ival = 2 &#125;;</span><br><span class="line">#&#125;</span><br><span class="line">###############################</span><br><span class="line">  .text</span><br><span class="line">  .def   main;</span><br><span class="line">  .scl  2;</span><br><span class="line">  .type 32;</span><br><span class="line">  .endef</span><br><span class="line">  .globl  main                    # -- Begin function main</span><br><span class="line">  .p2align  4, 0x90</span><br><span class="line">main:                                   # @main</span><br><span class="line">.seh_proc main</span><br><span class="line"># %bb.0:</span><br><span class="line">  pushq %rbp</span><br><span class="line">  .seh_pushreg 5</span><br><span class="line">  subq  $128, %rsp</span><br><span class="line">  .seh_stackalloc 128</span><br><span class="line">  leaq  128(%rsp), %rbp</span><br><span class="line">  .seh_setframe 5, 128</span><br><span class="line">  .seh_endprologue</span><br><span class="line">  callq __main</span><br><span class="line">  xorl  %eax, %eax</span><br><span class="line">  movl  $80, %ecx</span><br><span class="line">  movl  %ecx, %r8d</span><br><span class="line">  leaq  -80(%rbp), %rdx</span><br><span class="line">  movq  %rdx, %rcx</span><br><span class="line">  movl  %eax, %edx</span><br><span class="line">  movl  %eax, -84(%rbp)         # 4-byte Spill</span><br><span class="line">  callq memset</span><br><span class="line">  movl  $2, -80(%rbp)</span><br><span class="line">  movl  $2, -64(%rbp)</span><br><span class="line">  movl  $2, -48(%rbp)</span><br><span class="line">  movl  $2, -32(%rbp)</span><br><span class="line">  movl  $2, -16(%rbp)</span><br><span class="line">  movl  -84(%rbp), %eax         # 4-byte Reload</span><br><span class="line">  addq  $128, %rsp</span><br><span class="line">  popq  %rbp</span><br><span class="line">  retq</span><br><span class="line">  .seh_handlerdata</span><br><span class="line">  .text</span><br><span class="line">  .seh_endproc</span><br><span class="line">                                        # -- End function</span><br></pre></td></tr></table></figure>
<p>As can be seen, the direct initialization is more efficient. However, from the perspective of “readability” (after all, it is not standard C) and “portability,” writing a loop for assignment is more reliable.</p>
<h2 id="Static-Member-Initialization-Can-Access-Private-Members"><a href="#Static-Member-Initialization-Can-Access-Private-Members" class="headerlink" title="Static Member Initialization Can Access Private Members"></a>Static Member Initialization Can Access Private Members</h2><p>C++’s static member initialization can access the private members of a class:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">process</span> &#123;</span><br><span class="line">  <span class="type">static</span> process* run_chain;</span><br><span class="line">  <span class="type">static</span> process* running;</span><br><span class="line">&#125;;</span><br><span class="line">process* process::running = <span class="built_in">get_main</span>();</span><br><span class="line">process* process::run_chain = running;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>[ISO/IEC 14882:2014 §9.4.2] The static data member run_chain of class process is defined in global scope; the notation process::run_chain specifies that the member run_chain is a member of class process and <strong>in the scope of class process</strong>. In the static data member definition, the initializer expression refers to the static data member running of class process. — end example ]</p>
</blockquote>
<h2 id="Usage-of"><a href="#Usage-of" class="headerlink" title="Usage of !!"></a>Usage of <code>!!</code></h2><p>I’ve seen the use of <code>!</code> as follows:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> ival=<span class="number">3</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,!!ival);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The effect is that if <code>ival</code> is 0, <code>!!ival</code> equals 0, and if <code>ival</code> is non-zero, the result is 1.</p>
<p>Here are the IR comparisons of the two pieces of code:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// cpp</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> ival=<span class="number">11</span>;</span><br><span class="line">    <span class="type">bool</span> a = (<span class="type">bool</span>)ival;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// IR</span></span><br><span class="line">define i32 @<span class="built_in">main</span>() #<span class="number">0</span> &#123;</span><br><span class="line">  %ival = alloca i32, align <span class="number">4</span></span><br><span class="line">  %a = alloca i8, align <span class="number">1</span></span><br><span class="line">  store i32 <span class="number">11</span>, i32* %ival, align <span class="number">4</span></span><br><span class="line">  %<span class="number">0</span> = load i32, i32* %ival, align <span class="number">4</span></span><br><span class="line">  %tobool = icmp ne i32 %<span class="number">0</span>, <span class="number">0</span></span><br><span class="line">  %frombool = zext i1 %tobool to i8</span><br><span class="line">  store i8 %frombool, i8* %a, align <span class="number">1</span></span><br><span class="line">  ret i32 <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Using <code>!!</code> in the code:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// cpp</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> ival=<span class="number">11</span>;</span><br><span class="line">    <span class="type">bool</span> a = !!ival;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// IR</span></span><br><span class="line">define i32 @<span class="built_in">main</span>() #<span class="number">0</span> &#123;</span><br><span class="line">  %ival = alloca i32, align <span class="number">4</span></span><br><span class="line">  %a = alloca i8, align <span class="number">1</span></span><br><span class="line">  store i32 <span class="number">11</span>, i32* %ival, align <span class="number">4</span></span><br><span class="line">  %<span class="number">0</span> = load i32, i32* %ival, align <span class="number">4</span></span><br><span class="line">  %tobool = icmp ne i32 %<span class="number">0</span>, <span class="number">0</span></span><br><span class="line">  %lnot = <span class="keyword">xor</span> i1 %tobool, <span class="literal">true</span></span><br><span class="line">  %lnot1 = <span class="keyword">xor</span> i1 %lnot, <span class="literal">true</span></span><br><span class="line">  %frombool = zext i1 %lnot1 to i8</span><br><span class="line">  store i8 %frombool, i8* %a, align <span class="number">1</span></span><br><span class="line">  ret i32 <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Enums-in-the-C-Language-are-Just-Integers"><a href="#Enums-in-the-C-Language-are-Just-Integers" class="headerlink" title="Enums in the C Language are Just Integers"></a>Enums in the C Language are Just Integers</h2><blockquote>
<p><strong>[ISO/IEC 9899:1999 §6.4.4.4.2]</strong> An identifier declared as an enumeration constant has type int.</p>
</blockquote>
<blockquote>
<p><strong>[ISO/IEC 9899:1999 §6.7.2.2.3]</strong> The identifiers in an enumerator list are declared as constants that have type int and may appear wherever such are permitted.</p>
</blockquote>
<p><strong>Note:</strong> Enums in C++ differ from C, with C++ enums being a distinct type, please refer to <strong>[ISO/IEC 14882:2014 C.16 Clause7]</strong>.</p>
<h2 id="Pure-Virtual-Functions-in-C-Cannot-Provide-Definitions"><a href="#Pure-Virtual-Functions-in-C-Cannot-Provide-Definitions" class="headerlink" title="Pure Virtual Functions in C++ Cannot Provide Definitions"></a>Pure Virtual Functions in C++ Cannot Provide Definitions</h2><blockquote>
<p><strong>[ISO/IEC 14882:2014 §10.4]</strong> A function declaration cannot provide both a pure-specifier and a definition.</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">C</span> &#123;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">f</span><span class="params">()</span> </span>= <span class="number">0</span> &#123; &#125;; <span class="comment">// ill-formed</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Regular-Expression-for-Matching-C-Function-Declarations"><a href="#Regular-Expression-for-Matching-C-Function-Declarations" class="headerlink" title="Regular Expression for Matching C Function Declarations"></a>Regular Expression for Matching C Function Declarations</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">^([\w\*]+( )*?)&#123;2,&#125;\(([^!@#$+%^;]+?)\)(?!\s*;)</span><br></pre></td></tr></table></figure>
<p>Source: <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/476173/regex-to-pull-out-c-function-prototype-declarations/45866339#45866339">Regex to pull out C function prototype declarations?</a></p>
<h2 id="Aggregation-Structure-Initialization-in-C"><a href="#Aggregation-Structure-Initialization-in-C" class="headerlink" title="Aggregation Structure Initialization in C"></a>Aggregation Structure Initialization in C</h2><p>C language supports such an initialization method for aggregate structures:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> &#123; <span class="type">int</span> a; <span class="type">float</span> b; &#125; x = &#123; .a = <span class="number">2</span>, .b = <span class="number">2.2</span> &#125;;</span><br><span class="line"><span class="keyword">struct</span> &#123; <span class="type">int</span> a[<span class="number">3</span>], b; &#125; w[] = &#123; [<span class="number">1</span>].a[<span class="number">0</span>] = <span class="number">2</span> &#125;;</span><br></pre></td></tr></table></figure>
<p>This is because the initializer’s designator can be either <code>[constant-expression]</code> or <code>.identifier</code>.<br>PS: The question of <code>sizeof(w) == ?</code> is an interesting one.<br>For details, see <strong>[ISO/IEC 9899:1999 §6.7.8]</strong>.</p>
<h2 id="Function-Calls-via-Function-Pointers-Cannot-Use-Default-Parameters"><a href="#Function-Calls-via-Function-Pointers-Cannot-Use-Default-Parameters" class="headerlink" title="Function Calls via Function Pointers Cannot Use Default Parameters"></a>Function Calls via Function Pointers Cannot Use Default Parameters</h2><p>As the title suggests:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">int</span> ival=<span class="number">123</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ival);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="built_in">void</span>(*fp)(<span class="type">int</span>)=func;</span><br><span class="line">  <span class="built_in">fp</span>(); <span class="comment">// error: too few arguments to function call, expected 1, have 0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>First, let’s look at when the default parameters for functions get filled in; we can analyze this via the LLVM-IR code:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">int</span> ival=<span class="number">123</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ival);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="built_in">func</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The IR code for the main function is:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">define dso_local i32 @<span class="built_in">main</span>() #<span class="number">6</span> &#123;</span><br><span class="line">  call <span class="type">void</span> @_Z4funci(i32 <span class="number">123</span>)</span><br><span class="line">  ret i32 <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>We can see that during compilation, the omitted argument is directly replaced by the default value.<br>Function pointers only possess the address value of the function without any information about the actual parameters, so default parameters cannot be used when accessing via function pointers.<br><strong>Note:</strong> The same applies to member function pointers.</p>
<h2 id="Unspecified-Behavior"><a href="#Unspecified-Behavior" class="headerlink" title="Unspecified Behavior"></a>Unspecified Behavior</h2><blockquote>
<p>behavior, for a well-formed program construct and correct data, that depends on the implementation. [ Note: The implementation is not required to document which behavior occurs. The range of possible behaviors is usually delineated by this International Standard. — end note ]</p>
</blockquote>
<h2 id="Well-formed-Program"><a href="#Well-formed-Program" class="headerlink" title="Well-formed Program"></a>Well-formed Program</h2><blockquote>
<p>[<strong>ISO/IEC 14882:2014 §1.3.26</strong>] C++ program constructed according to the syntax rules, diagnosable semantic rules, and the One Definition Rule (3.2).</p>
</blockquote>
<h2 id="Implementation-Defined-Behavior"><a href="#Implementation-Defined-Behavior" class="headerlink" title="Implementation-Defined Behavior"></a>Implementation-Defined Behavior</h2><blockquote>
<p>[<strong>ISO/IEC 14882:2014</strong>] behavior, for a well-formed program construct and correct data, that depends on the implementation and that each implementation documents.</p>
</blockquote>
<h2 id="Undefined-Behavior-UB"><a href="#Undefined-Behavior-UB" class="headerlink" title="Undefined Behavior (UB)"></a>Undefined Behavior (UB)</h2><blockquote>
<p>[<strong>ISO/IEC 14882:2014 §1.9.4</strong>] This International Standard imposes no requirements on the behavior of programs that contain undefined behavior.<br>[<strong>ISO/IEC 14882:2014 §1.3.24</strong>] behavior for which this International Standard imposes no requirements [ Note: Undefined behavior may be expected when this International Standard omits any explicit definition of behavior or when a program uses an erroneous construct or erroneous data. Permissible undefined behavior ranges from ignoring the situation completely with unpredictable results, to behaving during translation or program execution in a documented manner characteristic of the environment (with or without the issuance of a diagnostic message), to terminating a translation or execution (with the issuance of a diagnostic message). Many erroneous program constructs do not engender undefined behavior; they are required to be diagnosed. — end note ]</p>
</blockquote>
<p>This means programs with UB exhibit unpredictable behavior, and any circumstances may occur.</p>
<h2 id="About-the-Injected-Class-Name-Issue"><a href="#About-the-Injected-Class-Name-Issue" class="headerlink" title="About the Injected Class Name Issue"></a>About the Injected Class Name Issue</h2><p>First, let’s understand what <code>injected-class-name</code> means:</p>
<blockquote>
<p>[<strong>ISO/IEC 14882:2014(E) §9.0.2</strong>] The class-name is also inserted into the scope of the class itself; this is known as the injected-class-name. For purposes of access checking, the injected-class-name is treated as if it were a public member name.</p>
</blockquote>
<p>This means that the name of the class is embedded in the scope of the class; <strong>for the purpose of access checking, the injected class name is treated as a public member</strong> (note this sentence).<br>The declaration of the injected class name is similar to the following:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="comment">// Mimic injected class name</span></span><br><span class="line">  <span class="keyword">using</span> AType=A;</span><br><span class="line"> &#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span> : <span class="keyword">private</span> A &#123; &#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">C</span> : <span class="keyword">public</span> B &#123;</span><br><span class="line">  <span class="comment">// A::AType aobj;</span></span><br><span class="line">  AType* aobj;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>Name lookup within a class starts from the current scope, and the injected class name is more evident in the inheritance hierarchy:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>&#123;&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span>:<span class="keyword">public</span> A&#123;</span><br><span class="line">  <span class="comment">// Equivalent to A aobj;</span></span><br><span class="line">  <span class="comment">// But differs from ::A aobj;</span></span><br><span class="line">  B::A aobj;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>As shown in the above code, <code>B::A</code> can be used to qualify the type <code>A</code> in the inheritance hierarchy of B.<br>In the description above, it states that the injected class name is treated as a public member; what happens if we mark the base class as <code>private</code> in the inheritance hierarchy?</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> &#123; &#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span> : <span class="keyword">private</span> A &#123; &#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">C</span> : <span class="keyword">public</span> B &#123;</span><br><span class="line">  A* p0;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc,<span class="type">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  C cobj;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Let’s compile this code:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">injected-class-name.cpp:4:3: error: <span class="string">&#x27;A&#x27;</span> is a private member of <span class="string">&#x27;A&#x27;</span></span><br><span class="line">  A* p0;</span><br><span class="line">  ^</span><br><span class="line">injected-class-name.cpp:2:11: note: constrained by private inheritance here</span><br><span class="line">class B : private A &#123; &#125;;</span><br><span class="line">          ^~~~~~~~~</span><br><span class="line">injected-class-name.cpp:1:7: note: member is declared here</span><br><span class="line">class A &#123; &#125;;</span><br><span class="line">      ^</span><br><span class="line">1 error generated.</span><br></pre></td></tr></table></figure>
<p>What about using <code>B::A</code> or <code>C::A</code>? The same error will occur.</p>
<p>Because name lookup for the base class name in the derived class finds the injected class name:</p>
<blockquote>
<p><strong>[ISO/IEC 14882:2014(E) §11.1.5]</strong> In a derived class, the lookup of a base class name will find the injected-class-name instead of the name of the base class in the scope in which it was declared.</p>
</blockquote>
<p>To resolve such issues, you should qualify the namespace (in the example above, change it to <code>::A</code>):</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> &#123; &#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span> : <span class="keyword">private</span> A &#123; &#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">C</span> : <span class="keyword">public</span> B &#123;</span><br><span class="line">  ::A* p0;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc,<span class="type">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  C cobj;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note that within the scope of the namespace, the default name lookup is namespace qualified.</p>
</blockquote>
<h2 id="A-C-Issue-that-Trims-Words"><a href="#A-C-Issue-that-Trims-Words" class="headerlink" title="A C++ Issue that Trims Words"></a>A C++ Issue that Trims Words</h2><p>Question: <strong>Can a derived class’s object access its base class members?</strong><br>A) Public members of public inheritance<br>B) Private members of public inheritance<br>C) Protected members of public inheritance<br>D) Public members of private inheritance  </p>
<p>At first glance, it seems that derived classes under inheritance using <code>public</code>/<code>protected</code>/<code>private</code> can access base class <code>public</code>/<code>private</code> members, so options A, C, and D seem valid.<br>However, note that the question refers to <strong>objects</strong>; objects can only access public members of the class, hence I have bolded that point in the question. :)</p>
<h2 id="Pointer-to-Integral-Conversion-using-reinterpret-cast"><a href="#Pointer-to-Integral-Conversion-using-reinterpret-cast" class="headerlink" title="Pointer to Integral Conversion using reinterpret_cast"></a>Pointer to Integral Conversion using reinterpret_cast</h2><h3 id="Pointer-to-Integer-Conversion"><a href="#Pointer-to-Integer-Conversion" class="headerlink" title="Pointer to Integer Conversion"></a>Pointer to Integer Conversion</h3><p>A pointer can be explicitly converted to any integral type that can hold it, but the mapping function is <strong>implementation-defined</strong>.<br>The value of type <code>std::nullptr_t</code> can be converted to an integral type, and this conversion is equivalent to converting <code>(void*)0</code> to an integral type.<br><strong>Note</strong>: <code>reinterpret_cast</code> cannot be used to convert any type of value to <code>std::nullptr_t</code>.</p>
<blockquote>
<p><strong>[ISO/IEC 14882:2014 §5.2.10.4]</strong> A pointer can be explicitly converted to any integral type large enough to hold it. The mapping function is implementation-defined. [ Note: It is intended to be unsurprising to those who know the addressing structure of the underlying machine. — end note ] A value of type std::nullptr_t can be converted to an integral type; the conversion has the same meaning and validity as a conversion of (void*)0 to the integral type. [ Note: A reinterpret_cast cannot be used to convert a value of any type to the type std::nullptr_t. — end note ]</p>
</blockquote>
<h3 id="Integral-to-Pointer-Conversion"><a href="#Integral-to-Pointer-Conversion" class="headerlink" title="Integral to Pointer Conversion"></a>Integral to Pointer Conversion</h3><p>Integral or enumeration types can be explicitly converted to pointers. A pointer converted to a sufficiently large integral type (if such exists in the implementation) and back to the same pointer type will retain its original value.<br>This means that this conversion does not result in undefined behavior (the mapping between pointers and integers otherwise remains implementation-defined):</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Compile using c++ compiler</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">uint64_t</span> ival=<span class="number">123</span>;</span><br><span class="line">  <span class="type">uint64_t</span> *pval=&amp;ival;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;ival address is %x.\n&quot;</span>,&amp;ival);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;pval contain address is %x.\n&quot;</span>,pval);</span><br><span class="line"></span><br><span class="line">  <span class="type">uint64_t</span> ui64val=(<span class="type">uint64_t</span>)pval;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;cast uint64_t* to uint64_t result is %x.\n&quot;</span>,ui64val);</span><br><span class="line"></span><br><span class="line">  <span class="type">uint64_t</span> *origVal=(<span class="type">uint64_t</span>*)ui64val;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;cast uint64_t to uint64_t* result is %x.\n&quot;</span>,origVal);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// output</span></span><br><span class="line">ival address is <span class="number">61f</span>e38.</span><br><span class="line">pval contain address is <span class="number">61f</span>e38.</span><br><span class="line">cast <span class="type">uint64_t</span>* to <span class="type">uint64_t</span> result is <span class="number">61f</span>e38.</span><br><span class="line">cast <span class="type">uint64_t</span> to <span class="type">uint64_t</span>* result is <span class="number">61f</span>e38.</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>[ISO/IEC 14882:2014 §5.2.10.5]</strong> A value of integral type or enumeration type can be explicitly converted to a pointer. A pointer converted to an integer of sufficient size (if any such exists on the implementation) and back to the same pointer type will have its original value; mappings between pointers and integers are otherwise implementation-defined. [ Note: Except as described in 3.7.4.3, the result of such a conversion will not be a safely-derived pointer value. — end note ]</p>
</blockquote>
<h3 id="Function-Pointer-Conversion"><a href="#Function-Pointer-Conversion" class="headerlink" title="Function Pointer Conversion"></a>Function Pointer Conversion</h3><p>Function pointers can be explicitly converted to function pointers of different types; calling a function through a converted function pointer may have effects differing from the function defined.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">int</span> ival)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;call func, the ival param is %d\n&quot;</span>,ival);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="built_in">void</span>(*func_i)(<span class="type">int</span>)=func;</span><br><span class="line">  <span class="built_in">void</span>(*func_i_d)(<span class="type">int</span>,<span class="type">double</span>)=<span class="built_in">reinterpret_cast</span>&lt;<span class="built_in">void</span>(*)(<span class="type">int</span>,<span class="type">double</span>)&gt;(func_i);</span><br><span class="line">  <span class="built_in">func_i_d</span>(<span class="number">123</span>,<span class="number">45.6</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Unless converting a type <code>pointer to T1</code> to <code>pointer to T2</code> (where T1 and T2 are function types) and converting back to its original type yields the original pointer value, such pointer conversions result in unspecified behavior.</p>
<blockquote>
<p><strong>[ISO/IEC 14882:2014 §5.2.10.6]</strong> A function pointer can be explicitly converted to a function pointer of a different type. The effect of calling a function through a pointer to a function type (8.3.5) that is not the same as the type used in the definition of the function is undefined. Except that converting a prvalue of type “pointer to T1” to the type “pointer to T2” (where T1 and T2 are function types) and back to its original type yields the original pointer value, the result of such a pointer conversion is unspecified. [ Note: see also 4.10 for more details of pointer conversions. — end note ]</p>
</blockquote>
<h2 id="offsetof-Cannot-Be-Used-on-Non-POD-Types-Standard-Layout"><a href="#offsetof-Cannot-Be-Used-on-Non-POD-Types-Standard-Layout" class="headerlink" title="offsetof Cannot Be Used on Non-POD Types (Standard Layout)"></a>offsetof Cannot Be Used on Non-POD Types (Standard Layout)</h2><p><code>offsetof</code> is a macro defined in <code>stddef.h</code>/<code>cstddef</code> which is used to obtain the offset of a structure member in that structure.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="type">char</span> pad7[<span class="number">7</span>];</span><br><span class="line">  <span class="type">int</span> ival;</span><br><span class="line">  <span class="type">double</span> dval;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;A::ival offset is %d\n&quot;</span>,<span class="built_in">offsetof</span>(A, ival));</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;A::dval offset is %d\n&quot;</span>,<span class="built_in">offsetof</span>(A, dval));</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// output</span></span><br><span class="line">A::ival offset is <span class="number">8</span></span><br><span class="line">A::dval offset is <span class="number">16</span></span><br></pre></td></tr></table></figure>
<p>However, it cannot be used on types that are not <strong>Standard Layout Classes</strong>, as this results in undefined behavior:</p>
<blockquote>
<p><strong>[ISO/IEC 14882:2014 §18.2.4]</strong>: The macro offsetof(type, member-designator) accepts a restricted set of type arguments in this International Standard. <strong>If type is not a standard-layout class (Clause 9), the results are undefined.</strong> The expression offsetof(type, member-designator) is never type-dependent (14.6.2.2) and it is value-dependent (14.6.2.3) if and only if type is dependent. The result of applying the offsetof macro to a field that is a static data member or a function member is undefined. No operation invoked by the offsetof macro shall throw an exception and noexcept(offsetof(type, member-designator)) shall be true.<br><em>Note that offsetof is required to work as specified even if the unary operator&amp; is overloaded for any of the types involved.</em></p>
</blockquote>
<p>Let’s also review what <code>Standard Layout types</code> are:</p>
<blockquote>
<p><strong>[ISO/IEC 14882:2014 §3.9.9]</strong>: <strong>Scalar types</strong>, <strong>standard-layout class types</strong> (Clause 9), <strong>arrays</strong> of such types and cv-qualified versions of these types (3.9.3) are collectively called <strong>standard-layout types</strong>.</p>
</blockquote>
<p>And <code>Standard Layout Class</code> is defined as:<br>A <strong>standard-layout class</strong> is a class that:</p>
<ul>
<li>has no non-static data members of type non-standard-layout class (or an array of such types) or reference,</li>
<li>has no virtual functions (10.3) and no virtual base classes (10.1),</li>
<li>has the same access control (Clause 11) for all non-static data members,</li>
<li>has no non-standard-layout base classes,</li>
<li>either has no non-static data members in the most derived class and at most one base class with non-static data members, or has no base classes with non-static data members, and</li>
<li>has no base classes of the same type as the first non-static data member.</li>
</ul>
<p>That is, if a class contains any of these, it is a non-standard layout class, and <code>offsetof</code> cannot be used on it.</p>
<h2 id="Standard-Layout-Types-in-C"><a href="#Standard-Layout-Types-in-C" class="headerlink" title="Standard Layout Types in C++"></a>Standard Layout Types in C++</h2><p>Let’s also review what <code>Standard Layout types</code> are:</p>
<blockquote>
<p><strong>[ISO/IEC 14882:2014 §3.9.9]</strong>: <strong>Scalar types</strong>, <strong>standard-layout class types</strong> (Clause 9), <strong>arrays</strong> of such types and cv-qualified versions of these types (3.9.3) are collectively called <strong>standard-layout types</strong>.</p>
</blockquote>
<p>And <code>Standard Layout Class</code> is defined as:<br>A <strong>standard-layout class</strong> is a class that:</p>
<ul>
<li>has no non-static data members of type non-standard-layout class (or an array of such types) or reference,</li>
<li>has no virtual functions (10.3) and no virtual base classes (10.1),</li>
<li>has the same access control (Clause 11) for all non-static data members,</li>
<li>has no non-standard-layout base classes,</li>
<li>either has no non-static data members in the most derived class and at most one base class with non-static data members, or has no base classes with non-static data members, and</li>
<li>has no base classes of the same type as the first non-static data member.</li>
</ul>
<h2 id="Placing-“new”-on-the-“this”-Pointer-of-a-Base-Class-Subobject"><a href="#Placing-“new”-on-the-“this”-Pointer-of-a-Base-Class-Subobject" class="headerlink" title="Placing “new” on the “this” Pointer of a Base Class Subobject"></a>Placing “new” on the “this” Pointer of a Base Class Subobject</h2><p>Doing this results in UB; let’s look directly at the code in the standard ([ISO/IEC 14882:2014 §3.8.5]):</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">B</span> &#123;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">f</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">mutate</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="keyword">virtual</span> ~<span class="built_in">B</span>();</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">D1</span> : B &#123; <span class="function"><span class="type">void</span> <span class="title">f</span><span class="params">()</span></span>; &#125;;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">D2</span> : B &#123; <span class="function"><span class="type">void</span> <span class="title">f</span><span class="params">()</span></span>; &#125;;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">B::mutate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">new</span> (<span class="keyword">this</span>) D2; <span class="comment">// reuses storage — ends the lifetime of *this</span></span><br><span class="line">  <span class="built_in">f</span>(); <span class="comment">// undefined behavior</span></span><br><span class="line">  ... = <span class="keyword">this</span>; <span class="comment">// OK, this points to valid memory</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">g</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="type">void</span>* p = std::<span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(D1) + <span class="built_in">sizeof</span>(D2));</span><br><span class="line">  B* pb = <span class="built_in">new</span> (p) D1;</span><br><span class="line">  pb-&gt;<span class="built_in">mutate</span>();</span><br><span class="line">  &amp;pb; <span class="comment">// OK: pb points to valid memory</span></span><br><span class="line">  <span class="type">void</span>* q = pb; <span class="comment">// OK: pb points to valid memory</span></span><br><span class="line">  pb-&gt;<span class="built_in">f</span>(); <span class="comment">// undefined behavior, lifetime of *pb has ended</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The lifetime of <code>this</code> ends after the destructor is called; calling the destructor means all data within that class becomes meaningless, and operating on meaningless data results in UB.</p>
<h2 id="Compiling-32-bit-Programs-with-MinGW-W64"><a href="#Compiling-32-bit-Programs-with-MinGW-W64" class="headerlink" title="Compiling 32-bit Programs with MinGW-W64"></a>Compiling 32-bit Programs with MinGW-W64</h2><p><code>GCC</code> supports the <code>-m32</code> option to compile code to 32-bit programs. However, if your MinGW uses the SEH or DWARF exception model, these are single-platform and do not support 32-bit compilation.<br>There is an answer on <a target="_blank" rel="noopener" href="https://stackoverflow.com/">stackoverflow</a>: <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/19690504/how-do-i-compile-and-link-a-32-bit-windows-executable-using-mingw-w64">How do I compile and link a 32-bit Windows executable using mingw-w64</a><br>There is also a question on CSDN: <a target="_blank" rel="noopener" href="https://bbs.csdn.net/topics/391866590">How to compile a 32-bit program with MinGW-w64</a><br>Solution: You can choose the SJLJ exception model version for download from <a target="_blank" rel="noopener" href="https://qa.debian.org/watch/sf.php/mingw-w64">here</a>, or use <a target="_blank" rel="noopener" href="http://tdm-gcc.tdragon.net/download">TDM GCC</a> (which has only been updated to MinGW5.1.0).</p>
<h2 id="Implicit-Function-Declarations-in-C"><a href="#Implicit-Function-Declarations-in-C" class="headerlink" title="Implicit Function Declarations in C"></a>Implicit Function Declarations in C</h2><p>The following code:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// hw.c</span></span><br><span class="line"><span class="comment">// Note no header files included</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;HelloWorld!\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Compiling with gcc will succeed and execute (with a warning):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ gcc hw.c -o hw.exe</span><br><span class="line">test.c: In <span class="keyword">function</span> <span class="string">&#x27;main&#x27;</span>:</span><br><span class="line">test.c:2:5: warning: implicit declaration of <span class="keyword">function</span> <span class="string">&#x27;printf&#x27;</span> [-Wimplicit-function-declaration]</span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">&quot;HelloWorld!\n&quot;</span>);</span><br><span class="line">     ^~~~~~</span><br><span class="line">test.c:2:5: warning: incompatible implicit declaration of built-in <span class="keyword">function</span> <span class="string">&#x27;printf&#x27;</span></span><br><span class="line">test.c:2:5: note: include <span class="string">&#x27;&lt;stdio.h&gt;&#x27;</span> or provide a declaration of <span class="string">&#x27;printf&#x27;</span></span><br></pre></td></tr></table></figure>
<p>This raises the question: why does my current compilation unit compile successfully without including <code>printf</code>‘s declaration?<br>Because the history of C language supported <code>implicit function declaration</code> (C89 supports implicit declarations):</p>
<blockquote>
<p>[ISO/IEC 9899:1990 6.3.2.2] If the expression that precedes the parenthesized argument list in a function call consists solely of an identifier and if no declaration is visible for this identifier, the identifier is implicitly declared exactly as if, in the innermost block containing the function call, the declaration </p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="type">int</span> <span class="title function_">identifier</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>
<p>However, this feature was removed in C99:</p>
<blockquote>
<p>[ISO/IEC 9899:1999 Foreword] <strong>remove implicit function declaration</strong></p>
</blockquote>
<p>The above code is equivalent to:</p>
<ol>
<li>The compiler implicitly declares the <code>printf</code> function.</li>
<li>The linker defaults to linking <code>stdlib</code>, so there is no undefined symbol linking error.</li>
</ol>
<p>In GCC, if you don’t want the default linking, you can use linker parameters (here are just three of them):</p>
<ul>
<li><strong>-nodefaultlibs</strong>: Does not use standard system libraries; only libraries specified in the compilation parameters will be passed to the linker.</li>
<li><strong>-nostdlib</strong>: Do not use the standard system startup files or libraries when linking.</li>
<li><strong>-nolibc</strong>: Do not use the C library or system libraries tightly coupled with it when linking.</li>
</ul>
<p>More GCC linking parameters can be found here: <a target="_blank" rel="noopener" href="https://gcc.gnu.org/onlinedocs/gcc/Link-Options.html">3.14 Options for Linking</a></p>
<h2 id="Viewing-Object-Memory-Layout-with-Clang"><a href="#Viewing-Object-Memory-Layout-with-Clang" class="headerlink" title="Viewing Object Memory Layout with Clang"></a>Viewing Object Memory Layout with Clang</h2><p>Clang can use the <code>-cc1 -fdump-record-layouts</code> parameters during compilation to view the memory layout of an object.<br>However, using the above command will not search for standard header files from the Path; we need to preprocess the source file first:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ clang++ -E main.c -o main_pp.cpp</span><br></pre></td></tr></table></figure>
<p>Then compile the preprocessed <code>.cpp</code> file with the <code>-cc1 -fdump-record-layouts</code> parameter:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ clang++ -cc1 -fdump-record-layouts main_pp.cpp</span><br></pre></td></tr></table></figure>

<p>Example:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// class_layout.cpp</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">int</span> ival=<span class="number">0</span>)</span></span>&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span>:<span class="keyword">public</span> A&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">int</span> ival=<span class="number">123</span>)</span></span>&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">C</span>:<span class="keyword">public</span> B&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">int</span> ival=<span class="number">123</span>)</span></span>&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  C cobj;</span><br><span class="line">  cobj.<span class="built_in">func</span>();</span><br><span class="line">  B &amp;bobj=cobj;</span><br><span class="line">  bobj.<span class="built_in">func</span>();</span><br><span class="line">  A &amp;aobj=cobj;</span><br><span class="line">  aobj.<span class="built_in">func</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Preprocess:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ clang++ -E class_layout.cpp -o class_layout_pp.cpp</span><br></pre></td></tr></table></figure>
<p>View the memory layout of the three classes:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ clang++ -cc1 -fdump-record-layouts class_layout_pp.cpp</span><br><span class="line">*** Dumping AST Record Layout</span><br><span class="line">         0 | class A</span><br><span class="line">         0 |   (A vtable pointer)</span><br><span class="line">           | [sizeof=8, dsize=8, align=8,</span><br><span class="line">           |  nvsize=8, nvalign=8]</span><br><span class="line"></span><br><span class="line">*** Dumping AST Record Layout</span><br><span class="line">         0 | class B</span><br><span class="line">         0 |   class A (primary base)</span><br><span class="line">         0 |     (A vtable pointer)</span><br><span class="line">           | [sizeof=8, dsize=8, align=8,</span><br><span class="line">           |  nvsize=8, nvalign=8]</span><br><span class="line"></span><br><span class="line">*** Dumping AST Record Layout</span><br><span class="line">         0 | class C</span><br><span class="line">         0 |   class B (primary base)</span><br><span class="line">         0 |     class A (primary base)</span><br><span class="line">         0 |       (A vtable pointer)</span><br><span class="line">           | [sizeof=8, dsize=8, align=8,</span><br><span class="line">           |  nvsize=8, nvalign=8]</span><br></pre></td></tr></table></figure>

<p>Refer to the article: <a target="_blank" rel="noopener" href="https://eli.thegreenplace.net/2012/12/17/dumping-a-c-objects-memory-layout-with-clang/">Dumping a C++ object’s memory layout with Clang</a></p>
<h2 id="Default-Parameters-of-Virtual-Functions-Are-Determined-by-the-Caller’s-Pointer-or-Reference-Static-Type"><a href="#Default-Parameters-of-Virtual-Functions-Are-Determined-by-the-Caller’s-Pointer-or-Reference-Static-Type" class="headerlink" title="Default Parameters of Virtual Functions Are Determined by the Caller’s (Pointer or Reference) Static Type"></a>Default Parameters of Virtual Functions Are Determined by the Caller’s (Pointer or Reference) Static Type</h2><p>Previously, I wrote about this in <a target="_blank" rel="noopener" href="https://imzlp.com/posts/19242/#override%E5%87%BD%E6%95%B0%E4%B8%8D%E4%BC%9A%E8%A6%86%E7%9B%96%E5%85%B6%E5%8E%9F%E6%9C%89%E9%BB%98%E8%AE%A4%E5%8F%82%E6%95%B0">C/C++ Standards Excerpts #override functions do not override their original default parameters</a>, but not in enough detail, so I’ll elaborate here.</p>
<p>Consider the following code:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">int</span> ival=<span class="number">0</span>)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    std::cout&lt;&lt;<span class="string">&quot;A::func, arg is &quot;</span>&lt;&lt;ival&lt;&lt;endl;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span>:<span class="keyword">public</span> A&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">int</span> ival=<span class="number">123</span>)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    std::cout&lt;&lt;<span class="string">&quot;B::func, arg is &quot;</span>&lt;&lt;ival&lt;&lt;endl;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">C</span>:<span class="keyword">public</span> B&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">int</span> ival=<span class="number">456</span>)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    std::cout&lt;&lt;<span class="string">&quot;C::func, arg is &quot;</span>&lt;&lt;ival&lt;&lt;endl;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  C cobj;</span><br><span class="line">  cobj.<span class="built_in">func</span>(); <span class="comment">// print what?</span></span><br><span class="line">  B &amp;bobj=cobj;</span><br><span class="line">  bobj.<span class="built_in">func</span>(); <span class="comment">// print what?</span></span><br><span class="line">  A &amp;aobj=cobj;</span><br><span class="line">  aobj.<span class="built_in">func</span>(); <span class="comment">// print what?</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// output</span></span><br><span class="line">C::func,arg is <span class="number">456</span></span><br><span class="line">C::func,arg is <span class="number">123</span></span><br><span class="line">C::func,arg is <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>The C++ standard stipulates the description concerning the use of default parameters for virtual functions:</p>
<blockquote>
<p>[ISO/IEC 14882:2014] A virtual function call (10.3) uses the default arguments in the declaration of the virtual function determined by the static type of the pointer or reference denoting the object.</p>
</blockquote>
<p>That is, the use of default parameters for a virtual function is determined by the static type of the pointer or reference denoting the object executing that virtual function call.<br>From the above example:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  C cobj;</span><br><span class="line">  cobj.<span class="built_in">func</span>(); <span class="comment">// The static type of the object executing the virtual function call is C, so the default parameter used is that declared in C::func, which is 456.</span></span><br><span class="line">  B &amp;bobj=cobj;</span><br><span class="line">  bobj.<span class="built_in">func</span>(); <span class="comment">// The static type of the object executing the virtual function call is B, so the default parameter used is that of B::func, which is 123.</span></span><br><span class="line">  A &amp;aobj=cobj;</span><br><span class="line">  aobj.<span class="built_in">func</span>(); <span class="comment">// The static type of the object executing the virtual function call is A, thus the default parameter used is A::func, which is 0.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Thus, the default parameters of polymorphic functions are not dynamically bound; they are determined at compile time based on the type of the object and which default parameter to use.<br>Let’s take a look at the LLVM-IR code of the above:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">define i32 @<span class="built_in">main</span>() #<span class="number">4</span> &#123;</span><br><span class="line">  %<span class="number">1</span> = alloca %<span class="keyword">class</span>.C, align <span class="number">8</span></span><br><span class="line">  %<span class="number">2</span> = alloca %<span class="keyword">class</span>.B*, align <span class="number">8</span></span><br><span class="line">  %<span class="number">3</span> = alloca %<span class="keyword">class</span>.A*, align <span class="number">8</span></span><br><span class="line">  <span class="comment">// Constructor for class C</span></span><br><span class="line">  call <span class="type">void</span> @_ZN1CC2Ev(%<span class="keyword">class</span>.C* %<span class="number">1</span>) #<span class="number">3</span></span><br><span class="line">  <span class="comment">// Call func directly through the C type object cobj</span></span><br><span class="line">  call <span class="type">void</span> @_ZN1C4funcEi(%<span class="keyword">class</span>.C* %<span class="number">1</span>, i32 <span class="number">456</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Call func using a reference bobj of type B</span></span><br><span class="line">  %<span class="number">4</span> = bitcast %<span class="keyword">class</span>.C* %<span class="number">1</span> to %<span class="keyword">class</span>.B*</span><br><span class="line">  store %<span class="keyword">class</span>.B* %<span class="number">4</span>, %<span class="keyword">class</span>.B** %<span class="number">2</span>, align <span class="number">8</span></span><br><span class="line">  %<span class="number">5</span> = load %<span class="keyword">class</span>.B*, %<span class="keyword">class</span>.B** %<span class="number">2</span>, align <span class="number">8</span></span><br><span class="line">  %<span class="number">6</span> = bitcast %<span class="keyword">class</span>.B* %<span class="number">5</span> to <span class="built_in">void</span> (%<span class="keyword">class</span>.B*, i32)***</span><br><span class="line">  %<span class="number">7</span> = load <span class="built_in">void</span> (%<span class="keyword">class</span>.B*, i32)**, <span class="built_in">void</span> (%<span class="keyword">class</span>.B*, i32)*** %<span class="number">6</span>, align <span class="number">8</span></span><br><span class="line">  %<span class="number">8</span> = getelementptr inbounds <span class="built_in">void</span> (%<span class="keyword">class</span>.B*, i32)*, <span class="built_in">void</span> (%<span class="keyword">class</span>.B*, i32)** %<span class="number">7</span>, i64 <span class="number">0</span></span><br><span class="line">  %<span class="number">9</span> = load <span class="built_in">void</span> (%<span class="keyword">class</span>.B*, i32)*, <span class="built_in">void</span> (%<span class="keyword">class</span>.B*, i32)** %<span class="number">8</span>, align <span class="number">8</span></span><br><span class="line">  <span class="comment">// The default parameter for this call has already been determined at compile time as that of B::func, which is not postponed to dynamic binding</span></span><br><span class="line">  call <span class="type">void</span> %<span class="number">9</span>(%<span class="keyword">class</span>.B* %<span class="number">5</span>, i32 <span class="number">123</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Call func using a reference aobj of type A</span></span><br><span class="line">  %<span class="number">10</span> = bitcast %<span class="keyword">class</span>.C* %<span class="number">1</span> to %<span class="keyword">class</span>.A*</span><br><span class="line">  store %<span class="keyword">class</span>.A* %<span class="number">10</span>, %<span class="keyword">class</span>.A** %<span class="number">3</span>, align <span class="number">8</span></span><br><span class="line">  %<span class="number">11</span> = load %<span class="keyword">class</span>.A*, %<span class="keyword">class</span>.A** %<span class="number">3</span>, align <span class="number">8</span></span><br><span class="line">  %<span class="number">12</span> = bitcast %<span class="keyword">class</span>.A* %<span class="number">11</span> to <span class="built_in">void</span> (%<span class="keyword">class</span>.A*, i32)***</span><br><span class="line">  %<span class="number">13</span> = load <span class="built_in">void</span> (%<span class="keyword">class</span>.A*, i32)**, <span class="built_in">void</span> (%<span class="keyword">class</span>.A*, i32)*** %<span class="number">12</span>, align <span class="number">8</span></span><br><span class="line">  %<span class="number">14</span> = getelementptr inbounds <span class="built_in">void</span> (%<span class="keyword">class</span>.A*, i32)*, <span class="built_in">void</span> (%<span class="keyword">class</span>.A*, i32)** %<span class="number">13</span>, i64 <span class="number">0</span></span><br><span class="line">  %<span class="number">15</span> = load <span class="built_in">void</span> (%<span class="keyword">class</span>.A*, i32)*, <span class="built_in">void</span> (%<span class="keyword">class</span>.A*, i32)** %<span class="number">14</span>, align <span class="number">8</span></span><br><span class="line">  <span class="comment">// The default parameter for this call has already been determined at compile time as that of A::func, which is not postponed to dynamic binding</span></span><br><span class="line">  call <span class="type">void</span> %<span class="number">15</span>(%<span class="keyword">class</span>.A* %<span class="number">11</span>, i32 <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="C-Lambda-Captures"><a href="#C-Lambda-Captures" class="headerlink" title="C++ Lambda Captures"></a>C++ Lambda Captures</h2><p>In a previous article (<a target="_blank" rel="noopener" href="https://imzlp.com/posts/19441/">How Lambda is Implemented in Compilers</a>), I mentioned that the result of a Lambda is essentially a class that overloads <code>()</code>.<br>However, regarding the capture aspect, it needs to be noted: how is the number of captures determined? If using value capture <code>[=]</code> or reference capture <code>[&amp;]</code>, will all previous data be treated as members of that Lambda?</p>
<p>With this question in mind, let’s explore this.<br>First, let’s state the conclusion: using default captures <code>[&amp;]</code>/<code>[=]</code> does not capture all the objects above into the Lambda. Instead, only objects actually used within the Lambda expression are captured.</p>
<p>Look at the following example:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="type">int</span> a=<span class="number">456</span>;<span class="keyword">class</span> <span class="title class_">A</span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">A</span>()&#123;&#125;</span><br><span class="line">  <span class="built_in">A</span>(<span class="type">const</span> A&amp; aobj):a&#123;aobj.a&#125;&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> a=<span class="number">123</span>;</span><br><span class="line">  A aobj;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">auto</span> lambdaObj=[=]()&#123;cout&lt;&lt;a&lt;&lt;<span class="string">&#x27;\t&#x27;</span>&lt;&lt;aobj.a&lt;&lt;endl;&#125;;</span><br><span class="line">  cout&lt;&lt;<span class="built_in">sizeof</span>(lambdaObj)&lt;&lt;endl;</span><br><span class="line">  <span class="built_in">lambdaObj</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// output</span></span><br><span class="line"><span class="number">8</span></span><br><span class="line"><span class="number">123</span>     <span class="number">456</span></span><br></pre></td></tr></table></figure>
<p>First, let’s look at the members of this closure object (LLVM-IR):</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// class A</span></span><br><span class="line">%<span class="keyword">class</span>.A = type &#123; i32 &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// lambdaObj class type</span></span><br><span class="line">%<span class="keyword">class</span>.anon = type &#123; i32, %<span class="keyword">class</span>.A &#125;</span><br></pre></td></tr></table></figure>
<p>Since it’s a value capture, the members of this closure object all make a copy.</p>
<p>Initially, I assumed that the generated closure object should have a constructor initializing with the captured parameters, but I’m not sure if it’s because LLVM optimizes or something else, no constructor was evidently produced. The initialization part of the captures is as follows:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">define i32 @<span class="built_in">main</span>() #<span class="number">4</span> &#123;</span><br><span class="line">  %<span class="number">1</span> = alloca i32, align <span class="number">4</span></span><br><span class="line">  %<span class="number">2</span> = alloca %<span class="keyword">class</span>.A, align <span class="number">4</span></span><br><span class="line">  store i32 <span class="number">123</span>, i32* %<span class="number">1</span>, align <span class="number">4</span></span><br><span class="line">  call <span class="type">void</span> @_ZN1AC2Ev(%<span class="keyword">class</span>.A* %<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Generated closure object</span></span><br><span class="line">  %<span class="number">3</span> = alloca %<span class="keyword">class</span>.anon, align <span class="number">4</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Assign captured parameters to the class parameters</span></span><br><span class="line">  %<span class="number">4</span> = getelementptr inbounds %<span class="keyword">class</span>.anon, %<span class="keyword">class</span>.anon* %<span class="number">3</span>, i32 <span class="number">0</span>, i32 <span class="number">0</span></span><br><span class="line">  %<span class="number">5</span> = load i32, i32* %<span class="number">1</span>, align <span class="number">4</span></span><br><span class="line">  store i32 %<span class="number">5</span>, i32* %<span class="number">4</span>, align <span class="number">4</span></span><br><span class="line">  %<span class="number">6</span> = getelementptr inbounds %<span class="keyword">class</span>.anon, %<span class="keyword">class</span>.anon* %<span class="number">3</span>, i32 <span class="number">0</span>, i32 <span class="number">1</span></span><br><span class="line">  <span class="comment">// Call closure object&#x27;s member A&#x27;s copy constructor A::A(const A&amp;)</span></span><br><span class="line">  call <span class="type">void</span> @_ZN1AC2ERKS_(%<span class="keyword">class</span>.A* %<span class="number">6</span>, %<span class="keyword">class</span>.A* <span class="built_in">dereferenceable</span>(<span class="number">4</span>) %<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Functions-Types-Typedef-Cannot-Be-Used-in-Definitions"><a href="#Functions-Types-Typedef-Cannot-Be-Used-in-Definitions" class="headerlink" title="Functions Types Typedef Cannot Be Used in Definitions"></a>Functions Types Typedef Cannot Be Used in Definitions</h2><p>Consider the following situation:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="type">void</span> <span class="title">Func</span><span class="params">(<span class="type">int</span>)</span></span>;</span><br><span class="line">Func TestFunc; <span class="comment">// OK</span></span><br><span class="line">Func TestFunc2&#123;&#125; <span class="comment">// ill-formed</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>[ISO/IEC 14882:2014 §8.3.5.10] A typedef of function type may be used to declare a function but shall not be used to define a function (8.4).</p>
</blockquote>
<h2 id="Lambda-Expressions-Syntax"><a href="#Lambda-Expressions-Syntax" class="headerlink" title="Lambda-Expressions Syntax"></a>Lambda-Expressions Syntax</h2><p>First, let’s look at the syntax description of Lambda-Expressions in the C++ standard (note that it is recursively described):<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/notes/cpp/index/lambda-expressions-syntex.webp" alt="index"><br>What does the following code express?</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  []()&#123;&#125;;</span><br><span class="line">  []&#123;&#125;();</span><br><span class="line">  &#123;&#125;[]&#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>First, look at the first line:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[]()&#123;&#125;;</span><br></pre></td></tr></table></figure>
<p>This line declares an unnamed closure object using a lambda expression, without captures, parameters, or any implementation.</p>
<p>The second line:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[]&#123;&#125;();</span><br></pre></td></tr></table></figure>
<p>This is interesting; according to the above <code>Lambda-Expression Syntax</code> diagram, the <code>$&#123;lambda\textrm&#123;-&#125;declarator&#125;\_&#123;opt&#125;$</code> is <code>Opt</code>, indicating it may be omitted.<br>The <code>$&#123;lambda\textrm&#123;-&#125;declarator&#125;$</code> includes `${(parameter\textrm{-}declaration\textrm{-}clause) mutable}_{opt}$, suggesting the parameter list can be omitted at the lambda expression declaration.<br>That means:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> lambdaObj=[]()&#123;&#125;;</span><br><span class="line"><span class="comment">// Can be written as</span></span><br><span class="line"><span class="keyword">auto</span> lambdaObj=[]&#123;&#125;;</span><br></pre></td></tr></table></figure>
<p>Thus, we can interpret the first half of the second line as declaring a <code>closure object</code>, while the final <code>();</code> calls this closure object.</p>
<p>The third line:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#125;[]&#123;&#125;;</span><br></pre></td></tr></table></figure>
<p>This line can also be written as:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">[]&#123;&#125;;</span><br></pre></td></tr></table></figure>
<p>A <code>block</code> followed by a lambda expression that creates an unnamed closure object.</p>
<h2 id="A-Pitfall-in-C-Declaration-Semantics"><a href="#A-Pitfall-in-C-Declaration-Semantics" class="headerlink" title="A Pitfall in C++ Declaration Semantics"></a>A Pitfall in C++ Declaration Semantics</h2><p>What is wrong with the following code? What will it output?</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">T</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    std::<span class="built_in">string</span>(hw);</span><br><span class="line">    std::cout&lt;&lt;hw&lt;&lt;std::endl;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  std::string hw&#123;<span class="string">&quot;helloworld&quot;</span>&#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc,<span class="type">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  T Obj;</span><br><span class="line">  Obj.<span class="built_in">print</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The answer is it will output nothing!<br>The actual execution semantics is not as we might expect; it creates a temporary <code>std::string</code> variable and then executes the destructor of that temporary variable.<br>This is because of C++’s declaration semantics rule:<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/notes/cpp/index/cpp-declara-syntax.webp"><br>Note that the above diagram is recursively defined.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">std::<span class="built_in">string</span>(hw);</span><br><span class="line"><span class="comment">// Equivalent to</span></span><br><span class="line">std::string hw;</span><br><span class="line"><span class="comment">// Of course, this is also equivalent</span></span><br><span class="line">std::<span class="built_in">string</span> ((((((hw))))));</span><br></pre></td></tr></table></figure>
<p>So, in the <code>print</code> function, a local <code>std::string</code> variable <code>hw</code> is created that hides the class-scope <code>hw</code>.<br>The solution: replace <code>()</code> with <code>&#123;&#125;</code>; in the previous case, using the initializer list will call the copy constructor and immediately destroy the temporary object.</p>
<p>In the current example, the problem is not severe. However, if this kind of operation is done on locks in multithreading, it could be highly problematic.</p>
<h2 id="Why-VC-Outputs-“烫烫烫”-for-Out-of-Bounds-Access"><a href="#Why-VC-Outputs-“烫烫烫”-for-Out-of-Bounds-Access" class="headerlink" title="Why VC Outputs “烫烫烫” for Out-of-Bounds Access"></a>Why VC Outputs “烫烫烫” for Out-of-Bounds Access</h2><p>When I learned C language years ago with VC, I encountered the output “烫烫烫” and similar “garbled” text when memory access went out of bounds.<br>For example, the following code (compiled with vs2017-debug-x86):</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">char</span> NoInitCharArray[<span class="number">10</span>];</span><br><span class="line">  std::cout &lt;&lt; NoInitCharArray &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Using x32dbg debugger:<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/notes/cpp/index/x32dbg-NoInitCharArray.webp"></p>
<p>Through IDA debugger:<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/notes/cpp/index/IDA-NoInitCharArray.webp"></p>
<p>Output result:<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/notes/cpp/index/IDA-0xCC-Debug.webp"></p>
<p>This occurs because in the <code>debug</code> mode, VC sets uninitialized memory to <code>0xCC</code>, which in GBK encoding represents <code>烫</code>.</p>
<h2 id="A-Bug-in-Clang"><a href="#A-Bug-in-Clang" class="headerlink" title="A Bug in Clang"></a>A Bug in Clang</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">test</span><span class="params">(<span class="type">int</span>)</span></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;aaa\n&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="type">void</span> _ZN1A4testEi(A*,<span class="type">int</span>)&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;bbb\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  A a;</span><br><span class="line">  a.<span class="built_in">test</span>(<span class="number">123</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The above code compiles and runs in Clang with the output <code>bbb</code> (the same behavior is present in the latest Clang5.0). In contrast, GCC generates a redefinition error.<br>I’ve dug a hole here and will analyze this problem later.</p>
<h2 id="Differences-Between-ISO-C-and-POSIX-Definitions-of-Byte"><a href="#Differences-Between-ISO-C-and-POSIX-Definitions-of-Byte" class="headerlink" title="Differences Between ISO C and POSIX Definitions of Byte"></a>Differences Between ISO C and POSIX Definitions of Byte</h2><h3 id="ISO-C"><a href="#ISO-C" class="headerlink" title="ISO C"></a>ISO C</h3><blockquote>
<p><strong>byte</strong><br>addressable unit of data storage large enough to hold any member of the basic character set of the execution environment<br><strong>NOTE 1</strong> It is possible to express the address of each individual byte of an object uniquely.<br><strong>NOTE 2</strong> A byte is composed of a contiguous sequence of bits, the number of which is implementation-defined. The least significant bit is called the low-order bit; the most significant bit is called the high-order bit.</p>
</blockquote>
<h3 id="POSIX"><a href="#POSIX" class="headerlink" title="POSIX"></a>POSIX</h3><blockquote>
<p><strong>Byte</strong><br>An individually addressable unit of data storage that is exactly an octet, used to store a character or a portion of a character; see also Section 3.87 (on page 47). A byte is composed of a contiguous sequence of 8 bits. The least significant bit is called the ‘low-order’ bit; the most significant is called the ‘high-order’ bit.<br>Note: The definition of byte from the ISO C standard is broader than the above and might accommodate hardware architectures with different-sized addressable units than octets.</p>
</blockquote>
<h2 id="Size-of-Reference-Member-of-Class"><a href="#Size-of-Reference-Member-of-Class" class="headerlink" title="Size of Reference Member of Class"></a>Size of Reference Member of Class</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ATest</span>&#123;</span><br><span class="line">  <span class="built_in">ATest</span>(<span class="type">int</span> &amp;x):<span class="built_in">y</span>(a)&#123;&#125;</span><br><span class="line">  <span class="type">int</span> &amp;y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// The size?</span></span><br><span class="line"><span class="built_in">sizeof</span>(ATest);</span><br></pre></td></tr></table></figure>
<p>The layout of class <code>ATest</code> in LLVM/Clang compiles into memory layout as:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%struct.ATest = type &#123; i32* &#125;</span><br></pre></td></tr></table></figure>
<p>As for why references are treated as pointers, please see <a target="_blank" rel="noopener" href="https://imzlp.com/posts/1756/#%E5%BC%95%E7%94%A8%E7%9A%84%E5%AE%9E%E7%8E%B0">the implementation of references</a>.<br>Thus, <code>sizeof(ATest)</code> will produce a result of 8 in this implementation.</p>
<h2 id="What-is-Translation-Unit-in-C-C"><a href="#What-is-Translation-Unit-in-C-C" class="headerlink" title="What is Translation Unit in C/C++?"></a>What is Translation Unit in C/C++?</h2><blockquote>
<p>[ISO/IEC 14882:2014]A source file together with all the headers (17.6.1.2) and source files included (16.2) via the preprocessing directive <code>#include</code>, less any source lines skipped by any of the conditional inclusion (16.1) preprocessing directives, is called a <strong>translation unit</strong>. [ Note: A C ++ program need not all be translated at the same time. — end note ]</p>
</blockquote>
<blockquote>
<p>[ISO/IEC 9899:1999]<br>A source file together with all the headers and source files included via the preprocessing directive <code>#include</code> is known as a <strong>preprocessing translation unit</strong>. After preprocessing, a preprocessing translation unit is called a <strong>translation unit</strong>.</p>
</blockquote>
<h2 id="Variable-Access-Across-Scope-in-C"><a href="#Variable-Access-Across-Scope-in-C" class="headerlink" title="Variable Access Across Scope in C"></a>Variable Access Across Scope in C</h2><p>If you have the following <strong>C</strong> code and compile it using a C compiler.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> i=<span class="number">123</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">(<span class="type">void</span>)</span></span>&#123;</span><br><span class="line">  <span class="type">int</span> i =<span class="number">456</span>;</span><br><span class="line">  <span class="comment">// How to access the external i?</span></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Because the concept of <code>namespace</code> does not exist in C, you cannot use <code>::</code> as in C++. However, you can use the following trick to achieve this:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> i=<span class="number">123</span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="type">int</span> i=<span class="number">456</span>;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">extern</span> <span class="type">int</span> i;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,i);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Google-C-Style-Guide"><a href="#Google-C-Style-Guide" class="headerlink" title="Google C++ Style Guide"></a>Google C++ Style Guide</h2><p>Simplified image version:<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/notes/cpp/index/GoogleCppStyleGuide.webp"><br>Chinese PDF version:</p>
<div class="pdfobject-container" data-target="https://img.imzlp.com/imgs/zlp/blog/notes/cpp/index/Google.C++.Progeamming.Guide.pdf" data-height="700px"></div>

<h2 id="C-17-Feature-Cheat-Sheet"><a href="#C-17-Feature-Cheat-Sheet" class="headerlink" title="C++17 Feature Cheat Sheet"></a>C++17 Feature Cheat Sheet</h2><div class="pdfobject-container" data-target="https://img.imzlp.com/imgs/zlp/blog/notes/cpp/index/Language.Features.of.CPP17.pdf" data-height="700px"></div>

<h2 id="Value-Category-Cheat-Sheet"><a href="#Value-Category-Cheat-Sheet" class="headerlink" title="Value Category Cheat Sheet"></a>Value Category Cheat Sheet</h2><div class="pdfobject-container" data-target="https://img.imzlp.com/imgs/zlp/blog/notes/cpp/index/value-category-cheatsheet.pdf" data-height="700px"></div>


<h2 id="New-Features-and-Compatibility-of-C-11"><a href="#New-Features-and-Compatibility-of-C-11" class="headerlink" title="New Features and Compatibility of C++11"></a>New Features and Compatibility of C++11</h2><div class="pdfobject-container" data-target="https://img.imzlp.com/imgs/zlp/blog/notes/cpp/index/TC++PL-Compatibility.pdf" data-height="700px"></div>

<h2 id="new-Constructors-and-Exceptions"><a href="#new-Constructors-and-Exceptions" class="headerlink" title="new, Constructors, and Exceptions"></a>new, Constructors, and Exceptions</h2><p>The new operation actually consists of two parts:</p>
<ol>
<li>First, it calls operator new to allocate memory.</li>
<li>Calls the constructor of the object.</li>
</ol>
<blockquote>
<p>Evaluation of a new expression invokes one or more allocation and constructor functions; see 5.3.4</p>
</blockquote>
<p>This is important because, although there are generally no issues, it becomes crucial when considering exception safety: How to determine if an exception was thrown by operator new or the class constructor when newing an object?<br>If operator new throws an exception, no memory is allocated (throwing std::bad_alloc), and thus operator delete should not be called. However, if an exception is thrown in the class constructor, it means memory has been allocated, so we need to call operator delete for cleanup.</p>
<h2 id="Meaning-of-Pointer-Comparison"><a href="#Meaning-of-Pointer-Comparison" class="headerlink" title="Meaning of Pointer Comparison"></a>Meaning of Pointer Comparison</h2><p>In C++, an object can have multiple valid addresses; therefore, pointer comparison is not about addresses but about object identity.</p>
<h2 id="Common-Terminology-Errors-in-C"><a href="#Common-Terminology-Errors-in-C" class="headerlink" title="Common Terminology Errors in C++"></a>Common Terminology Errors in C++</h2><p>A common issue is that different languages use different terminologies to describe the same behavior. For example, Java or other languages use <code>method</code> to describe functions within a class, while C++ does not have the concept of <code>method</code>; it should be called <code>member function</code>.<br>Here are some commonly misused terms in C++:</p>
<table>
<thead>
<tr>
<th align="center">Wrong</th>
<th align="center">Right</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Pure virtual base class</td>
<td align="center">Abstract class</td>
</tr>
<tr>
<td align="center">Method</td>
<td align="center">Member function</td>
</tr>
<tr>
<td align="center">Virtual method</td>
<td align="center">???</td>
</tr>
<tr>
<td align="center">Destructed</td>
<td align="center">Destroyed</td>
</tr>
<tr>
<td align="center">Cast operator</td>
<td align="center">Conversion operator</td>
</tr>
</tbody></table>
<h2 id="Why-Have-References"><a href="#Why-Have-References" class="headerlink" title="Why Have References?"></a>Why Have References?</h2><p>I believe there are two fundamental reasons for references in C++:</p>
<ol>
<li>To prevent the overhead of object copying (more concise than pointer indirection).</li>
<li>For IO stream usage (for instance, cout&lt;&lt;x&lt;&lt;y returns a reference to the stream, equivalent to using cout&lt;&lt;x, cout&lt;&lt;y).</li>
</ol>
<h2 id="Reasons-for-Certain-Language-Features-in-C"><a href="#Reasons-for-Certain-Language-Features-in-C" class="headerlink" title="Reasons for Certain Language Features in C++"></a>Reasons for Certain Language Features in C++</h2><ul>
<li>Namespaces provide a mechanism to deal with the same names in different libraries.</li>
<li>Exception handling establishes a basis for a common model for error handling.</li>
<li>Templates provide a mechanism for defining container classes and algorithms independent of specific types, where specific types can be provided by the user or other libraries.</li>
<li>Constructors and destructors provide a common model for object initialization and final cleanup.</li>
<li>Abstract classes provide a mechanism to define interfaces independently, regardless of the actual classes that implement them.</li>
<li>Runtime type information is a mechanism to retrieve type information because when an object is passed to a library and returned, it may only carry insufficiently specific (base class) type information.</li>
</ul>

      </div>
      
      
      
    </div>
    
  <ul class="breadcrumb">
          
            <li><a href="/notes/">NOTES</a></li>
          <li>CPP</li>
        
  </ul>

    
    
    


          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Error-of-using-alias-in-friend"><span class="nav-number">1.</span> <span class="nav-text">Error of using alias in friend</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Clang-compiles-C-to-WebAssembly"><span class="nav-number">2.</span> <span class="nav-text">Clang compiles C++ to WebAssembly</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#LLVM%E2%80%99s-built-in-IR-interpreter"><span class="nav-number">3.</span> <span class="nav-text">LLVM’s built-in IR interpreter</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#C-23-The-Next-C-Standard"><span class="nav-number">4.</span> <span class="nav-text">C++23: The Next C++ Standard</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Standalone-Build-of-MinGW-w64-for-Windows"><span class="nav-number">5.</span> <span class="nav-text">Standalone Build of MinGW-w64 for Windows</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#nodiscard"><span class="nav-number">6.</span> <span class="nav-text">[[nodiscard]]</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#C99-VAL-are-turing-complete"><span class="nav-number">7.</span> <span class="nav-text">C99 VAL are turing complete</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Disable-specific-numbered-warnings"><span class="nav-number">8.</span> <span class="nav-text">Disable specific numbered warnings</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Why-can%E2%80%99t-a-constructor-take-an-address"><span class="nav-number">9.</span> <span class="nav-text">Why can’t a constructor take an address?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Type-extraction-via-template-specialization"><span class="nav-number">10.</span> <span class="nav-text">Type extraction via template specialization</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Friendship-cannot-be-inherited"><span class="nav-number">11.</span> <span class="nav-text">Friendship cannot be inherited</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Scoped-enum"><span class="nav-number">12.</span> <span class="nav-text">Scoped enum</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#LoadLibrary-faild"><span class="nav-number">13.</span> <span class="nav-text">LoadLibrary faild</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Attention-when-using-in-Preprocessing"><span class="nav-number">14.</span> <span class="nav-text">Attention when using ## in Preprocessing</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Implementation-of-delete-in-C"><span class="nav-number">15.</span> <span class="nav-text">Implementation of delete[] in C++</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Memory-Breakpoints-in-VS"><span class="nav-number">16.</span> <span class="nav-text">Memory Breakpoints in VS</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Difference-between-move-and-forward"><span class="nav-number">17.</span> <span class="nav-text">Difference between move and forward</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Overloading-Rules-for-rvalue-and-lvalue"><span class="nav-number">18.</span> <span class="nav-text">Overloading Rules for rvalue and lvalue</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Implementing-non-const-lvalue-version"><span class="nav-number">18.1.</span> <span class="nav-text">Implementing non-const lvalue version</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Implementing-const-lvalue-version"><span class="nav-number">18.2.</span> <span class="nav-text">Implementing const lvalue version</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Only-implementing-rvalue-version"><span class="nav-number">18.3.</span> <span class="nav-text">Only implementing rvalue version</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Having-both-rvalue-and-lvalue-versions"><span class="nav-number">18.4.</span> <span class="nav-text">Having both rvalue and lvalue versions</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Conclusion"><span class="nav-number">18.5.</span> <span class="nav-text">Conclusion</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#rvalue-and-lvalue"><span class="nav-number">19.</span> <span class="nav-text">rvalue and lvalue</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#C-Object-Destruction-Order"><span class="nav-number">20.</span> <span class="nav-text">C++ Object Destruction Order</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Postfix-amp-and-amp-amp-Modifiers-of-C-Functions"><span class="nav-number">21.</span> <span class="nav-text">Postfix &amp; and &amp;&amp; Modifiers of C++ Functions</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Static-Linkage-Issue"><span class="nav-number">22.</span> <span class="nav-text">Static Linkage Issue</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Placement-new-Compilation-Errors"><span class="nav-number">23.</span> <span class="nav-text">Placement-new Compilation Errors</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#The-Next-Big-Thing-C-20"><span class="nav-number">24.</span> <span class="nav-text">The Next Big Thing: C++20</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Variable-Optimized-and-Not-Available"><span class="nav-number">25.</span> <span class="nav-text">Variable Optimized and Not Available</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#C5083-Error"><span class="nav-number">26.</span> <span class="nav-text">C5083 Error</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Property-Macros-in-VS"><span class="nav-number">27.</span> <span class="nav-text">Property Macros in VS</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Link-Error-When-Using-Win-Libraries-Without-Linking-Library"><span class="nav-number">28.</span> <span class="nav-text">Link Error When Using Win Libraries Without Linking Library</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Link-Error-LINK1112-When-Introducing-External-Libraries"><span class="nav-number">29.</span> <span class="nav-text">Link Error LINK1112 When Introducing External Libraries</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#LINK2038-Link-Error-When-Importing-External-Libraries"><span class="nav-number">30.</span> <span class="nav-text">LINK2038 Link Error When Importing External Libraries</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Precompiled-C1010-Error"><span class="nav-number">31.</span> <span class="nav-text">Precompiled C1010 Error</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#In-Class-Default-Values-and-Constructor-Initialization-Order"><span class="nav-number">32.</span> <span class="nav-text">In-Class Default Values and Constructor Initialization Order</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Template-Specialization-for-Variable-Templates"><span class="nav-number">33.</span> <span class="nav-text">Template Specialization for Variable Templates</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#What-is-the-Object-in-C-C"><span class="nav-number">34.</span> <span class="nav-text">What is the Object in C&#x2F;C++?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Why-C-Templates-Must-Provide-Declarations-and-Definitions"><span class="nav-number">35.</span> <span class="nav-text">Why C++ Templates Must Provide Declarations and Definitions</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Changing-File-Encoding-in-VS"><span class="nav-number">36.</span> <span class="nav-text">Changing File Encoding in VS</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Static-Members-of-C-Template-Specialization-Instances"><span class="nav-number">37.</span> <span class="nav-text">Static Members of C++ Template Specialization Instances</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#The-Reason-Why-this-Cannot-Be-Used-as-Default-Parameters-in-Functions"><span class="nav-number">38.</span> <span class="nav-text">The Reason Why this Cannot Be Used as Default Parameters in Functions</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Extracting-the-Number-of-Elements-in-an-Array"><span class="nav-number">39.</span> <span class="nav-text">Extracting the Number of Elements in an Array</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Bin2Hex"><span class="nav-number">40.</span> <span class="nav-text">Bin2Hex</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Reading-and-Writing-Binary-Files-in-C"><span class="nav-number">41.</span> <span class="nav-text">Reading and Writing Binary Files in C</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#GNU-Extension-struct-Initialization-first-%E2%80%A6-last"><span class="nav-number">42.</span> <span class="nav-text">GNU Extension: struct Initialization [first … last]</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Static-Member-Initialization-Can-Access-Private-Members"><span class="nav-number">43.</span> <span class="nav-text">Static Member Initialization Can Access Private Members</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Usage-of"><span class="nav-number">44.</span> <span class="nav-text">Usage of !!</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Enums-in-the-C-Language-are-Just-Integers"><span class="nav-number">45.</span> <span class="nav-text">Enums in the C Language are Just Integers</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Pure-Virtual-Functions-in-C-Cannot-Provide-Definitions"><span class="nav-number">46.</span> <span class="nav-text">Pure Virtual Functions in C++ Cannot Provide Definitions</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Regular-Expression-for-Matching-C-Function-Declarations"><span class="nav-number">47.</span> <span class="nav-text">Regular Expression for Matching C Function Declarations</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Aggregation-Structure-Initialization-in-C"><span class="nav-number">48.</span> <span class="nav-text">Aggregation Structure Initialization in C</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Function-Calls-via-Function-Pointers-Cannot-Use-Default-Parameters"><span class="nav-number">49.</span> <span class="nav-text">Function Calls via Function Pointers Cannot Use Default Parameters</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Unspecified-Behavior"><span class="nav-number">50.</span> <span class="nav-text">Unspecified Behavior</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Well-formed-Program"><span class="nav-number">51.</span> <span class="nav-text">Well-formed Program</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Implementation-Defined-Behavior"><span class="nav-number">52.</span> <span class="nav-text">Implementation-Defined Behavior</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Undefined-Behavior-UB"><span class="nav-number">53.</span> <span class="nav-text">Undefined Behavior (UB)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#About-the-Injected-Class-Name-Issue"><span class="nav-number">54.</span> <span class="nav-text">About the Injected Class Name Issue</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#A-C-Issue-that-Trims-Words"><span class="nav-number">55.</span> <span class="nav-text">A C++ Issue that Trims Words</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Pointer-to-Integral-Conversion-using-reinterpret-cast"><span class="nav-number">56.</span> <span class="nav-text">Pointer to Integral Conversion using reinterpret_cast</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Pointer-to-Integer-Conversion"><span class="nav-number">56.1.</span> <span class="nav-text">Pointer to Integer Conversion</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Integral-to-Pointer-Conversion"><span class="nav-number">56.2.</span> <span class="nav-text">Integral to Pointer Conversion</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Function-Pointer-Conversion"><span class="nav-number">56.3.</span> <span class="nav-text">Function Pointer Conversion</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#offsetof-Cannot-Be-Used-on-Non-POD-Types-Standard-Layout"><span class="nav-number">57.</span> <span class="nav-text">offsetof Cannot Be Used on Non-POD Types (Standard Layout)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Standard-Layout-Types-in-C"><span class="nav-number">58.</span> <span class="nav-text">Standard Layout Types in C++</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Placing-%E2%80%9Cnew%E2%80%9D-on-the-%E2%80%9Cthis%E2%80%9D-Pointer-of-a-Base-Class-Subobject"><span class="nav-number">59.</span> <span class="nav-text">Placing “new” on the “this” Pointer of a Base Class Subobject</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Compiling-32-bit-Programs-with-MinGW-W64"><span class="nav-number">60.</span> <span class="nav-text">Compiling 32-bit Programs with MinGW-W64</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Implicit-Function-Declarations-in-C"><span class="nav-number">61.</span> <span class="nav-text">Implicit Function Declarations in C</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Viewing-Object-Memory-Layout-with-Clang"><span class="nav-number">62.</span> <span class="nav-text">Viewing Object Memory Layout with Clang</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Default-Parameters-of-Virtual-Functions-Are-Determined-by-the-Caller%E2%80%99s-Pointer-or-Reference-Static-Type"><span class="nav-number">63.</span> <span class="nav-text">Default Parameters of Virtual Functions Are Determined by the Caller’s (Pointer or Reference) Static Type</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#C-Lambda-Captures"><span class="nav-number">64.</span> <span class="nav-text">C++ Lambda Captures</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Functions-Types-Typedef-Cannot-Be-Used-in-Definitions"><span class="nav-number">65.</span> <span class="nav-text">Functions Types Typedef Cannot Be Used in Definitions</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Lambda-Expressions-Syntax"><span class="nav-number">66.</span> <span class="nav-text">Lambda-Expressions Syntax</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#A-Pitfall-in-C-Declaration-Semantics"><span class="nav-number">67.</span> <span class="nav-text">A Pitfall in C++ Declaration Semantics</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Why-VC-Outputs-%E2%80%9C%E7%83%AB%E7%83%AB%E7%83%AB%E2%80%9D-for-Out-of-Bounds-Access"><span class="nav-number">68.</span> <span class="nav-text">Why VC Outputs “烫烫烫” for Out-of-Bounds Access</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#A-Bug-in-Clang"><span class="nav-number">69.</span> <span class="nav-text">A Bug in Clang</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Differences-Between-ISO-C-and-POSIX-Definitions-of-Byte"><span class="nav-number">70.</span> <span class="nav-text">Differences Between ISO C and POSIX Definitions of Byte</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ISO-C"><span class="nav-number">70.1.</span> <span class="nav-text">ISO C</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#POSIX"><span class="nav-number">70.2.</span> <span class="nav-text">POSIX</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Size-of-Reference-Member-of-Class"><span class="nav-number">71.</span> <span class="nav-text">Size of Reference Member of Class</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#What-is-Translation-Unit-in-C-C"><span class="nav-number">72.</span> <span class="nav-text">What is Translation Unit in C&#x2F;C++?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Variable-Access-Across-Scope-in-C"><span class="nav-number">73.</span> <span class="nav-text">Variable Access Across Scope in C</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Google-C-Style-Guide"><span class="nav-number">74.</span> <span class="nav-text">Google C++ Style Guide</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#C-17-Feature-Cheat-Sheet"><span class="nav-number">75.</span> <span class="nav-text">C++17 Feature Cheat Sheet</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Value-Category-Cheat-Sheet"><span class="nav-number">76.</span> <span class="nav-text">Value Category Cheat Sheet</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#New-Features-and-Compatibility-of-C-11"><span class="nav-number">77.</span> <span class="nav-text">New Features and Compatibility of C++11</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#new-Constructors-and-Exceptions"><span class="nav-number">78.</span> <span class="nav-text">new, Constructors, and Exceptions</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Meaning-of-Pointer-Comparison"><span class="nav-number">79.</span> <span class="nav-text">Meaning of Pointer Comparison</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Common-Terminology-Errors-in-C"><span class="nav-number">80.</span> <span class="nav-text">Common Terminology Errors in C++</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Why-Have-References"><span class="nav-number">81.</span> <span class="nav-text">Why Have References?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Reasons-for-Certain-Language-Features-in-C"><span class="nav-number">82.</span> <span class="nav-text">Reasons for Certain Language Features in C++</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person" oncontextmenu="return false" οndragstart="return false">
    <img class="site-author-image" itemprop="image" alt="LIPENGZHA"
      src="https://img.imzlp.com/imgs/zlp/picgo/2023/202304152112902.webp">
  <p class="site-author-name" itemprop="name">LIPENGZHA</p>
  <div class="site-description" itemprop="description">"I think, therefore I am"</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
             
          <span class="site-state-item-count">190</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">95</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">190</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/hxhb" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;hxhb" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://linkedin.com/in/lipengzha" title="Linkedin → https:&#x2F;&#x2F;linkedin.com&#x2F;in&#x2F;lipengzha" rel="noopener" target="_blank"><i class="fab fa-linkedin fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/imzlp" title="知乎 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;imzlp" rel="noopener" target="_blank"><i class="fa fa-custom zhihu fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/images/wechat-qrcode-offical.webp" title="微信公众号 → &#x2F;images&#x2F;wechat-qrcode-offical.webp"><i class="fab fa-weixin fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:imzlp@foxmail.com" title="E-Mail → mailto:imzlp@foxmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-rss fa-fw"></i></a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://consolehelp.imzlp.com/" title="https:&#x2F;&#x2F;consolehelp.imzlp.com&#x2F;" rel="noopener" target="_blank">UE Console Help</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://imzlp.com/opensource/" title="https:&#x2F;&#x2F;imzlp.com&#x2F;opensource&#x2F;" rel="noopener" target="_blank">Open Source Projects</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://imzlp.com/posts/11515/" title="https:&#x2F;&#x2F;imzlp.com&#x2F;posts&#x2F;11515&#x2F;" rel="noopener" target="_blank">UE C++ API Dash Documents</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://ue5wiki.com/" title="https:&#x2F;&#x2F;ue5wiki.com&#x2F;" rel="noopener" target="_blank">Unreal Engine Wiki</a>
        </li>
    </ul>
  </div>

      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2014 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">LIPENGZHA</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="Symbols count total">1.5m</span>
</div>
  <div class="powered-by-other">
    
	    <center>Github Pages | Actions | NeXT | Cloudflare | Hexo Deploy</center>
      
  </div>

<script>
function checkWebp(callback) {
    var img = new Image();
    img.onload = function () { callback((img.width > 0) && (img.height > 0)); };
    img.onerror = function () { callback(false); };
    img.src = 'data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA';
}
function showImage(useWebp) {
    var imgs = [].slice.call(document.querySelectorAll('img'));
    imgs.forEach(function (e) {
        if (!useWebp) {
            var src = e.getAttribute('data-src')
            src = src.replace(/\.webp$/, '.png');
            e.setAttribute('data-src', src);
        }
    });
}
checkWebp(showImage);
</script>

        








      </div>
    </footer>
  </div>

  
  <script src="//lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/animejs/3.2.1/anime.min.js"></script>
  <script src="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/jquery/3.5.1/jquery.min.js"></script>
  <script src="//lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/fancybox/3.5.7/jquery.fancybox.min.js"></script>
  <script src="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/lozad.js/1.16.0/lozad.min.js"></script>
  <script src="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/pangu/4.0.7/pangu.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>



<script src="/js/code-unfold.js"></script>

  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>




  
<script src="/js/local-search.js"></script>









<script>
document.querySelectorAll('.pdfobject-container').forEach(element => {
  let url = element.dataset.target;
  let pdfOpenParams = {
    navpanes : 0,
    toolbar  : 0,
    statusbar: 0,
    pagemode : 'thumbs',
    view     : 'FitH'
  };
  let pdfOpenFragment = '#' + Object.entries(pdfOpenParams).map(([key, value]) => `${key}=${encodeURIComponent(value)}`).join('&');
  let fullURL = `/lib/pdf/web/viewer.html?file=${encodeURIComponent(url)}${pdfOpenFragment}`;

  if (NexT.utils.supportsPDFs()) {
    element.innerHTML = `<embed class="pdfobject" src="${url + pdfOpenFragment}" type="application/pdf" style="height: ${element.dataset.height};">`;
  } else {
    element.innerHTML = `<iframe src="${fullURL}" style="height: ${element.dataset.height};" frameborder="0"></iframe>`;
  }
});
</script>


<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/mathjax/3.1.2/es5/tex-mml-chtml.min.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  
  <script src="//img.imzlp.com/imgs/zlp/picgo/2021/quicklink.umd.js"></script>
  <script>
      window.addEventListener('load', () => {
      quicklink({
        timeout : 3000,
        priority: true,
        ignores : [uri => uri.includes('#'),uri => uri === 'https://en.imzlp.com/notes/cpp/',]
      });
      });
  </script>


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/valine/1.4.14/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    var requiredFields = 'nick';
    requiredFields = requiredFields.split(',');
    
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'oCE6RMVkVoi5MgUhvFsn1EvV-gzGzoHsz',
      appKey     : 'K9SOaNYJ8PV6xaoFggWG5xvv',
      placeholder: "Leave something behind~",
      avatar     : 'robohash',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : 'en' || 'zh-cn',
      path       : location.pathname,
      recordIP   : true,
      serverURLs : '',
      requiredFields: requiredFields
    });
  }, window.Valine);
});
</script>

</body>
</html>
