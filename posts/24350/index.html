<!DOCTYPE html>
<html lang="en,default">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon-32x32-tilt-brush.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-tilt-brush.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-tilt-brush.png">
  <link rel="mask-icon" href="/images/favicon-32x32-tilt-brush.png" color="#222">
  <meta name="google-site-verification" content="ttIkhAIFZQM9Huj8roB0l95ePN2Tv2zv2wRFksi09WA">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noto Serif SC:300,300italic,400,400italic,700,700italic|Pacifico:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Roboto Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="//lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/5.15.2/css/all.min.css">
  <link rel="stylesheet" href="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/fancybox/3.5.7/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"en.imzlp.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false,"width":280},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"manual"},"fancybox":true,"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":false,"nav":null,"activeClass":"valine"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"code_unfold":{"enable":true,"CODE_MAX_HEIGHT":600},"path":"search.xml"};
  </script>

  <meta name="description" content="UE’s default resource management is relatively complex. By default, the resource packaging process is executed based on the configurations of maps, directories, and PrimaryAsset specified in ProjectSe">
<meta property="og:type" content="article">
<meta property="og:title" content="A Flexible and Non-Intrusive Basic Package Splitting Scheme">
<meta property="og:url" content="https://en.imzlp.com/posts/24350/index.html">
<meta property="og:site_name" content="Z&#39;s Blog">
<meta property="og:description" content="UE’s default resource management is relatively complex. By default, the resource packaging process is executed based on the configurations of maps, directories, and PrimaryAsset specified in ProjectSe">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/picgo/2022/202210231032930.webp">
<meta property="article:published_time" content="2022-10-23T15:20:00.000Z">
<meta property="article:modified_time" content="2022-10-23T15:20:00.000Z">
<meta property="article:author" content="LIPENGZHA">
<meta property="article:tag" content="UnrealEngine">
<meta property="article:tag" content="热更新">
<meta property="article:tag" content="HotPatcher">
<meta property="article:tag" content="资源管理">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img.imzlp.com/imgs/zlp/picgo/2022/202210231032930.webp">

<link rel="canonical" href="https://en.imzlp.com/posts/24350/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>A Flexible and Non-Intrusive Basic Package Splitting Scheme | Z's Blog</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FDCJ41EFP5"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-FDCJ41EFP5');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.staticfile.org/lxgw-wenkai-screen-webfont/1.7.0/style.min.css" /><!-- hexo injector head_end end --><link rel="alternate" href="/atom.xml" title="Z's Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Z's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        
            
  <li class="menu-item menu-item-notes">

    <a href="/notes/" rel="section"><i class="fa fa-edit fa-fw"></i>Notes</a>

  </li>


      
        
            
  <li class="menu-item menu-item-essay">

    <a href="/essay/" rel="section"><i class="fas fa-feather-alt fa-fw"></i>Essay</a>

  </li>


      
        
            
  <li class="menu-item menu-item-resources">

    <a href="/resources/" rel="section"><i class="fa fa-inbox fa-fw"></i>Resources</a>

  </li>


      
        <li class="menu-item menu-item-friends">

    <a href="/friends/" rel="section"><i class="fas fa-link fa-fw"></i>Friends</a>

  </li>
        
            
  <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About Me</a>

  </li>


      
        <li class="menu-item menu-item-showcase">

    <a href="/showcase/" rel="section"><i class="fa fa-solid fa-trophy fa-fw"></i>ShowCase</a>

  </li>
        <li class="menu-item menu-item-changelog">

    <a href="/changelog/" rel="section"><i class="fa fa-history fa-fw"></i>Site Log</a>

  </li>
        <li class="menu-item menu-item-opensource">

    <a href="/opensource/" rel="section"><i class="fas fa-code-branch fa-fw"></i>Open Source</a>

  </li>
        <li class="menu-item menu-item-uewiki">

    <a href="https://ue5wiki.com/" rel="noopener" target="_blank"><i class="fab fa-wikipedia-w fa-fw"></i>Unreal Wiki</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>



<script type="text/javascript">
  let domain='en.imzlp.com';
  let domain_str = atob(domain);
  let pathname = location.pathname;
  if (domain_str!= location.host.toLowerCase()){
        console.log(`this host is not safe,jump to https://${domain_str}${pathname}`);
        location.href=`https://${domain_str}${pathname}`;
  }
</script>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>
  <div class="l10n-header-widget">
    <script>
      // 获取当前页面的 URL
      const currentUrl = window.location.href;
      // 替换 URL 中的部分内容
      const jumpToL10nLink = currentUrl.replace('en.imzlp.com', 'imzlp.com');
      // 将 jumpToL10nLink 绑定到一个全局变量
      window.jumpToL10nLink = jumpToL10nLink;
    </script>

    <a href="#" class="post-l10n-link" title="切换至中文版本" style="float: left;border-bottom: none;" rel="noopener" target="_blank" onclick="window.open(window.jumpToL10nLink, '_blank'); return false;">
      <i class="fa fa-solid fa-language"></i>
    </a>
  </div>



    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en"
  >
    <link itemprop="mainEntityOfPage" href="https://en.imzlp.com/posts/24350/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://img.imzlp.com/imgs/zlp/picgo/2023/202304152112902.webp">
      <meta itemprop="name" content="LIPENGZHA">
      <meta itemprop="description" content=""I think, therefore I am"">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Z's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          A Flexible and Non-Intrusive Basic Package Splitting Scheme<a href="https://github.com/imzlp/blog-md/blob/en/_posts/2022-10-23-24350.md" class="post-edit-link" title="Edit this post" style="float: right;border-bottom: 0px;" rel="noopener" target="_blank"><i class="fa fa-pen-nib"></i></a><a href="https://imzlp.com/posts/24350/" class="post-l10n-link" title="切换至中文版本" style="float: left;border-bottom: 0px;" rel="noopener" target="_blank"><i class="fa fa-solid fa-language"></i></a>
        </h1>

        
          <div class="post-subtitle" style="text-align: center;line-height: 1;">
            <sub text-align="center" style="font-size: 15px;align-content: center;font-style: italic;bottom: 0em;">一种灵活与非侵入式的基础包拆分方案</sub>
          </div>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-10-23 15:20 15:20:00:20" itemprop="dateCreated datePublished" datetime="2022-10-23T15:20:00+00:00">2022-10-23 15:20</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/UnrealEngine/" itemprop="url" rel="index"><span itemprop="name">UnrealEngine</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/UnrealEngine/%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86/" itemprop="url" rel="index"><span itemprop="name">资源管理</span></a>
                </span>
            </span>

          
            <span id="/posts/24350/" class="post-meta-item leancloud_visitors" data-flag-title="A Flexible and Non-Intrusive Basic Package Splitting Scheme" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>11k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>28 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
              <img src="https://img.imzlp.com/imgs/zlp/picgo/2022/202210231032930.webp" itemprop="contentUrl" style="border-radius: 20px;">
         </div>
        <p>UE’s default resource management is relatively complex. By default, the resource packaging process is executed based on the configurations of maps, directories, and PrimaryAsset specified in <code>ProjectSetting</code>, as well as a combination of condition checks. Furthermore, UE’s Cook dynamically adds resources to the package based on runtime loading, making the resource packaging process almost a black box.</p>
<p>The blog introduces articles on <strong>default resource packaging rules</strong> and <strong>basic package splitting</strong>:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://imzlp.com/posts/22570/">UE Resource Management: Engine Packaging Resource Analysis</a></li>
<li><a target="_blank" rel="noopener" href="https://imzlp.com/posts/13765/">UE Hot Update: Splitting Basic Packages</a></li>
</ul>
<p>This article presents a new idea, utilizing <a target="_blank" rel="noopener" href="https://github.com/hxhb/HotPatcher">HotPatcher</a>‘s precise Cook and packaging mechanism to implement a HotChunker Mod that can perform <strong>non-intrusive</strong>, direct <strong>reuse of UE’s default packaging process</strong> and <strong>clearly</strong> split the basic package. This article will specifically introduce the usage and implementation principles.</p>
<span id="more"></span>

<h3 id="Issues-with-Default-Packaging"><a href="#Issues-with-Default-Packaging" class="headerlink" title="Issues with Default Packaging"></a>Issues with Default Packaging</h3><p>As mentioned earlier, the UE packaging parameters and configurations are complex, and there are some unresolvable issues:</p>
<ol>
<li>It is impossible to directly estimate which resources will enter the package and the final package size.</li>
<li>The packaging configurations can be scattered in various places, making them difficult to manage.</li>
<li>All Non-uasset resources are in package 0 (meaning they must enter the basic package).</li>
<li>It is impossible to split ShaderLibrary based on package splits (which can be very large).</li>
<li>It is impossible to split AssetRegistry based on package splits.</li>
<li>The ability to precisely control the ignored resources of a certain package rule.</li>
<li>A single set of PakFilter rules shared across all platforms.</li>
</ol>
<p>From a resource management perspective, it is hoped to have a clear and precise control of resource packaging rules; the default options provided by UE cannot achieve this.<br><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2022/202210231048454.webp"></p>
<h3 id="Clean-Basic-Package"><a href="#Clean-Basic-Package" class="headerlink" title="Clean Basic Package"></a>Clean Basic Package</h3><p>In the article <a target="_blank" rel="noopener" href="https://imzlp.com/posts/22570/">UE Resource Management: Engine Packaging Resource Analysis</a>, I analyzed the resource analysis rules when the engine packages resources.<br>In addition to resources, there are many Non-uasset files, such as: Slate images, Ini files, ShaderLib/AssetRegistry, and paths configured in the project for <code>DirectoriesToAlwaysStageAsUFS</code>.</p>
<p>A common situation is that when a new project is created, many resources are added, and no packaging rules are configured, executing packaging will package many unnecessary resources.</p>
<p><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2022/202210221953315.webp"></p>
<p>While this is user-friendly for beginners, it becomes a significant burden when wanting to manage things finely.</p>
<p>Firstly, the first question is: which are the necessary files for engine startup that must be in the basic package?<br>I summarize the following:</p>
<ol>
<li>SlateResources, Ini</li>
<li>Global ShaderLib</li>
<li>AssetRegistry</li>
<li>Configured startup maps, along with dependent blueprint GameMode, GameInstance, and other Gameplay framework resources.</li>
<li>Custom joystick resources for mobile terminals.</li>
<li>Basic UI resources that may be used.</li>
</ol>
<p>During the UE default packaging process, these resources and files will be analyzed and added to the package. However, to pack a clean basic package, we need to isolate the process for these <strong>necessary resources</strong> and allow the engine to analyze them, while additional non-essential resources are controlled by the business itself.</p>
<p>The second question is: how to exclude non-essential resources?</p>
<p>In the article <a target="_blank" rel="noopener" href="https://imzlp.com/posts/22570/#AssetManager">Engine Packaging Resource Analysis #AssetManager</a>, a condition check in CookOnTheFlyServer is recorded:</p>
<p>If no resources are explicitly specified on the command line and no resources are retrieved from <code>FGameDelegates::Get().GetCookModificationDelegate()</code> or <code>UAssetManager::Get().Modify</code>, then all resources from plugins and the project will be added.</p>
<p>The execution conditions are:</p>
<ol>
<li><code>AlwaysCookMaps</code> in <code>DefaultEditor.ini</code> is empty, and <code>AllMaps</code> is empty.</li>
<li>The project settings <code>List of maps to include in a packaged build</code> is empty.</li>
<li>The project settings <code>DirectoriesToAlwaysCook</code> is empty.</li>
<li><code>FGameDelegates::Get().GetCookModificationDelegate()</code> retrieves no resources.</li>
<li><code>UAssetManager::Get().ModifyCook</code> retrieves no resources.</li>
</ol>
<p>This means that not configuring any resources does not make the basic package smaller; it may actually make it larger. To avoid including all resources in the package, we need to feed some resources to CookOnTheFly using the methods above to prevent it from adding unmarked project resources.</p>
<p>The approach I chose is to overload <code>AssetManager</code> and override the <code>ModifyCook</code> function:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">UHotChunkerAssetManager::ModifyCook</span><span class="params">(TArray&lt;FName&gt;&amp; PackagesToCook, TArray&lt;FName&gt;&amp; PackagesToNeverCook)</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">   FName DefaultAsset = <span class="built_in">TEXT</span>(<span class="string">&quot;/Engine/EngineMaterials/DefaultDiffuse&quot;</span>);  </span><br><span class="line">   PackagesToCook.<span class="built_in">Add</span>(DefaultAsset);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Then, specify the AssetManager class as <code>UHotChunkerAssetManager</code> in project settings:<br><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2022/202210221948334.webp"></p>
<p>Executing CookCommandlet again shows that this condition is no longer satisfied:<br><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2022/202210221951677.webp"></p>
<p>The previous discussion dealt with resource control during the Cook phase. After Cook, it’s essential to control what resources enter the Pak.</p>
<p>In 4.27, all resources under Cooked in the current packaging task are added to the package by default:</p>
<p><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2022/202210222344804.webp"></p>
<p>If we want to produce a clean package, we need to control which files actually enter package 0, meaning only necessary files should be stored in <code>[PROJECTDIR]/Saved/Cooked</code>.</p>
<p>I added a feature to <a target="_blank" rel="noopener" href="https://github.com/hxhb/HotPatcher">HotPatcher</a> that allows custom specification of the path where resources are saved during Cook:</p>
<p><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2022/202210230904187.webp"></p>
<p>This allows for a non-intrusive Cook, thus achieving the separation of the basic package splitting.</p>
<h3 id="Intervening-in-CookCommandlet"><a href="#Intervening-in-CookCommandlet" class="headerlink" title="Intervening in CookCommandlet"></a>Intervening in CookCommandlet</h3><p>By default, we cannot directly intervene in UE’s packaging process.</p>
<p>UE’s packaging is executed by running UAT to perform BuildCookRun, a standalone program that acts like a task scheduler, launching multiple processes to execute different stages of tasks to orchestrate the entire packaging process and can skip certain stages.</p>
<p><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2022/202210230933114.webp"></p>
<p>This creates a problem, as it is inconvenient to intervene in this process because UAT is independent of our business code.</p>
<p>However, if modifications to the engine are necessary, that becomes problematic; it is not a universal solution. Modifying the engine every time there is a problem is too simplistic and not my style, so I researched a non-intrusive approach.</p>
<p>From the diagram above, we can see that UAT executes a commandlet for Cook, so while we cannot directly intervene in UAT’s flow, we can use some clever methods to intervene in the CookCommandlet process.</p>
<p><code>CookCommandlet</code> is a Commandlet executed with:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UE4Editor-cmd.exe PROJECT.uproject -run=CookCommandlet</span><br></pre></td></tr></table></figure>
<p><strong>Note</strong>, it essentially <strong>starts the project through the engine to execute a command line task.</strong> This means that when it starts, it will load the plugins within our project.</p>
<p>By leveraging this, we can achieve a non-intrusive intervention in the CookCommandlet process.</p>
<p>Next, we need to determine at what stage we want to do something in the CookCommandlet. For the needs of this article, we hope to invoke <a target="_blank" rel="noopener" href="https://github.com/hxhb/HotPatcher">HotPatcher</a> to execute the split packaging after Cook completes.</p>
<p>So at what timing is appropriate?</p>
<p>In previous articles, it has been introduced that UE’s Cook dynamically cooks the resources loaded into memory at runtime, meaning we cannot invoke our custom packaging task before Cook completes; otherwise, it would lead to inclusion in the basic package.</p>
<p>We can only do this after Cook finishes, but there is no exposed callback for completion, so we need to consider other solutions.</p>
<p>Because CookCommandlet is also an engine startup, we can use the engine’s exposed <code>CoreDelegates</code> timing to make choices. By reading the code, we find that a suitable timing is <code>OnEnginePreExit</code>, as this phase confirms that Cook is complete, and the engine hasn’t begun exiting yet, maintaining a full engine start state. Actions taken during this phase can utilize all engine functionalities without the risk of some modules being unloaded.</p>
<blockquote>
<p>Note that this callback only exists in version 4.25 and later; earlier engine versions do not have it.</p>
</blockquote>
<p>First, create a plugin, set up an Editor module, and listen to <code>FCoreDelegates::OnEnginePreExit</code> in <code>StartupModule</code>:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">FHotChunkerEditorModule::StartupModule</span><span class="params">()</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line"></span><br><span class="line">   <span class="meta">#<span class="keyword">if</span> ENGINE_MAJOR_VERSION &gt; 4 || (ENGINE_MAJOR_VERSION == 4 &amp;&amp; ENGINE_MINOR_VERSION &gt; 24)  </span></span><br><span class="line">       FCoreDelegates::OnEnginePreExit.<span class="built_in">AddRaw</span>(<span class="keyword">this</span>,&amp;FHotChunkerEditorModule::OnPreEngineExit_Commandlet);  </span><br><span class="line">    <span class="meta">#<span class="keyword">endif</span>  </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>In the listened callback, we can perform desired actions. However, we need to ensure that this is executed in the CookCommandlet, because the Editor module is executed whenever the engine starts; we simply need it to be effective in the CookCommandlet context:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">CommandletHelper::IsCookCommandlet</span><span class="params">()</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">   <span class="type">bool</span> bIsCookCommandlet = <span class="literal">false</span>;  </span><br><span class="line">  </span><br><span class="line">   <span class="keyword">if</span>(::<span class="built_in">IsRunningCommandlet</span>())  </span><br><span class="line">   &#123;     </span><br><span class="line">      FString CommandletName;  </span><br><span class="line">      <span class="type">bool</span> bIsCommandlet = CommandletHelper::<span class="built_in">GetCommandletArg</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;-run=&quot;</span>),CommandletName); </span><br><span class="line">      <span class="keyword">if</span>(bIsCommandlet &amp;&amp; !CommandletName.<span class="built_in">IsEmpty</span>())  </span><br><span class="line">      &#123;         </span><br><span class="line">         bIsCookCommandlet = CommandletName.<span class="built_in">Equals</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;cook&quot;</span>),ESearchCase::IgnoreCase);  </span><br><span class="line">      &#125;   </span><br><span class="line">   &#125;  </span><br><span class="line">   <span class="keyword">return</span> bIsCookCommandlet;  </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">FHotChunkerEditorModule::OnPreEngineExit_Commandlet</span><span class="params">()</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">   <span class="keyword">if</span>(CommandletHelper::<span class="built_in">IsCookCommandlet</span>())  </span><br><span class="line">   &#123;  </span><br><span class="line">      <span class="comment">// do something</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Through this method, it becomes possible to non-intrusively listen for when Cook is complete and implement custom packaging actions.</p>
<p><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2022/202210230957399.webp"></p>
<h3 id="Automated-Staging"><a href="#Automated-Staging" class="headerlink" title="Automated Staging"></a>Automated Staging</h3><p>The previous section discussed how to use the Hook Commandlet approach to invoke <a target="_blank" rel="noopener" href="https://github.com/hxhb/HotPatcher">HotPatcher</a> for packaging after Cook is completed.<br>After executing CookCommandlet, the packaging status is as follows:</p>
<ol>
<li>Basic resources have been cooked but not yet packaged into Pak.</li>
<li>Resources split by HotChunker have already been cooked and packaged into Pak, temporarily stored in a staging directory.</li>
</ol>
<p>By default, CookCommandlet does not package into Pak. The task of packaging the results of CookCommandlet into Pak is performed by UAT invoking UnrealPak.</p>
<p>The Pak we packaged in CookCommandlet does not directly reside in the <code>Saved/StagedBuilds</code> directory because subsequent creation of Pak by UAT will clear the StagedBuilds directory, making copying over before clearing essentially meaningless as it would be deleted.</p>
<p>Therefore, we need to find a slightly later opportunity where our created Pak will not be cleared.</p>
<p>Refer to this diagram:<br><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2022/202210231008946.webp"></p>
<p>The relevant code in the engine (<code>Scripts/CopyBuildToStagingDirectory.Automation.cs</code>):<br><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2022/202210231010067.webp"></p>
<p>This executes the cleanup prior to UAT invoking UnrealPak, and directly generates the output of UnrealPak into a clean StagedBuilds directory.</p>
<p>Thus, we need to execute our actions after UnrealPak but before the task concludes.</p>
<p>How to do this <strong>without modifying the engine</strong>?</p>
<p>Here, we need to introduce some basics about loading UE module types.<br>UE modules can have multiple types usually utilized in daily development like <code>Runtime</code>, <code>Editor</code>, <code>Developer</code>, etc. However, UE also provides a <code>Program</code> type that can allow the loading of some programs when starting.</p>
<p>Using HotChunker’s <code>.uplugin</code> as an example:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span>   </span><br><span class="line">   <span class="attr">&quot;FriendlyName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;HotChunker&quot;</span><span class="punctuation">,</span>  </span><br><span class="line">   <span class="attr">&quot;CreatedBy&quot;</span><span class="punctuation">:</span> <span class="string">&quot;lipengzha&quot;</span><span class="punctuation">,</span>  </span><br><span class="line">   <span class="attr">&quot;CreatedByURL&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://imzlp.com/&quot;</span><span class="punctuation">,</span>  </span><br><span class="line">   <span class="attr">&quot;CanContainContent&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span>  </span><br><span class="line">   <span class="attr">&quot;SupportedPrograms&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span> <span class="string">&quot;UnrealPak&quot;</span> <span class="punctuation">]</span><span class="punctuation">,</span>  </span><br><span class="line">   <span class="attr">&quot;Plugins&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>  </span><br><span class="line">      <span class="punctuation">&#123;</span>         </span><br><span class="line">         <span class="attr">&quot;Name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;HotPatcher&quot;</span><span class="punctuation">,</span>  </span><br><span class="line">         <span class="attr">&quot;Enabled&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span>  </span><br><span class="line">      <span class="punctuation">&#125;</span>  </span><br><span class="line">   <span class="punctuation">]</span><span class="punctuation">,</span>   </span><br><span class="line">   <span class="attr">&quot;Modules&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>  </span><br><span class="line">      <span class="punctuation">&#123;</span>         </span><br><span class="line">         <span class="attr">&quot;Name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;HotChunker&quot;</span><span class="punctuation">,</span>  </span><br><span class="line">         <span class="attr">&quot;Type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Program&quot;</span><span class="punctuation">,</span>  </span><br><span class="line">         <span class="attr">&quot;LoadingPhase&quot;</span><span class="punctuation">:</span> <span class="string">&quot;PostConfigInit&quot;</span><span class="punctuation">,</span>  </span><br><span class="line">         <span class="attr">&quot;ProgramAllowList&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span> <span class="string">&quot;UnrealPak&quot;</span> <span class="punctuation">]</span>  </span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>Specifying <code>SupportedPrograms</code> indicates that this plugin can be loaded when a Program starts, and the <code>ProgramAllowList</code> in Modules controls which programs can load that module.</p>
<p>This means we can have UnrealPak load a specific module in our project to perform our intended actions without impacting the engine.</p>
<blockquote>
<p>Note, this mechanism is fundamentally provided by the engine to enable non-intrusive extension of compression algorithms, and the way described in this article is a reasonable application.</p>
</blockquote>
<p>Of course, this requires passing the project path when starting the Program, which UAT does when invoking UnrealPak.</p>
<p>Within the packaging, the command executed by UAT to invoke UnrealPak is as follows:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">E:\UnrealProjects\BlankExample\BlankExample.uproject E:\UnrealProjects\BlankExample\Saved\StagedBuilds\WindowsNoEditor\BlankExample\Content\Paks\BlankExample-WindowsNoEditor.pak -create=D:\UnrealEngine\Source\UE_4.27.2\Engine\Programs\AutomationTool\Saved\Logs\PakList_BlankExample-WindowsNoEditor.txt -cryptokeys</span><br><span class="line">=E:\UnrealProjects\BlankExample\Saved\Cooked\WindowsNoEditor\BlankExample\Metadata\Crypto.json -secondaryOrder=E:\UnrealProjects\BlankExample\Build\WindowsNoEditor\FileOpenOrder\CookerOpenOrder.<span class="built_in">log</span> -patchpaddingalign=2048 -platform=Windows -compressionformats=Oodle -compressmethod=Kraken -compresslevel=3  -multiprocess -abslog=D:\UnrealEngine\Source\UE_4.27.</span><br><span class="line">2\Engine\Programs\AutomationTool\Saved\Logs\UnrealPak-BlankExample-WindowsNoEditor-2022.10.22-13.58.14.txt -compressionblocksize=256KB</span><br></pre></td></tr></table></figure>

<p>Now we can perform custom actions in the Module’s <code>StartupModule</code> or <code>ShutdownModule</code>:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">FHotChunkerModule::StartupModule</span><span class="params">()</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">   <span class="type">bool</span> bIsRunningProgram = FPlatformProperties::<span class="built_in">IsProgram</span>();  </span><br><span class="line">   <span class="built_in">UE_LOG</span>(LogHotChunker,Display,<span class="built_in">TEXT</span>(<span class="string">&quot;HotChunker StartupModule,is Program %s&quot;</span>), bIsRunningProgram ? <span class="built_in">TEXT</span>(<span class="string">&quot;TRUE&quot;</span>):<span class="built_in">TEXT</span>(<span class="string">&quot;FALSE&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note, it is essential to check at runtime whether the module is started as a Program to distinguish between a normal engine startup and Program startup. Use <code>FPlatformProperties::IsProgram()</code> for this check.</p>
</blockquote>
<p>At this point, when triggering packaging, the UnrealPak trigger will start our project Module, which can be seen in the UAT logs when UnrealPak is triggered:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LogHotChunker: Display: HotChunker StartupModule,is Program TRUE</span><br></pre></td></tr></table></figure>

<p><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2022/202210231025746.webp"></p>
<p>Within this Module, we simply need to copy the Pak we packaged in CookCommandlet from the temporary directory to the actual packaging <code>StagedBuilds</code> directory.</p>
<h3 id="General-Pak-Filtering-Rules"><a href="#General-Pak-Filtering-Rules" class="headerlink" title="General Pak Filtering Rules"></a>General Pak Filtering Rules</h3><p>In the article <a target="_blank" rel="noopener" href="https://imzlp.com/posts/13765/">UE Hot Update: Splitting Basic Packages</a>, I introduced a method to prevent Android Pak from entering OBB and provided an equivalent implementation for iOS.</p>
<p>However, the downside is that it requires modifying the engine, which is not a <strong>non-intrusive</strong> complete <strong>cross-platform</strong> solution.</p>
<p>Based on the package splitting scheme in this article, during the execution of <code>UnrealPak</code> invoking <code>HotChunker</code>, we can perform filtering to avoid entering the basic package.</p>
<p>Only one configuration is needed, and it is applicable across all platforms. It supports wildcards, making it easy to specify ignore rules:</p>
<p><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2022/202210231049018.webp"></p>
<h3 id="Chunk-Configuration"><a href="#Chunk-Configuration" class="headerlink" title="Chunk Configuration"></a>Chunk Configuration</h3><p>The new splitting approach, much like UE’s PrimaryAssetLabel, allows the creation of a <code>HotPatcherPrimaryLabel</code> resource for configuration. This is consistent with the Chunk configuration in the <a target="_blank" rel="noopener" href="https://github.com/hxhb/HotPatcher">HotPatcher</a> plugin, allowing for the specification of directories, resources, dependency analysis, non-resource file configurations, and forced ignoring of certain directories, all of which can be flexibly configured.</p>
<p><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2022/202210231054945.webp"></p>
<p><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2022/202210231054208.webp"></p>
<p>Additionally, the packaging Chunk’s configuration template can be modified in project settings, completely reusing <a target="_blank" rel="noopener" href="https://github.com/hxhb/HotPatcher">HotPatcher</a> settings:<br><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2022/202210231056458.webp"></p>
<p>This allows for control over the naming rules of the generated Pak, etc.</p>
<h3 id="Editor-Support"><a href="#Editor-Support" class="headerlink" title="Editor Support"></a>Editor Support</h3><p>I added right-click menu support for the <code>HotPatcherPrimaryLabel</code> resource:<br><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2022/202210231058735.webp"></p>
<p>This enables direct right-clicking to package the current configuration or to add it to <a target="_blank" rel="noopener" href="https://github.com/hxhb/HotPatcher">HotPatcher</a>‘s Chunk configuration.</p>
<p>Moreover, it is possible to view the resources included in the current Pak through the reference view:<br><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2022/202210231059005.webp"></p>
<h3 id="Preview-of-Pak-within-Pak"><a href="#Preview-of-Pak-within-Pak" class="headerlink" title="Preview of Pak within Pak"></a>Preview of Pak within Pak</h3><p>Taking Android as an example, using this packaging approach will allow a certain Pak to be included within a package:<br><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2022/20221123103823.webp"></p>
<p>This provides clearer and more flexible advantages.</p>
<h3 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h3><p>This article has introduced the shortcomings of UE’s default package splitting and the non-intrusive splitting of basic packages using <a target="_blank" rel="noopener" href="https://github.com/hxhb/HotPatcher">HotPatcher</a> methods and implementations. By leveraging many hidden features of the engine, the approach is realized through Commandlet Hook and Module for Program, avoiding modifications to the engine. </p>
<p>The proposed solution has been fully implemented and will be released as a Mod for HotPatcher, requiring only simple configuration and executing the default UE packaging to achieve the complete process.</p>

    </div>

    
    
        
        
          
            <blockquote class="blockquote-center">
              
                The article is finished. If you have any questions, please comment and communicate.
              
            <br/>
            
                <div class="qr-code" onclick="return false">
                    <script src="/js/qrcode.min.js"></script>
                    <div id="qrcode">
                      
                        <img src="https://imzlp.com/images/wechat-qrcode.webp">
                      
                    <p>Scan the QR code on WeChat and follow me.</p>
                    </div>
                </div>
            
            </blockquote>
          
        

        
          <div class="postCopyright" style="clear:both;">
             <span>Title:</span><a href="/posts/24350/" target="_blank">A Flexible and Non-Intrusive Basic Package Splitting Scheme</a><br/>
             <span>Author:</span><a href="/about" target="_blank" title="查看 LIPENGZHA 的资料">LIPENGZHA</a><br/>
             <span>Publish Date:</span>2022/10/23 15:20<br/>
             
             <span>Word Count:</span><span class="page-count">11k Words</span><br/>
             
             <span>Link:</span><a href="/posts/24350/" target="_blank" title="A Flexible and Non-Intrusive Basic Package Splitting Scheme">https://en.imzlp.com/posts/24350/</a>
             <span class="copy-path" data-clipboard-text="Link: https://en.imzlp.com/posts/24350/ Author: LIPENGZHA" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
             <script src="/js/jquery.min.js"></script>
             <script src="/js/clipboard.min.js"></script>
             <script> var clipboard = new Clipboard('.copy-path'); </script>
             <br/>
             
             <span>License:</span><i class="fab fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" title="Attribution-NonCommercial-ShareAlike 4.0 International">CC BY-NC-SA 4.0</a><br/>
             
             <span>Reprinting of the full article is prohibited.</span>
          </div>
        
    

        
  <div class="reward-container">
    <div>Your donation will encourage me to keep creating!</div>
    <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
      Donate
    </button>
    <div id="qr" style="display: none;">
        
        <div style="display: inline-block;">
          <img src="/images/reward/wechatpay.webp" alt="LIPENGZHA WeChat Pay">
          <p>WeChat Pay</p>
        </div>

    </div>
  </div>



      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/UnrealEngine/" rel="tag"># UnrealEngine</a>
              <a href="/tags/%E7%83%AD%E6%9B%B4%E6%96%B0/" rel="tag"># 热更新</a>
              <a href="/tags/HotPatcher/" rel="tag"># HotPatcher</a>
              <a href="/tags/%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86/" rel="tag"># 资源管理</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/posts/10975/" rel="prev" title="2022 Unreal Open Day">
      <i class="fa fa-chevron-left"></i> 2022 Unreal Open Day
    </a></div>
      <div class="post-nav-item">
    <a href="/posts/23932/" rel="next" title="How to write a good technical article">
      How to write a good technical article <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
      <div class="tabs tabs-comment">
        <ul class="nav-tabs">
            <li class="tab"><a href="#comment-utteranc">utteranc</a></li>
            <li class="tab"><a href="#comment-valine">valine</a></li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane utteranc" id="comment-utteranc">
              
  
  <div class="comments">
  <script src="https://utteranc.es/client.js" repo="hxhb/blog-comments" issue-term="pathname" theme="github-light" crossorigin="anonymous" async></script>
  </div>
  
  
            </div>
            <div class="tab-pane valine" id="comment-valine">
              <div class="comments" id="valine-comments"></div>
            </div>
        </div>
      </div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Issues-with-Default-Packaging"><span class="nav-number">1.</span> <span class="nav-text">Issues with Default Packaging</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Clean-Basic-Package"><span class="nav-number">2.</span> <span class="nav-text">Clean Basic Package</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Intervening-in-CookCommandlet"><span class="nav-number">3.</span> <span class="nav-text">Intervening in CookCommandlet</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Automated-Staging"><span class="nav-number">4.</span> <span class="nav-text">Automated Staging</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#General-Pak-Filtering-Rules"><span class="nav-number">5.</span> <span class="nav-text">General Pak Filtering Rules</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Chunk-Configuration"><span class="nav-number">6.</span> <span class="nav-text">Chunk Configuration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Editor-Support"><span class="nav-number">7.</span> <span class="nav-text">Editor Support</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Preview-of-Pak-within-Pak"><span class="nav-number">8.</span> <span class="nav-text">Preview of Pak within Pak</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Conclusion"><span class="nav-number">9.</span> <span class="nav-text">Conclusion</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person" oncontextmenu="return false" οndragstart="return false">
    <img class="site-author-image" itemprop="image" alt="LIPENGZHA"
      src="https://img.imzlp.com/imgs/zlp/picgo/2023/202304152112902.webp">
  <p class="site-author-name" itemprop="name">LIPENGZHA</p>
  <div class="site-description" itemprop="description">"I think, therefore I am"</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
             
          <span class="site-state-item-count">190</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">95</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">190</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/hxhb" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;hxhb" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://linkedin.com/in/lipengzha" title="Linkedin → https:&#x2F;&#x2F;linkedin.com&#x2F;in&#x2F;lipengzha" rel="noopener" target="_blank"><i class="fab fa-linkedin fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/imzlp" title="知乎 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;imzlp" rel="noopener" target="_blank"><i class="fa fa-custom zhihu fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/images/wechat-qrcode-offical.webp" title="微信公众号 → &#x2F;images&#x2F;wechat-qrcode-offical.webp"><i class="fab fa-weixin fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:imzlp@foxmail.com" title="E-Mail → mailto:imzlp@foxmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-rss fa-fw"></i></a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://consolehelp.imzlp.com/" title="https:&#x2F;&#x2F;consolehelp.imzlp.com&#x2F;" rel="noopener" target="_blank">UE Console Help</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://imzlp.com/opensource/" title="https:&#x2F;&#x2F;imzlp.com&#x2F;opensource&#x2F;" rel="noopener" target="_blank">Open Source Projects</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://imzlp.com/posts/11515/" title="https:&#x2F;&#x2F;imzlp.com&#x2F;posts&#x2F;11515&#x2F;" rel="noopener" target="_blank">UE C++ API Dash Documents</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://ue5wiki.com/" title="https:&#x2F;&#x2F;ue5wiki.com&#x2F;" rel="noopener" target="_blank">Unreal Engine Wiki</a>
        </li>
    </ul>
  </div>

      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2014 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">LIPENGZHA</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="Symbols count total">1.5m</span>
</div>
  <div class="powered-by-other">
    
	    <center>Github Pages | Actions | NeXT | Cloudflare | Hexo Deploy</center>
      
  </div>

<script>
function checkWebp(callback) {
    var img = new Image();
    img.onload = function () { callback((img.width > 0) && (img.height > 0)); };
    img.onerror = function () { callback(false); };
    img.src = 'data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA';
}
function showImage(useWebp) {
    var imgs = [].slice.call(document.querySelectorAll('img'));
    imgs.forEach(function (e) {
        if (!useWebp) {
            var src = e.getAttribute('data-src')
            src = src.replace(/\.webp$/, '.png');
            e.setAttribute('data-src', src);
        }
    });
}
checkWebp(showImage);
</script>

        








      </div>
    </footer>
  </div>

  
  <script src="//lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/animejs/3.2.1/anime.min.js"></script>
  <script src="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/jquery/3.5.1/jquery.min.js"></script>
  <script src="//lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/fancybox/3.5.7/jquery.fancybox.min.js"></script>
  <script src="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/lozad.js/1.16.0/lozad.min.js"></script>
  <script src="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/pangu/4.0.7/pangu.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>



<script src="/js/code-unfold.js"></script>

  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>




  
<script src="/js/local-search.js"></script>









<script>
document.querySelectorAll('.pdfobject-container').forEach(element => {
  let url = element.dataset.target;
  let pdfOpenParams = {
    navpanes : 0,
    toolbar  : 0,
    statusbar: 0,
    pagemode : 'thumbs',
    view     : 'FitH'
  };
  let pdfOpenFragment = '#' + Object.entries(pdfOpenParams).map(([key, value]) => `${key}=${encodeURIComponent(value)}`).join('&');
  let fullURL = `/lib/pdf/web/viewer.html?file=${encodeURIComponent(url)}${pdfOpenFragment}`;

  if (NexT.utils.supportsPDFs()) {
    element.innerHTML = `<embed class="pdfobject" src="${url + pdfOpenFragment}" type="application/pdf" style="height: ${element.dataset.height};">`;
  } else {
    element.innerHTML = `<iframe src="${fullURL}" style="height: ${element.dataset.height};" frameborder="0"></iframe>`;
  }
});
</script>


<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


  

  

  
  <script src="//img.imzlp.com/imgs/zlp/picgo/2021/quicklink.umd.js"></script>
  <script>
      window.addEventListener('load', () => {
      quicklink({
        timeout : 3000,
        priority: true,
        ignores : [uri => uri.includes('#'),uri => uri === 'https://en.imzlp.com/posts/24350/',]
      });
      });
  </script>


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/valine/1.4.14/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    var requiredFields = 'nick';
    requiredFields = requiredFields.split(',');
    
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'oCE6RMVkVoi5MgUhvFsn1EvV-gzGzoHsz',
      appKey     : 'K9SOaNYJ8PV6xaoFggWG5xvv',
      placeholder: "Leave something behind~",
      avatar     : 'robohash',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : 'en' || 'zh-cn',
      path       : location.pathname,
      recordIP   : true,
      serverURLs : '',
      requiredFields: requiredFields
    });
  }, window.Valine);
});
</script>

</body>
</html>
