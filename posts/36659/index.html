<!DOCTYPE html>
<html lang="en,default">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon-32x32-tilt-brush.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-tilt-brush.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-tilt-brush.png">
  <link rel="mask-icon" href="/images/favicon-32x32-tilt-brush.png" color="#222">
  <meta name="google-site-verification" content="ttIkhAIFZQM9Huj8roB0l95ePN2Tv2zv2wRFksi09WA">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noto Serif SC:300,300italic,400,400italic,700,700italic|Pacifico:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Roboto Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="//lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/5.15.2/css/all.min.css">
  <link rel="stylesheet" href="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/fancybox/3.5.7/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"en.imzlp.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false,"width":280},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"manual"},"fancybox":true,"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":false,"nav":null,"activeClass":"valine"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"code_unfold":{"enable":true,"CODE_MAX_HEIGHT":600},"path":"search.xml"};
  </script>

  <meta name="description" content="UE uses C++ as a compiled language, which means it becomes binary after compilation, and players can only update the game by reinstalling it. However, in game development, there’s often an urgent need">
<meta property="og:type" content="article">
<meta property="og:title" content="UE hot update: Lua programming guide based on UnLua">
<meta property="og:url" content="https://en.imzlp.com/posts/36659/index.html">
<meta property="og:site_name" content="Z&#39;s Blog">
<meta property="og:description" content="UE uses C++ as a compiled language, which means it becomes binary after compilation, and players can only update the game by reinstalling it. However, in game development, there’s often an urgent need">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/picgo/2023/20230323184439.webp">
<meta property="article:published_time" content="2020-03-24T10:50:17.000Z">
<meta property="article:modified_time" content="2021-06-22T11:08:09.000Z">
<meta property="article:author" content="LIPENGZHA">
<meta property="article:tag" content="UnrealEngine">
<meta property="article:tag" content="热更新">
<meta property="article:tag" content="Lua">
<meta property="article:tag" content="UnLua">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img.imzlp.com/imgs/zlp/picgo/2023/20230323184439.webp">

<link rel="canonical" href="https://en.imzlp.com/posts/36659/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>UE hot update: Lua programming guide based on UnLua | Z's Blog</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FDCJ41EFP5"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-FDCJ41EFP5');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.staticfile.org/lxgw-wenkai-screen-webfont/1.7.0/style.min.css" /><!-- hexo injector head_end end --><link rel="alternate" href="/atom.xml" title="Z's Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Z's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        
            
  <li class="menu-item menu-item-notes">

    <a href="/notes/" rel="section"><i class="fa fa-edit fa-fw"></i>Notes</a>

  </li>


      
        
            
  <li class="menu-item menu-item-essay">

    <a href="/essay/" rel="section"><i class="fas fa-feather-alt fa-fw"></i>Essay</a>

  </li>


      
        
            
  <li class="menu-item menu-item-resources">

    <a href="/resources/" rel="section"><i class="fa fa-inbox fa-fw"></i>Resources</a>

  </li>


      
        <li class="menu-item menu-item-friends">

    <a href="/friends/" rel="section"><i class="fas fa-link fa-fw"></i>Friends</a>

  </li>
        
            
  <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About Me</a>

  </li>


      
        <li class="menu-item menu-item-showcase">

    <a href="/showcase/" rel="section"><i class="fa fa-solid fa-trophy fa-fw"></i>ShowCase</a>

  </li>
        <li class="menu-item menu-item-changelog">

    <a href="/changelog/" rel="section"><i class="fa fa-history fa-fw"></i>Site Log</a>

  </li>
        <li class="menu-item menu-item-opensource">

    <a href="/opensource/" rel="section"><i class="fas fa-code-branch fa-fw"></i>Open Source</a>

  </li>
        <li class="menu-item menu-item-uewiki">

    <a href="https://ue5wiki.com/" rel="noopener" target="_blank"><i class="fab fa-wikipedia-w fa-fw"></i>Unreal Wiki</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>



<script type="text/javascript">
  let domain='en.imzlp.com';
  let domain_str = atob(domain);
  let pathname = location.pathname;
  if (domain_str!= location.host.toLowerCase()){
        console.log(`this host is not safe,jump to https://${domain_str}${pathname}`);
        location.href=`https://${domain_str}${pathname}`;
  }
</script>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>
  <div class="l10n-header-widget">
    <script>
      // 获取当前页面的 URL
      const currentUrl = window.location.href;
      // 替换 URL 中的部分内容
      const jumpToL10nLink = currentUrl.replace('en.imzlp.com', 'imzlp.com');
      // 将 jumpToL10nLink 绑定到一个全局变量
      window.jumpToL10nLink = jumpToL10nLink;
    </script>

    <a href="#" class="post-l10n-link" title="切换至中文版本" style="float: left;border-bottom: none;" rel="noopener" target="_blank" onclick="window.open(window.jumpToL10nLink, '_blank'); return false;">
      <i class="fa fa-solid fa-language"></i>
    </a>
  </div>



    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en"
  >
    <link itemprop="mainEntityOfPage" href="https://en.imzlp.com/posts/36659/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://img.imzlp.com/imgs/zlp/picgo/2023/202304152112902.webp">
      <meta itemprop="name" content="LIPENGZHA">
      <meta itemprop="description" content=""I think, therefore I am"">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Z's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          UE hot update: Lua programming guide based on UnLua<a href="https://github.com/imzlp/blog-md/blob/en/_posts/2020-03-24-36659.md" class="post-edit-link" title="Edit this post" style="float: right;border-bottom: 0px;" rel="noopener" target="_blank"><i class="fa fa-pen-nib"></i></a><a href="https://imzlp.com/posts/36659/" class="post-l10n-link" title="切换至中文版本" style="float: left;border-bottom: 0px;" rel="noopener" target="_blank"><i class="fa fa-solid fa-language"></i></a>
        </h1>

        
          <div class="post-subtitle" style="text-align: center;line-height: 1;">
            <sub text-align="center" style="font-size: 15px;align-content: center;font-style: italic;bottom: 0em;">UE热更新：基于UnLua的Lua编程指南</sub>
          </div>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-03-24 10:50 10:50:17:50" itemprop="dateCreated datePublished" datetime="2020-03-24T10:50:17+00:00">2020-03-24 10:50</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-06-22 11:08 11:08:09:08" itemprop="dateModified" datetime="2021-06-22T11:08:09+00:00">2021-06-22 11:08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/UnrealEngine/" itemprop="url" rel="index"><span itemprop="name">UnrealEngine</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/UnrealEngine/Lua/" itemprop="url" rel="index"><span itemprop="name">Lua</span></a>
                </span>
            </span>

          
            <span id="/posts/36659/" class="post-meta-item leancloud_visitors" data-flag-title="UE hot update: Lua programming guide based on UnLua" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>12k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>29 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>UE uses C++ as a compiled language, which means it becomes binary after compilation, and players can only update the game by reinstalling it. However, in game development, there’s often an urgent need for requirement adjustments and bug fixes, and frequently prompting players to update the app is unacceptable. Generally, game projects use Lua as the scripting language to transform the immutable C++ code at runtime into updatable Lua code.</p>
<p>Although UE does not officially support Lua, Tencent has open-sourced <a target="_blank" rel="noopener" href="https://github.com/Tencent/UnLua">UnLua</a>, which is being used in my current project. Over the past few days, I’ve organized some materials on UnLua (mainly the official documentation, issues, and presentation PPT) and combined it with my own experience from testing UnLua while writing a small demo, resulting in this programming guide for UE combined with UnLua. This article summarizes some basic methods and pitfalls for using UnLua to write business logic and will be updated continuously.</p>
<blockquote>
<p>Additionally, Lua files can be packaged into Pak using my previously open-sourced tool: <a target="_blank" rel="noopener" href="https://github.com/hxhb/HotPatcher">hxhb/HotPatcher</a>. I’ve also modified a version based on UnLua, adding some extra optimizations. The source code integrates the <a target="_blank" rel="noopener" href="https://github.com/diegonehab/luasocket">Luasocket</a>/<a target="_blank" rel="noopener" href="https://github.com/Tencent/LuaPanda">Luapanda</a>/<code>lpeg</code>/<code>Sproto</code>/<code>Luacrypt</code> libraries, and you can use <a target="_blank" rel="noopener" href="https://github.com/Tencent/LuaPanda">LuaPanda</a> for debugging. The GitHub address is: <a target="_blank" rel="noopener" href="https://github.com/hxhb/debugable-unlua">hxhb/debugable-unlua</a>.</p>
</blockquote>
<span id="more"></span>

<p><strong>Reference Materials</strong>:</p>
<ul>
<li><a href="UnLua/UnLua_UE4%E4%B8%8B%E7%9A%84Lua%E8%84%9A%E6%9C%AC%E6%8F%92%E4%BB%B6.pdf">UnLua_UE4 Lua Script Plugin PPT</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/Tencent/UnLua/blob/master/UnLua_Programming_Guide_EN.md">UnLua_Programming_Guide_EN</a></li>
<li><a target="_blank" rel="noopener" href="https://www.lua.org/pil/contents.html">Programming in Lua, 1st</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/Tencent/UnLua/issues/">Tencent/UnLua/issues</a></li>
</ul>
<h3 id="UnLua-Considerations"><a href="#UnLua-Considerations" class="headerlink" title="UnLua Considerations"></a>UnLua Considerations</h3><p>These are some potential pitfalls I’ve extracted from the UnLua official repository.</p>
<ul>
<li>Not all UFUNCTIONs are supported; only <code>BlueprintNativeEvent</code>/<code>BlueprintImplementationEvent</code>/<code>Replication Notify</code>/<code>Animation Notify</code>/<code>Input Event</code> are supported.</li>
<li>UnLua does not support multiple states, so running multiple clients in PIE mode will have issues. <a target="_blank" rel="noopener" href="https://github.com/Tencent/UnLua/issues/78">issues/78</a></li>
<li><del>Do not access Blueprint-defined structures in Lua. <a target="_blank" rel="noopener" href="https://github.com/Tencent/UnLua/issues/119">issues/119</a> / <a target="_blank" rel="noopener" href="https://github.com/Tencent/UnLua/issues/40">issues/40</a></del> (New submissions are now supported)</li>
<li>Using <code>self.Super</code> in UnLua will not recursively traverse all base classes in the inheritance hierarchy. <a target="_blank" rel="noopener" href="https://github.com/Tencent/UnLua/issues/131">issues/131</a></li>
<li>Non-dynamic delegates are not supported. <a target="_blank" rel="noopener" href="https://github.com/Tencent/UnLua/issues/128">issues/128</a></li>
<li>You cannot directly export static members of a class, but you can encapsulate them in a static method. <a target="_blank" rel="noopener" href="https://github.com/Tencent/UnLua/issues/22">issues/22</a></li>
<li>You cannot bind a Lua script to an object instance; the script specified in NewObject is bound to the UCLASS. <a target="_blank" rel="noopener" href="https://github.com/Tencent/UnLua/issues/134">issues/134</a></li>
<li>The index rule for using <code>UE4.TArray</code> in UnLua starts from 1, different from <code>TArray</code> in the engine which starts from 0. <a target="_blank" rel="noopener" href="https://github.com/Tencent/UnLua/issues/41">issues/41</a></li>
<li>Be aware that many functions exported to Lua have different names than those in Blueprints. For instance, <code>GetActorTransform</code> in Blueprints is actually used as <code>GetTransform</code> in Lua, and the names used in Lua are the actual defined names in C++, not the <code>DisplayName</code>.</li>
</ul>
<h3 id="Lua-Code-Hints"><a href="#Lua-Code-Hints" class="headerlink" title="Lua Code Hints"></a>Lua Code Hints</h3><h4 id="Exporting-Symbols"><a href="#Exporting-Symbols" class="headerlink" title="Exporting Symbols"></a>Exporting Symbols</h4><p>UnLua provides support for exporting reflection symbols within the engine, and you can also statically export symbols from non-reflection classes. It provides a <code>Commandlet</code> class called <code>UUnLuaIntelliSenseCommandlet</code> to export these symbols.</p>
<p>Here’s a brief introduction to calling the <code>Commandlet</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UE4Editor-cmd.exe PROJECT_PATH.uproject -run=COMMANDLET</span><br></pre></td></tr></table></figure>
<p>The usage of UnLua’s Commandlet is:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">D:\UnrealEngine\Epic\UE_4.23\Engine\Binaries\Win64\UE4Editor-cmd.exe C:\Users\imzlp\Documents\UnrealProjectSSD\MicroEnd_423\MicroEnd_423.uproject -run=UnLuaIntelliSense</span><br></pre></td></tr></table></figure>

<p>After execution, the directory <code>UnLua/Interamate/IntelliSense</code> will be generated, which contains symbols exported to Lua by the engine.</p>
<h4 id="Using-VSCode"><a href="#Using-VSCode" class="headerlink" title="Using VSCode"></a>Using VSCode</h4><p>Install the Emmylua plugin in VSCode, and after installation, add the previously generated <code>IntelliSense</code> directory to the vcode workspace.</p>
<h3 id="Calling-Parent-Class-Functions"><a href="#Calling-Parent-Class-Functions" class="headerlink" title="Calling Parent Class Functions"></a>Calling Parent Class Functions</h3><p>In Unreal C++, when we’ve overridden a virtual function from a parent class, we can specify calling the parent class implementation through <code>Super::</code>, but it’s different in Lua.</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">self</span>.Super.ReceiveBeginPlay(<span class="built_in">self</span>)</span><br></pre></td></tr></table></figure>
<p>In Lua, <code>self.Super</code> is used to call the parent class’s function.</p>
<blockquote>
<p>Note: In UnLua, Super simply simulates the “inheritance” semantics; in the case of multi-layer inheritance, there will be issues. Super will not actively traverse down the inheritance hierarchy. The “parent class” is not the metatable returned by <code>Class()</code>, but is set on the <code>Super</code> field (the metatable is defined in the C++ code of the plugin, and this process has been solidified).</p>
</blockquote>
<p>For calling the <code>superclass&#39;s superclass</code>:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">a.lua</span><br><span class="line"><span class="keyword">local</span> a = Class()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a:test</span><span class="params">()</span></span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"><span class="comment">--------------------------------------</span></span><br><span class="line"></span><br><span class="line">b.lua</span><br><span class="line"><span class="keyword">local</span> b = Class(<span class="string">&quot;a&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">--------------------------------------</span></span><br><span class="line"></span><br><span class="line">c.lua</span><br><span class="line"><span class="keyword">local</span> c = Class(<span class="string">&quot;b&quot;</span>)</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a:test</span><span class="params">()</span></span></span><br><span class="line"> c.Super.Super.test(<span class="built_in">self</span>)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>This issue was excerpted from UnLua issues: <a target="_blank" rel="noopener" href="https://github.com/Tencent/UnLua/issues/131">Usage Issue of <code>Super</code> in Class</a></p>
</blockquote>
<h3 id="Calling-Overridden-Methods"><a href="#Calling-Overridden-Methods" class="headerlink" title="Calling Overridden Methods"></a>Calling Overridden Methods</h3><blockquote>
<p>Note: Lua and the original class do not have an inheritance relationship but rather an affiliation relationship. Lua depends on Blueprint or C++ classes. The functions of the Lua-overridden class effectively replace the implementation of the current class’s functions.</p>
</blockquote>
<p>When overriding a UFUNCTION in a Lua subclass, you can call it using the following method, which is somewhat similar to <code>Super</code>, but written as <code>Overridden</code>:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">BP_Game_C:ReceiveBeginPlay</span><span class="params">()</span></span></span><br><span class="line">   <span class="built_in">self</span>.Overridden.ReceiveBeginPlay(<span class="built_in">self</span>) </span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>Ensure to pass <code>self</code> in, as failing to do so will cause a crash during execution due to parameter checks in UnLua. Calling UE functions in UnLua is akin to grabbing the raw pointer to a member function; you must manually pass this to it.</p>
<h3 id="Calling-UE-C-Functions"><a href="#Calling-UE-C-Functions" class="headerlink" title="Calling UE C++ Functions"></a>Calling UE C++ Functions</h3><p>UnLua allows enabling or disabling the UE namespace during compilation (i.e., all UE functions require the UE4 prefix).</p>
<p>The calling method is:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UE4.UKismetSystemLibrary.PrintString(<span class="built_in">self</span>,<span class="string">&quot;HelloWorld&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>The parameters match those of C++ calls (those with default parameters can also be omitted):</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UKismetSystemLibrary::<span class="built_in">PrintString</span>(<span class="keyword">this</span>, <span class="built_in">TEXT</span>(<span class="string">&quot;Hello&quot;</span>))</span><br></pre></td></tr></table></figure>

<h3 id="Overriding-Functions-with-Multiple-Return-Values"><a href="#Overriding-Functions-with-Multiple-Return-Values" class="headerlink" title="Overriding Functions with Multiple Return Values"></a>Overriding Functions with Multiple Return Values</h3><h4 id="Blueprints"><a href="#Blueprints" class="headerlink" title="Blueprints"></a>Blueprints</h4><p><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/36659/UnLua/override-mulit-return-value.webp"></p>
<p>The overridden Lua code:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">LoadingMap_C:GetName</span><span class="params">(InString)</span></span></span><br><span class="line">    UE4.UKismetSystemLibrary.PrintString(<span class="built_in">self</span>, InString)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>, <span class="string">&quot;helloworld&quot;</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<h4 id="C"><a href="#C" class="headerlink" title="C++"></a>C++</h4><p>Since multiple return values in C++ are realized by passing reference parameters, it’s different in Lua.</p>
<p>For the following C++ function:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .h</span></span><br><span class="line"><span class="built_in">UFUNCTION</span>(BlueprintCallable, Category = <span class="string">&quot;GameCore|Flib|GameFrameworkStatics&quot;</span>, meta = (CallableWithoutWorldContext, WorldContext = <span class="string">&quot;WorldContextObject&quot;</span>))</span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">bool</span> <span class="title">LuaGetMultiReturnExample</span><span class="params">(UObject* WorldContextObject, FString&amp; OutString, int32&amp; OutInt, UObject*&amp; OutGameInstance)</span></span>;</span><br><span class="line"><span class="comment">// .cpp</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">UFlibGameFrameworkStatics::LuaGetMultiReturnExample</span><span class="params">(UObject* WorldContextObject, FString&amp; OutString, int32&amp; OutInt, UObject*&amp; OutGameInstance)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">bool</span> bStatus = <span class="literal">false</span>;</span><br><span class="line">	<span class="keyword">if</span> (WorldContextObject)</span><br><span class="line">	&#123;</span><br><span class="line">		OutString = <span class="built_in">TEXT</span>(<span class="string">&quot;HelloWorld&quot;</span>);</span><br><span class="line">		OutInt = <span class="number">1111</span>;</span><br><span class="line">		OutGameInstance = UGameplayStatics::<span class="built_in">GetGameInstance</span>(WorldContextObject);</span><br><span class="line">		bStatus = <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> bStatus;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This function takes <code>WorldContextObject</code> as a parameter and receives three types as reference parameters, returning a bool. How to receive these parameter values in Lua?</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> ret1, ret2, ret3, ret4 = UE4.UFlibGameFrameworkStatics.LuaGetMultiReturnExample(<span class="built_in">self</span>, <span class="literal">nil</span>, <span class="literal">nil</span>, <span class="literal">nil</span>)</span><br></pre></td></tr></table></figure>

<p>This <code>local ret1, ret2 = func()</code> syntax follows Lua’s rules; you can refer to Programming in Lua, 4th edition, Chapter Six.</p>
<blockquote>
<p>Note: The order for receiving reference parameter return values and the actual function return value is: ret1, ret2, and ret3 are the reference parameters, while the final function return <code>bool</code> is ret4.</p>
</blockquote>
<p><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/36659/UnLua/lua-call-cpp-function-get-multi-ret.webp"></p>
<h4 id="Notes-on-Non-const-Reference-Parameters-as-Return-Values"><a href="#Notes-on-Non-const-Reference-Parameters-as-Return-Values" class="headerlink" title="Notes on Non-const Reference Parameters as Return Values"></a>Notes on Non-const Reference Parameters as Return Values</h4><blockquote>
<p><strong>Note</strong>: When calling UFUNCTION functions, non-const reference parameters can be ignored, but this does not apply to statically exported functions because UnLua performs a check on the number of parameters for static exports.</p>
</blockquote>
<p>Additionally, using references as return parameters requires consideration of the following two scenarios:</p>
<ol>
<li>Non-const reference as pure output</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">GetPlayerBaseInfo</span><span class="params">(int32 &amp;Level, <span class="type">float</span> &amp;Health, FString &amp;Name)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Level = <span class="number">7</span>;</span><br><span class="line">    Health = <span class="number">77</span>;</span><br><span class="line">    Name = <span class="string">&quot;Marcus&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In this case, the return value and input value have no relationship. In Lua, you can use:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> level, heath, name = <span class="built_in">self</span>:GetPlayerBaseInfo(<span class="number">0</span>, <span class="number">0</span>, <span class="string">&quot;&quot;</span>);</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>Non-const reference parameter used as both input and output</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">GetPlayerBaseInfo</span><span class="params">(int32 &amp;Level, <span class="type">float</span> &amp;Health, FString &amp;Name)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Level += <span class="number">7</span>;</span><br><span class="line">    Health += <span class="number">77</span>;</span><br><span class="line">    Name += <span class="string">&quot;Marcus&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In this scenario, the return value and input are directly related. Therefore, you cannot use it like in case 1:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> level, heath, name</span><br><span class="line">level, heath, name = <span class="built_in">self</span>:GetPlayerBaseInfo(level, heath, name);</span><br></pre></td></tr></table></figure>

<p>In this case, when calling Lua, both passed-in parameters and returned parameters must be specified; otherwise, normal behavior won’t occur as the values of <code>level, heath, and name</code> passed won’t change like C++ reference passing.</p>
<blockquote>
<p>Thus, how to call the function always depends on how it is written.</p>
</blockquote>
<p>This is also mentioned in UnLua’s issues: <a target="_blank" rel="noopener" href="https://github.com/Tencent/UnLua/issues/25">issues/25</a></p>
<h3 id="Checking-Interface-Inheritance"><a href="#Checking-Interface-Inheritance" class="headerlink" title="Checking Interface Inheritance"></a>Checking Interface Inheritance</h3><p>In C++, you can use <code>UKismetSystemLibrary::DoesImplementInterface</code>, and the same applies in Lua, but with a difference in the type of the interface passed in:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> CubeClass = UE4.UClass.Load(<span class="string">&quot;/Game/Cube_Blueprint.Cube_Blueprint&quot;</span>)</span><br><span class="line"><span class="keyword">local</span> World = <span class="built_in">self</span>:GetWorld()</span><br><span class="line"><span class="keyword">local</span> Cube_Ins = World:SpawnActor(CubeClass, <span class="built_in">self</span>:GetTransform(), UE4.ESpawnActorCollisionHandlingMethod.AlwaysSpawn, <span class="built_in">self</span>, <span class="built_in">self</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> UE4.UKismetSystemLibrary.DoesImplementInterface(Cube_Ins, UE4.UMyInterface) <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">print</span>(fmt(<span class="string">&quot;&#123;1&#125; inherited &#123;2&#125;&quot;</span>, CubeClass, UE4.UMyInterface))</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>You need to use the <code>UE4.U*Interface</code> format.</p>
<h3 id="Obtaining-TScriptInterface-Interface-Objects"><a href="#Obtaining-TScriptInterface-Interface-Objects" class="headerlink" title="Obtaining TScriptInterface Interface Objects"></a>Obtaining <code>TScriptInterface</code> Interface Objects</h3><p>When obtaining an interface in C++, the obtained type is <code>TScriptInterface&lt;&gt;</code>. Originally, I thought that I’d have to export <code>TScriptInterface</code> to access the interface. However, in UnLua, you can directly get <code>TScriptInterface&lt;&gt;</code> just like a normal UObject object.</p>
<p>For example, the following function:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UFUNCTION</span>(BlueprintCallable, Category = <span class="string">&quot;GameCore|Flib|GameFrameworkStatics&quot;</span>, meta = (CallableWithoutWorldContext, WorldContext = <span class="string">&quot;WorldContextObject&quot;</span>))</span><br><span class="line"><span class="function"><span class="type">static</span> TScriptInterface&lt;IINetGameInstance&gt; <span class="title">GetNetGameInstance</span><span class="params">(UObject* WorldContextObject)</span></span>;</span><br></pre></td></tr></table></figure>

<p>Calling it in Lua:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> GameInstance = UE4.UFlibGameFrameworkStatics.GetNetGameInstance(<span class="built_in">self</span>);</span><br></pre></td></tr></table></figure>

<p>The obtained type in C++ is <code>TScriptInterface&lt;&gt;</code>, but in Lua, it becomes the UObject of that interface.</p>
<p><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/36659/UnLua/unlua-get-tscriptinterface.webp"></p>
<h3 id="Calling-Member-Functions"><a href="#Calling-Member-Functions" class="headerlink" title="Calling Member Functions"></a>Calling Member Functions</h3><p>Having obtained the <code>TScriptInterface</code> interface (which is actually the UObject of that interface in Lua), there are three methods to call interface methods:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// This class does not need to be modified.</span></span><br><span class="line"><span class="built_in">UINTERFACE</span>(BlueprintType, MinimalAPI)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UINetGameInstance</span> : <span class="keyword">public</span> UIBaseEntityInterface</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">GENERATED_BODY</span>()</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GWORLD_API</span> IINetGameInstance</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">GENERATED_BODY</span>()</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">UFUNCTION</span>(Category = <span class="string">&quot;GameCore|GamePlayFramework&quot;</span>)</span><br><span class="line">		<span class="function"><span class="keyword">virtual</span> <span class="type">bool</span> <span class="title">FindSubsystem</span><span class="params">(<span class="type">const</span> FString&amp; InSysName, TScriptInterface&lt;IISubsystem&gt;&amp; OutSubsystem)</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="Calling-Functions-via-Objects"><a href="#Calling-Functions-via-Objects" class="headerlink" title="Calling Functions via Objects"></a>Calling Functions via Objects</h4><ol>
<li>You can obtain the object that implements the interface and then call the function through that object (using Lua’s <code>:</code> operator):</li>
</ol>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> GameInstance = UE4.UflibGameFrameworkStatics.GetNetGameInstance(<span class="built_in">self</span>);</span><br><span class="line"><span class="keyword">local</span> findRet1, findRet2 = GameInstance:FindSubsystem(<span class="string">&quot;TouchController&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="Specifying-Class-and-Function-Name"><a href="#Specifying-Class-and-Function-Name" class="headerlink" title="Specifying Class and Function Name"></a>Specifying Class and Function Name</h4><ol start="2">
<li>You can directly call by specifying the type name that implements the interface, much like a function pointer, passing the calling object’s instance as a parameter:</li>
</ol>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> GameInstance = UE4.UflibGameFrameworkStatics.GetNetGameInstance(<span class="built_in">self</span>);</span><br><span class="line"><span class="keyword">local</span> findRet1, findRet2 = UE4.UNetGameInstance.FindSubsystem(GameInstance, <span class="string">&quot;TouchController&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="Specifying-Interface-Class-and-Function-Name"><a href="#Specifying-Interface-Class-and-Function-Name" class="headerlink" title="Specifying Interface Class and Function Name"></a>Specifying Interface Class and Function Name</h4><ol start="3">
<li>You can also call through the interface type (as interfaces are UClass and their functions are also marked as UFUNCTION):</li>
</ol>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> GameInstance = UE4.UflibGameFrameworkStatics.GetNetGameInstance(<span class="built_in">self</span>);</span><br><span class="line"><span class="keyword">local</span> findRet1, findRet2 = UE4.UINetGameInstance.FindSubsystem(GameInstance, <span class="string">&quot;TouchController&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="Obtaining-UClass"><a href="#Obtaining-UClass" class="headerlink" title="Obtaining UClass"></a>Obtaining UClass</h3><p>To obtain a UClass in Lua for object creation, the method is:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> uclass = UE4.UClass.Load(<span class="string">&quot;/Game/Core/Blueprints/AI/BP_AICharacter.BP_AICharacter_C&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>The Load path corresponds to the <code>PackagePath</code> of that class.</p>
<p>For example, loading a UMG class in Lua and creating it to add to the viewport:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">LoadingMap_C:ReceiveBeginPlay</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">local</span> UMG_C = UE4.UClass.Load(<span class="string">&quot;/Game/Test/BPUI_TestMain.BPUI_TestMain_C&quot;</span>)</span><br><span class="line">    <span class="keyword">local</span> UMG_TestMain_Ins = UE4.UWidgetBlueprintLibrary.Create(<span class="built_in">self</span>, UMG_C)</span><br><span class="line">    UMG_TestMain_Ins:AddToViewport()</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>Note: The official implementation of <code>UE4.UClass.Load</code> in UnLua is defaulted to only create blueprint classes. For specifics, see the implementation in <code>LuaLib_Class.cpp</code> where <code>UClass_Load</code> is implemented.</p>
<p>You can modify it to support C++ classes:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">int32 <span class="title">UClass_Load</span><span class="params">(lua_State *L)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    int32 NumParams = <span class="built_in">lua_gettop</span>(L);</span><br><span class="line">    <span class="keyword">if</span> (NumParams != <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">UE_LOG</span>(LogUnLua, Log, <span class="built_in">TEXT</span>(<span class="string">&quot;%s: Invalid parameters!&quot;</span>), <span class="built_in">ANSI_TO_TCHAR</span>(__FUNCTION__));</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *ClassName = <span class="built_in">lua_tostring</span>(L, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (!ClassName)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">UE_LOG</span>(LogUnLua, Log, <span class="built_in">TEXT</span>(<span class="string">&quot;%s: Invalid class name!&quot;</span>), <span class="built_in">ANSI_TO_TCHAR</span>(__FUNCTION__));</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="function">FString <span class="title">ClassPath</span><span class="params">(ClassName)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="type">bool</span> IsCppClass = ClassPath.<span class="built_in">StartsWith</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;/Script&quot;</span>));</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!IsCppClass)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="type">const</span> TCHAR *Suffix = <span class="built_in">TEXT</span>(<span class="string">&quot;_C&quot;</span>);</span><br><span class="line">		int32 Index = INDEX_NONE;</span><br><span class="line">		ClassPath.<span class="built_in">FindChar</span>(<span class="built_in">TCHAR</span>(<span class="string">&#x27;.&#x27;</span>), Index);</span><br><span class="line">		<span class="keyword">if</span> (Index == INDEX_NONE)</span><br><span class="line">		&#123;</span><br><span class="line">			ClassPath.<span class="built_in">FindLastChar</span>(<span class="built_in">TCHAR</span>(<span class="string">&#x27;/&#x27;</span>), Index);</span><br><span class="line">			<span class="keyword">if</span> (Index != INDEX_NONE)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="type">const</span> FString Name = ClassPath.<span class="built_in">Mid</span>(Index + <span class="number">1</span>);</span><br><span class="line">				ClassPath += <span class="built_in">TCHAR</span>(<span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">				ClassPath += Name;</span><br><span class="line">				ClassPath.<span class="built_in">AppendChars</span>(Suffix, <span class="number">2</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (ClassPath.<span class="built_in">Right</span>(<span class="number">2</span>) != <span class="built_in">TEXT</span>(<span class="string">&quot;_C&quot;</span>))</span><br><span class="line">			&#123;</span><br><span class="line">				ClassPath.<span class="built_in">AppendChars</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;_C&quot;</span>), <span class="number">2</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    FClassDesc *ClassDesc = <span class="built_in">RegisterClass</span>(L, <span class="built_in">TCHAR_TO_ANSI</span>(*ClassPath));</span><br><span class="line">    <span class="keyword">if</span> (ClassDesc &amp;&amp; ClassDesc-&gt;<span class="built_in">AsClass</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        UnLua::<span class="built_in">PushUObject</span>(L, ClassDesc-&gt;<span class="built_in">AsClass</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">lua_pushnil</span>(L);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The path for C++ classes is:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/Script/GWorld.GWorldGameEngine</span><br></pre></td></tr></table></figure>

<p>It starts with <code>/Script</code>, followed by the module name to which the C++ class belongs, and after the <code>.</code> is the class name (excluding <code>U</code>/<code>A</code>, etc.).</p>
<h3 id="LoadObject"><a href="#LoadObject" class="headerlink" title="LoadObject"></a>LoadObject</h3><p>Load resources into memory:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> Object = LoadObject(<span class="string">&quot;/Game/Core/Blueprints/AI/BT_Enemy&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>For instance, loading a material ball for a model:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function Cube3_Blueprint_C:<span class="built_in">ReceiveBeginPlay</span>()</span><br><span class="line">    local MatIns = <span class="built_in">LoadObject</span>(<span class="string">&quot;/Game/TEST/Cube_Mat_Ins&quot;</span>)</span><br><span class="line">    UE4.UPrimitiveComponent.<span class="built_in">SetMaterial</span>(self.StaticMeshComponent, <span class="number">0</span>, MatIns)</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<p>Note: LuaObject in UnLua corresponds to <code>LoadObject&lt;Object&gt;</code>:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">int32 <span class="title">UObject_Load</span><span class="params">(lua_State *L)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">  UObject *Object = <span class="built_in">LoadObject</span>&lt;UObject&gt;(<span class="literal">nullptr</span>, *ObjectPath);</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Creating-Objects"><a href="#Creating-Objects" class="headerlink" title="Creating Objects"></a>Creating Objects</h3><blockquote>
<p>Note: Objects created in Lua with dynamic binding are bound to the UCLASS of that class, not the instance created from the New.</p>
</blockquote>
<p>UnLua’s handling of <code>NewObject</code> is covered in <code>Global_NewObject</code>:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">FScopedLuaDynamicBinding <span class="title">Binding</span><span class="params">(L, Class, ANSI_TO_TCHAR(ModuleName), TableRef)</span></span>;</span><br><span class="line">UObject *Object = <span class="built_in">StaticConstructObject_Internal</span>(Class, Outer, Name);</span><br></pre></td></tr></table></figure>

<h4 id="SpawnActor"><a href="#SpawnActor" class="headerlink" title="SpawnActor"></a>SpawnActor</h4><p>In Lua, SpawnActor and dynamic binding:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> World = <span class="built_in">self</span>:GetWorld()</span><br><span class="line"><span class="keyword">local</span> WeaponClass = UE4.UClass.Load(<span class="string">&quot;/Game/Core/Blueprints/Weapon/BP_DefaultWeapon.BP_DefaultWeapon&quot;</span>)</span><br><span class="line"><span class="keyword">local</span> NewWeapon = World:SpawnActor(WeaponClass, <span class="built_in">self</span>:GetTransform(), UE4.ESpawnActorCollisionHandlingMethod.AlwaysSpawn, <span class="built_in">self</span>, <span class="built_in">self</span>, <span class="string">&quot;Weapon.BP_DefaultWeapon_C&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="NewObject"><a href="#NewObject" class="headerlink" title="NewObject"></a>NewObject</h4><p>In Lua, calling NewObject and dynamic binding:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> ProxyObj = NewObject(ObjClass, <span class="built_in">self</span>, <span class="literal">nil</span>, <span class="string">&quot;Objects.ProxyObject&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>UnLua’s <code>NewObject</code> can accept four parameters: the UClass being created, Outer, Name, and the Lua script for dynamic binding.</p>
<h4 id="Component"><a href="#Component" class="headerlink" title="Component"></a>Component</h4><blockquote>
<p>Note: The original UnLua only allows loading BP’s UClass. Modifications are needed (modify <code>LuaLib_Class.cpp</code>‘s <code>UClass_Load</code> function to eliminate the logic of adding the <code>_C</code> suffix when passing a C++ class), and when creating Components, you also need to call <code>OnComponentCreated</code> and <code>RegisterComponent</code>. These two functions are not UFUNCTIONs and need to be manually exported.</p>
</blockquote>
<p>Export <code>OnComponentCreated</code> and <code>RegisterComponent</code> from ActorComponent:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Export Actor Component</span></span><br><span class="line"><span class="built_in">BEGIN_EXPORT_REFLECTED_CLASS</span>(UActorComponent)</span><br><span class="line">	<span class="built_in">ADD_FUNCTION</span>(RegisterComponent)</span><br><span class="line">	<span class="built_in">ADD_FUNCTION</span>(OnComponentCreated)</span><br><span class="line">	<span class="built_in">ADD_FUNCTION</span>(UnregisterComponent)</span><br><span class="line">	<span class="built_in">ADD_CONST_FUNCTION_EX</span>(<span class="string">&quot;IsRegistered&quot;</span>, <span class="type">bool</span>, IsRegistered)</span><br><span class="line">	<span class="built_in">ADD_CONST_FUNCTION_EX</span>(<span class="string">&quot;HasBeenCreated&quot;</span>, <span class="type">bool</span>, HasBeenCreated)</span><br><span class="line"><span class="built_in">END_EXPORT_CLASS</span>()</span><br><span class="line"><span class="built_in">IMPLEMENT_EXPORTED_CLASS</span>(UActorComponent)</span><br></pre></td></tr></table></figure>

<p>Usage remains consistent with C++ usage:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> StaticMeshClass = UE4.UClass.Load(<span class="string">&quot;/Script/Engine.StaticMeshComponent&quot;</span>)</span><br><span class="line"><span class="keyword">local</span> MeshObject = LoadObject(<span class="string">&quot;/Engine/VREditor/LaserPointer/CursorPointer&quot;</span>)</span><br><span class="line"><span class="keyword">local</span> StaticMeshComponent = NewObject(StaticMeshClass, <span class="built_in">self</span>, <span class="string">&quot;StaticMesh&quot;</span>)</span><br><span class="line">StaticMeshComponent:SetStaticMesh(MeshObject)</span><br><span class="line">StaticMeshComponent:RegisterComponent()</span><br><span class="line">StaticMeshComponent:OnComponentCreated()</span><br><span class="line"><span class="built_in">self</span>:ReceiveStaticMeshComponent(StaticMeshComponent)</span><br><span class="line"><span class="comment">-- StaticMeshComponent:K2_AttachToComponent(self.StaticMeshComponent, &quot;&quot;, EAttachmentRule.SnapToTarget, EAttachmentRule.SnapToTarget, EAttachmentRule.SnapToTarget)</span></span><br><span class="line">UE4.UStaticMeshComponent.K2_AttachToComponent(StaticMeshComponent, <span class="built_in">self</span>.StaticMeshComponent, <span class="string">&quot;&quot;</span>, EAttachmentRule.SnapToTarget, EAttachmentRule.SnapToTarget, EAttachmentRule.SnapToTarget)</span><br></pre></td></tr></table></figure>

<h4 id="UMG"><a href="#UMG" class="headerlink" title="UMG"></a>UMG</h4><p>Creating UMG first requires obtaining the UClass of the UI, then using <code>UWidgetBlueprintLibrary::Create</code> to create it, consistent with C++:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> UMG_C = UE4.UClass.Load(<span class="string">&quot;/Game/Test/BPUI_TestMain.BPUI_TestMain_C&quot;</span>)</span><br><span class="line"><span class="keyword">local</span> UMG_TestMain_Ins = UE4.UWidgetBlueprintLibrary.Create(<span class="built_in">self</span>, UMG_C)</span><br><span class="line">UMG_TestMain_Ins:AddToViewport()</span><br></pre></td></tr></table></figure>

<h3 id="Binding-Delegates"><a href="#Binding-Delegates" class="headerlink" title="Binding Delegates"></a>Binding Delegates</h3><h4 id="Dynamic-Multicast-Delegates"><a href="#Dynamic-Multicast-Delegates" class="headerlink" title="Dynamic Multicast Delegates"></a>Dynamic Multicast Delegates</h4><p>In C++ code, a dynamic multicast delegate is written as follows:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">DECLARE_DYNAMIC_MULTICAST_DELEGATE_OneParam</span>(FGameInstanceDyDlg, <span class="type">const</span> FString&amp;, InString);</span><br><span class="line"></span><br><span class="line"><span class="comment">// in class</span></span><br><span class="line"><span class="built_in">UPROPERTY</span>()</span><br><span class="line">FGameInstanceDyDlg GameInstanceDyDlg;</span><br></pre></td></tr></table></figure>

<p>In Lua, binding it can bind to Lua functions:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> GameInstance = UE4.UFlibGameFrameworkStatics.GetNetGameInstance(<span class="built_in">self</span>);</span><br><span class="line">GameInstance.GameInstanceDyMultiDlg:Add(<span class="built_in">self</span>, LoadingMap_C.BindGameInstanceDyMultiDlg)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- test bind dynamic multicast delegate lua func</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">LoadingMap_C:BindGameInstanceDyMultiDlg</span><span class="params">(InString)</span></span></span><br><span class="line">    UE4.UKismetSystemLibrary.PrintString(<span class="built_in">self</span>, InString)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>Similarly, you can also invoke, clean up, and remove the delegate:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-- remove </span><br><span class="line">GameInstance.GameInstanceDyMultiDlg:<span class="built_in">Remove</span>(self, LoadingMap_C.BindGameInstanceDyDlg)</span><br><span class="line">-- Clear</span><br><span class="line">GameInstance.GameInstanceDyMultiDlg:<span class="built_in">Clear</span>()</span><br><span class="line">-- broadcast</span><br><span class="line">GameInstance.GameInstanceDyMultiDlg:<span class="built_in">Broadcast</span>(<span class="string">&quot;66666666&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="Dynamic-Delegates"><a href="#Dynamic-Delegates" class="headerlink" title="Dynamic Delegates"></a>Dynamic Delegates</h4><p>In C++, the following dynamic delegate is declared:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">DECLARE_DYNAMIC_DELEGATE_OneParam</span>(FGameInstanceDyDlg, <span class="type">const</span> FString&amp;, InString);</span><br><span class="line"></span><br><span class="line"><span class="comment">// in class</span></span><br><span class="line"><span class="built_in">UPROPERTY</span>()</span><br><span class="line">FGameInstanceDyDlg GameInstanceDyDlg;</span><br></pre></td></tr></table></figure>

<p>In Lua, you bind it as follows:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GameInstance.GameInstanceDyDlg:Bind(<span class="built_in">self</span>, LoadingMap_C.BindGameInstanceDyMultiDlg)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- test bind dynamic delegate lua func</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">LoadingMap_C:BindGameInstanceDyDlg</span><span class="params">(InString)</span></span></span><br><span class="line">    UE4.UKismetSystemLibrary.PrintString(<span class="built_in">self</span>, InString)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>Dynamic delegates support <code>Bind</code>/<code>Unbind</code>/<code>Execute</code> operations:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- bind</span></span><br><span class="line">GameInstance.GameInstanceDyDlg:Bind(<span class="built_in">self</span>, LoadingMap_C.BindGameInstanceDyMultiDlg)</span><br><span class="line"><span class="comment">-- UnBind</span></span><br><span class="line">GameInstance.GameInstanceDyDlg:Unbind()</span><br><span class="line"><span class="comment">-- Execute</span></span><br><span class="line">GameInstance.GameInstanceDyDlg:Execute(<span class="string">&quot;GameInstanceDyMultiDlg&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="Non-Dynamic-Delegates-Are-Not-Supported"><a href="#Non-Dynamic-Delegates-Are-Not-Supported" class="headerlink" title="Non-Dynamic Delegates Are Not Supported"></a>Non-Dynamic Delegates Are Not Supported</h4><p>Since <code>BindStatic</code>/<code>BindRaw</code>/<code>BindUFunction</code> are all template functions, UnLua’s static export scheme does not support exporting them.</p>
<p>Official issue: <a target="_blank" rel="noopener" href="https://github.com/Tencent/UnLua/issues/128">How to correctly statically export normal delegates inherited from FScriptDelegate</a></p>
<h3 id="Using-Asynchronous-Events"><a href="#Using-Asynchronous-Events" class="headerlink" title="Using Asynchronous Events"></a>Using Asynchronous Events</h3><h4 id="Delay"><a href="#Delay" class="headerlink" title="Delay"></a>Delay</h4><p>If you wish to use a function similar to Delay:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * Perform a latent action with a delay (specified in seconds). Calling again while it is counting down will be ignored.</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * @param WorldContextWorld context.</span></span><br><span class="line"><span class="comment"> * @param Duration length of delay (in seconds).</span></span><br><span class="line"><span class="comment"> * @param LatentInfo The latent action.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">UFUNCTION</span>(BlueprintCallable, Category = <span class="string">&quot;Utilities|FlowControl&quot;</span>, meta = (Latent, WorldContext = <span class="string">&quot;WorldContextObject&quot;</span>, LatentInfo = <span class="string">&quot;LatentInfo&quot;</span>, Duration = <span class="string">&quot;0.2&quot;</span>, Keywords = <span class="string">&quot;sleep&quot;</span>))</span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">Delay</span><span class="params">(UObject* WorldContextObject, <span class="type">float</span> Duration, <span class="keyword">struct</span> FLatentActionInfo LatentInfo)</span></span>;</span><br></pre></td></tr></table></figure>

<p>In Lua, you can implement this using <code>coroutine</code>:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">LoadingMap_C:DelayFunc</span><span class="params">(Induration)</span></span></span><br><span class="line">    <span class="built_in">coroutine</span>.<span class="built_in">resume</span>(<span class="built_in">coroutine</span>.<span class="built_in">create</span>(</span><br><span class="line">        <span class="function"><span class="keyword">function</span><span class="params">(WorldContectObject, duration)</span></span>    </span><br><span class="line">            UE4.UKismetSystemLibrary.Delay(WorldContectObject, duration)</span><br><span class="line">            UE4.UKismetSystemLibrary.PrintString(WorldContectObject, <span class="string">&quot;Helloworld&quot;</span>)</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    ),</span><br><span class="line">    <span class="built_in">self</span>, Induration)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>You can bind it directly in <code>coroutine.create</code> or bind to an existing function:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">LoadingMap_C:DelayFunc</span><span class="params">(Induration)</span></span></span><br><span class="line">    <span class="built_in">coroutine</span>.<span class="built_in">resume</span>(<span class="built_in">coroutine</span>.<span class="built_in">create</span>(LoadingMap_C.DoDelay), <span class="built_in">self</span>, <span class="built_in">self</span>, Induration)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">LoadingMap_C:DoDelay</span><span class="params">(WorldContectObject, duration)</span></span>    </span><br><span class="line">    UE4.UKismetSystemLibrary.Delay(WorldContectObject, duration)</span><br><span class="line">    UE4.UKismetSystemLibrary.PrintString(WorldContectObject, <span class="string">&quot;Helloworld&quot;</span>)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>However, <strong>notice this point</strong>: when binding an existing Lua function, you need to pass an extra <code>self</code> to denote the caller of the function.</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">coroutine</span>.<span class="built_in">resume</span>(<span class="built_in">coroutine</span>.<span class="built_in">create</span>(LoadingMap_C.DoDelay), <span class="built_in">self</span>, <span class="built_in">self</span>, Induration)</span><br></pre></td></tr></table></figure>

<p>Here, the first <code>self</code> indicates that <code>LoadingMap_C.DoDelay</code> is being called via <code>self</code>, while the last two parameters are passed to the coroutine function.</p>
<p>Invocation code looks like this:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">LoadingMap_C:ReceiveBeginPlay</span><span class="params">()</span></span></span><br><span class="line">    <span class="comment">-- Outputs HelloWorld after 5 seconds</span></span><br><span class="line">    <span class="built_in">self</span>:DelayFunc(<span class="number">5.0</span>)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note: For UFUNCTIONs with <code>FLatentActionInfo</code>, you can directly use the above method, but for UE encapsulated asynchronous nodes, which are not functions but class nodes, you need to export them yourself.</p>
</blockquote>
<h4 id="AsyncLoadPrimaryAsset"><a href="#AsyncLoadPrimaryAsset" class="headerlink" title="AsyncLoadPrimaryAsset"></a>AsyncLoadPrimaryAsset</h4><p>In C++, you can use <code>UAsyncActionLoadPrimaryAsset::AsyncLoadPrimaryAsset</code> to load resources asynchronously:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * Load a primary asset into memory. The completed delegate will go off when the load succeeds or fails; you should cast the Loaded object to verify it is the correct type.</span></span><br><span class="line"><span class="comment"> * If LoadBundles are specified, those bundles are loaded along with the asset.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">UFUNCTION</span>(BlueprintCallable, meta = (BlueprintInternalUseOnly = <span class="string">&quot;true&quot;</span>, Category = <span class="string">&quot;AssetManager&quot;</span>, AutoCreateRefTerm = <span class="string">&quot;LoadBundles&quot;</span>, WorldContext = <span class="string">&quot;WorldContextObject&quot;</span>))</span><br><span class="line"><span class="function"><span class="type">static</span> UAsyncActionLoadPrimaryAsset* <span class="title">AsyncLoadPrimaryAsset</span><span class="params">(UObject* WorldContextObject, FPrimaryAssetId PrimaryAsset, <span class="type">const</span> TArray&lt;FName&gt;&amp; LoadBundles)</span></span>;</span><br></pre></td></tr></table></figure>

<p>To use this in Lua, you need to export the <code>FPrimaryAssetId</code> structure:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;UnLuaEx.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;LuaCore.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;UObject/PrimaryAssetId.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="built_in">BEGIN_EXPORT_CLASS</span>(FPrimaryAssetId, <span class="type">const</span> FString&amp;)</span><br><span class="line">	<span class="built_in">ADD_FUNCTION_EX</span>(<span class="string">&quot;ToString&quot;</span>, FString, ToString)</span><br><span class="line">	<span class="built_in">ADD_STATIC_FUNCTION_EX</span>(<span class="string">&quot;FromString&quot;</span>, FPrimaryAssetId, FromString, <span class="type">const</span> FString&amp;)</span><br><span class="line">	<span class="built_in">ADD_FUNCTION_EX</span>(<span class="string">&quot;IsValid&quot;</span>, <span class="type">bool</span>, IsValid)</span><br><span class="line"><span class="built_in">END_EXPORT_CLASS</span>()</span><br><span class="line"><span class="built_in">IMPLEMENT_EXPORTED_CLASS</span>(FPrimaryAssetId)</span><br></pre></td></tr></table></figure>

<p>You can then use it in Lua to asynchronously load level resources and open them upon completion:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Cube_Blueprint_C:ReceiveBeginPlay</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">local</span> Map = UE4.FPrimaryAssetId(<span class="string">&quot;Map:/Game/Test/LoadingMap&quot;</span>)</span><br><span class="line">    <span class="keyword">local</span> AsyncActionLoadPrimaryAsset = UE4.UAsyncActionLoadPrimaryAsset.AsyncLoadPrimaryAsset(<span class="built_in">self</span>, Map, <span class="literal">nil</span>)</span><br><span class="line">    AsyncActionLoadPrimaryAsset.Completed:Add(<span class="built_in">self</span>, Cube_Blueprint_C.ReceiveLoadedMap)</span><br><span class="line">    AsyncActionLoadPrimaryAsset:Activate()</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Cube_Blueprint_C:ReceiveLoadedMap</span><span class="params">(Object)</span></span></span><br><span class="line">    UE4.UGameplayStatics.OpenLevel(<span class="built_in">self</span>, <span class="string">&quot;/Game/Test/LoadingMap&quot;</span>, <span class="literal">true</span>)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<h4 id="SetTimer"><a href="#SetTimer" class="headerlink" title="SetTimer"></a>SetTimer</h4><p>For some requirements, you need Timer to call continuously; in C++, you can use <code>UKismetSystemLibrary::K2_SetTimerDelegate</code>, and in Blueprints, this corresponds to <code>SetTimerByEvent</code>, which is a UFUNCTION, so you can also call it in Lua.</p>
<p>Binding the delegate and cleanup operations:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">LoadingMap_C:ReceiveBeginPlay</span><span class="params">()</span></span></span><br><span class="line">    UpdateUILoopCount = <span class="number">0</span>;</span><br><span class="line">	UpdateUITimerHandle = UE4.UKismetSystemLibrary.K2_SetTimerDelegate(&#123;<span class="built_in">self</span>, LoadingMap_C.UpdateUI&#125;, <span class="number">0.3</span>, <span class="literal">true</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">LoadingMap_C:UpdateUI</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">if</span> UpdateUILoopCount &lt; <span class="number">10</span> <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;HelloWorld&quot;</span>)</span><br><span class="line">        UpdateUILoopCount = UpdateUILoopCount + <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        UE4.UKismetSystemLibrary.K2_ClearAndInvalidateTimerHandle(<span class="built_in">self</span>, UpdateUITimerHandle)</span><br><span class="line">    <span class="keyword">end</span> </span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>&#123;self, FUNCTION&#125;</code> creates a Delegate. Initially, I thought I would need to export a method to create a Dynamic Delegate myself, but it turns out I didn’t need to.</p>
</blockquote>
<h3 id="Binding-UMG-Control-Events"><a href="#Binding-UMG-Control-Events" class="headerlink" title="Binding UMG Control Events"></a>Binding UMG Control Events</h3><p>If you want to bind events like <code>OnPressed</code>/<code>OnClicked</code>/<code>OnReleased</code>/<code>OnHovered</code>/<code>OnUnhovered</code> for <code>UButton</code>, these are multicast delegates, so you’ll use <code>Add</code> to add them:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">DECLARE_DYNAMIC_MULTICAST_DELEGATE</span>(FOnButtonClickedEvent);</span><br><span class="line"><span class="built_in">DECLARE_DYNAMIC_MULTICAST_DELEGATE</span>(FOnButtonPressedEvent);</span><br><span class="line"><span class="built_in">DECLARE_DYNAMIC_MULTICAST_DELEGATE</span>(FOnButtonReleasedEvent);</span><br><span class="line"><span class="built_in">DECLARE_DYNAMIC_MULTICAST_DELEGATE</span>(FOnButtonHoverEvent);</span><br></pre></td></tr></table></figure>

<p>In Lua, to bind:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UMG_LoadingMap_C:Construct</span><span class="params">()</span></span></span><br><span class="line">    <span class="built_in">self</span>.ButtonItem.OnPressed:Add(<span class="built_in">self</span>, UMG_LoadingMap_C.OnButtonItemPressed)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UMG_LoadingMap_C:OnButtonItemPressed</span><span class="params">()</span></span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;On Button Item Pressed&quot;</span>)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<h3 id="UE4-TArray"><a href="#UE4-TArray" class="headerlink" title="UE4.TArray"></a>UE4.TArray</h3><p>In UnLua, the index rule for using <code>UE4.TArray</code> starts from 1, as opposed to the engine’s 0-based indexing. <a target="_blank" rel="noopener" href="https://github.com/Tencent/UnLua/issues/41">issues/41</a></p>
<h3 id="Cast"><a href="#Cast" class="headerlink" title="Cast"></a>Cast</h3><p>The syntax for type casting in UnLua is:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Obj:Cast(UE4.AActor)</span><br></pre></td></tr></table></figure>

<p>For instance:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> Character = Pawn:Cast(UE4.ABP_CharacterBase_C)</span><br></pre></td></tr></table></figure>
<h3 id="Using-Blueprint-Structures-in-Lua"><a href="#Using-Blueprint-Structures-in-Lua" class="headerlink" title="Using Blueprint Structures in Lua"></a>Using Blueprint Structures in Lua</h3><p>Create a blueprint structure in bp:<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/36659/UnLua/ue-bp-struct.webp"><br>In UnLua, you can access it in the following way:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">local bp_struct_ins = UE4.<span class="built_in">FBPStruct</span>()</span><br><span class="line">bp_struct_ins.string = <span class="string">&quot;123456&quot;</span></span><br><span class="line">bp_struct_ins.int32 = <span class="number">12345</span></span><br><span class="line">bp_struct_ins.<span class="type">float</span> = <span class="number">123.456</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">fmt</span>(<span class="string">&quot;string: &#123;&#125;,int32: &#123;&#125;,float: &#123;&#125;&quot;</span>,bp_struct_ins.string,bp_struct_ins.int32,bp_struct_ins.<span class="type">float</span>))</span><br></pre></td></tr></table></figure>
<p>You can use it like a C++ structure, but <strong>note</strong> that you need to add <code>F</code> in front of the blueprint structure type name. In the example above, the name in the blueprint is <code>BPStruct</code>, while in UnLua, it is accessed as <code>FBPStruct</code>.</p>
<h3 id="Insight-Profiler"><a href="#Insight-Profiler" class="headerlink" title="Insight Profiler"></a>Insight Profiler</h3><p>You can encapsulate <code>SCOPED_NAMED_EVENT</code> on the Lua side, but since Lua does not have C++ RAII mechanisms, it cannot detect when it leaves the scope in real-time. Therefore, you can only add marks at the beginning and end:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">TimerMgr:UpdateTimer</span><span class="params">(DeltaTime)</span></span></span><br><span class="line">    <span class="keyword">local</span> profile_tag = UE4.FProfileTag(<span class="string">&quot;TimerMgr_UpdateTimer&quot;</span>)</span><br><span class="line">    <span class="comment">-- dosomething...</span></span><br><span class="line">    profile_tag:End()</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>The implementation on the C++ side:</p>
<figure class="highlight cpp"><figcaption><span>ProfileTag.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;CoreMinimal.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ProfileTag.generated.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="built_in">USTRUCT</span>()</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">FProfileTag</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">GENERATED_BODY</span>()</span><br><span class="line">    <span class="built_in">FProfileTag</span>()&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Begin</span><span class="params">(<span class="type">const</span> FString&amp; Name)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(bInit) <span class="keyword">return</span>;</span><br><span class="line">        <span class="built_in">StaticBegin</span>(Name);</span><br><span class="line">        bInit = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">End</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(bInit)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">StaticEnd</span>();</span><br><span class="line">            bInit = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ~<span class="built_in">FProfileTag</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">End</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">StaticBegin</span><span class="params">(<span class="type">const</span> FString&amp; Name)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> PLATFORM_IMPLEMENTS_BeginNamedEventStatic</span></span><br><span class="line">        FPlatformMisc::<span class="built_in">BeginNamedEventStatic</span>(FColor::Yellow, *Name);</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">        FPlatformMisc::<span class="built_in">BeginNamedEvent</span>(FColor::Yellow, *Name);</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">StaticEnd</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        FPlatformMisc::<span class="built_in">EndNamedEvent</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">bool</span> bInit = <span class="literal">false</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>Expose it to the Lua side:</p>
<figure class="highlight cpp"><figcaption><span>Lualib_ProfileTag.cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;UnLuaEx.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;LuaCore.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ProfileTag.h&quot;</span></span></span><br><span class="line"><span class="function"><span class="type">static</span> int32 <span class="title">FProfileTag_New</span><span class="params">(lua_State *L)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    int32 NumParams = <span class="built_in">lua_gettop</span>(L);</span><br><span class="line">    <span class="keyword">if</span> (NumParams &lt; <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">UE_LOG</span>(LogUnLua, Log, <span class="built_in">TEXT</span>(<span class="string">&quot;%s: Invalid parameters!&quot;</span>), <span class="built_in">ANSI_TO_TCHAR</span>(__FUNCTION__));</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">void</span> *Userdata = <span class="built_in">NewTypedUserdata</span>(L, FProfileTag);</span><br><span class="line">    FProfileTag *V = <span class="built_in">new</span>(Userdata) <span class="built_in">FProfileTag</span>();</span><br><span class="line">    <span class="keyword">if</span> (NumParams &gt; <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        FString Name = <span class="built_in">ANSI_TO_TCHAR</span>((<span class="type">char</span>*)<span class="built_in">lua_tostring</span>(L,<span class="number">2</span>));</span><br><span class="line">        V-&gt;<span class="built_in">Begin</span>(Name);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> int32 <span class="title">FProfileTag_Begin</span><span class="params">(lua_State *L)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    int32 NumParams = <span class="built_in">lua_gettop</span>(L);</span><br><span class="line">    <span class="keyword">if</span> (NumParams &lt; <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">UE_LOG</span>(LogUnLua, Log, <span class="built_in">TEXT</span>(<span class="string">&quot;%s: Invalid parameters!&quot;</span>), <span class="built_in">ANSI_TO_TCHAR</span>(__FUNCTION__));</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    FProfileTag *V = (FProfileTag*)<span class="built_in">GetCppInstanceFast</span>(L, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (!V)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">UE_LOG</span>(LogUnLua, Log, <span class="built_in">TEXT</span>(<span class="string">&quot;%s: Invalid FProfileTag!&quot;</span>), <span class="built_in">ANSI_TO_TCHAR</span>(__FUNCTION__));</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    FString Name = <span class="built_in">ANSI_TO_TCHAR</span>((<span class="type">char</span>*)<span class="built_in">lua_tostring</span>(L,<span class="number">2</span>));</span><br><span class="line">    V-&gt;<span class="built_in">Begin</span>(Name);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">static</span> int32 <span class="title">FProfileTag_End</span><span class="params">(lua_State *L)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    int32 NumParams = <span class="built_in">lua_gettop</span>(L);</span><br><span class="line">    <span class="keyword">if</span> (NumParams &lt; <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">UE_LOG</span>(LogUnLua, Log, <span class="built_in">TEXT</span>(<span class="string">&quot;%s: Invalid parameters!&quot;</span>), <span class="built_in">ANSI_TO_TCHAR</span>(__FUNCTION__));</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    FProfileTag *V = (FProfileTag*)<span class="built_in">GetCppInstanceFast</span>(L, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (!V)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">UE_LOG</span>(LogUnLua, Log, <span class="built_in">TEXT</span>(<span class="string">&quot;%s: Invalid FProfileTag!&quot;</span>), <span class="built_in">ANSI_TO_TCHAR</span>(__FUNCTION__));</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    V-&gt;<span class="built_in">End</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> luaL_Reg FProfileTagLib[] =</span><br><span class="line">&#123;</span><br><span class="line">    &#123;<span class="string">&quot;__call&quot;</span>,FProfileTag_New&#125;,</span><br><span class="line">    &#123; <span class="string">&quot;Begin&quot;</span>, FProfileTag_Begin &#125;,</span><br><span class="line">    &#123; <span class="string">&quot;End&quot;</span>, FProfileTag_End &#125;,</span><br><span class="line">    &#123; <span class="literal">nullptr</span>, <span class="literal">nullptr</span> &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">BEGIN_EXPORT_REFLECTED_CLASS</span>(FProfileTag)</span><br><span class="line">    <span class="built_in">ADD_STATIC_FUNCTION_EX</span>(<span class="string">&quot;StaticBegin&quot;</span>,<span class="type">void</span>,StaticBegin,<span class="type">const</span> FString&amp;)</span><br><span class="line">    <span class="built_in">ADD_STATIC_FUNCTION_EX</span>(<span class="string">&quot;StaticEnd&quot;</span>,<span class="type">void</span>,StaticEnd)</span><br><span class="line">    <span class="built_in">ADD_LIB</span>(FProfileTagLib)</span><br><span class="line"><span class="built_in">END_EXPORT_CLASS</span>()</span><br><span class="line"><span class="built_in">IMPLEMENT_EXPORTED_CLASS</span>(FProfileTag)</span><br></pre></td></tr></table></figure>
<p>Then you can use it in Lua and view the execution cost of the Lua code in Unreal Insight:<br><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2021/20210622110706.webp"></p>
<p>Three usage methods are provided:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- using 1</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">TimerMgr:UpdateTimer</span><span class="params">(DeltaTime)</span></span></span><br><span class="line">    <span class="keyword">local</span> profile_tag = UE4.FProfileTag(<span class="string">&quot;TimerMgr_UpdateTimer&quot;</span>)</span><br><span class="line">    <span class="comment">-- dosomething...</span></span><br><span class="line">    profile_tag:End()</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- using 2</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">TimerMgr:UpdateTimer</span><span class="params">(DeltaTime)</span></span></span><br><span class="line">    <span class="keyword">local</span> profile_tag = UE4.FProfileTag()</span><br><span class="line">    profile_tag:Begin((<span class="string">&quot;TimerMgr_UpdateTimer&quot;</span>))</span><br><span class="line">    <span class="comment">-- dosomething...</span></span><br><span class="line">    profile_tag:End()</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- using 3</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">TimerMgr:UpdateTimer</span><span class="params">(DeltaTime)</span></span></span><br><span class="line">    UE4.FProfileTag.StaticBegin((<span class="string">&quot;TimerMgr_UpdateTimer&quot;</span>))</span><br><span class="line">    <span class="comment">-- dosomething...</span></span><br><span class="line">    UE4.FProfileTag.StaticEnd()</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>It is recommended to use the object creation method, as the created object will call End when the Lua object is destroyed if it is forgotten, preventing issues with Insight’s data collection. Using <code>StaticBegin/StaticEnd</code> must ensure that all code branches can reach <code>StaticEnd</code>.<br>You can combine Lua’s <code>debug.getinfo(1).name</code> to get the function name and display it in Insight:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">TimerMgr:UpdateTimer</span><span class="params">(DeltaTime)</span></span></span><br><span class="line">    <span class="keyword">local</span> profile_tag = UE4.FProfileTag(<span class="built_in">debug</span>.<span class="built_in">getinfo</span>(<span class="number">1</span>).name)</span><br><span class="line">    <span class="comment">-- dosomething...</span></span><br><span class="line">    profile_tag:End()</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

    </div>

    
    
        
        
          
            <blockquote class="blockquote-center">
              
                未完待续，欢迎指出问题和交流意见。
              
            <br/>
            
                <div class="qr-code" onclick="return false">
                    <script src="/js/qrcode.min.js"></script>
                    <div id="qrcode">
                      
                        <img src="https://imzlp.com/images/wechat-qrcode.webp">
                      
                    <p>Scan the QR code on WeChat and follow me.</p>
                    </div>
                </div>
            
            </blockquote>
          
        

        
          <div class="postCopyright" style="clear:both;">
             <span>Title:</span><a href="/posts/36659/" target="_blank">UE hot update: Lua programming guide based on UnLua</a><br/>
             <span>Author:</span><a href="/about" target="_blank" title="查看 LIPENGZHA 的资料">LIPENGZHA</a><br/>
             <span>Publish Date:</span>2020/03/24 10:50<br/>
             
              <span>Update Date:</span>2021/06/22 11:08<br/>
             
             <span>Word Count:</span><span class="page-count">12k Words</span><br/>
             
             <span>Link:</span><a href="/posts/36659/" target="_blank" title="UE hot update: Lua programming guide based on UnLua">https://en.imzlp.com/posts/36659/</a>
             <span class="copy-path" data-clipboard-text="Link: https://en.imzlp.com/posts/36659/ Author: LIPENGZHA" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
             <script src="/js/jquery.min.js"></script>
             <script src="/js/clipboard.min.js"></script>
             <script> var clipboard = new Clipboard('.copy-path'); </script>
             <br/>
             
             <span>License:</span><i class="fab fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" title="Attribution-NonCommercial-ShareAlike 4.0 International">CC BY-NC-SA 4.0</a><br/>
             
             <span>Reprinting of the full article is prohibited.</span>
          </div>
        
    

        
  <div class="reward-container">
    <div>Your donation will encourage me to keep creating!</div>
    <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
      Donate
    </button>
    <div id="qr" style="display: none;">
        
        <div style="display: inline-block;">
          <img src="/images/reward/wechatpay.webp" alt="LIPENGZHA WeChat Pay">
          <p>WeChat Pay</p>
        </div>

    </div>
  </div>



      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/UnrealEngine/" rel="tag"># UnrealEngine</a>
              <a href="/tags/%E7%83%AD%E6%9B%B4%E6%96%B0/" rel="tag"># 热更新</a>
              <a href="/tags/Lua/" rel="tag"># Lua</a>
              <a href="/tags/UnLua/" rel="tag"># UnLua</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/posts/8470/" rel="prev" title="Integrate ZSTD compression algorithm for UE4 using ModularFeature">
      <i class="fa fa-chevron-left"></i> Integrate ZSTD compression algorithm for UE4 using ModularFeature
    </a></div>
      <div class="post-nav-item">
    <a href="/posts/20425/" rel="next" title="The Differences and Relationships between UEC++ and Standard C++">
      The Differences and Relationships between UEC++ and Standard C++ <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
      <div class="tabs tabs-comment">
        <ul class="nav-tabs">
            <li class="tab"><a href="#comment-utteranc">utteranc</a></li>
            <li class="tab"><a href="#comment-valine">valine</a></li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane utteranc" id="comment-utteranc">
              
  
  <div class="comments">
  <script src="https://utteranc.es/client.js" repo="hxhb/blog-comments" issue-term="pathname" theme="github-light" crossorigin="anonymous" async></script>
  </div>
  
  
            </div>
            <div class="tab-pane valine" id="comment-valine">
              <div class="comments" id="valine-comments"></div>
            </div>
        </div>
      </div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#UnLua-Considerations"><span class="nav-number">1.</span> <span class="nav-text">UnLua Considerations</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Lua-Code-Hints"><span class="nav-number">2.</span> <span class="nav-text">Lua Code Hints</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Exporting-Symbols"><span class="nav-number">2.1.</span> <span class="nav-text">Exporting Symbols</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Using-VSCode"><span class="nav-number">2.2.</span> <span class="nav-text">Using VSCode</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Calling-Parent-Class-Functions"><span class="nav-number">3.</span> <span class="nav-text">Calling Parent Class Functions</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Calling-Overridden-Methods"><span class="nav-number">4.</span> <span class="nav-text">Calling Overridden Methods</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Calling-UE-C-Functions"><span class="nav-number">5.</span> <span class="nav-text">Calling UE C++ Functions</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Overriding-Functions-with-Multiple-Return-Values"><span class="nav-number">6.</span> <span class="nav-text">Overriding Functions with Multiple Return Values</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Blueprints"><span class="nav-number">6.1.</span> <span class="nav-text">Blueprints</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#C"><span class="nav-number">6.2.</span> <span class="nav-text">C++</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Notes-on-Non-const-Reference-Parameters-as-Return-Values"><span class="nav-number">6.3.</span> <span class="nav-text">Notes on Non-const Reference Parameters as Return Values</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Checking-Interface-Inheritance"><span class="nav-number">7.</span> <span class="nav-text">Checking Interface Inheritance</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Obtaining-TScriptInterface-Interface-Objects"><span class="nav-number">8.</span> <span class="nav-text">Obtaining TScriptInterface Interface Objects</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Calling-Member-Functions"><span class="nav-number">9.</span> <span class="nav-text">Calling Member Functions</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Calling-Functions-via-Objects"><span class="nav-number">9.1.</span> <span class="nav-text">Calling Functions via Objects</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Specifying-Class-and-Function-Name"><span class="nav-number">9.2.</span> <span class="nav-text">Specifying Class and Function Name</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Specifying-Interface-Class-and-Function-Name"><span class="nav-number">9.3.</span> <span class="nav-text">Specifying Interface Class and Function Name</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Obtaining-UClass"><span class="nav-number">10.</span> <span class="nav-text">Obtaining UClass</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LoadObject"><span class="nav-number">11.</span> <span class="nav-text">LoadObject</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Creating-Objects"><span class="nav-number">12.</span> <span class="nav-text">Creating Objects</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#SpawnActor"><span class="nav-number">12.1.</span> <span class="nav-text">SpawnActor</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#NewObject"><span class="nav-number">12.2.</span> <span class="nav-text">NewObject</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Component"><span class="nav-number">12.3.</span> <span class="nav-text">Component</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#UMG"><span class="nav-number">12.4.</span> <span class="nav-text">UMG</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Binding-Delegates"><span class="nav-number">13.</span> <span class="nav-text">Binding Delegates</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Dynamic-Multicast-Delegates"><span class="nav-number">13.1.</span> <span class="nav-text">Dynamic Multicast Delegates</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Dynamic-Delegates"><span class="nav-number">13.2.</span> <span class="nav-text">Dynamic Delegates</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Non-Dynamic-Delegates-Are-Not-Supported"><span class="nav-number">13.3.</span> <span class="nav-text">Non-Dynamic Delegates Are Not Supported</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Using-Asynchronous-Events"><span class="nav-number">14.</span> <span class="nav-text">Using Asynchronous Events</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Delay"><span class="nav-number">14.1.</span> <span class="nav-text">Delay</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#AsyncLoadPrimaryAsset"><span class="nav-number">14.2.</span> <span class="nav-text">AsyncLoadPrimaryAsset</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SetTimer"><span class="nav-number">14.3.</span> <span class="nav-text">SetTimer</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Binding-UMG-Control-Events"><span class="nav-number">15.</span> <span class="nav-text">Binding UMG Control Events</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UE4-TArray"><span class="nav-number">16.</span> <span class="nav-text">UE4.TArray</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Cast"><span class="nav-number">17.</span> <span class="nav-text">Cast</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Using-Blueprint-Structures-in-Lua"><span class="nav-number">18.</span> <span class="nav-text">Using Blueprint Structures in Lua</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Insight-Profiler"><span class="nav-number">19.</span> <span class="nav-text">Insight Profiler</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person" oncontextmenu="return false" οndragstart="return false">
    <img class="site-author-image" itemprop="image" alt="LIPENGZHA"
      src="https://img.imzlp.com/imgs/zlp/picgo/2023/202304152112902.webp">
  <p class="site-author-name" itemprop="name">LIPENGZHA</p>
  <div class="site-description" itemprop="description">"I think, therefore I am"</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
             
          <span class="site-state-item-count">190</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">95</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">190</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/hxhb" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;hxhb" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://linkedin.com/in/lipengzha" title="Linkedin → https:&#x2F;&#x2F;linkedin.com&#x2F;in&#x2F;lipengzha" rel="noopener" target="_blank"><i class="fab fa-linkedin fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/imzlp" title="知乎 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;imzlp" rel="noopener" target="_blank"><i class="fa fa-custom zhihu fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/images/wechat-qrcode-offical.webp" title="微信公众号 → &#x2F;images&#x2F;wechat-qrcode-offical.webp"><i class="fab fa-weixin fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:imzlp@foxmail.com" title="E-Mail → mailto:imzlp@foxmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-rss fa-fw"></i></a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://consolehelp.imzlp.com/" title="https:&#x2F;&#x2F;consolehelp.imzlp.com&#x2F;" rel="noopener" target="_blank">UE Console Help</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://imzlp.com/opensource/" title="https:&#x2F;&#x2F;imzlp.com&#x2F;opensource&#x2F;" rel="noopener" target="_blank">Open Source Projects</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://imzlp.com/posts/11515/" title="https:&#x2F;&#x2F;imzlp.com&#x2F;posts&#x2F;11515&#x2F;" rel="noopener" target="_blank">UE C++ API Dash Documents</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://ue5wiki.com/" title="https:&#x2F;&#x2F;ue5wiki.com&#x2F;" rel="noopener" target="_blank">Unreal Engine Wiki</a>
        </li>
    </ul>
  </div>

      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2014 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">LIPENGZHA</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="Symbols count total">1.5m</span>
</div>
  <div class="powered-by-other">
    
	    <center>Github Pages | Actions | NeXT | Cloudflare | Hexo Deploy</center>
      
  </div>

<script>
function checkWebp(callback) {
    var img = new Image();
    img.onload = function () { callback((img.width > 0) && (img.height > 0)); };
    img.onerror = function () { callback(false); };
    img.src = 'data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA';
}
function showImage(useWebp) {
    var imgs = [].slice.call(document.querySelectorAll('img'));
    imgs.forEach(function (e) {
        if (!useWebp) {
            var src = e.getAttribute('data-src')
            src = src.replace(/\.webp$/, '.png');
            e.setAttribute('data-src', src);
        }
    });
}
checkWebp(showImage);
</script>

        








      </div>
    </footer>
  </div>

  
  <script src="//lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/animejs/3.2.1/anime.min.js"></script>
  <script src="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/jquery/3.5.1/jquery.min.js"></script>
  <script src="//lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/fancybox/3.5.7/jquery.fancybox.min.js"></script>
  <script src="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/lozad.js/1.16.0/lozad.min.js"></script>
  <script src="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/pangu/4.0.7/pangu.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>



<script src="/js/code-unfold.js"></script>

  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>




  
<script src="/js/local-search.js"></script>









<script>
document.querySelectorAll('.pdfobject-container').forEach(element => {
  let url = element.dataset.target;
  let pdfOpenParams = {
    navpanes : 0,
    toolbar  : 0,
    statusbar: 0,
    pagemode : 'thumbs',
    view     : 'FitH'
  };
  let pdfOpenFragment = '#' + Object.entries(pdfOpenParams).map(([key, value]) => `${key}=${encodeURIComponent(value)}`).join('&');
  let fullURL = `/lib/pdf/web/viewer.html?file=${encodeURIComponent(url)}${pdfOpenFragment}`;

  if (NexT.utils.supportsPDFs()) {
    element.innerHTML = `<embed class="pdfobject" src="${url + pdfOpenFragment}" type="application/pdf" style="height: ${element.dataset.height};">`;
  } else {
    element.innerHTML = `<iframe src="${fullURL}" style="height: ${element.dataset.height};" frameborder="0"></iframe>`;
  }
});
</script>


<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


  

  

  
  <script src="//img.imzlp.com/imgs/zlp/picgo/2021/quicklink.umd.js"></script>
  <script>
      window.addEventListener('load', () => {
      quicklink({
        timeout : 3000,
        priority: true,
        ignores : [uri => uri.includes('#'),uri => uri === 'https://en.imzlp.com/posts/36659/',]
      });
      });
  </script>


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/valine/1.4.14/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    var requiredFields = 'nick';
    requiredFields = requiredFields.split(',');
    
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'oCE6RMVkVoi5MgUhvFsn1EvV-gzGzoHsz',
      appKey     : 'K9SOaNYJ8PV6xaoFggWG5xvv',
      placeholder: "Leave something behind~",
      avatar     : 'robohash',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : 'en' || 'zh-cn',
      path       : location.pathname,
      recordIP   : true,
      serverURLs : '',
      requiredFields: requiredFields
    });
  }, window.Valine);
});
</script>

</body>
</html>
