<!DOCTYPE html>
<html lang="en,default">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon-32x32-tilt-brush.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-tilt-brush.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-tilt-brush.png">
  <link rel="mask-icon" href="/images/favicon-32x32-tilt-brush.png" color="#222">
  <meta name="google-site-verification" content="ttIkhAIFZQM9Huj8roB0l95ePN2Tv2zv2wRFksi09WA">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noto Serif SC:300,300italic,400,400italic,700,700italic|Pacifico:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Roboto Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="//lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/5.15.2/css/all.min.css">
  <link rel="stylesheet" href="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/fancybox/3.5.7/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"en.imzlp.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false,"width":280},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"manual"},"fancybox":true,"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":false,"nav":null,"activeClass":"valine"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"code_unfold":{"enable":true,"CODE_MAX_HEIGHT":600},"path":"search.xml"};
  </script>

  <meta name="description" content="In a previous article, I introduced the development notes and some engineering practices for Mac&#x2F;iOS: UE4 Development Notes: Mac&#x2F;iOS Edition. This article serves as a sister piece, documenting the sta">
<meta property="og:type" content="article">
<meta property="og:title" content="UE Development Notes: Android">
<meta property="og:url" content="https://en.imzlp.com/posts/17996/index.html">
<meta property="og:site_name" content="Z&#39;s Blog">
<meta property="og:description" content="In a previous article, I introduced the development notes and some engineering practices for Mac&#x2F;iOS: UE4 Development Notes: Mac&#x2F;iOS Edition. This article serves as a sister piece, documenting the sta">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/picgo/2023/20230206152333.webp">
<meta property="article:published_time" content="2021-04-15T19:54:12.000Z">
<meta property="article:modified_time" content="2021-04-15T19:54:12.000Z">
<meta property="article:author" content="LIPENGZHA">
<meta property="article:tag" content="UnrealEngine">
<meta property="article:tag" content="Android">
<meta property="article:tag" content="UPL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img.imzlp.com/imgs/zlp/picgo/2023/20230206152333.webp">

<link rel="canonical" href="https://en.imzlp.com/posts/17996/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>UE Development Notes: Android | Z's Blog</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FDCJ41EFP5"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-FDCJ41EFP5');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.staticfile.org/lxgw-wenkai-screen-webfont/1.7.0/style.min.css" /><!-- hexo injector head_end end --><link rel="alternate" href="/atom.xml" title="Z's Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Z's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        
            
  <li class="menu-item menu-item-notes">

    <a href="/notes/" rel="section"><i class="fa fa-edit fa-fw"></i>Notes</a>

  </li>


      
        
            
  <li class="menu-item menu-item-essay">

    <a href="/essay/" rel="section"><i class="fas fa-feather-alt fa-fw"></i>Essay</a>

  </li>


      
        
            
  <li class="menu-item menu-item-resources">

    <a href="/resources/" rel="section"><i class="fa fa-inbox fa-fw"></i>Resources</a>

  </li>


      
        <li class="menu-item menu-item-friends">

    <a href="/friends/" rel="section"><i class="fas fa-link fa-fw"></i>Friends</a>

  </li>
        
            
  <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About Me</a>

  </li>


      
        <li class="menu-item menu-item-showcase">

    <a href="/showcase/" rel="section"><i class="fa fa-solid fa-trophy fa-fw"></i>ShowCase</a>

  </li>
        <li class="menu-item menu-item-changelog">

    <a href="/changelog/" rel="section"><i class="fa fa-history fa-fw"></i>Site Log</a>

  </li>
        <li class="menu-item menu-item-opensource">

    <a href="/opensource/" rel="section"><i class="fas fa-code-branch fa-fw"></i>Open Source</a>

  </li>
        <li class="menu-item menu-item-uewiki">

    <a href="https://ue5wiki.com/" rel="noopener" target="_blank"><i class="fab fa-wikipedia-w fa-fw"></i>Unreal Wiki</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>



<script type="text/javascript">
  let domain='en.imzlp.com';
  let domain_str = atob(domain);
  let pathname = location.pathname;
  if (domain_str!= location.host.toLowerCase()){
        console.log(`this host is not safe,jump to https://${domain_str}${pathname}`);
        location.href=`https://${domain_str}${pathname}`;
  }
</script>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>
  <div class="l10n-header-widget">
    <script>
      // 获取当前页面的 URL
      const currentUrl = window.location.href;
      // 替换 URL 中的部分内容
      const jumpToL10nLink = currentUrl.replace('en.imzlp.com', 'imzlp.com');
      // 将 jumpToL10nLink 绑定到一个全局变量
      window.jumpToL10nLink = jumpToL10nLink;
    </script>

    <a href="#" class="post-l10n-link" title="切换至中文版本" style="float: left;border-bottom: none;" rel="noopener" target="_blank" onclick="window.open(window.jumpToL10nLink, '_blank'); return false;">
      <i class="fa fa-solid fa-language"></i>
    </a>
  </div>



    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en"
  >
    <link itemprop="mainEntityOfPage" href="https://en.imzlp.com/posts/17996/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://img.imzlp.com/imgs/zlp/picgo/2023/202304152112902.webp">
      <meta itemprop="name" content="LIPENGZHA">
      <meta itemprop="description" content=""I think, therefore I am"">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Z's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          UE Development Notes: Android<a href="https://github.com/imzlp/blog-md/blob/en/_posts/2021-04-15-17996.md" class="post-edit-link" title="Edit this post" style="float: right;border-bottom: 0px;" rel="noopener" target="_blank"><i class="fa fa-pen-nib"></i></a><a href="https://imzlp.com/posts/17996/" class="post-l10n-link" title="切换至中文版本" style="float: left;border-bottom: 0px;" rel="noopener" target="_blank"><i class="fa fa-solid fa-language"></i></a>
        </h1>

        
          <div class="post-subtitle" style="text-align: center;line-height: 1;">
            <sub text-align="center" style="font-size: 15px;align-content: center;font-style: italic;bottom: 0em;">UE开发笔记：Android篇</sub>
          </div>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-04-15 19:54 19:54:12:54" itemprop="dateCreated datePublished" datetime="2021-04-15T19:54:12+00:00">2021-04-15 19:54</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/UnrealEngine/" itemprop="url" rel="index"><span itemprop="name">UnrealEngine</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/UnrealEngine/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
                </span>
            </span>

          
            <span id="/posts/17996/" class="post-meta-item leancloud_visitors" data-flag-title="UE Development Notes: Android" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>18k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>44 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>In a previous article, I introduced the development notes and some engineering practices for Mac/iOS: <a target="_blank" rel="noopener" href="https://imzlp.com/posts/1948/">UE4 Development Notes: Mac/iOS Edition</a>. This article serves as a sister piece, documenting the standardized environment, debugging tools, engineering practices, and analysis of related engine code that I used while developing on Android with UE. It records some pitfalls encountered in the project, primarily organized from my previous notes <a target="_blank" rel="noopener" href="https://imzlp.com/notes/ue/">notes/ue</a>. Future Android-related content will also be updated in this article.</p>
<span id="more"></span>

<h2 id="Blog-Articles"><a href="#Blog-Articles" class="headerlink" title="Blog Articles"></a>Blog Articles</h2><p>Articles related to Android in the blog:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://imzlp.com/posts/20367/">UE4 Source Code Analysis: Modifying the Default Data Storage Path for Games</a></li>
<li><a target="_blank" rel="noopener" href="https://imzlp.com/posts/27289/">UE4: Best Practices for UPL and JNI Calls</a></li>
</ul>
<h2 id="Compilation-Environment"><a href="#Compilation-Environment" class="headerlink" title="Compilation Environment"></a>Compilation Environment</h2><p>The development environment for Android requires a combination of JDK/NDK/SDK/Ant/Gradle. The UE documentation mentions that NVDIA’s CodeWorks must be installed. However, due to network issues in China, it’s challenging to download, and some components are not necessary, so I packaged an Android development environment for quick deployment.</p>
<p>Component versions:</p>
<ul>
<li>JDK 18077</li>
<li>NDK r14b</li>
<li>SDK android19-26</li>
<li>Ant 1.8.2</li>
<li>Gradle 4.1</li>
</ul>
<p>Download link: <a target="_blank" rel="noopener" href="https://stusdnueducn-my.sharepoint.com/:u:/g/personal/2017020625_stu_sdnu_edu_cn/EUEwhi0h05JLvdogvD5qbz0Be96Q6s7n0PlrHng4cqtsiA?e=Lctclf">AndroidSDK_1R7u1_20190923.7z</a>, after unzipping, there is an <code>AddToPath.bat</code> script to add the necessary environment variables with one click.</p>
<figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"><span class="built_in">set</span> &quot;current_dir_name=%~dp0&quot;</span><br><span class="line">setx /M JAVA_HOME &quot;<span class="variable">%current_dir_name%</span>jdk18077&quot;</span><br><span class="line">setx /M ANDROID_HOME &quot;<span class="variable">%current_dir_name%</span>android-sdk-windows&quot;</span><br><span class="line">setx /M ANDROID_NDK_ROOT &quot;<span class="variable">%current_dir_name%</span>android-ndk-r14b&quot;</span><br><span class="line">setx /M ANT_HOME &quot;<span class="variable">%current_dir_name%</span>apache-ant-<span class="number">1</span>.<span class="number">8</span>.<span class="number">2</span>&quot;</span><br><span class="line">setx /M GRADLE_HOME &quot;<span class="variable">%current_dir_name%</span>gradle-<span class="number">4</span>.<span class="number">1</span>&quot;</span><br><span class="line">setx /M NDK_ROOT &quot;<span class="variable">%current_dir_name%</span>android-ndk-r14b&quot;</span><br><span class="line">setx /M NDKROOT &quot;<span class="variable">%current_dir_name%</span>android-ndk-r14b&quot;</span><br><span class="line">setx /M NVPACK_NDK_TOOL_VERSION &quot;<span class="number">4</span>.<span class="number">9</span>&quot;</span><br><span class="line">setx /M NVPACK_NDK_VERSION &quot;android-ndk-r14b&quot;</span><br><span class="line">setx /M NVPACK_ROOT &quot;<span class="variable">%current_dir_name%</span>&quot;</span><br></pre></td></tr></table></figure>

<p>If you need to update to a newer version of NDK and SDK, some versions might be outdated. You can download the necessary versions yourself:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://androidsdkmanager.azurewebsites.net/SDKPlatform">Online Android SDK Manager</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.android.com/ndk/downloads?hl=en">Android Developer NDK Downloads</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.android.com/ndk/downloads/older_releases?hl=en">Unsupported NDK Downloads</a></li>
</ul>
<p>After downloading, place them in the corresponding directory and modify the values in the environment variables.</p>
<p><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/17996/20210416124501.webp"></p>
<p>After adding the environment variables, there is no need to set the SDK and NDK paths in UE; you can keep the defaults for packaging.</p>
<h2 id="Engine-Dependencies-and-Support"><a href="#Engine-Dependencies-and-Support" class="headerlink" title="Engine Dependencies and Support"></a>Engine Dependencies and Support</h2><h3 id="Engine-Support-for-Android-Versions"><a href="#Engine-Support-for-Android-Versions" class="headerlink" title="Engine Support for Android Versions"></a>Engine Support for Android Versions</h3><p>In my previous notes: <a target="_blank" rel="noopener" href="https://imzlp.com/notes/ue/#Android-SDK%E7%89%88%E6%9C%AC%E4%B8%8EAndroid%E7%9A%84%E7%89%88%E6%9C%AC">Android SDK Versions and Android Versions</a>, I listed a table comparing Android system versions and API level versions.</p>
<p>However, different versions of the UE engine support different Android systems. In the <code>Project Setting</code> - <code>Android</code>, you can set the <code>Minimum SDK Version</code>, which is the lowest system version supported for packaging Android in UE.</p>
<p>In UE4.25, the minimum level can be set to 19, which is Android 4.4. In engine versions prior to 4.25, the minimum supported level is 9, which is Android 2.3.</p>
<p>This part of the code can be viewed in <a target="_blank" rel="noopener" href="https://github.com/EpicGames/UnrealEngine/blob/4.24/Engine/Source/Runtime/Android/AndroidRuntimeSettings/Classes/AndroidRuntimeSettings.h">Runtime/Android/AndroidRuntimeSettings/Classes/AndroidRuntimeSettings.h</a> and compared for differences between engine versions.</p>
<h3 id="SDK-Version-to-Android-Version-Mapping-Table"><a href="#SDK-Version-to-Android-Version-Mapping-Table" class="headerlink" title="SDK Version to Android Version Mapping Table"></a>SDK Version to Android Version Mapping Table</h3><p>You can see the <a target="_blank" rel="noopener" href="https://developer.android.com/studio/releases/platforms">Android SDK Platform</a> on Google’s developer site.<br>The meaning of Build.VERSION_CODES: <a target="_blank" rel="noopener" href="https://developer.android.com/reference/android/os/Build.VERSION_CODES">Build.VERSION_CODES</a></p>
<table>
<thead>
<tr>
<th align="center">AndroidVersion</th>
<th align="center">SDK Version</th>
<th align="center">Build.VERSION_CODES</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Android 11</td>
<td align="center">(API level 30)</td>
<td align="center">R</td>
</tr>
<tr>
<td align="center">Android 10</td>
<td align="center">(API level 29)</td>
<td align="center">Q</td>
</tr>
<tr>
<td align="center">Android 9</td>
<td align="center">(API level 28)</td>
<td align="center">P</td>
</tr>
<tr>
<td align="center">Android 8.1</td>
<td align="center">(API level27)</td>
<td align="center">O_MR1</td>
</tr>
<tr>
<td align="center">Android 8.0</td>
<td align="center">(API level 26)</td>
<td align="center">O</td>
</tr>
<tr>
<td align="center">Android 7.1</td>
<td align="center">(API level 25)</td>
<td align="center">N_MR1</td>
</tr>
<tr>
<td align="center">Android 7.0</td>
<td align="center">(API level 24)</td>
<td align="center">N</td>
</tr>
<tr>
<td align="center">Android 6.0</td>
<td align="center">(API level 23)</td>
<td align="center">M</td>
</tr>
<tr>
<td align="center">Android 5.1</td>
<td align="center">(API level 22)</td>
<td align="center">LOLLIPOP_MR1</td>
</tr>
<tr>
<td align="center">Android 5.0</td>
<td align="center">(API level 21)</td>
<td align="center">LOLLIPOP</td>
</tr>
<tr>
<td align="center">Android 4.4W</td>
<td align="center">(API level 20)</td>
<td align="center">KITKAT_WATCH</td>
</tr>
<tr>
<td align="center">Android 4.4</td>
<td align="center">(API level 19)</td>
<td align="center">KITKAT</td>
</tr>
<tr>
<td align="center">Android 4.3</td>
<td align="center">(API level 18)</td>
<td align="center">JELLY_BEAN_MR2</td>
</tr>
<tr>
<td align="center">Android 4.2</td>
<td align="center">(API level 17)</td>
<td align="center">JELLY_BEAN_MR1</td>
</tr>
<tr>
<td align="center">Android 4.1</td>
<td align="center">(API level 16)</td>
<td align="center">JELLY_BEAN</td>
</tr>
<tr>
<td align="center">Android 4.0.3</td>
<td align="center">(API level15)</td>
<td align="center">ICE_CREAM_SANDWICH_MR1</td>
</tr>
<tr>
<td align="center">Android 4.0</td>
<td align="center">(API level 14)</td>
<td align="center">ICE_CREAM_SANDWICH</td>
</tr>
<tr>
<td align="center">Android 3.2</td>
<td align="center">(API level 13)</td>
<td align="center">HONEYCOMB_MR2</td>
</tr>
<tr>
<td align="center">Android 3.1</td>
<td align="center">(API level 12)</td>
<td align="center">HONEYCOMB_MR1</td>
</tr>
<tr>
<td align="center">Android 3.0</td>
<td align="center">(API level 11)</td>
<td align="center">HONEYCOMB</td>
</tr>
<tr>
<td align="center">Android 2.3.3</td>
<td align="center">(API level 10)</td>
<td align="center">GINGERBREAD_MR1</td>
</tr>
<tr>
<td align="center">Android 2.3</td>
<td align="center">(API level 9)</td>
<td align="center">GINGERBREAD</td>
</tr>
</tbody></table>
<p>The minimum support for Android in UE4 is SDK9, which corresponds to Android 2.3.</p>
<h3 id="Engine-Requirements-for-Android-NDK"><a href="#Engine-Requirements-for-Android-NDK" class="headerlink" title="Engine Requirements for Android NDK"></a>Engine Requirements for Android NDK</h3><p>UE requires the NDK environment installed on the system while packaging Android, but different engine versions have different requirements for the NDK version.</p>
<p>Using an unsupported NDK version will result in the following error:</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">UATHelper: Packaging (Android (ETC2)):   ERROR: Android toolchain NDK r14b not supported; please use NDK r21 to NDK r23 (NDK r21b recommended)</span><br><span class="line">PackagingResults: Error: Android toolchain NDK r14b not supported; please use NDK r21 to NDK r23 (NDK r21b recommended)</span><br></pre></td></tr></table></figure>

<p>It indicates that the current NDK version in the system is not supported and displays the supported versions.</p>
<p>The NDK version detection during UE packaging occurs within UBT, specifically in the file <code>UnrealBuildTool/Platform/Android/AndroidToolChain.cs</code>.</p>
<p>It defines the minimum and maximum supported NDK versions for the current engine version:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// in ue 4.25</span></span><br><span class="line"><span class="keyword">readonly</span> <span class="built_in">int</span> MinimumNDKToolchain = <span class="number">210100</span>;</span><br><span class="line"><span class="keyword">readonly</span> <span class="built_in">int</span> MaximumNDKToolchain = <span class="number">230100</span>;</span><br><span class="line"><span class="keyword">readonly</span> <span class="built_in">int</span> RecommendedNDKToolchain = <span class="number">210200</span>;</span><br></pre></td></tr></table></figure>

<p>You can conveniently view the required NDK versions for different engine versions on GitHub: <a target="_blank" rel="noopener" href="https://github.com/EpicGames/UnrealEngine/blob/4.25/Engine/Source/Programs/UnrealBuildTool/Platform/Android/AndroidToolChain.cs">UE_425_AndroidToolChain.cs</a></p>
<p>The engine’s documentation also elaborates on different engine versions’ NDK requirements: <a target="_blank" rel="noopener" href="https://docs.unrealengine.com/en-US/SharingAndReleasing/Mobile/Android/Setup/AndroidStudio/index.html">Setting Up Android SDK and NDK for Unreal</a></p>
<table>
<thead>
<tr>
<th>Unreal Engine</th>
<th>NDK Version</th>
</tr>
</thead>
<tbody><tr>
<td>4.25+</td>
<td>NDK r21b, NDK r20b</td>
</tr>
<tr>
<td>4.21 - 4.24</td>
<td>NDK r14b</td>
</tr>
<tr>
<td>4.19 - 4.20</td>
<td>NDK r12b</td>
</tr>
</tbody></table>
<h3 id="NDK-Compiler-Versions"><a href="#NDK-Compiler-Versions" class="headerlink" title="NDK Compiler Versions"></a>NDK Compiler Versions</h3><p>UE4 supports Android NDK versions <code>r14b</code>-<code>r18b</code>, but in UE4.22.3, setting <code>r18b</code> was recognized by the engine as <code>r18c</code>:</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">UATHelper: Packaging (Android (ETC2)):   Using &#x27;git status&#x27; to determine working set for adaptive non-unity build (C:\Users\imzlp\Documents\Unreal Projects\GWorldClient).</span><br><span class="line">UATHelper: Packaging (Android (ETC2)):   ERROR: Android toolchain NDK r18c not supported; please use NDK r14b to NDK r18b (NDK r14b recommended)</span><br><span class="line">PackagingResults: Error: Android toolchain NDK r18c not supported; please use NDK r14b to NDK r18b (NDK r14b recommended)</span><br><span class="line">UATHelper: Packaging (Android (ETC2)): Took 7.4575476s to run UnrealBuildTool.exe, ExitCode=5</span><br><span class="line">UATHelper: Packaging (Android (ETC2)): ERROR: UnrealBuildTool failed. See log for more details. (C:\Users\imzlp\AppData\Roaming\Unreal Engine\AutomationTool\Logs\C+Program+Files+Epic+Games+UE_4.22\UBT-GWorld-Android-Development.txt)</span><br><span class="line">UATHelper: Packaging (Android (ETC2)):        (see C:\Users\imzlp\AppData\Roaming\Unreal Engine\AutomationTool\Logs\C+Program+Files+Epic+Games+UE_4.22\Log.txt for full exception trace)</span><br><span class="line">PackagingResults: Error: UnrealBuildTool failed. See log for more details. (C:\Users\imzlp\AppData\Roaming\Unreal Engine\AutomationTool\Logs\C+Program+Files+Epic+Games+UE_4.22\UBT-GWorld-Android-Development.txt)</span><br><span class="line">UATHelper: Packaging (Android (ETC2)): AutomationTool exiting with ExitCode=5 (5)</span><br><span class="line">UATHelper: Packaging (Android (ETC2)): BUILD FAILED</span><br><span class="line">PackagingResults: Error: Unknown Error</span><br></pre></td></tr></table></figure>

<p>The reason for needing to change the NDK version is that the compilers included in different NDK versions have varying levels of support for the C++11 standard.</p>
<table>
<thead>
<tr>
<th>NDK</th>
<th>clang version</th>
</tr>
</thead>
<tbody><tr>
<td>r14b</td>
<td>clang 3.8.275480  (based on LLVM 3.8.275480)</td>
</tr>
<tr>
<td>r17c</td>
<td>clang version 6.0.2</td>
</tr>
<tr>
<td>r18b</td>
<td>clang version 7.0.2</td>
</tr>
<tr>
<td>r20b</td>
<td>clang version 8.0.7</td>
</tr>
</tbody></table>
<h2 id="Tools"><a href="#Tools" class="headerlink" title="Tools"></a>Tools</h2><h3 id="ADB"><a href="#ADB" class="headerlink" title="ADB"></a>ADB</h3><p>ADB is a powerful debugging tool for Android, and familiarizing yourself with some ADB commands can greatly enhance efficiency. First, download <a href="index/Adb.7z">ADB</a>.</p>
<h4 id="Install-APK"><a href="#Install-APK" class="headerlink" title="Install APK"></a>Install APK</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ adb install APK_FILE_NAME.apk</span><br></pre></td></tr></table></figure>

<h4 id="Launch-App"><a href="#Launch-App" class="headerlink" title="Launch App"></a>Launch App</h4><p>The installed renderdoccmd does not have a desktop icon. To start it yourself, you can only use the following ADB command:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell am start org.renderdoc.renderdoccmd.arm64/.Loader -e renderdoccmd <span class="string">&quot;remoteserver&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><a target="_blank" rel="noopener" href="https://stusdnueducn-my.sharepoint.com/:f:/g/personal/2017020625_stu_sdnu_edu_cn/EnnSRgeQZOZAmytO_Mm6nD0BQ9HOk42Ximo78ovuzOVEQg?e=xCoutx">renderdoc-cmd-apk</a></li>
</ul>
<p>ADB command template for launching the app:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell am start PACKAGE_NAME/.ActivityName</span><br></pre></td></tr></table></figure>

<p>This method requires knowing the app’s package name and activity name. The package name can be easily found, but if you don’t know the activity, you can obtain it through the following procedure:</p>
<p>First, use a decompiling tool to unpack the APK (you can use the earlier mentioned <a target="_blank" rel="noopener" href="https://imzlp.com/notes/tips/index.html#apk%E7%9A%84%E5%8F%8D%E7%BC%96%E8%AF%91%E4%B8%8E%E7%AD%BE%E5%90%8D">apktools</a>):</p>
<figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apktool.bat d -o ./renderdoccmd_arm64 org.renderdoc.renderdoccmd.arm64.apk</span><br></pre></td></tr></table></figure>

<p>Then, open the <code>AndroidManifest.xml</code> file in the <code>org.renderdoc.renderdoccmd.arm64</code> directory and find the <code>Application</code> entry:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span> standalone=<span class="string">&quot;no&quot;</span>?&gt;</span><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span> <span class="attr">package</span>=<span class="string">&quot;org.renderdoc.renderdoccmd.arm64&quot;</span> <span class="attr">platformBuildVersionCode</span>=<span class="string">&quot;26&quot;</span> <span class="attr">platformBuildVersionName</span>=<span class="string">&quot;8.0.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.INTERNET&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-feature</span> <span class="attr">android:glEsVersion</span>=<span class="string">&quot;0x00030000&quot;</span> <span class="attr">android:required</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">application</span> <span class="attr">android:debuggable</span>=<span class="string">&quot;true&quot;</span> <span class="attr">android:hasCode</span>=<span class="string">&quot;true&quot;</span> <span class="attr">android:icon</span>=<span class="string">&quot;@drawable/icon&quot;</span> <span class="attr">android:label</span>=<span class="string">&quot;RenderDocCmd&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:configChanges</span>=<span class="string">&quot;keyboardHidden|orientation&quot;</span> <span class="attr">android:exported</span>=<span class="string">&quot;true&quot;</span> <span class="attr">android:label</span>=<span class="string">&quot;RenderDoc&quot;</span> <span class="attr">android:name</span>=<span class="string">&quot;.Loader&quot;</span> <span class="attr">android:screenOrientation</span>=<span class="string">&quot;landscape&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">meta-data</span> <span class="attr">android:name</span>=<span class="string">&quot;android.app.lib_name&quot;</span> <span class="attr">android:value</span>=<span class="string">&quot;renderdoccmd&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>This contains all registered <code>Activity</code> entries. For an APK without a UI, there is typically only one activity; hence the main activity for the renderdoccmd is <code>.Loader</code>.</p>
<p>If it’s a UI app, there may be multiple activities. You can check the <code>Category</code> in <code>AndroidManifest.xml</code> or identify the main activity by looking for the one with <code>main</code> in its name. Typically, it starts with the launcher, leads to the main activity, or some may navigate to a login interface.</p>
<blockquote>
<p>PS: The main activity for a game packaged with UE is <code>com.epicgames.ue4.SplashActivity</code>, which can be launched using the following command.</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell am start com.imzlp.GWorld/com.epicgames.ue4.SplashActivity</span><br></pre></td></tr></table></figure>

<h4 id="Transfer-Files"><a href="#Transfer-Files" class="headerlink" title="Transfer Files"></a>Transfer Files</h4><p>To transfer files from your computer to the mobile device using ADB:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># adb push 1.0_Android_ETC2_P.pak /sdcard/Android/data/com.imzlp.TEST/files/UE4GameData/Mobile422/Mobile422/Saved/Paks</span></span><br><span class="line">$ adb push FILE_NAME REMOATE_PATH</span><br></pre></td></tr></table></figure>

<p>To transfer files from the mobile device to your computer:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># adb pull /sdcard/Android/data/com.imzlp.TEST/files/UE4GameData/Mobile422/Mobile422/Saved/Paks/1.0_Android_ETC2_P.pak A.Pak</span></span><br><span class="line">$ adb pull REMOATE_FILE_PATH LOCAL_PATH</span><br></pre></td></tr></table></figure>

<h4 id="Logcat"><a href="#Logcat" class="headerlink" title="Logcat"></a>Logcat</h4><p>Using <code>logcat</code> allows you to see log information from the Android device.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">adb logcat</span></span><br></pre></td></tr></table></figure>

<p>This will print out all information from the current device, but during app debugging, we don’t need to see so much. We can use <code>find</code> to filter results (case sensitive):</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">adb logcat | find <span class="string">&quot;GWorld&quot;</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">adb logcat | find <span class="string">&quot;KEY_WORD&quot;</span></span></span><br></pre></td></tr></table></figure>

<p>To filter logs from the packaged UE app:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">adb logcat | find <span class="string">&quot;UE4&quot;</span></span></span><br></pre></td></tr></table></figure>

<p>If there are too many accumulated logs from frequent runs, you can clear them:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb logcat -c</span><br></pre></td></tr></table></figure>

<h4 id="Extract-Installed-APKs-from-the-Device"><a href="#Extract-Installed-APKs-from-the-Device" class="headerlink" title="Extract Installed APKs from the Device"></a>Extract Installed APKs from the Device</h4><p>Note: When executing the following commands, ensure that developer permissions are enabled on your phone. You must allow the verification fingerprint prompts.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Check connected devices</span></span><br><span class="line">$ adb devices</span><br><span class="line">List of devices attached</span><br><span class="line">b2fcxxxx        unauthorized</span><br><span class="line"><span class="comment"># List all installed apps on the phone</span></span><br><span class="line">$ adb shell pm list package</span><br><span class="line"><span class="comment"># If prompted with the error below, execute adb kill-server</span></span><br><span class="line">error: device unauthorized.</span><br><span class="line">This adb servers <span class="variable">$ADB_VENDOR_KEYS</span> is not <span class="built_in">set</span></span><br><span class="line">Try <span class="string">&#x27;adb kill-server&#x27;</span> <span class="keyword">if</span> that seems wrong.</span><br><span class="line">Otherwise check <span class="keyword">for</span> a confirmation dialog on your device.</span><br><span class="line"><span class="comment"># Normally, it should list many entries like this</span></span><br><span class="line">C:\Users\imzlp&gt;adb shell pm list package</span><br><span class="line">package:com.miui.screenrecorder</span><br><span class="line">package:com.amazon.mShop.android.shopping</span><br><span class="line">package:com.mobisystems.office</span><br><span class="line">package:com.weico.international</span><br><span class="line">package:com.github.shadowsocks</span><br><span class="line">package:com.android.cts.priv.ctsshim</span><br><span class="line">package:com.sorcerer.sorcery.iconpack</span><br><span class="line">package:com.google.android.youtube</span><br><span class="line"></span><br><span class="line"><span class="comment"># Find the APK location for the specified app</span></span><br><span class="line">$ adb shell pm path com.github.shadowsocks</span><br><span class="line">package:/data/app/com.github.shadowsocks-iBtqbmLo8rYcq2BqFhJtsA==/base.apk</span><br><span class="line"><span class="comment"># Then pull that file to your local machine</span></span><br><span class="line">$ adb pull /data/app/com.github.shadowsocks-iBtqbmLo8rYcq2BqFhJtsA==/base.apk</span><br><span class="line">/data/app/com.github.shadowsocks-iBtqbmLo8rYcq2BqFhJtsA==/...se.apk: 1 file pulled. 21.5 MB/s (4843324 bytes <span class="keyword">in</span> 0.215s)</span><br></pre></td></tr></table></figure>

<h4 id="Flash-Recovery"><a href="#Flash-Recovery" class="headerlink" title="Flash Recovery"></a>Flash Recovery</h4><p>Download <a href="index/Adb.7z">ADB</a>, and use the following commands based on your circumstances (if you’re already in bootloader, you don’t need to execute the first command).</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">adb reboot bootloader</span><br><span class="line"><span class="comment"># Write img to the device</span></span><br><span class="line">fastboot flash recovery recovery.img</span><br><span class="line">fastboot flash boot boot.img</span><br><span class="line"><span class="comment"># Boot img</span></span><br><span class="line">fastboot boot recovery.img</span><br></pre></td></tr></table></figure>

<h4 id="Port-Forwarding"><a href="#Port-Forwarding" class="headerlink" title="Port Forwarding"></a>Port Forwarding</h4><p>You can specify port forwarding with ADB commands:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># PC to Device</span></span><br><span class="line">adb reverse tcp:1985 tcp:1985</span><br><span class="line"><span class="comment"># Device to PC</span></span><br><span class="line">adb forward tcp:1985 tcp:1985</span><br></pre></td></tr></table></figure>
<ul>
<li><a target="_blank" rel="noopener" href="http://blog.xiaoyu.im/post_678.html">Super useful front-end debugging method on Android (adb reverse)</a></li>
</ul>
<h4 id="Check-APK-Location-by-Package-Name"><a href="#Check-APK-Location-by-Package-Name" class="headerlink" title="Check APK Location by Package Name"></a>Check APK Location by Package Name</h4><p>You can use the following ADB commands:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ adb shell pm list package -f com.tencent.tmgp.fm</span><br><span class="line">package:/data/app/com.tencent.tmgp.fm-a_cOsX8G3VClXwiI-RD9wQ==/base.apk=com.tencent.tmgp.fm</span><br></pre></td></tr></table></figure>
<p>The last parameter is the package name, and the output will be the APK’s path.</p>
<h4 id="View-Package-Name-of-the-Current-Window’s-App"><a href="#View-Package-Name-of-the-Current-Window’s-App" class="headerlink" title="View Package Name of the Current Window’s App"></a>View Package Name of the Current Window’s App</h4><p>Use the following ADB command:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ adb shell dumpsys window w | findstr \/ | findstr name=</span><br><span class="line">      mSurface=Surface(name=SideSlideGestureBar-Bottom)/@0xa618588</span><br><span class="line">      mSurface=Surface(name=SideSlideGestureBar-Right)/@0x619b646</span><br><span class="line">      mSurface=Surface(name=SideSlideGestureBar-Left)/@0xea02007</span><br><span class="line">      mSurface=Surface(name=StatusBar)/@0x7e4962d</span><br><span class="line">       mAnimationIsEntrance=<span class="literal">true</span>      mSurface=Surface(name=com.tencent.tmgp.fm/com.epicgames.ue4.GameActivity)/@0x43b30a0</span><br><span class="line">      mSurface=Surface(name=com.tencent.tmgp.fm/com.epicgames.ue4.GameActivity)/@0xa3481e</span><br><span class="line">       mAnimationIsEntrance=<span class="literal">true</span>      mSurface=Surface(name=com.vivo.livewallpaper.monster.bmw.MonsterWallpaperService)/@0x53e44ae</span><br></pre></td></tr></table></figure>
<p>In this output, the string following <code>mAnimationIsEntrance=true      mSurface=Surface(name=</code> and before <code>/</code> is our app’s package name.</p>
<h4 id="View-Symbols-in-SO-Files"><a href="#View-Symbols-in-SO-Files" class="headerlink" title="View Symbols in SO Files"></a>View Symbols in SO Files</h4><p>You can use the <code>objdump</code> tool, which has a variety of executable programs compatible with different platforms in NDK:</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x86_64-linux-android-objdump.exe</span><br><span class="line">aarch64-linux-android-objdump.exe</span><br><span class="line">arm-linux-androideabi-objdump.exe</span><br></pre></td></tr></table></figure>
<p>Choose the one you need.</p>
<p>You can use the command <code>objdump -tT libUE4.so</code> to output the contents of the SO symbol table.</p>
<h3 id="SessionFrontEnd-Real-Time-Analysis"><a href="#SessionFrontEnd-Real-Time-Analysis" class="headerlink" title="SessionFrontEnd Real-Time Analysis"></a>SessionFrontEnd Real-Time Analysis</h3><p>There are several prerequisites:</p>
<ol>
<li>USB connection between PC and phone </li>
<li>ADB installed</li>
</ol>
<p>First, port mapping is needed because <code>SessionFrontEnd</code> communicates with the game through listening ports, and the phone and PC are not in the same subnet. Therefore, you need to forward the PC’s listening port to the phone’s port through ADB.</p>
<p>The listening port for SessionFrontEnd can be obtained via port analysis on <code>UE4Editor.exe</code>:  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\lipengzha&gt;netstat -ano | findstr <span class="string">&quot;231096&quot;</span>  </span><br><span class="line">  TCP    0.0.0.0:1985           0.0.0.0:0              LISTENING       231096 </span><br><span class="line">  TCP    0.0.0.0:3961           0.0.0.0:0              LISTENING       231096 </span><br><span class="line">  TCP    0.0.0.0:3963           0.0.0.0:0              LISTENING       231096 </span><br><span class="line">  TCP    127.0.0.1:4014         127.0.0.1:12639        ESTABLISHED     231096 </span><br><span class="line">  TCP    127.0.0.1:4199         127.0.0.1:12639        ESTABLISHED     231096 </span><br><span class="line">  UDP    0.0.0.0:6666           *:*                                    231096 </span><br><span class="line">  UDP    0.0.0.0:24024          *:*                                    231096 </span><br><span class="line">  UDP    0.0.0.0:58101          *:*                                    231096 </span><br></pre></td></tr></table></figure>
<p>You need to map port 1985 on the PC to port 1985 on Android, so when the mobile app connects to <code>0.0.0.0</code> on port <code>1985</code>, it connects to the port on the PC.</p>
<p>Use the following ADB command:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb reverse tcp:1985 tcp:1985 </span><br></pre></td></tr></table></figure>
<p>Then specify the launch parameters for the app on the phone:  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">../../../FGame/FGame.uproject -Messaging -SessionOwner=<span class="string">&quot;lipengzha&quot;</span> -SessionName=<span class="string">&quot;Launch On Android Device&quot;</span>  </span><br></pre></td></tr></table></figure>
<p>Save these texts as a <code>UE4Commandline.txt</code> file in the project data directory, specifically at:  </p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/sdcard/UE4Game/PROJECT_NAME/ </span><br></pre></td></tr></table></figure>
<p>Afterward, directly start the app, and you will see the device’s data in <code>SessionFrontEnd</code> on the PC. </p>
<p><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2021/20210521165056.webp"></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://medium.com/realities-io/oculus-quest-performance-tools-in-unreal-engine-2210f2581c8f">Oculus Quest Performance Tools in Unreal Engine</a> </li>
<li><a target="_blank" rel="noopener" href="https://docs.unrealengine.com/en-US/TestingAndOptimization/PerformanceAndProfiling/UnrealInsights/Overview/index.html">Unreal Insights Overview</a></li>
</ul>
<h3 id="Unreal-Insights-Real-Time-Analysis"><a href="#Unreal-Insights-Real-Time-Analysis" class="headerlink" title="Unreal Insights Real-Time Analysis"></a>Unreal Insights Real-Time Analysis</h3><p>The previous section introduced using <code>SessionFrontEnd</code> for real-time analysis on Android. During actual testing, it was found to be somewhat unstable, potentially causing crashes in the game. In newer versions of the engine, UE also provides a new performance analysis tool called Unreal Insights, which allows for more convenient and intuitive profiling.<br>Documentation:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.unrealengine.com/en-US/TestingAndOptimization/PerformanceAndProfiling/UnrealInsights/index.html">Unreal Insights</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.unrealengine.com/en-US/TestingAndOptimization/PerformanceAndProfiling/UnrealInsights/Reference/index.html">Unreal Insights Reference</a></li>
</ul>
<p>Port mapping is also required, mapping port 1980 on the PC to the device:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb reverse tcp:1980 tcp:1980 </span><br></pre></td></tr></table></figure>
<p>Next, add startup commands to the Android device: </p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">../../../FGame/FGame.uproject -Messaging -SessionOwner=&quot;lipengzha&quot; -SessionName=&quot;Launch On Android Device&quot; -iterative -tracehost=127.0.0.1 -Trace=CPU </span><br></pre></td></tr></table></figure>

<p>Enable Unreal Insights on the PC and start the game on the mobile device to begin real-time capturing:</p>
<p><img data-src="https://img.imzlp.com/imgs/zlp/blog/notes/ue/index/2020/20210112171826.webp">  </p>
<p>Unreal Insights can also capture data in PIE mode in real time by adding the <code>-trace</code> parameter when starting the Editor:</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UE4Editor.exe PROJECT_NAME.uproject -trace=counters,cpu,frame,bookmark,gpu</span><br></pre></td></tr></table></figure>
<p>After launching the game, listen to <code>127.0.0.1</code> in Unreal Insights.</p>
<h2 id="Engineering-Practices"><a href="#Engineering-Practices" class="headerlink" title="Engineering Practices"></a>Engineering Practices</h2><h3 id="Link-libraries-that-support-both-armv7-and-arm64"><a href="#Link-libraries-that-support-both-armv7-and-arm64" class="headerlink" title="Link libraries that support both armv7 and arm64"></a>Link libraries that support both armv7 and arm64</h3><p>When developing for Android, there is a requirement to support both arm64 and armv7, and both libraries need to be added to <code>PublicAdditionalLibraries</code> in the Build.cs:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PublicAdditionalLibraries.<span class="built_in">AddRange</span>(<span class="keyword">new</span> string[]</span><br><span class="line">&#123;</span><br><span class="line">  Path.<span class="built_in">Combine</span>(ThirdPartyFolder, <span class="string">&quot;Android_armeabi-v7a&quot;</span>, AkConfigurationDir),</span><br><span class="line">  Path.<span class="built_in">Combine</span>(ThirdPartyFolder, <span class="string">&quot;Android_arm64-v8a&quot;</span>, AkConfigurationDir),</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>However, there isn’t a method in UE’s ModuleRules to determine the architecture currently being compiled (the ModuleRules constructor only runs once during compilation), leading to linker errors when compiling for arm64, as it finds the armv7 libraries:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">14&gt;ld.lld: error: D:/Client/Plugins/WWise/ThirdParty/Android_armeabi-v7a/Profile/lib\libAkSoundEngine.a(AkAudioLib.o) is incompatible with aarch64linux</span><br><span class="line">ld.lld: error: D:/Client/Plugins/WWise/ThirdParty/Android_armeabi-v7a/Profile/lib\libAkSoundEngine.a(AkLEngine.o) is incompatible with aarch64linux</span><br><span class="line">ld.lld: error: D:/Client/Plugins/WWise/ThirdParty/Android_armeabi-v7a/Profile/lib\libAkSoundEngine.a(AkAudioLib.o) is incompatible with aarch64linux</span><br><span class="line">ld.lld: error: D:/Client/Plugins/WWise/ThirdParty/Android_armeabi-v7a/Profile/lib\libAkSoundEngine.a(AkLEngine.o) is incompatible with aarch64linux</span><br><span class="line">ld.lld: error: D:/Client/Plugins/WWise/ThirdParty/Android_armeabi-v7a/Profile/lib\libAkMemoryMgr.a(AkMemoryMgr.o) is incompatible with aarch64linux</span><br><span class="line">ld.lld: error: D:/Client/Plugins/WWise/ThirdParty/Android_armeabi-v7a/Profile/lib\libAkMemoryMgr.a(AkMemoryMgrBase.o) is incompatible with aarch64linux</span><br><span class="line">ld.lld: error: D:/Client/Plugins/WWise/ThirdParty/Android_armeabi-v7a/Profile/lib\libAkMemoryMgr.a(AkMemoryMgr.o) is incompatible with aarch64linux</span><br><span class="line">ld.lld: error: D:/Client/Plugins/WWise/ThirdParty/Android_armeabi-v7a/Profile/lib\libAkMemoryMgr.a(AkMemoryMgrBase.o) is incompatible with aarch64linux</span><br><span class="line">ld.lld: error: D:/Client/Plugins/WWise/ThirdParty/Android_armeabi-v7a/Profile/lib\libAkStreamMgr.a(AkStreamMgr.o) is incompatible with aarch64linux</span><br><span class="line">ld.lld: error: D:/Client/Plugins/WWise/ThirdParty/Android_armeabi-v7a/Profile/lib\libAkStreamMgr.a(AkStreamMgr.o) is incompatible with aarch64linux</span><br><span class="line">ld.lld: error: D:/Client/Plugins/WWise/ThirdParty/Android_armeabi-v7a/Profile/lib\libAkMusicEngine.a(AkMusicRenderer.o) is incompatible with aarch64linux</span><br><span class="line">ld.lld: error: D:/Client/Plugins/WWise/ThirdParty/Android_armeabi-v7a/Profile/lib\libAkMusicEngine.a(AkMusicRenderer.o) is incompatible with aarch64linux</span><br><span class="line">ld.lld: error: D:/Client/Plugins/WWise/ThirdParty/Android_armeabi-v7a/Profile/lib\libAkSpatialAudio.a(AkSpatialAudio.o) is incompatible with aarch64linux</span><br><span class="line">ld.lld: error: D:/Client/Plugins/WWise/ThirdParty/Android_armeabi-v7a/Profile/lib\libAkSpatialAudio.a(AkSpatialAudio.o) is incompatible with aarch64linux</span><br><span class="line">ld.lld: error: D:/Client/Plugins/WWise/ThirdParty/Android_armeabi-v7a/Profile/lib\libAkAudioInputSource.a(AkFXSrcAudioInput.o) is incompatible with aarch64linux</span><br><span class="line">ld.lld: error: D:/Client/Plugins/WWise/ThirdParty/Android_armeabi-v7a/Profile/lib\libAkAudioInputSource.a(AkFXSrcAudioInput.o) is incompatible with aarch64linux</span><br><span class="line">ld.lld: error: D:/Client/Plugins/WWise/ThirdParty/Android_armeabi-v7a/Profile/lib\libAkVorbisDecoder.a(AkVorbisLib.o) is incompatible with aarch64linux</span><br><span class="line">ld.lld: error: D:/Client/Plugins/WWise/ThirdParty/Android_armeabi-v7a/Profile/lib\libAkVorbisDecoder.a(AkVorbisLib.o) is incompatible with aarch64linux</span><br><span class="line">ld.lld: error: D:/Client/Plugins/WWise/ThirdParty/Android_armeabi-v7a/Profile/lib\libAkMeterFX.a(InitAkMeterFX.o) is incompatible with aarch64linux</span><br><span class="line">ld.lld: error: D:/Client/Plugins/WWise/ThirdParty/Android_armeabi-v7a/Profile/lib\libAkMeterFX.a(InitAkMeterFX.o) is incompatible with aarch64linux</span><br><span class="line">ld.lld: error: too many errors emitted, stopping now (use -error-limit=0 to see all errors)</span><br><span class="line">clang++: error: linker command failed with exit code 1 (use -v to see invocation)</span><br><span class="line">14&gt;Execution failed. Error: 1 (0x01) Target: &#x27;C:\BuildAgent\workspace\FGameClientBuild\Client\Binaries\Android\FGame-arm64.so&#x27;</span><br></pre></td></tr></table></figure>

<p>Thus, a method is needed to allow the compiler to automatically match the correct path for linking when using <code>PublicAdditionalLibraries</code> with both the arm64 and armv7 libraries.</p>
<p>Looking through the UBT code, it’s discovered that UE performs pattern matching on the paths of link libraries for Android:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">Engine\Source\Programs\UnrealBuildTool\Platform\Android\AndroidToolChain.cs</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">private</span> Dictionary&lt;<span class="built_in">string</span>, <span class="built_in">string</span>[]&gt; AllArchNames = <span class="keyword">new</span> Dictionary&lt;<span class="built_in">string</span>, <span class="built_in">string</span>[]&gt; &#123;</span><br><span class="line">  &#123; <span class="string">&quot;-armv7&quot;</span>, <span class="keyword">new</span> <span class="built_in">string</span>[] &#123; <span class="string">&quot;armv7&quot;</span>, <span class="string">&quot;armeabi-v7a&quot;</span>, &#125; &#125;,</span><br><span class="line">  &#123; <span class="string">&quot;-arm64&quot;</span>, <span class="keyword">new</span> <span class="built_in">string</span>[] &#123; <span class="string">&quot;arm64&quot;</span>, <span class="string">&quot;arm64-v8a&quot;</span>, &#125; &#125;,</span><br><span class="line">  &#123; <span class="string">&quot;-x86&quot;</span>,   <span class="keyword">new</span> <span class="built_in">string</span>[] &#123; <span class="string">&quot;x86&quot;</span>, &#125; &#125;,</span><br><span class="line">  &#123; <span class="string">&quot;-x64&quot;</span>,   <span class="keyword">new</span> <span class="built_in">string</span>[] &#123; <span class="string">&quot;x64&quot;</span>, <span class="string">&quot;x86_64&quot;</span>, &#125; &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="built_in">bool</span> <span class="title">IsDirectoryForArch</span>(<span class="params"><span class="built_in">string</span> Dir, <span class="built_in">string</span> Arch</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// make sure paths use one particular slash</span></span><br><span class="line">  Dir = Dir.Replace(<span class="string">&quot;\\&quot;</span>, <span class="string">&quot;/&quot;</span>).ToLowerInvariant();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// look for other architectures in the Dir path, and fail if it finds it</span></span><br><span class="line">  <span class="keyword">foreach</span> (KeyValuePair&lt;<span class="built_in">string</span>, <span class="built_in">string</span>[]&gt; Pair <span class="keyword">in</span> AllArchNames)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> (Pair.Key != Arch)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">foreach</span> (<span class="built_in">string</span> ArchName <span class="keyword">in</span> Pair.Value)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// if there&#x27;s a directory in the path with a bad architecture name, reject it</span></span><br><span class="line">        <span class="keyword">if</span> (Regex.IsMatch(Dir, <span class="string">&quot;/&quot;</span> + ArchName + <span class="string">&quot;$&quot;</span>) || Regex.IsMatch(Dir, <span class="string">&quot;/&quot;</span> + ArchName + <span class="string">&quot;/&quot;</span>) || Regex.IsMatch(Dir, <span class="string">&quot;/&quot;</span> + ArchName + <span class="string">&quot;_API[0-9]+_NDK[0-9]+&quot;</span>, RegexOptions.IgnoreCase))</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// if nothing was found, we are okay</span></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">override</span> FileItem[] <span class="title">LinkAllFiles</span>(<span class="params">LinkEnvironment LinkEnvironment, <span class="built_in">bool</span> bBuildImportLibraryOnly, IActionGraphBuilder Graph</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="comment">// Add the library paths to the additional path list</span></span><br><span class="line">  <span class="keyword">foreach</span> (DirectoryReference LibraryPath <span class="keyword">in</span> LinkEnvironment.LibraryPaths)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// LinkerPaths could be relative or absolute</span></span><br><span class="line">    <span class="built_in">string</span> AbsoluteLibraryPath = Utils.ExpandVariables(LibraryPath.FullName);</span><br><span class="line">    <span class="keyword">if</span> (IsDirectoryForArch(AbsoluteLibraryPath, Arch))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// environment variables aren&#x27;t expanded when using the $( style</span></span><br><span class="line">      <span class="keyword">if</span> (Path.IsPathRooted(AbsoluteLibraryPath) == <span class="literal">false</span>)</span><br><span class="line">      &#123;</span><br><span class="line">        AbsoluteLibraryPath = Path.Combine(LinkerPath.FullName, AbsoluteLibraryPath);</span><br><span class="line">      &#125;</span><br><span class="line">      AbsoluteLibraryPath = Utils.CollapseRelativeDirectories(AbsoluteLibraryPath);</span><br><span class="line">      <span class="keyword">if</span> (!AdditionalLibraryPaths.Contains(AbsoluteLibraryPath))</span><br><span class="line">      &#123;</span><br><span class="line">        AdditionalLibraryPaths.Add(AbsoluteLibraryPath);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The key part is this line:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (Regex.IsMatch(Dir, <span class="string">&quot;/&quot;</span> + ArchName + <span class="string">&quot;$&quot;</span>) || Regex.IsMatch(Dir, <span class="string">&quot;/&quot;</span> + ArchName + <span class="string">&quot;/&quot;</span>) || Regex.IsMatch(Dir, <span class="string">&quot;/&quot;</span> + ArchName + <span class="string">&quot;_API[0-9]+_NDK[0-9]+&quot;</span>, RegexOptions.IgnoreCase))</span><br></pre></td></tr></table></figure>
<p>Based on the regex rule above, you can change the paths of the linked libraries to:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">XXXX/armeabi-v7a/</span><br><span class="line">XXXX/armeabi-v8a/</span><br></pre></td></tr></table></figure>
<p>As long as the paths for the libraries added for Android match this rule, UE will automatically use the corresponding architecture’s libraries (.a and .so can both use this rule).</p>
<p>UE is quite tricky here; this requirement isn’t documented, making it a completely unspoken rule. </p>
<h3 id="Android-Runtime-Permission-Requests"><a href="#Android-Runtime-Permission-Requests" class="headerlink" title="Android Runtime Permission Requests"></a>Android Runtime Permission Requests</h3><p>ActivityCompact has a requestPermission method that can handle such situations.</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.android.com/training/permissions/requesting#java">Requesting App Permissions</a></li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/c1c03825d7a5">Android Runtime Permission Request</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.android.com/guide/topics/permissions/overview">Permissions in Android</a></li>
</ul>
<h3 id="Get-Package-Name-on-Android"><a href="#Get-Package-Name-on-Android" class="headerlink" title="Get Package Name on Android"></a>Get Package Name on Android</h3><p>By adding the following code in UPL in Java:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">AndroidThunkJava_GetPackageName</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">Context</span> <span class="variable">context</span> <span class="operator">=</span> getApplicationContext();</span><br><span class="line">  <span class="keyword">return</span> context.getPackageName();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>You can call it from C++ using JNI:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">FString <span class="title">UFlibAppHelper::GetAppPackageName</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    FString result;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> PLATFORM_ANDROID</span></span><br><span class="line">    <span class="keyword">if</span> (JNIEnv* Env = FAndroidApplication::<span class="built_in">GetJavaEnv</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        jmethodID GetInstalledPakPathMethodID = FJavaWrapper::<span class="built_in">FindMethod</span>(Env, FJavaWrapper::GameActivityClassID, <span class="string">&quot;AndroidThunkJava_GetPackageName&quot;</span>, <span class="string">&quot;()Ljava/lang/String;&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">        result = FJavaHelper::<span class="built_in">FStringFromLocalRef</span>(Env, (jstring)FJavaWrapper::<span class="built_in">CallObjectMethod</span>(Env, FJavaWrapper::GameActivityThis, GetInstalledPakPathMethodID));</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    <span class="keyword">return</span> result; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Get-External-Storage-Path-on-Android"><a href="#Get-External-Storage-Path-on-Android" class="headerlink" title="Get External Storage Path on Android"></a>Get External Storage Path on Android</h3><p>To get the App’s sandbox path:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// /storage/emulated/0/Android/data/com.xxxx.yyyy.zzzz/files</span></span><br><span class="line"><span class="function">FString <span class="title">FAndroidGCloudPlatformMisc::getExternalStorageDirectory</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    FString result;</span><br><span class="line">    <span class="keyword">if</span> (JNIEnv* Env = FAndroidApplication::<span class="built_in">GetJavaEnv</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// get context</span></span><br><span class="line">        jobject JniEnvContext;</span><br><span class="line">        &#123;</span><br><span class="line">            jclass activityThreadClass = Env-&gt;<span class="built_in">FindClass</span>(<span class="string">&quot;android/app/ActivityThread&quot;</span>);</span><br><span class="line">            jmethodID currentActivityThread = FJavaWrapper::<span class="built_in">FindStaticMethod</span>(Env, activityThreadClass, <span class="string">&quot;currentActivityThread&quot;</span>, <span class="string">&quot;()Landroid/app/ActivityThread;&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">            jobject at = Env-&gt;<span class="built_in">CallStaticObjectMethod</span>(activityThreadClass, currentActivityThread);</span><br><span class="line">            jmethodID getApplication = FJavaWrapper::<span class="built_in">FindMethod</span>(Env, activityThreadClass, <span class="string">&quot;getApplication&quot;</span>, <span class="string">&quot;()Landroid/app/Application;&quot;</span>, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">            JniEnvContext = FJavaWrapper::<span class="built_in">CallObjectMethod</span>(Env, at, getApplication);</span><br><span class="line">        &#125;</span><br><span class="line">        jmethodID getExternalFilesDir = Env-&gt;<span class="built_in">GetMethodID</span>(Env-&gt;<span class="built_in">GetObjectClass</span>(JniEnvContext), <span class="string">&quot;getExternalFilesDir&quot;</span>, <span class="string">&quot;(Ljava/lang/String;)Ljava/io/File;&quot;</span>);</span><br><span class="line">        <span class="comment">// get File</span></span><br><span class="line">        jobject ExternalFileDir = Env-&gt;<span class="built_in">CallObjectMethod</span>(JniEnvContext, getExternalFilesDir, <span class="literal">nullptr</span>);</span><br><span class="line">        <span class="comment">// getPath method in File class</span></span><br><span class="line">        jmethodID getFilePath = Env-&gt;<span class="built_in">GetMethodID</span>(Env-&gt;<span class="built_in">FindClass</span>(<span class="string">&quot;java/io/File&quot;</span>), <span class="string">&quot;getPath&quot;</span>, <span class="string">&quot;()Ljava/lang/String;&quot;</span>);</span><br><span class="line">        jstring pathString = (jstring)Env-&gt;<span class="built_in">CallObjectMethod</span>(ExternalFileDir, getFilePath, <span class="literal">nullptr</span>);</span><br><span class="line">        <span class="type">const</span> <span class="type">char</span> *nativePathString = Env-&gt;<span class="built_in">GetStringUTFChars</span>(pathString, <span class="number">0</span>);</span><br><span class="line">        result = <span class="built_in">ANSI_TO_TCHAR</span>(nativePathString);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Get-Installed-App’s-APK-Path-on-Android"><a href="#Get-Installed-App’s-APK-Path-on-Android" class="headerlink" title="Get Installed App’s APK Path on Android"></a>Get Installed App’s APK Path on Android</h3><p>To retrieve the APK path at runtime, since UE does not have existing interfaces, JNI must be used to get it from Java.<br>By checking the Android Developer documentation, it is found that <a target="_blank" rel="noopener" href="https://developer.android.com/reference/android/content/pm/ApplicationInfo#sourceDir">ApplicationInfo</a> contains the <code>sourceDir</code> property, which records the APK path. This can be fetched using the <code>PackageManager</code> call to <a target="_blank" rel="noopener" href="https://developer.android.com/reference/android/content/pm/PackageManager#getApplicationInfo(java.lang.String,%20int)">getApplicationInfo</a> for a specific package name.</p>
<p>Thus, Java code in UPL:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">AndroidThunkJava_GetInstalledApkPath</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">Context</span> <span class="variable">context</span> <span class="operator">=</span> getApplicationContext();</span><br><span class="line">    <span class="type">PackageManager</span> <span class="variable">packageManager</span> <span class="operator">=</span> context.getPackageManager();</span><br><span class="line">    ApplicationInfo appInfo;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        appInfo = packageManager.getApplicationInfo(context.getPackageName(), PackageManager.GET_META_DATA);</span><br><span class="line">        <span class="keyword">return</span> appInfo.sourceDir;</span><br><span class="line">    &#125;<span class="keyword">catch</span> (PackageManager.NameNotFoundException e)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;invalid&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Then call it in UE using JNI:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (JNIEnv* Env = FAndroidApplication::<span class="built_in">GetJavaEnv</span>())</span><br><span class="line">&#123;</span><br><span class="line">    jmethodID GetInstalledPakPathMethodID = FJavaWrapper::<span class="built_in">FindMethod</span>(Env, FJavaWrapper::GameActivityClassID, <span class="string">&quot;AndroidThunkJava_GetInstalledApkPath&quot;</span>, <span class="string">&quot;()Ljava/lang/String;&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">    FString ResultApkPath = FJavaHelperEx::<span class="built_in">FStringFromLocalRef</span>(Env, (jstring)FJavaWrapper::<span class="built_in">CallObjectMethod</span>(Env, FJavaWrapper::GameActivityThis, GetInstalledPakPathMethodID));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Here <code>FJavaHelperEx::FStringFromLocalRef</code> is my wrapper function for converting from jstring to FString:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> FJavaHelperEx</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function">FString <span class="title">FStringFromParam</span><span class="params">(JNIEnv* Env, jstring JavaString)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!Env || !JavaString || Env-&gt;<span class="built_in">IsSameObject</span>(JavaString, <span class="literal">NULL</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">const</span> <span class="keyword">auto</span> chars = Env-&gt;<span class="built_in">GetStringUTFChars</span>(JavaString, <span class="number">0</span>);</span><br><span class="line">        <span class="function">FString <span class="title">ReturnString</span><span class="params">(UTF8_TO_TCHAR(chars))</span></span>;</span><br><span class="line">        Env-&gt;<span class="built_in">ReleaseStringUTFChars</span>(JavaString, chars);</span><br><span class="line">        <span class="keyword">return</span> ReturnString;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function">FString <span class="title">FStringFromLocalRef</span><span class="params">(JNIEnv* Env, jstring JavaString)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        FString ReturnString = <span class="built_in">FStringFromParam</span>(Env, JavaString);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (Env &amp;&amp; JavaString)</span><br><span class="line">        &#123;</span><br><span class="line">            Env-&gt;<span class="built_in">DeleteLocalRef</span>(JavaString);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ReturnString;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The retrieved result:<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/notes/ue/index/2020/20201016112348.webp"></p>
<h3 id="Upgrade-to-AndroidX"><a href="#Upgrade-to-AndroidX" class="headerlink" title="Upgrade to AndroidX"></a>Upgrade to AndroidX</h3><p>Use UPL to intervene in the packaging process:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">gradleProperties</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">insert</span>&gt;</span></span><br><span class="line">		android.useAndroidX=true</span><br><span class="line">		android.enableJetifier=true</span><br><span class="line">	<span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">gradleProperties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">baseBuildGradleAdditions</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">insert</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- Here goes the gradle code --&gt;</span></span><br><span class="line">		allprojects &#123;</span><br><span class="line">			def mappings = [</span><br><span class="line">				&#x27;android.support.annotation&#x27;: &#x27;androidx.annotation&#x27;,</span><br><span class="line">				&#x27;android.arch.lifecycle&#x27;: &#x27;androidx.lifecycle&#x27;,</span><br><span class="line">				&#x27;android.support.v4.app.NotificationCompat&#x27;: &#x27;androidx.core.app.NotificationCompat&#x27;,</span><br><span class="line">				&#x27;android.support.v4.app.ActivityCompat&#x27;: &#x27;androidx.core.app.ActivityCompat&#x27;,</span><br><span class="line">				&#x27;android.support.v4.content.ContextCompat&#x27;: &#x27;androidx.core.content.ContextCompat&#x27;,</span><br><span class="line">				&#x27;android.support.v13.app.FragmentCompat&#x27;: &#x27;androidx.legacy.app.FragmentCompat&#x27;,</span><br><span class="line">				&#x27;android.arch.lifecycle.Lifecycle&#x27;: &#x27;androidx.lifecycle.Lifecycle&#x27;,</span><br><span class="line">				&#x27;android.arch.lifecycle.LifecycleObserver&#x27;: &#x27;androidx.lifecycle.LifecycleObserver&#x27;,</span><br><span class="line">				&#x27;android.arch.lifecycle.OnLifecycleEvent&#x27;: &#x27;androidx.lifecycle.OnLifecycleEvent&#x27;,</span><br><span class="line">				&#x27;android.arch.lifecycle.ProcessLifecycleOwner&#x27;: &#x27;androidx.lifecycle.ProcessLifecycleOwner&#x27;,</span><br><span class="line">			]</span><br><span class="line"></span><br><span class="line">			beforeEvaluate &#123; project -&gt;</span><br><span class="line">				project.rootProject.projectDir.traverse(type: groovy.io.FileType.FILES, nameFilter: ~/.*\.java$/) &#123; f -&gt;</span><br><span class="line">					mappings.each &#123; entry -&gt;</span><br><span class="line">						if (f.getText(&#x27;UTF-8&#x27;).contains(entry.key)) &#123;</span><br><span class="line">							println &quot;Updating $&#123;entry.key&#125; to $&#123;entry.value&#125; in file $&#123;f&#125;&quot;</span><br><span class="line">							ant.replace(file: f, token: entry.key, value: entry.value)</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">baseBuildGradleAdditions</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Not supporting AndroidX on UE 4.27 will lead to a packing failure.</p>
</blockquote>
<p>In these two lines of code in <code>SplashActivity.java</code>, there are errors:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.support.v4.app.ActivityCompat;</span><br><span class="line"><span class="keyword">import</span> android.support.v4.content.ContextCompat;</span><br></pre></td></tr></table></figure>

<p>Error log: <code>Task :app:compileDebugJavaWithJavac FAILED</code>, and following the method in this article to support AndroidX allows packing to succeed.</p>
<p>References:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://answers.unrealengine.com/questions/961161/androidx-support.html">AndroidX support</a></li>
<li><a target="_blank" rel="noopener" href="https://medium.com/nineva/how-to-force-the-unreal-engine-android-project-to-use-androidx-f7060abd56ac">How to force the Unreal Engine Android project to use AndroidX?</a></li>
</ul>
<h3 id="Adding-External-Storage-Read-Write-Permissions-for-APK"><a href="#Adding-External-Storage-Read-Write-Permissions-for-APK" class="headerlink" title="Adding External Storage Read/Write Permissions for APK"></a>Adding External Storage Read/Write Permissions for APK</h3><p>In <code>Project Settings</code> - <code>Platform</code> - <code>Android</code> - <code>Advanced APK Packaging</code> - <code>Extra Permissions</code>, add:</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">android.permission.WRITE_EXTERNAL_STORAGE</span><br><span class="line">android.permission.READ_EXTERNAL_STORAGE</span><br></pre></td></tr></table></figure>

<p><img data-src="https://img.imzlp.com/imgs/zlp/blog/notes/ue/index/UE4/ue4-android-add-extra-permissions.webp"></p>
<h3 id="HTTP-Request-Error-on-AndroidP"><a href="#HTTP-Request-Error-on-AndroidP" class="headerlink" title="HTTP Request Error on AndroidP"></a>HTTP Request Error on AndroidP</h3><p>Using HTTP requests to upload data on Android P will show the following error message:</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">2018-10-10 16:39:21.312 31611-31646/com.xfhy.tinkerfirmdemo W/CrashReport: java.io.IOException: Cleartext HTTP traffic to android.bugly.qq.com not permitted</span><br><span class="line">        at com.android.okhttp.HttpHandler$CleartextURLFilter.checkURLPermitted(HttpHandler.java:115)</span><br><span class="line">        at com.android.okhttp.internal.huc.HttpURLConnectionImpl.execute(HttpURLConnectionImpl.java:458)</span><br><span class="line">        at com.android.okhttp.internal.huc.HttpURLConnectionImpl.connect(HttpURLConnectionImpl.java:127)</span><br><span class="line">        at com.android.okhttp.internal.huc.HttpURLConnectionImpl.getOutputStream(HttpURLConnectionImpl.java:258)</span><br><span class="line">        at com.tencent.bugly.proguard.ai.a(BUGLY:265)</span><br><span class="line">        at com.tencent.bugly.proguard.ai.a(BUGLY:114)</span><br><span class="line">        at com.tencent.bugly.proguard.al.run(BUGLY:355)</span><br><span class="line">        at com.tencent.bugly.proguard.ak$1.run(BUGLY:723)</span><br><span class="line">        at java.lang.Thread.run(Thread.java:764)</span><br><span class="line">2018-10-10 16:39:21.312 31611-31646/com.xfhy.tinkerfirmdemo E/CrashReport: Failed to upload, please check your network.</span><br><span class="line">2018-10-10 16:39:21.312 31611-31646/com.xfhy.tinkerfirmdemo D/CrashReport: Failed to execute post.</span><br><span class="line">2018-10-10 16:39:21.312 31611-31646/com.xfhy.tinkerfirmdemo E/CrashReport: [Upload] Failed to upload(1): Failed to upload for no response!</span><br><span class="line">2018-10-10 16:39:21.313 31611-31646/com.xfhy.tinkerfirmdemo E/CrashReport: [Upload] Failed to upload(1) userinfo: failed after many attempts</span><br></pre></td></tr></table></figure>
<ul>
<li><a target="_blank" rel="noopener" href="http://www.douevencode.com/articles/2018-07/cleartext-communication-not-permitted/">Android P - CLEARTEXT communication not permitted by network security policy</a></li>
</ul>
<p>You need to configure the specified domain name as a whitelist during packaging.</p>
<p>The method is as follows:</p>
<p>Create a <code>network_security_config.xml</code> file in <code>res/xml</code> with the following content (modify the URL as needed):</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">network-security-config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">domain-config</span> <span class="attr">cleartextTrafficPermitted</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">domain</span> <span class="attr">includeSubdomains</span>=<span class="string">&quot;true&quot;</span>&gt;</span>android.bugly.qq.com<span class="tag">&lt;/<span class="name">domain</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">domain-config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">network-security-config</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Then reference this file in <code>AndroidManifest.xml</code>:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">application</span> <span class="attr">android:networkSecurityConfig</span>=<span class="string">&quot;@xml/network_security_config&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>Re-packaging will bring the following log at runtime:</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">02-25 21:09:15.831 27760 27791 D NetworkSecurityConfig: Using Network Security Config from resource network_security_config debugBuild: true</span><br></pre></td></tr></table></figure>

<ul>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/3600483f9c9f">New Features in Android P</a></li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/cbd4ffc26501">Adapting Bugly to Android P</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.android.com/training/articles/security-config?hl=zh-cn">Android Developer Network Security Configuration</a></li>
</ul>
<h3 id="Writing-Files-on-Android"><a href="#Writing-Files-on-Android" class="headerlink" title="Writing Files on Android"></a>Writing Files on Android</h3><p>When calling <code>FFileHelper::SaveArrayToFile</code>:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FFileHelper::<span class="built_in">SaveArrayToFile</span>(<span class="built_in">TArrayView</span>&lt;<span class="type">const</span> uint8&gt;(data, delta), *path, &amp;IFileManager::<span class="built_in">Get</span>(), EFileWrite::FILEWRITE_Append));</span><br></pre></td></tr></table></figure>

<p>This function internally creates an <code>FArchive</code> object to manage the current file, which has an <code>IFileHandle</code> object called <code>Handle</code>. On the Android platform, it’s <code>FFileHandleAndroid</code>.</p>
<p>Writing to files in <code>FArchive</code> calls <code>Serialize</code>, which in turn calls <code>Handle</code>‘s <code>Write</code>:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">FArchiveFileWriterGeneric::WriteLowLevel</span><span class="params">( <span class="type">const</span> uint8* Src, int64 CountToWrite )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> Handle-&gt;<span class="built_in">Write</span>( Src, CountToWrite );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The Android <code>Write</code> implementation is:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Runtime/Core/Private/Android/AndroidFile.h</span></span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">bool</span> <span class="title">Write</span><span class="params">(<span class="type">const</span> uint8* Source, int64 BytesToWrite)</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">CheckValid</span>();</span><br><span class="line">	<span class="keyword">if</span> (<span class="literal">nullptr</span> != File-&gt;Asset)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// Can&#x27;t write to assets.</span></span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="type">bool</span> bSuccess = <span class="literal">true</span>;</span><br><span class="line">	<span class="keyword">while</span> (BytesToWrite)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">check</span>(BytesToWrite &gt;= <span class="number">0</span>);</span><br><span class="line">		int64 ThisSize = FMath::<span class="built_in">Min</span>&lt;int64&gt;(READWRITE_SIZE, BytesToWrite);</span><br><span class="line">		<span class="built_in">check</span>(Source);</span><br><span class="line">		<span class="keyword">if</span> (__pwrite(File-&gt;Handle, Source, ThisSize, CurrentOffset) != ThisSize)</span><br><span class="line">		&#123;</span><br><span class="line">			bSuccess = <span class="literal">false</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		CurrentOffset += ThisSize;</span><br><span class="line">		Source += ThisSize;</span><br><span class="line">		BytesToWrite -= ThisSize;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Update the cached file length</span></span><br><span class="line">	Length = FMath::<span class="built_in">Max</span>(Length, CurrentOffset);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> bSuccess;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>You can see it writes to a file in chunks of 1MB each time.</p>
<h3 id="Android-File-Write-Error-Code-Correspondence"><a href="#Android-File-Write-Error-Code-Correspondence" class="headerlink" title="Android File Write Error Code Correspondence"></a>Android File Write Error Code Correspondence</h3><ul>
<li><a target="_blank" rel="noopener" href="http://androidxref.com/8.0.0_r4/xref/bionic/libc/bionic/strerror.cpp#35">http://androidxref.com/8.0.0_r4/xref/bionic/libc/bionic/strerror.cpp#35</a></li>
</ul>
<p>Look up error string by error code number.</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://androidxref.com/8.0.0_r4/xref/bionic/libc/bionic/strerror_r.cpp#_sys_error_strings">http://androidxref.com/8.0.0_r4/xref/bionic/libc/bionic/strerror_r.cpp#_sys_error_strings</a></li>
<li><a target="_blank" rel="noopener" href="http://androidxref.com/8.0.0_r4/xref/bionic/libc/private/bionic_errdefs.h">http://androidxref.com/8.0.0_r4/xref/bionic/libc/private/bionic_errdefs.h</a></li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// bionic_errdefs.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __BIONIC_ERRDEF</span></span><br><span class="line"><span class="meta">#<span class="keyword">error</span> <span class="string">&quot;__BIONIC_ERRDEF must be defined before including this file&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">__BIONIC_ERRDEF( <span class="number">0</span>              ,   <span class="number">0</span>, <span class="string">&quot;Success&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EPERM          ,   <span class="number">1</span>, <span class="string">&quot;Operation not permitted&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ENOENT         ,   <span class="number">2</span>, <span class="string">&quot;No such file or directory&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ESRCH          ,   <span class="number">3</span>, <span class="string">&quot;No such process&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EINTR          ,   <span class="number">4</span>, <span class="string">&quot;Interrupted system call&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EIO            ,   <span class="number">5</span>, <span class="string">&quot;I/O error&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ENXIO          ,   <span class="number">6</span>, <span class="string">&quot;No such device or address&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( E2BIG          ,   <span class="number">7</span>, <span class="string">&quot;Argument list too long&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ENOEXEC        ,   <span class="number">8</span>, <span class="string">&quot;Exec format error&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EBADF          ,   <span class="number">9</span>, <span class="string">&quot;Bad file descriptor&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ECHILD         ,  <span class="number">10</span>, <span class="string">&quot;No child processes&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EAGAIN         ,  <span class="number">11</span>, <span class="string">&quot;Try again&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ENOMEM         ,  <span class="number">12</span>, <span class="string">&quot;Out of memory&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EACCES         ,  <span class="number">13</span>, <span class="string">&quot;Permission denied&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EFAULT         ,  <span class="number">14</span>, <span class="string">&quot;Bad address&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ENOTBLK        ,  <span class="number">15</span>, <span class="string">&quot;Block device required&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EBUSY          ,  <span class="number">16</span>, <span class="string">&quot;Device or resource busy&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EEXIST         ,  <span class="number">17</span>, <span class="string">&quot;File exists&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EXDEV          ,  <span class="number">18</span>, <span class="string">&quot;Cross-device link&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ENODEV         ,  <span class="number">19</span>, <span class="string">&quot;No such device&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ENOTDIR        ,  <span class="number">20</span>, <span class="string">&quot;Not a directory&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EISDIR         ,  <span class="number">21</span>, <span class="string">&quot;Is a directory&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EINVAL         ,  <span class="number">22</span>, <span class="string">&quot;Invalid argument&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ENFILE         ,  <span class="number">23</span>, <span class="string">&quot;File table overflow&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EMFILE         ,  <span class="number">24</span>, <span class="string">&quot;Too many open files&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ENOTTY         ,  <span class="number">25</span>, <span class="string">&quot;Not a typewriter&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ETXTBSY        ,  <span class="number">26</span>, <span class="string">&quot;Text file busy&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EFBIG          ,  <span class="number">27</span>, <span class="string">&quot;File too large&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ENOSPC         ,  <span class="number">28</span>, <span class="string">&quot;No space left on device&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ESPIPE         ,  <span class="number">29</span>, <span class="string">&quot;Illegal seek&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EROFS          ,  <span class="number">30</span>, <span class="string">&quot;Read-only file system&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EMLINK         ,  <span class="number">31</span>, <span class="string">&quot;Too many links&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EPIPE          ,  <span class="number">32</span>, <span class="string">&quot;Broken pipe&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EDOM           ,  <span class="number">33</span>, <span class="string">&quot;Math argument out of domain of func&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ERANGE         ,  <span class="number">34</span>, <span class="string">&quot;Math result not representable&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EDEADLK        ,  <span class="number">35</span>, <span class="string">&quot;Resource deadlock would occur&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ENAMETOOLONG   ,  <span class="number">36</span>, <span class="string">&quot;File name too long&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ENOLCK         ,  <span class="number">37</span>, <span class="string">&quot;No record locks available&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ENOSYS         ,  <span class="number">38</span>, <span class="string">&quot;Function not implemented&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ENOTEMPTY      ,  <span class="number">39</span>, <span class="string">&quot;Directory not empty&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ELOOP          ,  <span class="number">40</span>, <span class="string">&quot;Too many symbolic links encountered&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ENOMSG         ,  <span class="number">42</span>, <span class="string">&quot;No message of desired type&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EIDRM          ,  <span class="number">43</span>, <span class="string">&quot;Identifier removed&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ECHRNG         ,  <span class="number">44</span>, <span class="string">&quot;Channel number out of range&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EL2NSYNC       ,  <span class="number">45</span>, <span class="string">&quot;Level 2 not synchronized&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EL3HLT         ,  <span class="number">46</span>, <span class="string">&quot;Level 3 halted&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EL3RST         ,  <span class="number">47</span>, <span class="string">&quot;Level 3 reset&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ELNRNG         ,  <span class="number">48</span>, <span class="string">&quot;Link number out of range&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EUNATCH        ,  <span class="number">49</span>, <span class="string">&quot;Protocol driver not attached&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ENOCSI         ,  <span class="number">50</span>, <span class="string">&quot;No CSI structure available&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EL2HLT         ,  <span class="number">51</span>, <span class="string">&quot;Level 2 halted&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EBADE          ,  <span class="number">52</span>, <span class="string">&quot;Invalid exchange&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EBADR          ,  <span class="number">53</span>, <span class="string">&quot;Invalid request descriptor&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EXFULL         ,  <span class="number">54</span>, <span class="string">&quot;Exchange full&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ENOANO         ,  <span class="number">55</span>, <span class="string">&quot;No anode&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EBADRQC        ,  <span class="number">56</span>, <span class="string">&quot;Invalid request code&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EBADSLT        ,  <span class="number">57</span>, <span class="string">&quot;Invalid slot&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EBFONT         ,  <span class="number">59</span>, <span class="string">&quot;Bad font file format&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ENOSTR         ,  <span class="number">60</span>, <span class="string">&quot;Device not a stream&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ENODATA        ,  <span class="number">61</span>, <span class="string">&quot;No data available&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ETIME          ,  <span class="number">62</span>, <span class="string">&quot;Timer expired&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ENOSR          ,  <span class="number">63</span>, <span class="string">&quot;Out of streams resources&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ENONET         ,  <span class="number">64</span>, <span class="string">&quot;Machine is not on the network&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ENOPKG         ,  <span class="number">65</span>, <span class="string">&quot;Package not installed&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EREMOTE        ,  <span class="number">66</span>, <span class="string">&quot;Object is remote&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ENOLINK        ,  <span class="number">67</span>, <span class="string">&quot;Link has been severed&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EADV           ,  <span class="number">68</span>, <span class="string">&quot;Advertise error&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ESRMNT         ,  <span class="number">69</span>, <span class="string">&quot;Srmount error&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ECOMM          ,  <span class="number">70</span>, <span class="string">&quot;Communication error on send&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EPROTO         ,  <span class="number">71</span>, <span class="string">&quot;Protocol error&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EMULTIHOP      ,  <span class="number">72</span>, <span class="string">&quot;Multihop attempted&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EDOTDOT        ,  <span class="number">73</span>, <span class="string">&quot;RFS specific error&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EBADMSG        ,  <span class="number">74</span>, <span class="string">&quot;Not a data message&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EOVERFLOW      ,  <span class="number">75</span>, <span class="string">&quot;Value too large for defined data type&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ENOTUNIQ       ,  <span class="number">76</span>, <span class="string">&quot;Name not unique on network&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EBADFD         ,  <span class="number">77</span>, <span class="string">&quot;File descriptor in bad state&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EREMCHG        ,  <span class="number">78</span>, <span class="string">&quot;Remote address changed&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ELIBACC        ,  <span class="number">79</span>, <span class="string">&quot;Can not access a needed shared library&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ELIBBAD        ,  <span class="number">80</span>, <span class="string">&quot;Accessing a corrupted shared library&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ELIBSCN        ,  <span class="number">81</span>, <span class="string">&quot;.lib section in a.out corrupted&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ELIBMAX        ,  <span class="number">82</span>, <span class="string">&quot;Attempting to link in too many shared libraries&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ELIBEXEC       ,  <span class="number">83</span>, <span class="string">&quot;Cannot exec a shared library directly&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EILSEQ         ,  <span class="number">84</span>, <span class="string">&quot;Illegal byte sequence&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ERESTART       ,  <span class="number">85</span>, <span class="string">&quot;Interrupted system call should be restarted&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ESTRPIPE       ,  <span class="number">86</span>, <span class="string">&quot;Streams pipe error&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EUSERS         ,  <span class="number">87</span>, <span class="string">&quot;Too many users&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ENOTSOCK       ,  <span class="number">88</span>, <span class="string">&quot;Socket operation on non-socket&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EDESTADDRREQ   ,  <span class="number">89</span>, <span class="string">&quot;Destination address required&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EMSGSIZE       ,  <span class="number">90</span>, <span class="string">&quot;Message too long&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EPROTOTYPE     ,  <span class="number">91</span>, <span class="string">&quot;Protocol wrong type for socket&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ENOPROTOOPT    ,  <span class="number">92</span>, <span class="string">&quot;Protocol not available&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EPROTONOSUPPORT,  <span class="number">93</span>, <span class="string">&quot;Protocol not supported&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ESOCKTNOSUPPORT,  <span class="number">94</span>, <span class="string">&quot;Socket type not supported&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EOPNOTSUPP     ,  <span class="number">95</span>, <span class="string">&quot;Operation not supported on transport endpoint&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EPFNOSUPPORT   ,  <span class="number">96</span>, <span class="string">&quot;Protocol family not supported&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EAFNOSUPPORT   ,  <span class="number">97</span>, <span class="string">&quot;Address family not supported by protocol&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EADDRINUSE     ,  <span class="number">98</span>, <span class="string">&quot;Address already in use&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EADDRNOTAVAIL  ,  <span class="number">99</span>, <span class="string">&quot;Cannot assign requested address&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ENETDOWN       , <span class="number">100</span>, <span class="string">&quot;Network is down&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ENETUNREACH    , <span class="number">101</span>, <span class="string">&quot;Network is unreachable&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ENETRESET      , <span class="number">102</span>, <span class="string">&quot;Network dropped connection because of reset&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ECONNABORTED   , <span class="number">103</span>, <span class="string">&quot;Software caused connection abort&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ECONNRESET     , <span class="number">104</span>, <span class="string">&quot;Connection reset by peer&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ENOBUFS        , <span class="number">105</span>, <span class="string">&quot;No buffer space available&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EISCONN        , <span class="number">106</span>, <span class="string">&quot;Transport endpoint is already connected&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ENOTCONN       , <span class="number">107</span>, <span class="string">&quot;Transport endpoint is not connected&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ESHUTDOWN      , <span class="number">108</span>, <span class="string">&quot;Cannot send after transport endpoint shutdown&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ETOOMANYREFS   , <span class="number">109</span>, <span class="string">&quot;Too many references: cannot splice&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ETIMEDOUT      , <span class="number">110</span>, <span class="string">&quot;Connection timed out&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ECONNREFUSED   , <span class="number">111</span>, <span class="string">&quot;Connection refused&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EHOSTDOWN      , <span class="number">112</span>, <span class="string">&quot;Host is down&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EHOSTUNREACH   , <span class="number">113</span>, <span class="string">&quot;No route to host&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EALREADY       , <span class="number">114</span>, <span class="string">&quot;Operation already in progress&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EINPROGRESS    , <span class="number">115</span>, <span class="string">&quot;Operation now in progress&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ESTALE         , <span class="number">116</span>, <span class="string">&quot;Stale NFS file handle&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EUCLEAN        , <span class="number">117</span>, <span class="string">&quot;Structure needs cleaning&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ENOTNAM        , <span class="number">118</span>, <span class="string">&quot;Not a XENIX named type file&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ENAVAIL        , <span class="number">119</span>, <span class="string">&quot;No XENIX semaphores available&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EISNAM         , <span class="number">120</span>, <span class="string">&quot;Is a named type file&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EREMOTEIO      , <span class="number">121</span>, <span class="string">&quot;Remote I/O error&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EDQUOT         , <span class="number">122</span>, <span class="string">&quot;Quota exceeded&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ENOMEDIUM      , <span class="number">123</span>, <span class="string">&quot;No medium found&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EMEDIUMTYPE    , <span class="number">124</span>, <span class="string">&quot;Wrong medium type&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ECANCELED      , <span class="number">125</span>, <span class="string">&quot;Operation Canceled&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ENOKEY         , <span class="number">126</span>, <span class="string">&quot;Required key not available&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EKEYEXPIRED    , <span class="number">127</span>, <span class="string">&quot;Key has expired&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EKEYREVOKED    , <span class="number">128</span>, <span class="string">&quot;Key has been revoked&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EKEYREJECTED   , <span class="number">129</span>, <span class="string">&quot;Key was rejected by service&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( EOWNERDEAD     , <span class="number">130</span>, <span class="string">&quot;Owner died&quot;</span> )</span><br><span class="line">__BIONIC_ERRDEF( ENOTRECOVERABLE, <span class="number">131</span>, <span class="string">&quot;State not recoverable&quot;</span> )</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">undef</span> __BIONIC_ERRDEF</span></span><br><span class="line">```### Get GPU <span class="keyword">and</span> OpenGL ES Version Information</span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line">$ adb shell dumpsys | grep GLES</span><br><span class="line">GLES: Qualcomm, <span class="built_in">Adreno</span> (TM) <span class="number">650</span>, OpenGL ES <span class="number">3.2</span> V@<span class="number">0502.0</span> (GIT@<span class="number">191610</span>ae03, Ic907de5ed0, <span class="number">1600323700</span>) (Date:<span class="number">09</span>/<span class="number">17</span>/<span class="number">20</span>)</span><br></pre></td></tr></table></figure>

<h3 id="UE-Project-Startup-Parameters"><a href="#UE-Project-Startup-Parameters" class="headerlink" title="UE Project Startup Parameters"></a>UE Project Startup Parameters</h3><p>Looking at the code in the engine, under the <code>Launch</code> module in <code>Launch\Private\Android\LaunchAndroid.cpp</code>, there is the <code>InitCommandLine</code> function:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Launch\Private\Android\LaunchAndroid.cpp</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">InitCommandLine</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">static</span> <span class="type">const</span> uint32 CMD_LINE_MAX = <span class="number">16384u</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// initialize the command line to an empty string</span></span><br><span class="line">  FCommandLine::<span class="built_in">Set</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;&quot;</span>));</span><br><span class="line"></span><br><span class="line">  AAssetManager* AssetMgr = <span class="built_in">AndroidThunkCpp_GetAssetManager</span>();</span><br><span class="line">  AAsset* asset = <span class="built_in">AAssetManager_open</span>(AssetMgr, <span class="built_in">TCHAR_TO_UTF8</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;UE4CommandLine.txt&quot;</span>)), AASSET_MODE_BUFFER);</span><br><span class="line">  <span class="keyword">if</span> (<span class="literal">nullptr</span> != asset)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">void</span>* FileContents = <span class="built_in">AAsset_getBuffer</span>(asset);</span><br><span class="line">    int32 FileLength = <span class="built_in">AAsset_getLength</span>(asset);</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> CommandLine[CMD_LINE_MAX];</span><br><span class="line">    FileLength = (FileLength &lt; CMD_LINE_MAX - <span class="number">1</span>) ? FileLength : CMD_LINE_MAX - <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">memcpy</span>(CommandLine, FileContents, FileLength);</span><br><span class="line">    CommandLine[FileLength] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">AAsset_close</span>(asset);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// chop off trailing spaces</span></span><br><span class="line">    <span class="keyword">while</span> (*CommandLine &amp;&amp; <span class="built_in">isspace</span>(CommandLine[<span class="built_in">strlen</span>(CommandLine) - <span class="number">1</span>]))</span><br><span class="line">    &#123;</span><br><span class="line">      CommandLine[<span class="built_in">strlen</span>(CommandLine) - <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    FCommandLine::<span class="built_in">Append</span>(<span class="built_in">UTF8_TO_TCHAR</span>(CommandLine));</span><br><span class="line">    FPlatformMisc::<span class="built_in">LowLevelOutputDebugStringf</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;APK Commandline: %s&quot;</span>), FCommandLine::<span class="built_in">Get</span>());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// read in the command line text file from the sdcard if it exists</span></span><br><span class="line">  FString CommandLineFilePath = GFilePathBase + <span class="built_in">FString</span>(<span class="string">&quot;/UE4Game/&quot;</span>) + (!FApp::<span class="built_in">IsProjectNameEmpty</span>() ? FApp::<span class="built_in">GetProjectName</span>() : FPlatformProcess::<span class="built_in">ExecutableName</span>()) + <span class="built_in">FString</span>(<span class="string">&quot;/UE4CommandLine.txt&quot;</span>);</span><br><span class="line">  FILE* CommandLineFile = <span class="built_in">fopen</span>(<span class="built_in">TCHAR_TO_UTF8</span>(*CommandLineFilePath), <span class="string">&quot;r&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span>(CommandLineFile == <span class="literal">NULL</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// if that failed, try the lowercase version</span></span><br><span class="line">    CommandLineFilePath = CommandLineFilePath.<span class="built_in">Replace</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;UE4CommandLine.txt&quot;</span>), <span class="built_in">TEXT</span>(<span class="string">&quot;ue4commandline.txt&quot;</span>));</span><br><span class="line">    CommandLineFile = <span class="built_in">fopen</span>(<span class="built_in">TCHAR_TO_UTF8</span>(*CommandLineFilePath), <span class="string">&quot;r&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(CommandLineFile)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="type">char</span> CommandLine[CMD_LINE_MAX];</span><br><span class="line">    <span class="built_in">fgets</span>(CommandLine, <span class="built_in">ARRAY_COUNT</span>(CommandLine) - <span class="number">1</span>, CommandLineFile);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">fclose</span>(CommandLineFile);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// chop off trailing spaces</span></span><br><span class="line">    <span class="keyword">while</span> (*CommandLine &amp;&amp; <span class="built_in">isspace</span>(CommandLine[<span class="built_in">strlen</span>(CommandLine) - <span class="number">1</span>]))</span><br><span class="line">    &#123;</span><br><span class="line">      CommandLine[<span class="built_in">strlen</span>(CommandLine) - <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// initialize the command line to an empty string</span></span><br><span class="line">    FCommandLine::<span class="built_in">Set</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;&quot;</span>));</span><br><span class="line"></span><br><span class="line">    FCommandLine::<span class="built_in">Append</span>(<span class="built_in">UTF8_TO_TCHAR</span>(CommandLine));</span><br><span class="line">    FPlatformMisc::<span class="built_in">LowLevelOutputDebugStringf</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;Override Commandline: %s&quot;</span>), FCommandLine::<span class="built_in">Get</span>());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> !UE_BUILD_SHIPPING</span></span><br><span class="line">  <span class="keyword">if</span> (FString* ConfigRulesCmdLineAppend = FAndroidMisc::<span class="built_in">GetConfigRulesVariable</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;cmdline&quot;</span>)))</span><br><span class="line">  &#123;</span><br><span class="line">    FCommandLine::<span class="built_in">Append</span>(**ConfigRulesCmdLineAppend);</span><br><span class="line">    FPlatformMisc::<span class="built_in">LowLevelOutputDebugStringf</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;ConfigRules appended: %s&quot;</span>), **ConfigRulesCmdLineAppend);</span><br><span class="line">  &#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In simple terms, this means writing startup parameters into <code>UE4Game/ProjectName/ue4commandline.txt</code>, and the engine will read from this file during startup and add it to <code>FCommandLine</code>.</p>
<h3 id="Android-Set-Aspect-Ratio"><a href="#Android-Set-Aspect-Ratio" class="headerlink" title="Android Set Aspect Ratio"></a>Android Set Aspect Ratio</h3><p>The value under <code>Project Settings</code> - <code>Platforms</code> - <code>Android</code> - <code>Maximum support aspect ratio</code> defaults to 2.1, but in full screen situations, there may be black edges.<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/notes/ue/index/UE4/ue4-project-settings-android-maximum-support-aspect-ratio.webp"></p>
<p>This value controls the value in <code>AndroidManifest.xml</code>:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta-data</span> <span class="attr">android:name</span>=<span class="string">&quot;android.max_aspect&quot;</span> <span class="attr">android:value</span>=<span class="string">&quot;2.1&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>I currently set the value to 2.5.</p>
<blockquote>
<p>Note: <code>Enable FullScreen Immersive on KitKat and above devices</code> controls whether to hide the virtual keys when entering the game.</p>
</blockquote>
<h2 id="UPL-for-Android"><a href="#UPL-for-Android" class="headerlink" title="UPL for Android"></a>UPL for Android</h2><p>In UE, when adding third-party modules or modifying configuration files for mobile, <code>AdditionalPropertiesForReceipt</code> is often used, where <code>ReceiptProperty</code> is created with the <code>xml</code> file being the Unreal Plugin Language (UPL) script.</p>
<p>The platform names for <code>ReceiptProperty</code> are fixed for iOS and Android, namely <code>IOSPlugin</code> and <code>AndroidPlugin</code>, and cannot specify other names (see code <a target="_blank" rel="noopener" href="https://github.com/EpicGames/UnrealEngine/blob/283e412aa843210f2d6e9ed0236861cf749b3429/Engine/Source/Programs/UnrealBuildTool/Platform/IOS/UEDeployIOS.cs#L1153">UEDeployIOS.cs#L1153</a> and <a target="_blank" rel="noopener" href="https://github.com/EpicGames/UnrealEngine/blob/1eb5d965b994b4bd59f31ec4158d42f13137ab1f/Engine/Source/Programs/UnrealBuildTool/Platform/Android/UEDeployAndroid.cs#L4303">UEDeployAndroid.cs#L4303</a>).</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AdditionalPropertiesForReceipt.Add(<span class="keyword">new</span> ReceiptProperty(<span class="string">&quot;AndroidPlugin&quot;</span>, Path.Combine(ThirdPartyPath, <span class="string">&quot;Android/PlatformUtils_UPL_Android.xml&quot;</span>)));</span><br></pre></td></tr></table></figure>

<ul>
<li><a target="_blank" rel="noopener" href="https://docs.unrealengine.com/en-US/Platforms/Mobile/UnrealPluginLanguage/index.html">Unreal Plugin Language</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/34374244">Unreal Plugin Language Reference (Android Version)</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/EpicGames/UnrealEngine/blob/f8f4b403eb682ffc055613c7caf9d2ba5df7f319/Engine/Source/Programs/UnrealBuildTool/System/UnrealPluginLanguage.cs">Engine/Source/Programs/UnrealBuildTool/System/UnrealPluginLanguage.cs</a></li>
</ul>
<h3 id="All-UPL-in-Android-Project"><a href="#All-UPL-in-Android-Project" class="headerlink" title="All UPL in Android Project"></a>All UPL in Android Project</h3><p>You can find all UPL file paths in the project path under <code>Intermediate/Android/ActiveUPL.xml</code>:</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Plugins\Online\Android\OnlineSubsystemGooglePlay\Source\OnlineSubsystemGooglePlay_UPL.xml</span><br><span class="line">Plugins\Runtime\AndroidPermission\Source\AndroidPermission\AndroidPermission_APL.xml</span><br><span class="line">Plugins\Runtime\GoogleCloudMessaging\Source\GoogleCloudMessaging\GoogleCloudMessaging_UPL.xml</span><br><span class="line">Plugins\Runtime\GooglePAD\Source\GooglePAD\GooglePAD_APL.xml</span><br><span class="line">Plugins\Runtime\Oculus\OculusVR\Source\OculusHMD\OculusMobile_APL.xml</span><br><span class="line">Source\Runtime\Online\Voice\AndroidVoiceImpl_UPL.xml</span><br><span class="line">Source\ThirdParty\GoogleGameSDK\GoogleGameSDK_APL.xml</span><br></pre></td></tr></table></figure>

<h3 id="Deleting-Items-from-AndroidManifest-xml"><a href="#Deleting-Items-from-AndroidManifest-xml" class="headerlink" title="Deleting Items from AndroidManifest.xml"></a>Deleting Items from AndroidManifest.xml</h3><p>Since UE automatically adds items to <code>AndroidManifest.xml</code>, manually adding items can cause errors indicating they already exist:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">UATHelper: <span class="built_in">Packaging</span> (<span class="built_in">Android</span> (ASTC)):   &gt; Task :app:processDebugManifest FAILED</span><br><span class="line">UATHelper: <span class="built_in">Packaging</span> (<span class="built_in">Android</span> (ASTC)):   </span><br><span class="line">UATHelper: <span class="built_in">Packaging</span> (<span class="built_in">Android</span> (ASTC)):   Z:\app\src\main\AndroidManifest.xml:<span class="number">47</span>:<span class="number">5</span><span class="number">-106</span> Error:</span><br><span class="line">UATHelper: <span class="built_in">Packaging</span> (<span class="built_in">Android</span> (ASTC)):     Element meta-data<span class="meta">#com.epicgames.ue4.GameActivity.bUseExternalFilesDir at AndroidManifest.xml:47:5-106 duplicated with element declared at AndroidManifest.xml:27:5-107</span></span><br><span class="line">UATHelper: <span class="built_in">Packaging</span> (<span class="built_in">Android</span> (ASTC)):   Z:\app\src\main\AndroidManifest.xml Error:</span><br><span class="line">UATHelper: <span class="built_in">Packaging</span> (<span class="built_in">Android</span> (ASTC)):     Validation failed, exiting</span><br><span class="line">UATHelper: <span class="built_in">Packaging</span> (<span class="built_in">Android</span> (ASTC)):   </span><br><span class="line">UATHelper: <span class="built_in">Packaging</span> (<span class="built_in">Android</span> (ASTC)):   FAILURE: Build failed with an exception.</span><br><span class="line">UATHelper: <span class="built_in">Packaging</span> (<span class="built_in">Android</span> (ASTC)):   </span><br><span class="line">UATHelper: <span class="built_in">Packaging</span> (<span class="built_in">Android</span> (ASTC)):   * What went wrong:</span><br><span class="line">UATHelper: <span class="built_in">Packaging</span> (<span class="built_in">Android</span> (ASTC)):   Execution failed <span class="keyword">for</span> task <span class="string">&#x27;:app:processDebugManifest&#x27;</span>.</span><br><span class="line">UATHelper: <span class="built_in">Packaging</span> (<span class="built_in">Android</span> (ASTC)):   &gt; Manifest merger failed with multiple errors, see logs</span><br><span class="line">UATHelper: <span class="built_in">Packaging</span> (<span class="built_in">Android</span> (ASTC)):   </span><br><span class="line">UATHelper: <span class="built_in">Packaging</span> (<span class="built_in">Android</span> (ASTC)):   See http:<span class="comment">//g.co/androidstudio/manifest-merger for more information about the manifest merger.</span></span><br><span class="line">UATHelper: <span class="built_in">Packaging</span> (<span class="built_in">Android</span> (ASTC)):   </span><br><span class="line">UATHelper: <span class="built_in">Packaging</span> (<span class="built_in">Android</span> (ASTC)):   * Try:</span><br><span class="line">UATHelper: <span class="built_in">Packaging</span> (<span class="built_in">Android</span> (ASTC)):   Run with --stacktrace option to get the stack trace. Run with --info <span class="keyword">or</span> --debug option to get more log output. Run with --scan to get full insights.</span><br><span class="line">UATHelper: <span class="built_in">Packaging</span> (<span class="built_in">Android</span> (ASTC)):   </span><br><span class="line">UATHelper: <span class="built_in">Packaging</span> (<span class="built_in">Android</span> (ASTC)):   * Get more help at https:<span class="comment">//help.gradle.org</span></span><br><span class="line">UATHelper: <span class="built_in">Packaging</span> (<span class="built_in">Android</span> (ASTC)):   </span><br><span class="line">UATHelper: <span class="built_in">Packaging</span> (<span class="built_in">Android</span> (ASTC)):   BUILD FAILED in <span class="number">10</span>s</span><br><span class="line">UATHelper: <span class="built_in">Packaging</span> (<span class="built_in">Android</span> (ASTC)):   <span class="number">189</span> actionable tasks: <span class="number">1</span> executed, <span class="number">188</span> up-to-date</span><br><span class="line">UATHelper: <span class="built_in">Packaging</span> (<span class="built_in">Android</span> (ASTC)):   ERROR: cmd.exe failed with args /c <span class="string">&quot;C:\Users\lipengzha\Documents\Unreal Projects\GCloudExample\Intermediate\Android\armv7\gradle\rungradle.bat&quot;</span> :app:assembleDebug</span><br><span class="line">PackagingResults: Error: cmd.exe failed with args /c <span class="string">&quot;C:\Users\lipengzha\Documents\Unreal Projects\GCloudExample\Intermediate\Android\armv7\gradle\rungradle.bat&quot;</span> :app:assembleDebug</span><br><span class="line">UATHelper: <span class="built_in">Packaging</span> (<span class="built_in">Android</span> (ASTC)): Took <span class="number">13.3060694</span>s to run UnrealBuildTool.exe, ExitCode=<span class="number">6</span></span><br><span class="line">UATHelper: <span class="built_in">Packaging</span> (<span class="built_in">Android</span> (ASTC)): UnrealBuildTool failed. See log <span class="keyword">for</span> more details. (C:\Users\lipengzha\AppData\Roaming\Unreal Engine\AutomationTool\Logs\C+Program+Files+Epic+Games+UE_4<span class="number">.25</span>\UBT-.txt)</span><br><span class="line">UATHelper: <span class="built_in">Packaging</span> (<span class="built_in">Android</span> (ASTC)): AutomationTool exiting with ExitCode=<span class="number">6</span> (<span class="number">6</span>)</span><br><span class="line">UATHelper: <span class="built_in">Packaging</span> (<span class="built_in">Android</span> (ASTC)): BUILD FAILED</span><br><span class="line">PackagingResults: Error: Unknown Error</span><br></pre></td></tr></table></figure>

<p>To modify or delete items generated by UE in <code>AndroidManifest.xml</code>, you can use the method of deleting first and then adding them back.</p>
<p>Taking the deletion of the following item as an example:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta-data android:name=<span class="string">&quot;com.epicgames.ue4.GameActivity.bUseExternalFilesDir&quot;</span> android:value=<span class="string">&quot;false&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>
<p>You can write the following code in the <code>androidManifestUpdates</code> of the UPL:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">androidManifestUpdates</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">loopElements</span> <span class="attr">tag</span>=<span class="string">&quot;meta-data&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setStringFromAttribute</span> <span class="attr">result</span>=<span class="string">&quot;ApplicationSectionName&quot;</span> <span class="attr">tag</span>=<span class="string">&quot;$&quot;</span> <span class="attr">name</span>=<span class="string">&quot;android:name&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setBoolIsEqual</span> <span class="attr">result</span>=<span class="string">&quot;bUseExternalFilesDir&quot;</span> <span class="attr">arg1</span>=<span class="string">&quot;$S(ApplicationSectionName)&quot;</span> <span class="attr">arg2</span>=<span class="string">&quot;com.epicgames.ue4.GameActivity.bUseExternalFilesDir&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">if</span> <span class="attr">condition</span>=<span class="string">&quot;bUseExternalFilesDir&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">true</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">removeElement</span> <span class="attr">tag</span>=<span class="string">&quot;$&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">true</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">loopElements</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">androidManifestUpdates</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>This traverses through <code>AndroidManifest.xml</code> to remove the <code>meta-data</code> where <code>android:name</code> equals <code>com.epicgames.ue4.GameActivity.bUseExternalFilesDir</code>.</p>
<h3 id="JNI-Call-to-Receive-ActivityResult"><a href="#JNI-Call-to-Receive-ActivityResult" class="headerlink" title="JNI Call to Receive ActivityResult"></a>JNI Call to Receive ActivityResult</h3><p>Sometimes you need to create an <code>Intent</code> using <code>startActivityForResult</code> to perform operations such as opening the camera or selecting an image from the album.</p>
<p>However, Android does not block the current function during these operations, so data cannot be directly received in the calling function. The result from actions executed via <code>startActivityForResult</code> will be called in the Activity’s <code>onActivityResult</code>.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GameActivity.java</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onActivityResult</span><span class="params">(<span class="type">int</span> requestCode, <span class="type">int</span> resultCode, Intent data)</span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>UE provides a way to append Java code to <code>OnActivityResult</code> in UPL:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- optional additions to GameActivity onActivityResult in GameActivity.java --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">gameActivityOnActivityResultAdditions</span>&gt;</span>	<span class="tag">&lt;/<span class="name">gameActivityOnActivityResultAdditions</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Using this approach, added Java code will be appended to the end of the <code>OnActivityResult</code> function. However, there is a problem: after executing the custom appended code, the received result still needs to be handled and passed back to UE, which can be cumbersome.</p>
<p>After reviewing the code, I found that UE offers a multicast delegate event for the Java side’s <code>OnActivityResult</code>, allowing you to listen for <code>OnActivityResult</code> events in UE using C++ to handle it.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Launch/Puclic/Android/AndroidJNI.h</span></span><br><span class="line"><span class="built_in">DECLARE_MULTICAST_DELEGATE_SixParams</span>(FOnActivityResult, JNIEnv *, jobject, jobject, jint, jint, jobject);</span><br><span class="line"></span><br><span class="line"><span class="comment">// The delegate is defined in `FJavaWrapper`</span></span><br><span class="line"><span class="comment">// Delegate that can be registered to that is called when an activity is finished</span></span><br><span class="line"><span class="type">static</span> FOnActivityResult OnActivityResultDelegate;</span><br></pre></td></tr></table></figure>
<p>In UE, you can bind this multicast delegate to listen for calls to Java’s <code>OnActivityResult</code>, allowing you to handle them accordingly.</p>
<p>It is called from the Java side in <code>AndroidJNI.cpp</code> through the <code>Java_com_epicgames_ue4_GameActivity_nativeOnActivityResult</code> function, and the calling mechanism is documented in the previous notes.</p>
<h3 id="Java-Calls-C"><a href="#Java-Calls-C" class="headerlink" title="Java Calls C++"></a>Java Calls C++</h3><p>Some needs and implementations require calling from Java to C++. You can do so as follows:<br>First, declare a <code>native</code> Java function in <code>GameActivity</code> (no need to define it):</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title function_">nativeOnActivityResult</span><span class="params">(GameActivity activity, <span class="type">int</span> requestCode, <span class="type">int</span> resultCode, Intent data)</span>;</span><br></pre></td></tr></table></figure>
<p>Then, define a corresponding C++ function as follows:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">JNI_METHOD <span class="type">void</span> <span class="title">Java_com_epicgames_ue4_GameActivity_nativeOnActivityResult</span><span class="params">(JNIEnv* jenv, jobject thiz, jobject activity, jint requestCode, jint resultCode, jobject data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	FJavaWrapper::OnActivityResultDelegate.<span class="built_in">Broadcast</span>(jenv, thiz, activity, requestCode, resultCode, data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>You can see the rules for the function name are as follows:</p>
<ol>
<li>The function must be prefixed with <code>JNI_METHOD</code>, which is a macro <code>__attribute__ ((visibility (&quot;default&quot;))) extern &quot;C&quot;</code>.</li>
<li>The function name must start with <code>Java_</code> followed by <code>com_epicgames_ue4_GameActivity_</code>, indicating it is defined in <code>GameActivity</code>.</li>
<li>The following part must match the Java function name.</li>
</ol>
<p>The rules for accepting parameters are:</p>
<ol>
<li>The first parameter is the Java <code>Env</code>.</li>
<li>The second parameter is the Java <code>this</code>.</li>
<li>The subsequent parameters correspond to the parameters passed from Java.<h3 id="Full-Screen-Adaptation-for-Android-P"><a href="#Full-Screen-Adaptation-for-Android-P" class="headerlink" title="Full-Screen Adaptation for Android P"></a>Full-Screen Adaptation for Android P</h3></li>
</ol>
<p>When packaging in UE4, the project will generate a GameActivity.java file, which contains the OnCreate code for full-screen adaptation:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">	<span class="keyword">if</span> (UseDisplayCutout)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// will not be true if not Android Pie or later</span></span><br><span class="line">	    WindowManager.<span class="type">LayoutParams</span> <span class="variable">params</span> <span class="operator">=</span> getWindow().getAttributes();</span><br><span class="line">		params.layoutInDisplayCutoutMode = WindowManager.LayoutParams.LAYOUT_IN_DISPLAY_CUTOUT_MODE_SHORT_EDGES;</span><br><span class="line">	    getWindow().setAttributes(params);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Android P and later systems do not support this, so you will need to write JNI calls to forcibly enable compatibility for P and later system versions. In UE4.23 and later engine versions, you can use UPL to add code to the OnCreate function, allowing you to directly insert the code into GameActivity.java:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;gameActivityOnCreateFinalAdditions&gt;</span><br><span class="line">&lt;insert&gt;</span><br><span class="line">    <span class="comment">// Allow the use of cutouts on P versions</span></span><br><span class="line">    <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.P) &#123;</span><br><span class="line">    WindowManager.<span class="type">LayoutParams</span> <span class="variable">lp</span> <span class="operator">=</span> <span class="built_in">this</span>.getWindow().getAttributes();</span><br><span class="line">    lp.layoutInDisplayCutoutMode = WindowManager.LayoutParams.LAYOUT_IN_DISPLAY_CUTOUT_MODE_SHORT_EDGES;</span><br><span class="line">    <span class="built_in">this</span>.getWindow().setAttributes(lp);</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/insert&gt;</span><br><span class="line">&lt;/gameActivityOnCreateFinalAdditions&gt;</span><br></pre></td></tr></table></figure>

<p>In UE4.23 and prior versions, you cannot add code to <code>OnCreate</code>; instead, you must write a JNI call:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">AndroidThunkJava_SetFullScreenDisplayForP</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">final</span> <span class="type">GameActivity</span> <span class="variable">Activity</span> <span class="operator">=</span> <span class="built_in">this</span>;</span><br><span class="line">	runOnUiThread(<span class="keyword">new</span> <span class="title class_">Runnable</span>() </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">GameActivity</span> <span class="variable">InActivity</span> <span class="operator">=</span> Activity;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">WindowManager</span> <span class="variable">windowManager</span> <span class="operator">=</span>  InActivity.getWindowManager();</span><br><span class="line">            <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.P) </span><br><span class="line">            &#123;</span><br><span class="line">        </span><br><span class="line">                WindowManager.<span class="type">LayoutParams</span> <span class="variable">lp</span> <span class="operator">=</span> InActivity.getWindow().getAttributes();</span><br><span class="line">                lp.layoutInDisplayCutoutMode = WindowManager.LayoutParams.LAYOUT_IN_DISPLAY_CUTOUT_MODE_SHORT_EDGES;</span><br><span class="line">                InActivity.getWindow().setAttributes(lp);</span><br><span class="line">                Log.debug( <span class="string">&quot;call AndroidThunkJava_SetFullScreenDisplayForP&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Add this to GameActivity.java via UPL using <code>&lt;gameActivityClassAdditions&gt;</code>, and invoke it through JNI when the game starts.</p>
<p>Note:</p>
<p><code>layoutInDisplayCutoutMode</code> options include:</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://developer.android.com/reference/android/view/WindowManager.LayoutParams#LAYOUT_IN_DISPLAY_CUTOUT_MODE_ALWAYS">LAYOUT_IN_DISPLAY_CUTOUT_MODE_ALWAYS</a>(Added in <a target="_blank" rel="noopener" href="https://developer.android.com/guide/topics/manifest/uses-sdk-element#ApiLevels">API level 30</a>): Always allows the window to extend into the area of the <code>DisplayCutout</code> on all screen edges.</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://developer.android.com/reference/android/view/WindowManager.LayoutParams#LAYOUT_IN_DISPLAY_CUTOUT_MODE_DEFAULT">LAYOUT_IN_DISPLAY_CUTOUT_MODE_DEFAULT</a>(Added in <a target="_blank" rel="noopener" href="https://developer.android.com/guide/topics/manifest/uses-sdk-element#ApiLevels">API level 28</a>): Allows the window to extend into the <code>DisplayCutout</code> area only when the window is fully contained within the system bar.</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://developer.android.com/reference/android/view/WindowManager.LayoutParams#LAYOUT_IN_DISPLAY_CUTOUT_MODE_NEVER">LAYOUT_IN_DISPLAY_CUTOUT_MODE_NEVER</a>(Added in <a target="_blank" rel="noopener" href="https://developer.android.com/guide/topics/manifest/uses-sdk-element#ApiLevels">API level 28</a>): Never allow the window to overlap with the <code>DisplayCutout</code> area.</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://developer.android.com/reference/android/view/WindowManager.LayoutParams#LAYOUT_IN_DISPLAY_CUTOUT_MODE_SHORT_EDGES">LAYOUT_IN_DISPLAY_CUTOUT_MODE_SHORT_EDGES</a>(Added in <a target="_blank" rel="noopener" href="https://developer.android.com/guide/topics/manifest/uses-sdk-element#ApiLevels">API level 28</a>): Always allows the window to extend into the area of the <code>DisplayCutout</code> on the short edges of the screen.#### External Resources</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://docs.unrealengine.com/zh-CN/Support/Builds/ReleaseNotes/4_23/index.html">UE4.23 Release Notes</a></p>
</li>
</ul>
<h3 id="Restarting-the-App-on-Android"><a href="#Restarting-the-App-on-Android" class="headerlink" title="Restarting the App on Android"></a>Restarting the App on Android</h3><p>Sometimes, after a game update, you need to restart the App for changes to take effect. In UE, you can write the following Java code using UPL:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">AndroidThunkJava_AndroidAPI_RestartApplication</span><span class="params">( )</span> &#123;</span><br><span class="line">	<span class="type">Context</span> <span class="variable">context</span> <span class="operator">=</span> getApplicationContext();</span><br><span class="line">    <span class="type">PackageManager</span> <span class="variable">pm</span> <span class="operator">=</span> context.getPackageManager();</span><br><span class="line">    <span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> pm.getLaunchIntentForPackage(context.getPackageName());</span><br><span class="line">    <span class="type">int</span> <span class="variable">delayTime</span> <span class="operator">=</span> <span class="number">500</span>;</span><br><span class="line">    <span class="type">AlarmManager</span> <span class="variable">alarmManager</span> <span class="operator">=</span> (AlarmManager) context.getSystemService(Context.ALARM_SERVICE);</span><br><span class="line">    <span class="type">PendingIntent</span> <span class="variable">restartIntent</span> <span class="operator">=</span> PendingIntent.getActivity(context, <span class="number">0</span>, intent, PendingIntent.FLAG_CANCEL_CURRENT);</span><br><span class="line">    alarmManager.set(AlarmManager.RTC, System.currentTimeMillis() + delayTime, restartIntent);</span><br><span class="line">    System.exit(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Trigger this through JNI when you need to restart:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">RestartApplication</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> PLATFORM_ANDROID</span></span><br><span class="line">	<span class="keyword">if</span> (JNIEnv* Env = FAndroidApplication::<span class="built_in">GetJavaEnv</span>(<span class="literal">true</span>))</span><br><span class="line">	&#123;</span><br><span class="line">		FJavaWrapper::<span class="built_in">CallVoidMethod</span>(Env, FJavaWrapper::GameActivityThis, AndroidThunkJava_AndroidAPI_RestartApplication);</span><br><span class="line">	&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Common-Issues"><a href="#Common-Issues" class="headerlink" title="Common Issues"></a>Common Issues</h2><h3 id="app-assembleDebug-Error"><a href="#app-assembleDebug-Error" class="headerlink" title="app:assembleDebug Error"></a>app:assembleDebug Error</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UATHelper: Packaging (Android…) ERROR: cmd.exe failed with args /c “[ProjectPath]\Intermediate/Android/APK/gradle/rungradle.bat” :app:assembleDebug</span><br></pre></td></tr></table></figure>
<p>Uncheck the following option:<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/notes/ue/index/UE4/ue4-package-android-error-assdebug.webp"></p>
<p>The <code>Enable Gradle instead of Ant</code> option is no longer present in 4.24+, and the logs indicate that UE failed to download <code>Grade</code> from the internet. You can enable global proxy during packaging. Alternatively, you can use my packaged Gradle version: <a target="_blank" rel="noopener" href="https://stusdnueducn-my.sharepoint.com/:u:/g/personal/2017020625_stu_sdnu_edu_cn/EchGqZT81YdGi_nAncZPrMkBW3DkeGySMHkhWWYA6SaWMg?e=qReHkS">gradle-5.4.1.7z</a> and extract it to the following path:</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\lipengzha\.gradle\wrapper\dists\gradle-5.4.1-all\3221gyojl5jsh0helicew7rwx\gradle-5.4.1</span><br></pre></td></tr></table></figure>

<p>Then create an environment variable <code>GRADLE_HOME</code> that points to this path.</p>
<blockquote>
<p>In certain cases, cleaning the project’s Intermediate directory can also resolve the issue and is worth a try.</p>
</blockquote>
<p>There are also related articles that update Android Tools. The steps are:</p>
<ol>
<li>run NVPACK/android-sdk-windows/tools/android.bat</li>
<li>click on “Deselect All”</li>
<li>update Extras/Android Support Repository</li>
</ol>
<p>Articles:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://answers.unrealengine.com/questions/720605/android-packaging-build-fail-ue-418.html">Android packaging build fail - UE 4.18</a></li>
</ul>
<h3 id="app-packagedebug-Error"><a href="#app-packagedebug-Error" class="headerlink" title="app:packagedebug Error"></a>app:packagedebug Error</h3><p>If you encounter the following error log during packaging:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">execution failed for task &#x27;:app:packagedebug&#x27;.  </span><br><span class="line"> &gt; a failure occurred while executing com.android.build.gradle.internal.tasks.workers$actionfacade   </span><br><span class="line">&gt; out of range: 3185947123</span><br></pre></td></tr></table></figure>
<p>Solution: Delete <code>Intermediate/Android</code> and <code>Intermediate/Build/Android</code> from your project.</p>
<h2 id="Related-Links"><a href="#Related-Links" class="headerlink" title="Related Links"></a>Related Links</h2><ul>
<li><a target="_blank" rel="noopener" href="https://docs.unrealengine.com/en-US/SharingAndReleasing/Mobile/Android/Setup/index.html">Android Project Setup</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.android.com/">Android Developer</a></li>
</ul>

    </div>

    
    
        
        
          
            <blockquote class="blockquote-center">
              
                The article is finished. If you have any questions, please comment and communicate.
              
            <br/>
            
                <div class="qr-code" onclick="return false">
                    <script src="/js/qrcode.min.js"></script>
                    <div id="qrcode">
                      
                        <img src="https://imzlp.com/images/wechat-qrcode.webp">
                      
                    <p>Scan the QR code on WeChat and follow me.</p>
                    </div>
                </div>
            
            </blockquote>
          
        

        
          <div class="postCopyright" style="clear:both;">
             <span>Title:</span><a href="/posts/17996/" target="_blank">UE Development Notes: Android</a><br/>
             <span>Author:</span><a href="/about" target="_blank" title="查看 LIPENGZHA 的资料">LIPENGZHA</a><br/>
             <span>Publish Date:</span>2021/04/15 19:54<br/>
             
             <span>Word Count:</span><span class="page-count">18k Words</span><br/>
             
             <span>Link:</span><a href="/posts/17996/" target="_blank" title="UE Development Notes: Android">https://en.imzlp.com/posts/17996/</a>
             <span class="copy-path" data-clipboard-text="Link: https://en.imzlp.com/posts/17996/ Author: LIPENGZHA" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
             <script src="/js/jquery.min.js"></script>
             <script src="/js/clipboard.min.js"></script>
             <script> var clipboard = new Clipboard('.copy-path'); </script>
             <br/>
             
             <span>License:</span><i class="fab fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" title="Attribution-NonCommercial-ShareAlike 4.0 International">CC BY-NC-SA 4.0</a><br/>
             
             <span>Reprinting of the full article is prohibited.</span>
          </div>
        
    

        
  <div class="reward-container">
    <div>Your donation will encourage me to keep creating!</div>
    <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
      Donate
    </button>
    <div id="qr" style="display: none;">
        
        <div style="display: inline-block;">
          <img src="/images/reward/wechatpay.webp" alt="LIPENGZHA WeChat Pay">
          <p>WeChat Pay</p>
        </div>

    </div>
  </div>



      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/UnrealEngine/" rel="tag"># UnrealEngine</a>
              <a href="/tags/Android/" rel="tag"># Android</a>
              <a href="/tags/UPL/" rel="tag"># UPL</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/posts/24336/" rel="prev" title="UE project optimization: PSO Cache">
      <i class="fa fa-chevron-left"></i> UE project optimization: PSO Cache
    </a></div>
      <div class="post-nav-item">
    <a href="/posts/19135/" rel="next" title="UE Performance Analysis: Memory Optimization">
      UE Performance Analysis: Memory Optimization <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
      <div class="tabs tabs-comment">
        <ul class="nav-tabs">
            <li class="tab"><a href="#comment-utteranc">utteranc</a></li>
            <li class="tab"><a href="#comment-valine">valine</a></li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane utteranc" id="comment-utteranc">
              
  
  <div class="comments">
  <script src="https://utteranc.es/client.js" repo="hxhb/blog-comments" issue-term="pathname" theme="github-light" crossorigin="anonymous" async></script>
  </div>
  
  
            </div>
            <div class="tab-pane valine" id="comment-valine">
              <div class="comments" id="valine-comments"></div>
            </div>
        </div>
      </div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Blog-Articles"><span class="nav-number">1.</span> <span class="nav-text">Blog Articles</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Compilation-Environment"><span class="nav-number">2.</span> <span class="nav-text">Compilation Environment</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Engine-Dependencies-and-Support"><span class="nav-number">3.</span> <span class="nav-text">Engine Dependencies and Support</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Engine-Support-for-Android-Versions"><span class="nav-number">3.1.</span> <span class="nav-text">Engine Support for Android Versions</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SDK-Version-to-Android-Version-Mapping-Table"><span class="nav-number">3.2.</span> <span class="nav-text">SDK Version to Android Version Mapping Table</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Engine-Requirements-for-Android-NDK"><span class="nav-number">3.3.</span> <span class="nav-text">Engine Requirements for Android NDK</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#NDK-Compiler-Versions"><span class="nav-number">3.4.</span> <span class="nav-text">NDK Compiler Versions</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Tools"><span class="nav-number">4.</span> <span class="nav-text">Tools</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ADB"><span class="nav-number">4.1.</span> <span class="nav-text">ADB</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Install-APK"><span class="nav-number">4.1.1.</span> <span class="nav-text">Install APK</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Launch-App"><span class="nav-number">4.1.2.</span> <span class="nav-text">Launch App</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Transfer-Files"><span class="nav-number">4.1.3.</span> <span class="nav-text">Transfer Files</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Logcat"><span class="nav-number">4.1.4.</span> <span class="nav-text">Logcat</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Extract-Installed-APKs-from-the-Device"><span class="nav-number">4.1.5.</span> <span class="nav-text">Extract Installed APKs from the Device</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Flash-Recovery"><span class="nav-number">4.1.6.</span> <span class="nav-text">Flash Recovery</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Port-Forwarding"><span class="nav-number">4.1.7.</span> <span class="nav-text">Port Forwarding</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Check-APK-Location-by-Package-Name"><span class="nav-number">4.1.8.</span> <span class="nav-text">Check APK Location by Package Name</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#View-Package-Name-of-the-Current-Window%E2%80%99s-App"><span class="nav-number">4.1.9.</span> <span class="nav-text">View Package Name of the Current Window’s App</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#View-Symbols-in-SO-Files"><span class="nav-number">4.1.10.</span> <span class="nav-text">View Symbols in SO Files</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SessionFrontEnd-Real-Time-Analysis"><span class="nav-number">4.2.</span> <span class="nav-text">SessionFrontEnd Real-Time Analysis</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Unreal-Insights-Real-Time-Analysis"><span class="nav-number">4.3.</span> <span class="nav-text">Unreal Insights Real-Time Analysis</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Engineering-Practices"><span class="nav-number">5.</span> <span class="nav-text">Engineering Practices</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Link-libraries-that-support-both-armv7-and-arm64"><span class="nav-number">5.1.</span> <span class="nav-text">Link libraries that support both armv7 and arm64</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Android-Runtime-Permission-Requests"><span class="nav-number">5.2.</span> <span class="nav-text">Android Runtime Permission Requests</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Get-Package-Name-on-Android"><span class="nav-number">5.3.</span> <span class="nav-text">Get Package Name on Android</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Get-External-Storage-Path-on-Android"><span class="nav-number">5.4.</span> <span class="nav-text">Get External Storage Path on Android</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Get-Installed-App%E2%80%99s-APK-Path-on-Android"><span class="nav-number">5.5.</span> <span class="nav-text">Get Installed App’s APK Path on Android</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Upgrade-to-AndroidX"><span class="nav-number">5.6.</span> <span class="nav-text">Upgrade to AndroidX</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Adding-External-Storage-Read-Write-Permissions-for-APK"><span class="nav-number">5.7.</span> <span class="nav-text">Adding External Storage Read&#x2F;Write Permissions for APK</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HTTP-Request-Error-on-AndroidP"><span class="nav-number">5.8.</span> <span class="nav-text">HTTP Request Error on AndroidP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Writing-Files-on-Android"><span class="nav-number">5.9.</span> <span class="nav-text">Writing Files on Android</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Android-File-Write-Error-Code-Correspondence"><span class="nav-number">5.10.</span> <span class="nav-text">Android File Write Error Code Correspondence</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UE-Project-Startup-Parameters"><span class="nav-number">5.11.</span> <span class="nav-text">UE Project Startup Parameters</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Android-Set-Aspect-Ratio"><span class="nav-number">5.12.</span> <span class="nav-text">Android Set Aspect Ratio</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#UPL-for-Android"><span class="nav-number">6.</span> <span class="nav-text">UPL for Android</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#All-UPL-in-Android-Project"><span class="nav-number">6.1.</span> <span class="nav-text">All UPL in Android Project</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Deleting-Items-from-AndroidManifest-xml"><span class="nav-number">6.2.</span> <span class="nav-text">Deleting Items from AndroidManifest.xml</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JNI-Call-to-Receive-ActivityResult"><span class="nav-number">6.3.</span> <span class="nav-text">JNI Call to Receive ActivityResult</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Java-Calls-C"><span class="nav-number">6.4.</span> <span class="nav-text">Java Calls C++</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Full-Screen-Adaptation-for-Android-P"><span class="nav-number">6.5.</span> <span class="nav-text">Full-Screen Adaptation for Android P</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Restarting-the-App-on-Android"><span class="nav-number">6.6.</span> <span class="nav-text">Restarting the App on Android</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Common-Issues"><span class="nav-number">7.</span> <span class="nav-text">Common Issues</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#app-assembleDebug-Error"><span class="nav-number">7.1.</span> <span class="nav-text">app:assembleDebug Error</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#app-packagedebug-Error"><span class="nav-number">7.2.</span> <span class="nav-text">app:packagedebug Error</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Related-Links"><span class="nav-number">8.</span> <span class="nav-text">Related Links</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person" oncontextmenu="return false" οndragstart="return false">
    <img class="site-author-image" itemprop="image" alt="LIPENGZHA"
      src="https://img.imzlp.com/imgs/zlp/picgo/2023/202304152112902.webp">
  <p class="site-author-name" itemprop="name">LIPENGZHA</p>
  <div class="site-description" itemprop="description">"I think, therefore I am"</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
             
          <span class="site-state-item-count">190</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">95</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">190</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/hxhb" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;hxhb" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://linkedin.com/in/lipengzha" title="Linkedin → https:&#x2F;&#x2F;linkedin.com&#x2F;in&#x2F;lipengzha" rel="noopener" target="_blank"><i class="fab fa-linkedin fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/imzlp" title="知乎 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;imzlp" rel="noopener" target="_blank"><i class="fa fa-custom zhihu fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/images/wechat-qrcode-offical.webp" title="微信公众号 → &#x2F;images&#x2F;wechat-qrcode-offical.webp"><i class="fab fa-weixin fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:imzlp@foxmail.com" title="E-Mail → mailto:imzlp@foxmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-rss fa-fw"></i></a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://consolehelp.imzlp.com/" title="https:&#x2F;&#x2F;consolehelp.imzlp.com&#x2F;" rel="noopener" target="_blank">UE Console Help</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://imzlp.com/opensource/" title="https:&#x2F;&#x2F;imzlp.com&#x2F;opensource&#x2F;" rel="noopener" target="_blank">Open Source Projects</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://imzlp.com/posts/11515/" title="https:&#x2F;&#x2F;imzlp.com&#x2F;posts&#x2F;11515&#x2F;" rel="noopener" target="_blank">UE C++ API Dash Documents</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://ue5wiki.com/" title="https:&#x2F;&#x2F;ue5wiki.com&#x2F;" rel="noopener" target="_blank">Unreal Engine Wiki</a>
        </li>
    </ul>
  </div>

      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2014 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">LIPENGZHA</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="Symbols count total">1.5m</span>
</div>
  <div class="powered-by-other">
    
	    <center>Github Pages | Actions | NeXT | Cloudflare | Hexo Deploy</center>
      
  </div>

<script>
function checkWebp(callback) {
    var img = new Image();
    img.onload = function () { callback((img.width > 0) && (img.height > 0)); };
    img.onerror = function () { callback(false); };
    img.src = 'data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA';
}
function showImage(useWebp) {
    var imgs = [].slice.call(document.querySelectorAll('img'));
    imgs.forEach(function (e) {
        if (!useWebp) {
            var src = e.getAttribute('data-src')
            src = src.replace(/\.webp$/, '.png');
            e.setAttribute('data-src', src);
        }
    });
}
checkWebp(showImage);
</script>

        








      </div>
    </footer>
  </div>

  
  <script src="//lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/animejs/3.2.1/anime.min.js"></script>
  <script src="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/jquery/3.5.1/jquery.min.js"></script>
  <script src="//lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/fancybox/3.5.7/jquery.fancybox.min.js"></script>
  <script src="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/lozad.js/1.16.0/lozad.min.js"></script>
  <script src="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/pangu/4.0.7/pangu.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>



<script src="/js/code-unfold.js"></script>

  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>




  
<script src="/js/local-search.js"></script>









<script>
document.querySelectorAll('.pdfobject-container').forEach(element => {
  let url = element.dataset.target;
  let pdfOpenParams = {
    navpanes : 0,
    toolbar  : 0,
    statusbar: 0,
    pagemode : 'thumbs',
    view     : 'FitH'
  };
  let pdfOpenFragment = '#' + Object.entries(pdfOpenParams).map(([key, value]) => `${key}=${encodeURIComponent(value)}`).join('&');
  let fullURL = `/lib/pdf/web/viewer.html?file=${encodeURIComponent(url)}${pdfOpenFragment}`;

  if (NexT.utils.supportsPDFs()) {
    element.innerHTML = `<embed class="pdfobject" src="${url + pdfOpenFragment}" type="application/pdf" style="height: ${element.dataset.height};">`;
  } else {
    element.innerHTML = `<iframe src="${fullURL}" style="height: ${element.dataset.height};" frameborder="0"></iframe>`;
  }
});
</script>


<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


  

  

  
  <script src="//img.imzlp.com/imgs/zlp/picgo/2021/quicklink.umd.js"></script>
  <script>
      window.addEventListener('load', () => {
      quicklink({
        timeout : 3000,
        priority: true,
        ignores : [uri => uri.includes('#'),uri => uri === 'https://en.imzlp.com/posts/17996/',]
      });
      });
  </script>


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/valine/1.4.14/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    var requiredFields = 'nick';
    requiredFields = requiredFields.split(',');
    
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'oCE6RMVkVoi5MgUhvFsn1EvV-gzGzoHsz',
      appKey     : 'K9SOaNYJ8PV6xaoFggWG5xvv',
      placeholder: "Leave something behind~",
      avatar     : 'robohash',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : 'en' || 'zh-cn',
      path       : location.pathname,
      recordIP   : true,
      serverURLs : '',
      requiredFields: requiredFields
    });
  }, window.Valine);
});
</script>

</body>
</html>
