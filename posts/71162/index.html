<!DOCTYPE html>
<html lang="en,default">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon-32x32-tilt-brush.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-tilt-brush.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-tilt-brush.png">
  <link rel="mask-icon" href="/images/favicon-32x32-tilt-brush.png" color="#222">
  <meta name="google-site-verification" content="ttIkhAIFZQM9Huj8roB0l95ePN2Tv2zv2wRFksi09WA">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noto Serif SC:300,300italic,400,400italic,700,700italic|Pacifico:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Roboto Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="//lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/5.15.2/css/all.min.css">
  <link rel="stylesheet" href="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/fancybox/3.5.7/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"en.imzlp.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false,"width":280},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"manual"},"fancybox":true,"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":false,"nav":null,"activeClass":"valine"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"code_unfold":{"enable":true,"CODE_MAX_HEIGHT":600},"path":"search.xml"};
  </script>

  <meta name="description" content="In the previous article Design and Implementation of Resource Self-Correction in UE, I introduced the implementation plan of filtering using the asset inspection of ResScannerUE, followed by automated">
<meta property="og:type" content="article">
<meta property="og:title" content="Use reflection to create properties cache for assets in UE">
<meta property="og:url" content="https://en.imzlp.com/posts/71162/index.html">
<meta property="og:site_name" content="Z&#39;s Blog">
<meta property="og:description" content="In the previous article Design and Implementation of Resource Self-Correction in UE, I introduced the implementation plan of filtering using the asset inspection of ResScannerUE, followed by automated">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/picgo/2023/10/24/105204.png">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/picgo/2023/10/24/114517.png">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/picgo/2023/10/24/144553.png">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/picgo/2023/20230918154313.png">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/picgo/2023/10/25/113741.png">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/picgo/2023/10/25/120759.png">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/picgo/2023/20230918153727.png">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/picgo/2023/10/24/172640.png">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/picgo/2023/10/25/115456.png">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/picgo/2023/10/25/122419.png">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/picgo/2023/10/25/132232.png">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/picgo/2023/10/25/132354.png">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/picgo/2023/10/25/142829.png">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/picgo/2023/10/25/143522.png">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/picgo/2023/10/25/150904.png">
<meta property="article:published_time" content="2023-10-25T15:27:37.000Z">
<meta property="article:modified_time" content="2023-10-25T15:27:37.000Z">
<meta property="article:author" content="LIPENGZHA">
<meta property="article:tag" content="UnrealEngine">
<meta property="article:tag" content="反射">
<meta property="article:tag" content="资源管理">
<meta property="article:tag" content="AssetRegistry">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img.imzlp.com/imgs/zlp/picgo/2023/10/24/105204.png">

<link rel="canonical" href="https://en.imzlp.com/posts/71162/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>Use reflection to create properties cache for assets in UE | Z's Blog</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FDCJ41EFP5"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-FDCJ41EFP5');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.staticfile.org/lxgw-wenkai-screen-webfont/1.7.0/style.min.css" /><!-- hexo injector head_end end --><link rel="alternate" href="/atom.xml" title="Z's Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Z's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        
            
  <li class="menu-item menu-item-notes">

    <a href="/notes/" rel="section"><i class="fa fa-edit fa-fw"></i>Notes</a>

  </li>


      
        
            
  <li class="menu-item menu-item-essay">

    <a href="/essay/" rel="section"><i class="fas fa-feather-alt fa-fw"></i>Essay</a>

  </li>


      
        
            
  <li class="menu-item menu-item-resources">

    <a href="/resources/" rel="section"><i class="fa fa-inbox fa-fw"></i>Resources</a>

  </li>


      
        <li class="menu-item menu-item-friends">

    <a href="/friends/" rel="section"><i class="fas fa-link fa-fw"></i>Friends</a>

  </li>
        
            
  <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About Me</a>

  </li>


      
        <li class="menu-item menu-item-showcase">

    <a href="/showcase/" rel="section"><i class="fa fa-solid fa-trophy fa-fw"></i>ShowCase</a>

  </li>
        <li class="menu-item menu-item-changelog">

    <a href="/changelog/" rel="section"><i class="fa fa-history fa-fw"></i>Site Log</a>

  </li>
        <li class="menu-item menu-item-opensource">

    <a href="/opensource/" rel="section"><i class="fas fa-code-branch fa-fw"></i>Open Source</a>

  </li>
        <li class="menu-item menu-item-uewiki">

    <a href="https://ue5wiki.com/" rel="noopener" target="_blank"><i class="fab fa-wikipedia-w fa-fw"></i>Unreal Wiki</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>



<script type="text/javascript">
  let domain='en.imzlp.com';
  let domain_str = atob(domain);
  let pathname = location.pathname;
  if (domain_str!= location.host.toLowerCase()){
        console.log(`this host is not safe,jump to https://${domain_str}${pathname}`);
        location.href=`https://${domain_str}${pathname}`;
  }
</script>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>
  <div class="l10n-header-widget">
    <script>
      // 获取当前页面的 URL
      const currentUrl = window.location.href;
      // 替换 URL 中的部分内容
      const jumpToL10nLink = currentUrl.replace('en.imzlp.com', 'imzlp.com');
      // 将 jumpToL10nLink 绑定到一个全局变量
      window.jumpToL10nLink = jumpToL10nLink;
    </script>

    <a href="#" class="post-l10n-link" title="切换至中文版本" style="float: left;border-bottom: none;" rel="noopener" target="_blank" onclick="window.open(window.jumpToL10nLink, '_blank'); return false;">
      <i class="fa fa-solid fa-language"></i>
    </a>
  </div>



    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en"
  >
    <link itemprop="mainEntityOfPage" href="https://en.imzlp.com/posts/71162/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://img.imzlp.com/imgs/zlp/picgo/2023/202304152112902.webp">
      <meta itemprop="name" content="LIPENGZHA">
      <meta itemprop="description" content=""I think, therefore I am"">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Z's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Use reflection to create properties cache for assets in UE<a href="https://github.com/imzlp/blog-md/blob/en/_posts/2023-10-25-71162.md" class="post-edit-link" title="Edit this post" style="float: right;border-bottom: 0px;" rel="noopener" target="_blank"><i class="fa fa-pen-nib"></i></a><a href="https://imzlp.com/posts/71162/" class="post-l10n-link" title="切换至中文版本" style="float: left;border-bottom: 0px;" rel="noopener" target="_blank"><i class="fa fa-solid fa-language"></i></a>
        </h1>

        
          <div class="post-subtitle" style="text-align: center;line-height: 1;">
            <sub text-align="center" style="font-size: 15px;align-content: center;font-style: italic;bottom: 0em;">UE中利用反射为资产建立属性缓存</sub>
          </div>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-10-25 15:27 15:27:37:27" itemprop="dateCreated datePublished" datetime="2023-10-25T15:27:37+00:00">2023-10-25 15:27</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/UnrealEngine/" itemprop="url" rel="index"><span itemprop="name">UnrealEngine</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/UnrealEngine/%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86/" itemprop="url" rel="index"><span itemprop="name">资源管理</span></a>
                </span>
            </span>

          
            <span id="/posts/71162/" class="post-meta-item leancloud_visitors" data-flag-title="Use reflection to create properties cache for assets in UE" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>8.6k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>22 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>In the previous article <a target="_blank" rel="noopener" href="https://imzlp.com/posts/19901/">Design and Implementation of Resource Self-Correction in UE</a>, I introduced the implementation plan of filtering using the asset inspection of ResScannerUE, followed by automated processing.</p>
<p>Normally, if you want to check a certain property within a resource, you need to load the asset and retrieve the object:<br><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2023/10/24/105204.png"></p>
<p>However, if you want to check the properties of many resources in bulk, loading resources one by one in this way takes a long time, especially in the absence of DDC, where loading resources triggers the construction of DDC cache, which is time-consuming and has a high performance overhead.</p>
<p>As the size of the assets increases, scanning all resources in a project completely can be extraordinarily time-consuming. Therefore, I wonder if it’s possible to implement a method that does not require loading resources but can still retrieve properties within resources.</p>
<p>After research, I found a clever way to achieve this by combining reflection, asset serialization, and the features of AssetRegistry. Moreover, this is a non-intrusive approach that does not require modifying any existing resource type code.</p>
<p>This article will introduce the implementation principles and analyze the related logic in the engine, as well as present the practical application of this mechanism in the project.</p>
<span id="more"></span>

<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>In my initial conception, one of my ideas was to cache the properties of resources during editing separately, recording the UUID value of the cached resource to verify the consistency between the resource and its cache, and then uniformly reading from this cache later.</p>
<p>However, I later abandoned this idea because changes to resources involve many people, and each person has a separate local runtime environment. How should the generated property caches be synchronized? If each machine generates independently, how should conflicts be resolved when multiple people edit the same resource? One problem leads to multiple potential issues, and in this case, it can only serve as a local temporary cache rather than a universal global data source.</p>
<p>Nevertheless, the overall idea of establishing a property cache for assets has not changed. The key is <strong>how to cache properties</strong> to be <strong>shared across the entire project</strong>. The process is as follows:</p>
<p><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2023/10/24/114517.png"></p>
<p>Moreover, it should ideally require no additional management or synchronization cost; the best approach would be completely non-intrusive.</p>
<h2 id="Property-Cache"><a href="#Property-Cache" class="headerlink" title="Property Cache"></a>Property Cache</h2><p>The core part of this article lies in establishing the asset property cache and how to store it.</p>
<p>In UE, it’s possible to cache the values of certain properties. When you hover over a resource in the Content Browser, the asset’s basic information and some properties will pop up in AssetTips:<br><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2023/10/24/144553.png" alt="AnimSequence"></p>
<p><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2023/20230918154313.png" alt="Texture"></p>
<p>The engine can obtain and display these properties and values without loading resources. These properties are marked as <code>AssetRegistrySearchable</code> in the C++ of the respective asset type. Taking <code>UTexture</code> as an example:</p>
<figure class="highlight cpp"><figcaption><span>Engine/Texture.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** A bias to the index of the top mip level to use. */</span></span><br><span class="line"><span class="built_in">UPROPERTY</span>(EditAnywhere, BlueprintReadWrite, Category=LevelOfDetail, meta=(DisplayName=<span class="string">&quot;LOD Bias&quot;</span>), AssetRegistrySearchable)</span><br><span class="line">int32 LODBias;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Compression settings to use when building the texture. */</span></span><br><span class="line"><span class="built_in">UPROPERTY</span>(EditAnywhere, BlueprintReadWrite, Category=Compression, AssetRegistrySearchable)</span><br><span class="line">TEnumAsByte&lt;<span class="keyword">enum</span> <span class="title class_">TextureCompressionSettings</span>&gt; CompressionSettings;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** The texture filtering mode to use when sampling this texture. */</span></span><br><span class="line"><span class="built_in">UPROPERTY</span>(EditAnywhere, BlueprintReadWrite, Category=Texture, AssetRegistrySearchable, AdvancedDisplay)</span><br><span class="line">TEnumAsByte&lt;<span class="keyword">enum</span> <span class="title class_">TextureFilter</span>&gt; Filter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** The texture mip load options. */</span></span><br><span class="line"><span class="built_in">UPROPERTY</span>(EditAnywhere, BlueprintReadWrite, Category = Texture, AssetRegistrySearchable, AdvancedDisplay)</span><br><span class="line">ETextureMipLoadOptions MipLoadOptions;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Texture group this texture belongs to */</span></span><br><span class="line"><span class="built_in">UPROPERTY</span>(EditAnywhere, BlueprintReadWrite, Category=LevelOfDetail, meta=(DisplayName=<span class="string">&quot;Texture Group&quot;</span>), AssetRegistrySearchable)</span><br><span class="line">TEnumAsByte&lt;<span class="keyword">enum</span> <span class="title class_">TextureGroup</span>&gt; LODGroup;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** This should be unchecked if using alpha channels individually as masks. */</span></span><br><span class="line"><span class="built_in">UPROPERTY</span>(EditAnywhere, BlueprintReadWrite, Category=Texture, meta=(DisplayName=<span class="string">&quot;sRGB&quot;</span>), AssetRegistrySearchable)</span><br><span class="line">uint8 SRGB:<span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p>They will be serialized into the uasset upon asset saving and will generate AssetData for the asset at engine startup, adding it to AssetRegistry for quick filtering of assets in the editor (for instance, to display only a certain type of resource), which is also the reason why assets can be quickly searched and filtered in the Content Browser.</p>
<p>I intend to utilize this feature to satisfy the demand for resource property caching.</p>
<h3 id="Property-Reflection-FLAG"><a href="#Property-Reflection-FLAG" class="headerlink" title="Property Reflection FLAG"></a>Property Reflection FLAG</h3><p>As mentioned earlier, the properties displayed in AssetTips are marked as <code>AssetRegistrySearchable</code>, so let’s analyze what the reflection marker <code>UPROPERTY</code> specifically does.</p>
<p>Taking <code>CompressionSettings</code> and <code>SRGB</code> from <code>UTexture</code> as examples:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** Compression settings to use when building the texture. */</span></span><br><span class="line"><span class="built_in">UPROPERTY</span>(EditAnywhere, BlueprintReadWrite, Category=Compression, AssetRegistrySearchable)</span><br><span class="line">TEnumAsByte&lt;<span class="keyword">enum</span> <span class="title class_">TextureCompressionSettings</span>&gt; CompressionSettings;</span><br><span class="line"><span class="comment">/** This should be unchecked if using alpha channels individually as masks. */</span></span><br><span class="line"><span class="built_in">UPROPERTY</span>(EditAnywhere, BlueprintReadWrite, Category=Texture, meta=(DisplayName=<span class="string">&quot;sRGB&quot;</span>), AssetRegistrySearchable)</span><br><span class="line">uint8 SRGB:<span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p>The reflection code generated from these reflection properties is:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// CompressionSettings</span></span><br><span class="line"><span class="type">const</span> UE4CodeGen_Private::FBytePropertyParams Z_Construct_UClass_UTexture_Statics::NewProp_CompressionSettings = &#123; </span><br><span class="line">    <span class="string">&quot;CompressionSettings&quot;</span>, </span><br><span class="line">    <span class="literal">nullptr</span>, </span><br><span class="line">    (EPropertyFlags)<span class="number">0x0010010000000005</span>, </span><br><span class="line">    UE4CodeGen_Private::EPropertyGenFlags::Byte, </span><br><span class="line">    RF_Public|RF_Transient|RF_MarkAsNative, </span><br><span class="line">    <span class="number">1</span>, </span><br><span class="line">    <span class="built_in">STRUCT_OFFSET</span>(UTexture, CompressionSettings), </span><br><span class="line">    Z_Construct_UEnum_Engine_TextureCompressionSettings, </span><br><span class="line">    <span class="built_in">METADATA_PARAMS</span>(Z_Construct_UClass_UTexture_Statics::NewProp_CompressionSettings_MetaData, <span class="built_in">UE_ARRAY_COUNT</span>(Z_Construct_UClass_UTexture_Statics::NewProp_CompressionSettings_MetaData)) </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// SRGB</span></span><br><span class="line"><span class="type">const</span> UE4CodeGen_Private::FBoolPropertyParams Z_Construct_UClass_UTexture_Statics::NewProp_SRGB = &#123; </span><br><span class="line">    <span class="string">&quot;SRGB&quot;</span>, </span><br><span class="line">    <span class="literal">nullptr</span>, </span><br><span class="line">    (EPropertyFlags)<span class="number">0x0010010000000005</span>, </span><br><span class="line">    UE4CodeGen_Private::EPropertyGenFlags::Bool, </span><br><span class="line">    RF_Public|RF_Transient|RF_MarkAsNative, </span><br><span class="line">    <span class="number">1</span>, </span><br><span class="line">    <span class="built_in">sizeof</span>(uint8), </span><br><span class="line">    <span class="built_in">sizeof</span>(UTexture), </span><br><span class="line">    &amp;Z_Construct_UClass_UTexture_Statics::NewProp_SRGB_SetBit, </span><br><span class="line">    <span class="built_in">METADATA_PARAMS</span>(Z_Construct_UClass_UTexture_Statics::NewProp_SRGB_MetaData, <span class="built_in">UE_ARRAY_COUNT</span>(Z_Construct_UClass_UTexture_Statics::NewProp_SRGB_MetaData)) </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>They share a common <code>PropertyFlags</code> value of <code>0x0010010000000005</code>, which is a bitmask storing various FLAG values:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CPF_Edit                         = <span class="number">0x0000000000000001</span>,  <span class="comment">///&lt; Property is user-settable in the editor.</span></span><br><span class="line">CPF_BlueprintVisible             = <span class="number">0x0000000000000004</span>,   <span class="comment">///&lt; This property can be read by blueprint code</span></span><br><span class="line">CPF_AssetRegistrySearchable      = <span class="number">0x0000010000000000</span>,  <span class="comment">///&lt; asset instances will add properties with this flag to the asset registry automatically</span></span><br><span class="line">CPF_NativeAccessSpecifierPublic  = <span class="number">0x0010000000000000</span>,  <span class="comment">///&lt; Public native access specifier</span></span><br></pre></td></tr></table></figure>

<p>These are used to mark the purpose of the reflected property. In this example, it indicates: properties that are editable in the editor, displayed in blueprints, searchable by the AssetRegistry, and are public.</p>
<p>In the editor or other places requiring access to this reflection property, FLAGs can be used to determine whether a particular property should be processed.</p>
<p>Adding the <code>AssetRegistrySearchable</code> marker to the UPROPERTY allows the reflection property to acquire the <code>CPF_AssetRegistrySearchable</code>, enabling it to be identified by the AssetRegistry system and correctly serialized into the uasset.</p>
<h3 id="Serialization"><a href="#Serialization" class="headerlink" title="Serialization"></a>Serialization</h3><p>The previous section mentioned that by adding the <code>AssetRegistrySearchable</code> marker, it allows serialization into the uasset. This section will introduce how the engine implements the storage and reading.</p>
<h4 id="Saving"><a href="#Saving" class="headerlink" title="Saving"></a>Saving</h4><p>When the engine saves a resource, it triggers the serialization of AssetRegistryData, with the call stack as follows:<br><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2023/10/25/113741.png"></p>
<p>During this process, it retrieves the TAG values of all Object properties marked as AssetRegistrySearchable in the current resource and serializes them into the asset:<br><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2023/10/25/120759.png"></p>
<p>The final serialized content of the Tag is:<br><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2023/20230918153727.png"></p>
<p>It is an array in a Key-Value format, where the Key is the string name of the reflection property and the Value is the current resource value for that property, exported in the form of <code>ExportTextureItem</code> (similarly to the implementation ideas in <a target="_blank" rel="noopener" href="https://imzlp.com/posts/19901/#%E9%80%9A%E7%94%A8%E7%9A%84%E5%B1%9E%E6%80%A7%E6%9B%BF%E6%8D%A2%E5%AE%9E%E7%8E%B0">Design and Implementation of Resource Self-Correction in UE#Universal Property Replacement Implementation</a>), achieving universal storage of any property.</p>
<h4 id="Reading"><a href="#Reading" class="headerlink" title="Reading"></a>Reading</h4><p>In the article <a target="_blank" rel="noopener" href="https://imzlp.com/posts/32412/">Resource Management: UASSET Resource Encryption Scheme</a>, I introduced content regarding resource encryption in UE, which includes a section on Package Summary.</p>
<p>In the Summary, there is a dedicated property used to mark the file offset of <code>AssetRegistryData</code> within the current asset:<br><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2023/10/24/172640.png"></p>
<p>Based on this offset, it is possible to directly access <code>AssetRegistryData</code> without fully loading a resource, simply by reading the <code>PackageSummary</code>.<br><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2023/10/25/115456.png"></p>
<p>In <code>FPackageReader::ReadAssetRegistryData</code>, it reads the <code>uasset</code> file and constructs <code>FAssetData</code>:<br><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2023/10/25/122419.png"></p>
<p>Then it adds this to <code>AssetDataList</code>:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create a new FAssetData for this asset and update it with the gathered data</span></span><br><span class="line">AssetDataList.<span class="built_in">Add</span>(</span><br><span class="line">    <span class="keyword">new</span> <span class="built_in">FAssetData</span>(</span><br><span class="line">        <span class="built_in">FName</span>(*PackageName), </span><br><span class="line">        <span class="built_in">FName</span>(*PackagePath), </span><br><span class="line">        <span class="built_in">FName</span>(*AssetName), </span><br><span class="line">        <span class="built_in">FName</span>(*ObjectClassName), </span><br><span class="line">        <span class="built_in">MoveTemp</span>(TagsAndValues), </span><br><span class="line">        PackageFileSummary.ChunkIDs, </span><br><span class="line">        PackageFileSummary.PackageFlags</span><br><span class="line">    )</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>This allows for direct retrieval of the cached resource’s AssetData from AssetRegistry.</p>
<h2 id="Non-Intrusive-Implementation"><a href="#Non-Intrusive-Implementation" class="headerlink" title="Non-Intrusive Implementation"></a>Non-Intrusive Implementation</h2><p>The previous sections introduced how to add the <code>AssetRegistrySearchable</code> reflection property, as well as the logic behind storing during resource saving and loading AssetData from uasset at engine startup.</p>
<p>In simple terms, by adding the <code>AssetRegistrySearchable</code> FLAG to properties, it allows for serialization into the asset without loading resources for access.</p>
<p>This achieves half of the requirements we previously outlined. However, there remains a crucial question: what to do with properties that do not have the <code>AssetRegistrySearchable</code> reflection marker added in the code?<br>If we could only manually add <code>AssetRegistrySearchable</code> to the required properties, we would have to modify its C++ code each time a new property is required. This is unacceptable; making invasive modifications is too limiting.</p>
<p>So, is there a method to dynamically add <code>AssetRegistrySearchable</code> to properties without modifying the code?</p>
<p>Yes! By utilizing UE’s reflection to dynamically modify the FProperty reflection FLAG in UClass, as I previously described in the article <a target="_blank" rel="noopener" href="https://imzlp.com/posts/15049/#%E4%BF%AE%E6%94%B9UClass%E6%8E%A7%E5%88%B6%E5%8F%8D%E5%B0%84%E5%B1%9E%E6%80%A7">UE: Hook UObject#Modify UClass Control Reflection Property</a>.</p>
<p>For the needs of this article, we need to add the <code>CPF_AssetRegistrySearchable</code> FLAG to <code>FProperty</code>:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">FProperty* <span class="title">GetPropertyByName</span><span class="params">(UClass* Class, FName PropertyName)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	FProperty* Property = <span class="literal">nullptr</span>;</span><br><span class="line">	<span class="keyword">for</span>(TFieldIterator&lt;FProperty&gt; <span class="built_in">PropertyIter</span>(Class);PropertyIter;++PropertyIter)</span><br><span class="line">	&#123;</span><br><span class="line">		FProperty* PropertyIns = *PropertyIter;</span><br><span class="line">		<span class="keyword">if</span>(PropertyIns-&gt;<span class="built_in">GetName</span>().<span class="built_in">Equals</span>(PropertyName.<span class="built_in">ToString</span>()))</span><br><span class="line">		&#123;</span><br><span class="line">			Property = PropertyIns;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> Property;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">AddAssetRegistrySearchableToProperty</span><span class="params">(UClass* Class, <span class="type">const</span> FString&amp; PropertyName,</span></span></span><br><span class="line"><span class="params"><span class="function">	<span class="type">bool</span> bSearchable)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	FProperty* Property = <span class="built_in">GetPropertyByName</span>(Class,*PropertyName);</span><br><span class="line">	<span class="keyword">if</span>(!Property-&gt;<span class="built_in">HasAnyPropertyFlags</span>(EPropertyFlags::CPF_AssetRegistrySearchable))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(bSearchable)</span><br><span class="line">		&#123;</span><br><span class="line">			Property-&gt;<span class="built_in">SetPropertyFlags</span>(EPropertyFlags::CPF_AssetRegistrySearchable);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			Property-&gt;<span class="built_in">ClearPropertyFlags</span>(EPropertyFlags::CPF_AssetRegistrySearchable);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Based on the analysis of serializing AssetRegistryData during resource saving, we simply need to modify the UClass of the resource type before actually saving it.</p>
<p>Taking <code>BoneCompressionSettings</code> from <code>AnimSequence</code> as an example, it does not have the <code>AssetRegistrySearchable</code> marker added:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** The bone compression settings used to compress bones in this sequence. */</span>  </span><br><span class="line"><span class="built_in">UPROPERTY</span>(Category = Compression, EditAnywhere, meta = (ForceShowEngineContent))  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UAnimBoneCompressionSettings</span>* BoneCompressionSettings;</span><br></pre></td></tr></table></figure>

<p>During engine runtime, we can execute the following code:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">AddAssetRegistrySearchableToProperty</span>(UAnimSequence::<span class="built_in">StaticClass</span>(),<span class="built_in">TEXT</span>(<span class="string">&quot;BoneCompressionSettings&quot;</span>),<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<p>Then save the asset, in <code>GetAssetRegistryTagFromProperty</code>, it will detect that it has the <code>CPF_AssetRegistrySearchable</code> FLAG:<br><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2023/10/25/132232.png"></p>
<p>And it can export the actual property value as a string:<br><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2023/10/25/132354.png"></p>
<p>This allows us to perfectly meet our requirement to serialize certain properties into the asset.</p>
<h2 id="Reuse-and-Consistency"><a href="#Reuse-and-Consistency" class="headerlink" title="Reuse and Consistency"></a>Reuse and Consistency</h2><p>Since AssetData is directly serialized into the asset, it will be updated with each resource saving. Therefore, as long as the latest resource can be updated, the accuracy of its property values can be ensured.</p>
<p>Moreover, for collaboration, each person will save their modified resources. If conflicts arise between resources from different submissions, version control can resolve this. This can ensure consistency between the resources in the remote repository and their cached property values (all stored within a single uasset file), preventing confusion.</p>
<p><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2023/10/25/142829.png"></p>
<h2 id="Caching-Property-Reading"><a href="#Caching-Property-Reading" class="headerlink" title="Caching Property Reading"></a>Caching Property Reading</h2><p>Now that the property caching for assets has been fully implemented, how can it be applied?</p>
<p><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2023/10/25/143522.png"></p>
<p>In the application of ResScanner:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> GetPropertyValueByName = [&amp;Rule,<span class="keyword">this</span>](<span class="type">const</span> FAssetData&amp; AssetData,<span class="type">const</span> FString&amp; PropertyName)  </span><br><span class="line">&#123;  </span><br><span class="line">    FString AssetDataTagValue;  </span><br><span class="line">    <span class="keyword">if</span>(!AssetData.<span class="built_in">GetTagValue</span>(*PropertyName,AssetDataTagValue))  </span><br><span class="line">    &#123;       </span><br><span class="line">        AssetDataTagValue = UFlibAssetParseHelper::<span class="built_in">GetPropertyValueByName</span>(<span class="built_in">GetPropertyOwning</span>(AssetData,Rule),PropertyName);  </span><br><span class="line">    &#125;    </span><br><span class="line">    <span class="keyword">return</span> AssetDataTagValue;  </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>The resources are only loaded when property values cannot be obtained from TagsAndValues.</p>
<p>For ResScannerUE, there may be many rules for property inspection. Before the scanning module starts, all rules containing property checks will be automatically retrieved, and <code>CPF_AssetRegistrySearchable</code> will be added to the properties to be checked. Regardless of how many rules are added, it can achieve a non-intrusive effect.</p>
<p><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2023/10/25/150904.png"></p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>Some of the knowledge involved in this article is summarized and analyzed more specifically in other articles on the blog and can serve as extended reading.</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://imzlp.com/posts/19901/#%E9%80%9A%E7%94%A8%E7%9A%84%E5%B1%9E%E6%80%A7%E6%9B%BF%E6%8D%A2%E5%AE%9E%E7%8E%B0">Design and Implementation of Resource Self-Correction in UE#Universal Property Replacement Implementation</a></li>
<li><a target="_blank" rel="noopener" href="https://imzlp.com/posts/9780/">UE Reflection Implementation Analysis: Reflection Code Generation (1)</a></li>
<li><a target="_blank" rel="noopener" href="https://imzlp.com/posts/12624/">UE Reflection Implementation Analysis: Basic Concepts</a></li>
<li><a target="_blank" rel="noopener" href="https://imzlp.com/posts/15049/#%E4%BF%AE%E6%94%B9UClass%E6%8E%A7%E5%88%B6%E5%8F%8D%E5%B0%84%E5%B1%9E%E6%80%A7">UE: Hook UObject#Modify UClass Control Reflection Property</a></li>
</ul>
<p>This article analyzes and utilizes engine features such as type reflection, asset serialization, and AssetRegistry data generation, and combines them to implement a non-intrusive mechanism for caching resource properties without modifying any existing resource type code.</p>
<p>By allowing access to properties within resources without loading the resources, the demand for “resource property checks” will not lead to significant increases in check duration due to the expansion of resource scale, nor will it generate issues during scans when the local environment lacks DDC, thus greatly enhancing the checking efficiency.</p>

    </div>

    
    
        
        
          
            <blockquote class="blockquote-center">
              
                The article is finished. If you have any questions, please comment and communicate.
              
            <br/>
            
                <div class="qr-code" onclick="return false">
                    <script src="/js/qrcode.min.js"></script>
                    <div id="qrcode">
                      
                        <img src="https://imzlp.com/images/wechat-qrcode.webp">
                      
                    <p>Scan the QR code on WeChat and follow me.</p>
                    </div>
                </div>
            
            </blockquote>
          
        

        
          <div class="postCopyright" style="clear:both;">
             <span>Title:</span><a href="/posts/71162/" target="_blank">Use reflection to create properties cache for assets in UE</a><br/>
             <span>Author:</span><a href="/about" target="_blank" title="查看 LIPENGZHA 的资料">LIPENGZHA</a><br/>
             <span>Publish Date:</span>2023/10/25 15:27<br/>
             
             <span>Word Count:</span><span class="page-count">8.6k Words</span><br/>
             
             <span>Link:</span><a href="/posts/71162/" target="_blank" title="Use reflection to create properties cache for assets in UE">https://en.imzlp.com/posts/71162/</a>
             <span class="copy-path" data-clipboard-text="Link: https://en.imzlp.com/posts/71162/ Author: LIPENGZHA" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
             <script src="/js/jquery.min.js"></script>
             <script src="/js/clipboard.min.js"></script>
             <script> var clipboard = new Clipboard('.copy-path'); </script>
             <br/>
             
             <span>License:</span><i class="fab fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" title="Attribution-NonCommercial-ShareAlike 4.0 International">CC BY-NC-SA 4.0</a><br/>
             
             <span>Reprinting of the full article is prohibited.</span>
          </div>
        
    

        
  <div class="reward-container">
    <div>Your donation will encourage me to keep creating!</div>
    <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
      Donate
    </button>
    <div id="qr" style="display: none;">
        
        <div style="display: inline-block;">
          <img src="/images/reward/wechatpay.webp" alt="LIPENGZHA WeChat Pay">
          <p>WeChat Pay</p>
        </div>

    </div>
  </div>



      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/UnrealEngine/" rel="tag"># UnrealEngine</a>
              <a href="/tags/%E5%8F%8D%E5%B0%84/" rel="tag"># 反射</a>
              <a href="/tags/%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86/" rel="tag"># 资源管理</a>
              <a href="/tags/AssetRegistry/" rel="tag"># AssetRegistry</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/posts/35791/" rel="prev" title="Macau Travel Guide">
      <i class="fa fa-chevron-left"></i> Macau Travel Guide
    </a></div>
      <div class="post-nav-item">
    <a href="/posts/19901/" rel="next" title="Implementation scheme of resource self-correction in UE">
      Implementation scheme of resource self-correction in UE <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
      <div class="tabs tabs-comment">
        <ul class="nav-tabs">
            <li class="tab"><a href="#comment-utteranc">utteranc</a></li>
            <li class="tab"><a href="#comment-valine">valine</a></li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane utteranc" id="comment-utteranc">
              
  
  <div class="comments">
  <script src="https://utteranc.es/client.js" repo="hxhb/blog-comments" issue-term="pathname" theme="github-light" crossorigin="anonymous" async></script>
  </div>
  
  
            </div>
            <div class="tab-pane valine" id="comment-valine">
              <div class="comments" id="valine-comments"></div>
            </div>
        </div>
      </div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Introduction"><span class="nav-number">1.</span> <span class="nav-text">Introduction</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Property-Cache"><span class="nav-number">2.</span> <span class="nav-text">Property Cache</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Property-Reflection-FLAG"><span class="nav-number">2.1.</span> <span class="nav-text">Property Reflection FLAG</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Serialization"><span class="nav-number">2.2.</span> <span class="nav-text">Serialization</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Saving"><span class="nav-number">2.2.1.</span> <span class="nav-text">Saving</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Reading"><span class="nav-number">2.2.2.</span> <span class="nav-text">Reading</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Non-Intrusive-Implementation"><span class="nav-number">3.</span> <span class="nav-text">Non-Intrusive Implementation</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Reuse-and-Consistency"><span class="nav-number">4.</span> <span class="nav-text">Reuse and Consistency</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Caching-Property-Reading"><span class="nav-number">5.</span> <span class="nav-text">Caching Property Reading</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Conclusion"><span class="nav-number">6.</span> <span class="nav-text">Conclusion</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person" oncontextmenu="return false" οndragstart="return false">
    <img class="site-author-image" itemprop="image" alt="LIPENGZHA"
      src="https://img.imzlp.com/imgs/zlp/picgo/2023/202304152112902.webp">
  <p class="site-author-name" itemprop="name">LIPENGZHA</p>
  <div class="site-description" itemprop="description">"I think, therefore I am"</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
             
          <span class="site-state-item-count">190</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">95</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">190</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/hxhb" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;hxhb" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://linkedin.com/in/lipengzha" title="Linkedin → https:&#x2F;&#x2F;linkedin.com&#x2F;in&#x2F;lipengzha" rel="noopener" target="_blank"><i class="fab fa-linkedin fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/imzlp" title="知乎 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;imzlp" rel="noopener" target="_blank"><i class="fa fa-custom zhihu fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/images/wechat-qrcode-offical.webp" title="微信公众号 → &#x2F;images&#x2F;wechat-qrcode-offical.webp"><i class="fab fa-weixin fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:imzlp@foxmail.com" title="E-Mail → mailto:imzlp@foxmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-rss fa-fw"></i></a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://consolehelp.imzlp.com/" title="https:&#x2F;&#x2F;consolehelp.imzlp.com&#x2F;" rel="noopener" target="_blank">UE Console Help</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://imzlp.com/opensource/" title="https:&#x2F;&#x2F;imzlp.com&#x2F;opensource&#x2F;" rel="noopener" target="_blank">Open Source Projects</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://imzlp.com/posts/11515/" title="https:&#x2F;&#x2F;imzlp.com&#x2F;posts&#x2F;11515&#x2F;" rel="noopener" target="_blank">UE C++ API Dash Documents</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://ue5wiki.com/" title="https:&#x2F;&#x2F;ue5wiki.com&#x2F;" rel="noopener" target="_blank">Unreal Engine Wiki</a>
        </li>
    </ul>
  </div>

      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2014 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">LIPENGZHA</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="Symbols count total">1.5m</span>
</div>
  <div class="powered-by-other">
    
	    <center>Github Pages | Actions | NeXT | Cloudflare | Hexo Deploy</center>
      
  </div>

<script>
function checkWebp(callback) {
    var img = new Image();
    img.onload = function () { callback((img.width > 0) && (img.height > 0)); };
    img.onerror = function () { callback(false); };
    img.src = 'data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA';
}
function showImage(useWebp) {
    var imgs = [].slice.call(document.querySelectorAll('img'));
    imgs.forEach(function (e) {
        if (!useWebp) {
            var src = e.getAttribute('data-src')
            src = src.replace(/\.webp$/, '.png');
            e.setAttribute('data-src', src);
        }
    });
}
checkWebp(showImage);
</script>

        








      </div>
    </footer>
  </div>

  
  <script src="//lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/animejs/3.2.1/anime.min.js"></script>
  <script src="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/jquery/3.5.1/jquery.min.js"></script>
  <script src="//lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/fancybox/3.5.7/jquery.fancybox.min.js"></script>
  <script src="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/lozad.js/1.16.0/lozad.min.js"></script>
  <script src="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/pangu/4.0.7/pangu.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>



<script src="/js/code-unfold.js"></script>

  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>




  
<script src="/js/local-search.js"></script>









<script>
document.querySelectorAll('.pdfobject-container').forEach(element => {
  let url = element.dataset.target;
  let pdfOpenParams = {
    navpanes : 0,
    toolbar  : 0,
    statusbar: 0,
    pagemode : 'thumbs',
    view     : 'FitH'
  };
  let pdfOpenFragment = '#' + Object.entries(pdfOpenParams).map(([key, value]) => `${key}=${encodeURIComponent(value)}`).join('&');
  let fullURL = `/lib/pdf/web/viewer.html?file=${encodeURIComponent(url)}${pdfOpenFragment}`;

  if (NexT.utils.supportsPDFs()) {
    element.innerHTML = `<embed class="pdfobject" src="${url + pdfOpenFragment}" type="application/pdf" style="height: ${element.dataset.height};">`;
  } else {
    element.innerHTML = `<iframe src="${fullURL}" style="height: ${element.dataset.height};" frameborder="0"></iframe>`;
  }
});
</script>


<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


  

  

  
  <script src="//img.imzlp.com/imgs/zlp/picgo/2021/quicklink.umd.js"></script>
  <script>
      window.addEventListener('load', () => {
      quicklink({
        timeout : 3000,
        priority: true,
        ignores : [uri => uri.includes('#'),uri => uri === 'https://en.imzlp.com/posts/71162/',]
      });
      });
  </script>


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/valine/1.4.14/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    var requiredFields = 'nick';
    requiredFields = requiredFields.split(',');
    
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'oCE6RMVkVoi5MgUhvFsn1EvV-gzGzoHsz',
      appKey     : 'K9SOaNYJ8PV6xaoFggWG5xvv',
      placeholder: "Leave something behind~",
      avatar     : 'robohash',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : 'en' || 'zh-cn',
      path       : location.pathname,
      recordIP   : true,
      serverURLs : '',
      requiredFields: requiredFields
    });
  }, window.Valine);
});
</script>

</body>
</html>
