<!DOCTYPE html>
<html lang="en,default">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon-32x32-tilt-brush.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-tilt-brush.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-tilt-brush.png">
  <link rel="mask-icon" href="/images/favicon-32x32-tilt-brush.png" color="#222">
  <meta name="google-site-verification" content="ttIkhAIFZQM9Huj8roB0l95ePN2Tv2zv2wRFksi09WA">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noto Serif SC:300,300italic,400,400italic,700,700italic|Pacifico:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Roboto Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="//lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/5.15.2/css/all.min.css">
  <link rel="stylesheet" href="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/fancybox/3.5.7/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"en.imzlp.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false,"width":280},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"manual"},"fancybox":true,"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":false,"nav":null,"activeClass":"valine"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"code_unfold":{"enable":true,"CODE_MAX_HEIGHT":600},"path":"search.xml"};
  </script>

  <meta name="description" content="I previously wrote an article introducing UE’s default unpacking method (UE Hot Update: Splitting the Base Package), but the default unpacking method in UE is not flexible enough for large-scale resou">
<meta property="og:type" content="article">
<meta property="og:title" content="Resource Management: Reshaping UnrealEngine Subcontracting Solution">
<meta property="og:url" content="https://en.imzlp.com/posts/37036/index.html">
<meta property="og:site_name" content="Z&#39;s Blog">
<meta property="og:description" content="I previously wrote an article introducing UE’s default unpacking method (UE Hot Update: Splitting the Base Package), but the default unpacking method in UE is not flexible enough for large-scale resou">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/picgo/2023/20230220171922.webp">
<meta property="article:published_time" content="2023-03-15T11:24:32.000Z">
<meta property="article:modified_time" content="2023-03-15T11:24:32.000Z">
<meta property="article:author" content="LIPENGZHA">
<meta property="article:tag" content="UnrealEngine">
<meta property="article:tag" content="热更新">
<meta property="article:tag" content="资源管理">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img.imzlp.com/imgs/zlp/picgo/2023/20230220171922.webp">

<link rel="canonical" href="https://en.imzlp.com/posts/37036/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>Resource Management: Reshaping UnrealEngine Subcontracting Solution | Z's Blog</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FDCJ41EFP5"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-FDCJ41EFP5');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.staticfile.org/lxgw-wenkai-screen-webfont/1.7.0/style.min.css" /><!-- hexo injector head_end end --><link rel="alternate" href="/atom.xml" title="Z's Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Z's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        
            
  <li class="menu-item menu-item-notes">

    <a href="/notes/" rel="section"><i class="fa fa-edit fa-fw"></i>Notes</a>

  </li>


      
        
            
  <li class="menu-item menu-item-essay">

    <a href="/essay/" rel="section"><i class="fas fa-feather-alt fa-fw"></i>Essay</a>

  </li>


      
        
            
  <li class="menu-item menu-item-resources">

    <a href="/resources/" rel="section"><i class="fa fa-inbox fa-fw"></i>Resources</a>

  </li>


      
        <li class="menu-item menu-item-friends">

    <a href="/friends/" rel="section"><i class="fas fa-link fa-fw"></i>Friends</a>

  </li>
        
            
  <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About Me</a>

  </li>


      
        <li class="menu-item menu-item-showcase">

    <a href="/showcase/" rel="section"><i class="fa fa-solid fa-trophy fa-fw"></i>ShowCase</a>

  </li>
        <li class="menu-item menu-item-changelog">

    <a href="/changelog/" rel="section"><i class="fa fa-history fa-fw"></i>Site Log</a>

  </li>
        <li class="menu-item menu-item-opensource">

    <a href="/opensource/" rel="section"><i class="fas fa-code-branch fa-fw"></i>Open Source</a>

  </li>
        <li class="menu-item menu-item-uewiki">

    <a href="https://ue5wiki.com/" rel="noopener" target="_blank"><i class="fab fa-wikipedia-w fa-fw"></i>Unreal Wiki</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>



<script type="text/javascript">
  let domain='en.imzlp.com';
  let domain_str = atob(domain);
  let pathname = location.pathname;
  if (domain_str!= location.host.toLowerCase()){
        console.log(`this host is not safe,jump to https://${domain_str}${pathname}`);
        location.href=`https://${domain_str}${pathname}`;
  }
</script>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>
  <div class="l10n-header-widget">
    <script>
      // 获取当前页面的 URL
      const currentUrl = window.location.href;
      // 替换 URL 中的部分内容
      const jumpToL10nLink = currentUrl.replace('en.imzlp.com', 'imzlp.com');
      // 将 jumpToL10nLink 绑定到一个全局变量
      window.jumpToL10nLink = jumpToL10nLink;
    </script>

    <a href="#" class="post-l10n-link" title="切换至中文版本" style="float: left;border-bottom: none;" rel="noopener" target="_blank" onclick="window.open(window.jumpToL10nLink, '_blank'); return false;">
      <i class="fa fa-solid fa-language"></i>
    </a>
  </div>



    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en"
  >
    <link itemprop="mainEntityOfPage" href="https://en.imzlp.com/posts/37036/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://img.imzlp.com/imgs/zlp/picgo/2023/202304152112902.webp">
      <meta itemprop="name" content="LIPENGZHA">
      <meta itemprop="description" content=""I think, therefore I am"">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Z's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Resource Management: Reshaping UnrealEngine Subcontracting Solution<a href="https://github.com/imzlp/blog-md/blob/en/_posts/2023-03-15-37036.md" class="post-edit-link" title="Edit this post" style="float: right;border-bottom: 0px;" rel="noopener" target="_blank"><i class="fa fa-pen-nib"></i></a><a href="https://imzlp.com/posts/37036/" class="post-l10n-link" title="切换至中文版本" style="float: left;border-bottom: 0px;" rel="noopener" target="_blank"><i class="fa fa-solid fa-language"></i></a>
        </h1>

        
          <div class="post-subtitle" style="text-align: center;line-height: 1;">
            <sub text-align="center" style="font-size: 15px;align-content: center;font-style: italic;bottom: 0em;">资源管理：重塑UE的包拆分方案</sub>
          </div>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-03-15 11:24 11:24:32:24" itemprop="dateCreated datePublished" datetime="2023-03-15T11:24:32+00:00">2023-03-15 11:24</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/UnrealEngine/" itemprop="url" rel="index"><span itemprop="name">UnrealEngine</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/UnrealEngine/%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86/" itemprop="url" rel="index"><span itemprop="name">资源管理</span></a>
                </span>
            </span>

          
            <span id="/posts/37036/" class="post-meta-item leancloud_visitors" data-flag-title="Resource Management: Reshaping UnrealEngine Subcontracting Solution" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>10k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>26 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>I previously wrote an article introducing UE’s default unpacking method (<a target="_blank" rel="noopener" href="https://imzlp.com/posts/13765/">UE Hot Update: Splitting the Base Package</a>), but the default unpacking method in UE is not flexible enough for large-scale resource projects and cannot meet the refined management needs of super-large-scale resource projects.</p>
<p>To address the issues with <a target="_blank" rel="noopener" href="https://imzlp.com/posts/37036/#UE%E9%BB%98%E8%AE%A4%E6%89%93%E5%8C%85%E7%9A%84%E9%97%AE%E9%A2%98">UE’s default packaging and resource splitting pain points</a>, I developed an extension based on HotPatcherCore that can solve the drawbacks of the default unpacking process, making it sufficiently flexible and powerful. There’s an article on the blog that introduces its overall implementation mechanism: <a target="_blank" rel="noopener" href="https://imzlp.com/posts/24350/">A Flexible and Non-Intrusive Base Package Splitting Solution</a>.</p>
<p>HotChunker can be integrated into UE’s default packaging process non-intrusively, requiring no manual handling. As long as the default UE packaging is done, it will automatically trigger HotChunker’s unpacking process, achieving resource cooking, packaging, and automatic copying to the StagedBuilds directory.</p>
<p>This article will focus on how to configure resource splitting using HotChunker, automate builds, minimize resource redundancy, and implement parallel packaging.</p>
<span id="more"></span>

<h2 id="Issues-with-UE’s-Default-Packaging"><a href="#Issues-with-UE’s-Default-Packaging" class="headerlink" title="Issues with UE’s Default Packaging"></a>Issues with UE’s Default Packaging</h2><p>The <code>CookerOnTheFly</code> - <code>UnrealPak</code> mode used by UE has some inherent issues:</p>
<ol>
<li>Cannot precisely package and flexibly control custom unpacking behaviors</li>
<li>No cross-platform universal pak entry filtering mechanism (only Android’s <code>ObbFilter</code>)</li>
<li>Strong dependency on the Cook process, unable to package a single Chunk independently</li>
<li>Difficult to perform programmatic unpacking conveniently</li>
<li>Cannot configure Chunks to include Not-uasset files</li>
<li>All Not-uasset files are in Chunk 0</li>
<li>Unable to split Metadatas based on Chunks</li>
</ol>
<p>The implementation of HotChunker can effectively address the above issues, making each Chunk self-contained:</p>
<p><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2023/20230228200915.webp"></p>
<p>The final effect for UE’s packaged resource configuration allows only the most basic resources to be managed and packaged by UE, while the rest can be split through HotChunker’s configuration.</p>
<p><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2023/20230315143842.webp"></p>
<p>The following part of the article will discuss how to configure this.</p>
<h2 id="Chunk-Configuration"><a href="#Chunk-Configuration" class="headerlink" title="Chunk Configuration"></a>Chunk Configuration</h2><p>The configuration of Chunks is the smallest unit for package splitting. In UE, each Chunk will be packaged into a separate pak file.</p>
<p>For HotChunker implementations, the configuration of a single Chunk can include the following attributes:<br><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2023/20230228203921.webp"></p>
<p>The resource configuration of a Chunk provides two modes: Rule/Getter, used to <strong>specify the resource path for packaging</strong> or <strong>programmatically obtain it from code</strong>.</p>
<p>Each Chunk can add external files as well as control the serialization of shaders, asset registry serialization, etc. Moreover, the Chunk’s metadata is self-contained, most notably reducing the size of the Shader Library within the installation package.</p>
<p>By default, the shaders of a UE packaged project are serialized into the same file, which is included in pakchunk0, meaning that the complete Shader of the entire project is within the installation package. As the resource scale increases, the size of the Shader Library can become extremely large, potentially reaching hundreds of MB. Making each Chunk’s Shader self-contained can effectively mitigate this issue. Coupled with my previous <a target="_blank" rel="noopener" href="https://imzlp.com/posts/26943/">Efficient ZSTD Shader Dictionary Training Solution</a>, it maximizes the reduction of Shader Library size and enables on-demand downloading of shaders.</p>
<h3 id="Rule"><a href="#Rule" class="headerlink" title="Rule"></a>Rule</h3><p>The Rule mode configuration is similar to that of HotPatcher, allowing specification of included paths, resources, and ignored resources.</p>
<p><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2023/20230315124916.webp"></p>
<p>This mode is suitable for configuring relatively fixed resources, such as packaging a specific directory or a particular map.</p>
<h3 id="Getter"><a href="#Getter" class="headerlink" title="Getter"></a>Getter</h3><p>In addition to directly specifying resources, I have also provided a Getter configuration mode that allows you to specify a class inheriting from <code>UHPLGetter</code> to dynamically obtain resources managed by the Chunk from code.</p>
<p><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2023/20230315130036.webp"></p>
<p>This mode was designed to establish a direct correspondence with the configurations by planners. It allows planning-based configurations to control packaging.</p>
<p>For example, the current version includes which maps and character classes, etc. These configurations will change continuously with the development process, and the data source is with the planners. In UE’s default method, modifications to packaging configurations still need to be made within the project.</p>
<p>However, HotChunker establishes a correspondence between <strong>packaging</strong> and <strong>planning configurations</strong> through this Getter configuration method, enabling planners to directly control which resources are packaged.</p>
<h2 id="Chunk-Management"><a href="#Chunk-Management" class="headerlink" title="Chunk Management"></a>Chunk Management</h2><h3 id="HPL-Resources"><a href="#HPL-Resources" class="headerlink" title="HPL Resources"></a>HPL Resources</h3><p>Similar to PrimaryLabel, I added an equivalent configuration for Chunk which I call <code>HPL</code> (HotPatcherPrimaryLabel).</p>
<p>You can create an HPL resource to edit the resources to be packaged; each HPL is an independent Chunk.<br><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2023/20230228202219.webp"></p>
<p><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2023/20230228202419.webp"></p>
<p>During packaging, you need to add the scan paths in <code>Project Settings</code> - <code>Plugins</code> - <code>HotChunker</code>:</p>
<p><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2023/20230228202942.webp"></p>
<p>In HotChunker packaging, it will automatically scan all configured directories for HPL resources for packaging.</p>
<h3 id="DataTable"><a href="#DataTable" class="headerlink" title="DataTable"></a>DataTable</h3><p>If you want to create multiple Chunks, you can create multiple HPL resources, but for easier management, I also support DataTable configuration.<br>Select to create a DataTable, and choose <code>HPLChunkSetting</code> for <code>RoleStructure</code>:<br><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2023/20230228204447.webp"></p>
<p>Open the editor, each element is an independent HPL Chunk configuration:<br><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2023/20230228202600.webp"></p>
<p>Additionally, I have added a dedicated packaging button for the HPL DataTable, allowing you to directly select which Chunk to package from the table interface:<br><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2023/20230228203107.webp"><br>It will trigger a separate process to execute without blocking the current editor.<br><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2023/20230228203252.webp"></p>
<p>Similarly, when a HPL DataTable is created and needs to be included in packaging, you need to add the <code>ImportRuleTables</code> configuration in <code>Project Settings</code> - <code>Plugins</code> - <code>HotChunker</code>:<br><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2023/20230228204359.webp"></p>
<h3 id="Dynamic-Registration"><a href="#Dynamic-Registration" class="headerlink" title="Dynamic Registration"></a>Dynamic Registration</h3><p>To achieve programmatic automated sub-packaging, I have added a dynamic registration mechanism for the splitting configuration. Simply bind the Delegate:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FHotChunkerDelegates::OnNotyfyChunkRegister.<span class="built_in">AddStatic</span>(&amp;FGameEditorModule::OnNotyfyChunkRegister);</span><br></pre></td></tr></table></figure>
<p>In this function, register the Chunk:<br><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2023/20230228202005.webp"></p>
<p>Through dynamic registration or the previously mentioned Getter mechanism, the planning configuration can be correlated with the packaging, allowing you to automatically control which resources to package according to the planning configuration, liberating programmers from configuration tasks.</p>
<h2 id="Editor-Support"><a href="#Editor-Support" class="headerlink" title="Editor Support"></a>Editor Support</h2><p>I provide editor options for Chunk’s DT configuration, conveniently allowing the selection of a specific Chunk for packaging. During development, artists can easily package the resources they need, avoiding wait times for packaging.</p>
<ol>
<li>Package a single Chunk</li>
<li>Package all Chunks in the DT</li>
<li>Import/Export Chunk configurations</li>
<li>Non-blocking editor</li>
</ol>
<p><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2023/20230315130612.webp"></p>
<h2 id="Global-Configuration-and-Process-Extension"><a href="#Global-Configuration-and-Process-Extension" class="headerlink" title="Global Configuration and Process Extension"></a>Global Configuration and Process Extension</h2><p>In <code>Project Settings</code> - <code>Plugins</code> - <code>HotChunker</code>, global configurations and logical replacements (ChunkerManager) can be made.</p>
<ol>
<li>HPL scan path</li>
<li>Chunk Rule DT configuration</li>
<li>Pak Setting</li>
<li>Feature switches</li>
<li>Replace ChunkerManager</li>
<li>Global Overriding</li>
</ol>
<p><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2023/20230315120919.webp"></p>
<h3 id="Intervening-at-Various-Stages-of-Chunker"><a href="#Intervening-at-Various-Stages-of-Chunker" class="headerlink" title="Intervening at Various Stages of Chunker"></a>Intervening at Various Stages of Chunker</h3><p>To achieve sufficient flexibility, during implementation, I left many points open for intervention at various stages of Chunk packaging.</p>
<ol>
<li>Resource analysis and processing on demand</li>
<li>Retrieve packaging status and results</li>
<li>Get complete Manifest information</li>
<li>Perform package audits</li>
</ol>
<p>Within the framework, various analysis requirements of the project can be implemented non-intrusively.</p>
<p><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2023/20230228203716.webp"></p>
<h2 id="Redundancy-Control"><a href="#Redundancy-Control" class="headerlink" title="Redundancy Control"></a>Redundancy Control</h2><p>I introduced the situation where priority does not take effect when packaging through UE’s default unpacking form in <a target="_blank" rel="noopener" href="https://imzlp.com/posts/13765/#Priority%E6%89%93%E5%8C%85%E6%97%B6%E5%A4%B1%E6%95%88">UE Hot Update: Splitting the Base Package#Priority Packaging Failure</a> and provided a solution.</p>
<p>HotChunker has avoided these issues during its implementation, and Chunk configurations also support <code>Priority</code>.</p>
<p><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2023/20230228143440.webp"></p>
<p>If the priority of the Chunks is at the same level, then there will be no dependency between them, and some resources may become redundant. </p>
<p>Chunks included in the installation package do not have resource redundancy, while Chunks outside the installation package can control redundancy based on priority.</p>
<h2 id="Commandlet-Support"><a href="#Commandlet-Support" class="headerlink" title="Commandlet Support"></a>Commandlet Support</h2><p>I have added various Commandlet supports to HotChunker, allowing for easy command line packaging.</p>
<ol>
<li>Package all configured Chunks in the project</li>
<li>Package a group of Chunks</li>
<li>Package a single Chunk</li>
<li>Package a named Chunk</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-run=HotChunker -TargetPlatform=IOS</span><br><span class="line">-run=HotMultiChunker -config=G:/HPL/HPL_ChunkerSettings.json -TargetPlatform=IOS</span><br><span class="line">-run=HotSingleChunker -config=G:/HPL/ChunkerSetting.json -TargetPlatform=IOS</span><br><span class="line">-run=HotNamedChunk -ChunkName=XXXX -TargetPlatform=IOS</span><br></pre></td></tr></table></figure>

<h2 id="Packaging-Control-and-Dynamic-Switches"><a href="#Packaging-Control-and-Dynamic-Switches" class="headerlink" title="Packaging Control and Dynamic Switches"></a>Packaging Control and Dynamic Switches</h2><p>Chunk packaging control is divided into three types:</p>
<ol>
<li>bUseHPL: Whether to enable HotChunker’s configuration for packaging Chunks</li>
<li>ALL: All Chunks</li>
<li>BASEBUILDS: Chunks within the installation package</li>
<li>EXTERNAL: Chunks outside the installation package</li>
</ol>
<p>In project settings, you can control the default packaging type:<br><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2023/20230315121324.webp"></p>
<p>Apart from fixed configurations, you can also pass commands in the commandlet to override configurations in the engine, which can facilitate controlling CI/CD.</p>
<p>Currently, there are two dynamic switches supported:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># true/false</span></span><br><span class="line">-bUseHPL=</span><br><span class="line"><span class="comment"># ALL/BASEBUILDS/EXTERNAL</span></span><br><span class="line">-GenerateType=</span><br></pre></td></tr></table></figure>

<p>When passing these during the launching of UE’s CookCommandlet, it will automatically control the packaging switches of the Chunker and the types of Chunks generated.</p>
<p>If you call <code>HotChunkerCommandlet</code> in your CI/CD, you can also pass these two dynamic switches.<br>For example, to package only non-installation package Chunks:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-run=HotChunker -TargetPlatform=IOS -GenerateType=EXTERNAL</span><br></pre></td></tr></table></figure>

<p>This allows for easy integration into CI/CD systems:<br><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2023/20230315121715.webp"></p>
<p>Through this mechanism, precise control during packaging can be achieved. In certain testing scenarios, it enables rapid packaging, avoiding the need to process complete resources each time.</p>
<h2 id="Chunk-Encryption"><a href="#Chunk-Encryption" class="headerlink" title="Chunk Encryption"></a>Chunk Encryption</h2><p>Chunks managed and packaged using HotChunker default to reusing the <code>DefaultCrypto.ini</code> configuration in the project settings.</p>
<p>Configuration can be found in <code>Project Settings</code> - <code>Plugins</code> - <code>HotChunker</code> - <code>HPLPakSettings</code> - <code>EncryptSettings</code>:<br><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2023/20230315123852.webp"></p>
<p><code>bUseDefaultCryptoIni</code>: Uses the configuration in project settings. If not reused, the <code>CryptoKeys</code> can specify a crypto.json for encryption.</p>
<h2 id="Universal-Package-Filtering-Solution"><a href="#Universal-Package-Filtering-Solution" class="headerlink" title="Universal Package Filtering Solution"></a>Universal Package Filtering Solution</h2><p>In the article <a target="_blank" rel="noopener" href="https://imzlp.com/posts/13765/">UE Hot Update: Splitting the Base Package</a>, I introduced methods for package filtering for Android and IOS.<br>The engine’s default only provides <code>ObbFilter</code> for Android without an equivalent for IOS, which needs to be implemented independently.</p>
<p>In the implementation of HotChunker, I supplemented the package filtering mechanism, allowing each Chunk to specify whether it should enter the installation package directly.</p>
<p><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2023/20230315122047.webp"></p>
<p>Moreover, special handling can be done for specific platforms: for instance, it can enter the base package by default, but not on the WindowsNoEditor platform.<br><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2023/20230315122130.webp"></p>
<p>If you prefer not to configure each Chunk individually, you can set a global override in project settings:<br><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2023/20230315122357.webp"></p>
<p>This configuration means that when packaging for the WindowsNoEditor platform, all managed chunks by HotChunker will be archived into the installation package.<br><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2023/20230315145347.webp"></p>
<h2 id="Process-Optimization"><a href="#Process-Optimization" class="headerlink" title="Process Optimization"></a>Process Optimization</h2><p>By default, UE uses the CookerOnTheFly process, which requires all resources involved in the packaging from the current project to be cooked first before it enters the Pak packaging process.</p>
<p>Essentially, it is a serial process:<br><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2023/20230315131233.webp"></p>
<p>However, when the scale of resources becomes large, this process can take a long time.</p>
<p>In reality, we do not necessarily need to complete the processing of all resources to create the installation package. Because, in mobile games, the resources in the installation package are only a small portion; the majority are dynamically downloaded during hot updates.</p>
<p>In HotChunker’s implementation, the packaging of installation package Chunks and the dynamic downloading of Chunks can be executed in parallel:<br><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2023/20230315131835.webp"></p>
<p>This can save considerable time, allowing the fastest possible speed to create an installation package and performing another separate packaging task <strong>in parallel</strong> for dynamic downloaded Chunks.</p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>The packaging management solution based on HotChunker is a powerful and precise package management mechanism. It enables precise resource splitting while ensuring configuration flexibility and supports powerful Commandlet capabilities. It allows for easy non-intrusive process extension and resource auditing.</p>
<p>Moreover, this solution integrates non-intrusively, requiring no modifications to the default packaging process or the engine. The entire implementation is plugin-based, automatically executing when the plugin is enabled and the default UE packaging is triggered.</p>

    </div>

    
    
        
        
          
            <blockquote class="blockquote-center">
              
                The article is finished. If you have any questions, please comment and communicate.
              
            <br/>
            
                <div class="qr-code" onclick="return false">
                    <script src="/js/qrcode.min.js"></script>
                    <div id="qrcode">
                      
                        <img src="https://imzlp.com/images/wechat-qrcode.webp">
                      
                    <p>Scan the QR code on WeChat and follow me.</p>
                    </div>
                </div>
            
            </blockquote>
          
        

        
          <div class="postCopyright" style="clear:both;">
             <span>Title:</span><a href="/posts/37036/" target="_blank">Resource Management: Reshaping UnrealEngine Subcontracting Solution</a><br/>
             <span>Author:</span><a href="/about" target="_blank" title="查看 LIPENGZHA 的资料">LIPENGZHA</a><br/>
             <span>Publish Date:</span>2023/03/15 11:24<br/>
             
             <span>Word Count:</span><span class="page-count">10k Words</span><br/>
             
             <span>Link:</span><a href="/posts/37036/" target="_blank" title="Resource Management: Reshaping UnrealEngine Subcontracting Solution">https://en.imzlp.com/posts/37036/</a>
             <span class="copy-path" data-clipboard-text="Link: https://en.imzlp.com/posts/37036/ Author: LIPENGZHA" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
             <script src="/js/jquery.min.js"></script>
             <script src="/js/clipboard.min.js"></script>
             <script> var clipboard = new Clipboard('.copy-path'); </script>
             <br/>
             
             <span>License:</span><i class="fab fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" title="Attribution-NonCommercial-ShareAlike 4.0 International">CC BY-NC-SA 4.0</a><br/>
             
             <span>Reprinting of the full article is prohibited.</span>
          </div>
        
    

        
  <div class="reward-container">
    <div>Your donation will encourage me to keep creating!</div>
    <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
      Donate
    </button>
    <div id="qr" style="display: none;">
        
        <div style="display: inline-block;">
          <img src="/images/reward/wechatpay.webp" alt="LIPENGZHA WeChat Pay">
          <p>WeChat Pay</p>
        </div>

    </div>
  </div>



      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/UnrealEngine/" rel="tag"># UnrealEngine</a>
              <a href="/tags/%E7%83%AD%E6%9B%B4%E6%96%B0/" rel="tag"># 热更新</a>
              <a href="/tags/%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86/" rel="tag"># 资源管理</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/posts/27475/" rel="prev" title="UE plug-in and tool development:Commandlet">
      <i class="fa fa-chevron-left"></i> UE plug-in and tool development:Commandlet
    </a></div>
      <div class="post-nav-item">
    <a href="/posts/56381/" rel="next" title="Memory Expansion: Utilize new memory features of IOS in UE">
      Memory Expansion: Utilize new memory features of IOS in UE <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
      <div class="tabs tabs-comment">
        <ul class="nav-tabs">
            <li class="tab"><a href="#comment-utteranc">utteranc</a></li>
            <li class="tab"><a href="#comment-valine">valine</a></li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane utteranc" id="comment-utteranc">
              
  
  <div class="comments">
  <script src="https://utteranc.es/client.js" repo="hxhb/blog-comments" issue-term="pathname" theme="github-light" crossorigin="anonymous" async></script>
  </div>
  
  
            </div>
            <div class="tab-pane valine" id="comment-valine">
              <div class="comments" id="valine-comments"></div>
            </div>
        </div>
      </div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Issues-with-UE%E2%80%99s-Default-Packaging"><span class="nav-number">1.</span> <span class="nav-text">Issues with UE’s Default Packaging</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Chunk-Configuration"><span class="nav-number">2.</span> <span class="nav-text">Chunk Configuration</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Rule"><span class="nav-number">2.1.</span> <span class="nav-text">Rule</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Getter"><span class="nav-number">2.2.</span> <span class="nav-text">Getter</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Chunk-Management"><span class="nav-number">3.</span> <span class="nav-text">Chunk Management</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#HPL-Resources"><span class="nav-number">3.1.</span> <span class="nav-text">HPL Resources</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DataTable"><span class="nav-number">3.2.</span> <span class="nav-text">DataTable</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Dynamic-Registration"><span class="nav-number">3.3.</span> <span class="nav-text">Dynamic Registration</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Editor-Support"><span class="nav-number">4.</span> <span class="nav-text">Editor Support</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Global-Configuration-and-Process-Extension"><span class="nav-number">5.</span> <span class="nav-text">Global Configuration and Process Extension</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Intervening-at-Various-Stages-of-Chunker"><span class="nav-number">5.1.</span> <span class="nav-text">Intervening at Various Stages of Chunker</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redundancy-Control"><span class="nav-number">6.</span> <span class="nav-text">Redundancy Control</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Commandlet-Support"><span class="nav-number">7.</span> <span class="nav-text">Commandlet Support</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Packaging-Control-and-Dynamic-Switches"><span class="nav-number">8.</span> <span class="nav-text">Packaging Control and Dynamic Switches</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Chunk-Encryption"><span class="nav-number">9.</span> <span class="nav-text">Chunk Encryption</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Universal-Package-Filtering-Solution"><span class="nav-number">10.</span> <span class="nav-text">Universal Package Filtering Solution</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Process-Optimization"><span class="nav-number">11.</span> <span class="nav-text">Process Optimization</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Conclusion"><span class="nav-number">12.</span> <span class="nav-text">Conclusion</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person" oncontextmenu="return false" οndragstart="return false">
    <img class="site-author-image" itemprop="image" alt="LIPENGZHA"
      src="https://img.imzlp.com/imgs/zlp/picgo/2023/202304152112902.webp">
  <p class="site-author-name" itemprop="name">LIPENGZHA</p>
  <div class="site-description" itemprop="description">"I think, therefore I am"</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
             
          <span class="site-state-item-count">190</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">95</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">190</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/hxhb" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;hxhb" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://linkedin.com/in/lipengzha" title="Linkedin → https:&#x2F;&#x2F;linkedin.com&#x2F;in&#x2F;lipengzha" rel="noopener" target="_blank"><i class="fab fa-linkedin fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/imzlp" title="知乎 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;imzlp" rel="noopener" target="_blank"><i class="fa fa-custom zhihu fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/images/wechat-qrcode-offical.webp" title="微信公众号 → &#x2F;images&#x2F;wechat-qrcode-offical.webp"><i class="fab fa-weixin fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:imzlp@foxmail.com" title="E-Mail → mailto:imzlp@foxmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-rss fa-fw"></i></a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://consolehelp.imzlp.com/" title="https:&#x2F;&#x2F;consolehelp.imzlp.com&#x2F;" rel="noopener" target="_blank">UE Console Help</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://imzlp.com/opensource/" title="https:&#x2F;&#x2F;imzlp.com&#x2F;opensource&#x2F;" rel="noopener" target="_blank">Open Source Projects</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://imzlp.com/posts/11515/" title="https:&#x2F;&#x2F;imzlp.com&#x2F;posts&#x2F;11515&#x2F;" rel="noopener" target="_blank">UE C++ API Dash Documents</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://ue5wiki.com/" title="https:&#x2F;&#x2F;ue5wiki.com&#x2F;" rel="noopener" target="_blank">Unreal Engine Wiki</a>
        </li>
    </ul>
  </div>

      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2014 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">LIPENGZHA</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="Symbols count total">1.5m</span>
</div>
  <div class="powered-by-other">
    
	    <center>Github Pages | Actions | NeXT | Cloudflare | Hexo Deploy</center>
      
  </div>

<script>
function checkWebp(callback) {
    var img = new Image();
    img.onload = function () { callback((img.width > 0) && (img.height > 0)); };
    img.onerror = function () { callback(false); };
    img.src = 'data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA';
}
function showImage(useWebp) {
    var imgs = [].slice.call(document.querySelectorAll('img'));
    imgs.forEach(function (e) {
        if (!useWebp) {
            var src = e.getAttribute('data-src')
            src = src.replace(/\.webp$/, '.png');
            e.setAttribute('data-src', src);
        }
    });
}
checkWebp(showImage);
</script>

        








      </div>
    </footer>
  </div>

  
  <script src="//lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/animejs/3.2.1/anime.min.js"></script>
  <script src="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/jquery/3.5.1/jquery.min.js"></script>
  <script src="//lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/fancybox/3.5.7/jquery.fancybox.min.js"></script>
  <script src="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/lozad.js/1.16.0/lozad.min.js"></script>
  <script src="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/pangu/4.0.7/pangu.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>



<script src="/js/code-unfold.js"></script>

  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>




  
<script src="/js/local-search.js"></script>









<script>
document.querySelectorAll('.pdfobject-container').forEach(element => {
  let url = element.dataset.target;
  let pdfOpenParams = {
    navpanes : 0,
    toolbar  : 0,
    statusbar: 0,
    pagemode : 'thumbs',
    view     : 'FitH'
  };
  let pdfOpenFragment = '#' + Object.entries(pdfOpenParams).map(([key, value]) => `${key}=${encodeURIComponent(value)}`).join('&');
  let fullURL = `/lib/pdf/web/viewer.html?file=${encodeURIComponent(url)}${pdfOpenFragment}`;

  if (NexT.utils.supportsPDFs()) {
    element.innerHTML = `<embed class="pdfobject" src="${url + pdfOpenFragment}" type="application/pdf" style="height: ${element.dataset.height};">`;
  } else {
    element.innerHTML = `<iframe src="${fullURL}" style="height: ${element.dataset.height};" frameborder="0"></iframe>`;
  }
});
</script>


<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


  

  

  
  <script src="//img.imzlp.com/imgs/zlp/picgo/2021/quicklink.umd.js"></script>
  <script>
      window.addEventListener('load', () => {
      quicklink({
        timeout : 3000,
        priority: true,
        ignores : [uri => uri.includes('#'),uri => uri === 'https://en.imzlp.com/posts/37036/',]
      });
      });
  </script>


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/valine/1.4.14/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    var requiredFields = 'nick';
    requiredFields = requiredFields.split(',');
    
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'oCE6RMVkVoi5MgUhvFsn1EvV-gzGzoHsz',
      appKey     : 'K9SOaNYJ8PV6xaoFggWG5xvv',
      placeholder: "Leave something behind~",
      avatar     : 'robohash',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : 'en' || 'zh-cn',
      path       : location.pathname,
      recordIP   : true,
      serverURLs : '',
      requiredFields: requiredFields
    });
  }, window.Valine);
});
</script>

</body>
</html>
