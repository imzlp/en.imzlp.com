<!DOCTYPE html>
<html lang="en,default">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon-32x32-tilt-brush.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-tilt-brush.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-tilt-brush.png">
  <link rel="mask-icon" href="/images/favicon-32x32-tilt-brush.png" color="#222">
  <meta name="google-site-verification" content="ttIkhAIFZQM9Huj8roB0l95ePN2Tv2zv2wRFksi09WA">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noto Serif SC:300,300italic,400,400italic,700,700italic|Pacifico:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Roboto Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="//lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/5.15.2/css/all.min.css">
  <link rel="stylesheet" href="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/fancybox/3.5.7/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"en.imzlp.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false,"width":280},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"manual"},"fancybox":true,"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":false,"nav":null,"activeClass":"valine"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"code_unfold":{"enable":true,"CODE_MAX_HEIGHT":600},"path":"search.xml"};
  </script>

  <meta name="description" content="In game development, program performance is a crucial issue that needs to be emphasized. To cover the largest possible user base, we must consider the operational effects on mid to low-end devices and">
<meta property="og:type" content="article">
<meta property="og:title" content="UE Performance Analysis: Memory Optimization">
<meta property="og:url" content="https://en.imzlp.com/posts/19135/index.html">
<meta property="og:site_name" content="Z&#39;s Blog">
<meta property="og:description" content="In game development, program performance is a crucial issue that needs to be emphasized. To cover the largest possible user base, we must consider the operational effects on mid to low-end devices and">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/picgo/2023/20230206152408.webp">
<meta property="article:published_time" content="2021-03-30T10:59:16.000Z">
<meta property="article:modified_time" content="2021-03-30T10:59:16.000Z">
<meta property="article:author" content="LIPENGZHA">
<meta property="article:tag" content="UnrealEngine">
<meta property="article:tag" content="Profiling">
<meta property="article:tag" content="内存优化">
<meta property="article:tag" content="Memory">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img.imzlp.com/imgs/zlp/picgo/2023/20230206152408.webp">

<link rel="canonical" href="https://en.imzlp.com/posts/19135/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>UE Performance Analysis: Memory Optimization | Z's Blog</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FDCJ41EFP5"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-FDCJ41EFP5');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.staticfile.org/lxgw-wenkai-screen-webfont/1.7.0/style.min.css" /><!-- hexo injector head_end end --><link rel="alternate" href="/atom.xml" title="Z's Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Z's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        
            
  <li class="menu-item menu-item-notes">

    <a href="/notes/" rel="section"><i class="fa fa-edit fa-fw"></i>Notes</a>

  </li>


      
        
            
  <li class="menu-item menu-item-essay">

    <a href="/essay/" rel="section"><i class="fas fa-feather-alt fa-fw"></i>Essay</a>

  </li>


      
        
            
  <li class="menu-item menu-item-resources">

    <a href="/resources/" rel="section"><i class="fa fa-inbox fa-fw"></i>Resources</a>

  </li>


      
        <li class="menu-item menu-item-friends">

    <a href="/friends/" rel="section"><i class="fas fa-link fa-fw"></i>Friends</a>

  </li>
        
            
  <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About Me</a>

  </li>


      
        <li class="menu-item menu-item-showcase">

    <a href="/showcase/" rel="section"><i class="fa fa-solid fa-trophy fa-fw"></i>ShowCase</a>

  </li>
        <li class="menu-item menu-item-changelog">

    <a href="/changelog/" rel="section"><i class="fa fa-history fa-fw"></i>Site Log</a>

  </li>
        <li class="menu-item menu-item-opensource">

    <a href="/opensource/" rel="section"><i class="fas fa-code-branch fa-fw"></i>Open Source</a>

  </li>
        <li class="menu-item menu-item-uewiki">

    <a href="https://ue5wiki.com/" rel="noopener" target="_blank"><i class="fab fa-wikipedia-w fa-fw"></i>Unreal Wiki</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>



<script type="text/javascript">
  let domain='en.imzlp.com';
  let domain_str = atob(domain);
  let pathname = location.pathname;
  if (domain_str!= location.host.toLowerCase()){
        console.log(`this host is not safe,jump to https://${domain_str}${pathname}`);
        location.href=`https://${domain_str}${pathname}`;
  }
</script>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>
  <div class="l10n-header-widget">
    <script>
      // 获取当前页面的 URL
      const currentUrl = window.location.href;
      // 替换 URL 中的部分内容
      const jumpToL10nLink = currentUrl.replace('en.imzlp.com', 'imzlp.com');
      // 将 jumpToL10nLink 绑定到一个全局变量
      window.jumpToL10nLink = jumpToL10nLink;
    </script>

    <a href="#" class="post-l10n-link" title="切换至中文版本" style="float: left;border-bottom: none;" rel="noopener" target="_blank" onclick="window.open(window.jumpToL10nLink, '_blank'); return false;">
      <i class="fa fa-solid fa-language"></i>
    </a>
  </div>



    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en"
  >
    <link itemprop="mainEntityOfPage" href="https://en.imzlp.com/posts/19135/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://img.imzlp.com/imgs/zlp/picgo/2023/202304152112902.webp">
      <meta itemprop="name" content="LIPENGZHA">
      <meta itemprop="description" content=""I think, therefore I am"">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Z's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          UE Performance Analysis: Memory Optimization<a href="https://github.com/imzlp/blog-md/blob/en/_posts/2021-03-30-19135.md" class="post-edit-link" title="Edit this post" style="float: right;border-bottom: 0px;" rel="noopener" target="_blank"><i class="fa fa-pen-nib"></i></a><a href="https://imzlp.com/posts/19135/" class="post-l10n-link" title="切换至中文版本" style="float: left;border-bottom: 0px;" rel="noopener" target="_blank"><i class="fa fa-solid fa-language"></i></a>
        </h1>

        
          <div class="post-subtitle" style="text-align: center;line-height: 1;">
            <sub text-align="center" style="font-size: 15px;align-content: center;font-style: italic;bottom: 0em;">UE性能分析：内存优化</sub>
          </div>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-03-30 10:59 10:59:16:59" itemprop="dateCreated datePublished" datetime="2021-03-30T10:59:16+00:00">2021-03-30 10:59</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/UnrealEngine/" itemprop="url" rel="index"><span itemprop="name">UnrealEngine</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/UnrealEngine/Profiling/" itemprop="url" rel="index"><span itemprop="name">Profiling</span></a>
                </span>
            </span>

          
            <span id="/posts/19135/" class="post-meta-item leancloud_visitors" data-flag-title="UE Performance Analysis: Memory Optimization" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>10k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>26 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>In game development, program performance is a crucial issue that needs to be emphasized. To cover the largest possible user base, we must consider the operational effects on mid to low-end devices and ensure compatibility with a wide range of hardware specifications. In this context, it is key to analyze and optimize the performance bottlenecks of the game.</p>
<p>Loading more resources into memory at runtime is essentially a trade-off of space for time. Frequent I/O from the disk is quite time-consuming, and pre-loading resources into memory allows for fast retrieval. However, memory resources are also limited and cannot be used without restrictions, especially for some mid to low-end mobile devices where devices with 4GB or even less memory still have a significant market share. Therefore, it is important to avoid wasting memory, as excessive memory usage may lead to termination by the system.</p>
<p>Memory optimization fundamentally seeks to strike a balance between loading efficiency and memory consumption, aiming to use as much available memory as possible while ensuring that more low-end devices run normally without triggering OOM.</p>
<p>I plan to write a few articles related to performance optimization. This article will start with UE memory analysis, introducing commonly used memory analysis tools and methods, as well as organizing the memory optimization techniques that can be applied in UE projects. This part was previously recorded in the form of notes at <a target="_blank" rel="noopener" href="https://imzlp.com/notes/ue/">notes/ue</a>, and subsequent memory-related content will be added to this article.</p>
<span id="more"></span>

<p>Memory optimization primarily focuses on the following four aspects:</p>
<ol>
<li>Identifying memory leaks</li>
<li>Trimming unnecessary modules</li>
<li>Optimizing the memory usage of existing modules</li>
<li>Lossy optimization: cutting content (material quality, etc.)</li>
</ol>
<p>A three-step approach: debug, squeeze out excess, cut down requirements.</p>
<h2 id="Memory-Analysis-Tools"><a href="#Memory-Analysis-Tools" class="headerlink" title="Memory Analysis Tools"></a>Memory Analysis Tools</h2><p>Before performing memory optimization, it’s essential to gain a rough understanding of the memory distribution of the UE project, which can be done using the memory analysis tools provided by UE and some native platform analysis tools.</p>
<p>Memory Analysis Resources:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.unrealengine.com/zh-CN/ProductionPipelines/DevelopmentSetup/Tools/LowLevelMemoryTracker/index.html">LLM</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/61366273">UE4 Memory Profiler</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/xoyojank/article/details/82876508">Native Memory Analysis on Android</a></li>
</ul>
<p>Some common console commands:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">stat</span> memory <span class="comment"># Displays memory usage of various subsystems in the engine</span></span><br><span class="line"><span class="built_in">stat</span> MemoryAllocator <span class="comment"># Displays memory allocation information</span></span><br><span class="line"><span class="built_in">stat</span> MemoryPlatform <span class="comment"># Displays platform memory information</span></span><br><span class="line"><span class="built_in">stat</span> MemoryStaticMesh <span class="comment"># Displays memory information for static meshes</span></span><br></pre></td></tr></table></figure>
<p>You can also enable LLM by adding the <code>-LLM</code> parameter at startup.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-LLM <span class="comment"># Enable LLM</span></span><br><span class="line">-LLMCSV <span class="comment"># Continuously write all values to a CSV file. Automatically enables -LLM.</span></span><br><span class="line">-llmtagsets=Assets <span class="comment"># Experimental feature. Displays the total memory allocated for each asset.</span></span><br><span class="line">-llmtagsets=AssetClasses <span class="comment"># Experimental feature. Displays the total for each UObject class type.</span></span><br></pre></td></tr></table></figure>

<p>Then you can use the following console commands during runtime:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">stat</span> llm <span class="comment"># Displays LLM summary. All lower-level engine statistics are consolidated into a single engine statistic.</span></span><br><span class="line"><span class="built_in">stat</span> llmfull <span class="comment"># Displays all LLM statistics</span></span><br><span class="line"><span class="built_in">stat</span> LLMPlatform <span class="comment"># Displays all memory information allocated from the OS</span></span><br><span class="line"><span class="built_in">stat</span> LLMOverhead <span class="comment"># Displays memory used internally by LLM</span></span><br></pre></td></tr></table></figure>
<p>Memory analysis can also use the following tools:</p>
<ul>
<li>memreport</li>
<li>MemoryProfiler</li>
<li>Heapprofd(Android)</li>
<li>Instrument(IOS)</li>
</ul>
<p>Entering <code>memreport</code> (-full) in the game console will create a directory and <code>.memreport</code> file in <code>Saved/Profiling/Memreports</code>, which can be opened with a text editor to view the memory usage of different parts of the game.</p>
<p>I will provide more details on the usage of specific memory analysis tools and the analysis process for memory allocation in the UE engine, as time allows. For more detailed information about LLM, please refer to the UE documentation.</p>
<h2 id="Memory-Optimization-Solutions"><a href="#Memory-Optimization-Solutions" class="headerlink" title="Memory Optimization Solutions"></a>Memory Optimization Solutions</h2><p>The listed optimization methods are actually optional; it is not necessary to implement all of them to achieve the best results, as memory optimization must balance efficiency. Therefore, optimizations can be controlled based on project requirements across different devices while ensuring feature consistency for low-end machines.</p>
<p>Here, I will mainly list which parts of UE can be optimized and how to do so. Specific optimization data will be analyzed and supplemented over time.</p>
<h3 id="Disable-Unnecessary-Feature-Support"><a href="#Disable-Unnecessary-Feature-Support" class="headerlink" title="Disable Unnecessary Feature Support"></a>Disable Unnecessary Feature Support</h3><p>Based on the requirements, the following engine module supports can be trimmed:</p>
<ul>
<li>APEX: If the Nvidia APEX destruction system is not used, support for APEX can be removed during engine compilation. This can be set in BuildSetting or TargetRules by setting <code>bCompileAPEX=true</code>.</li>
<li>Recast(NavMesh): If the client does not need support for Recast during runtime and does not require local NavMesh navigation, NavMesh support can be trimmed at runtime. This can be set in BuildSetting or TargetRules by setting <code>bCompileRecast=false</code>.</li>
<li>FreeType: If FreeType font support is needed, it can be set in BuildSetting or TargetRules by setting <code>bCompileFreeType=false</code>.</li>
<li>ICU(unicode/i18n): The Core module of the engine supports unicode/i18n, which can be controlled via <code>bCompileICU=false</code> in BuildSetting or TargetRules.</li>
<li>CompileForSize: UE provides an optimization option that strictly controls size during compilation but sacrifices performance. This can be set in BuildSetting or TargetRules by setting <code>bCompileForSize=false</code>; if true, the compilation will use <code>-Oz</code> for Android, or <code>-O3</code> if false.</li>
<li>CEF3: Optional support for the Chromium Embedded Framework, Google’s embedded browser support. This can be controlled by setting <code>bCompileCEF3=false</code> in BuildSetting or TargetRules.</li>
<li>bUsesSteam: Whether to use Steam; can be disabled for mobile games, controlled through <code>bUsesSteam</code> in TargetRules.</li>
<li>SpeedTree: If the game does not require SpeedTree for vegetation modeling, compilation of SpeedTree can be disabled via <code>bOverrideCompileSpeedTree</code> in TargetRules.</li>
<li>Audio Module: If the project uses WWise or similar as an audio playback interface and does not require the built-in Audio module of the engine, that functionality is redundant and can be trimmed away.</li>
<li>Internationalization Module: If multi-language support of the game does not rely on UE’s text collection and translation functionality, this module can be removed.</li>
</ul>
<p>This can reduce the size of the static program after compilation and decrease unnecessary execution logic.</p>
<h3 id="Control-AssetRegistry-Serialization"><a href="#Control-AssetRegistry-Serialization" class="headerlink" title="Control AssetRegistry Serialization"></a>Control AssetRegistry Serialization</h3><p>The AssetRegistry is mainly used in the Editor for resource searching and filtering operations, primarily utilized by the Content Browser, as described in the UE documentation: <a target="_blank" rel="noopener" href="https://docs.unrealengine.com/en-US/ProgrammingAndScripting/ProgrammingWithCPP/Assets/Registry/index.html">Asset Registry</a>.</p>
<p>For the project, it may not be necessary to use it at runtime, but the <code>AssetRegistry</code> module loads <code>AssetRegistry.bin</code> into memory as soon as it starts, consuming memory unnecessarily if it is not needed.</p>
<p>Fortunately, UE provides methods to not serialize or partially serialize AssetRegistry data. During the construction of <code>UAssetRegistryImpl</code>, the <code>InitializeSerializationOptionsFromIni</code> function will read configurations from <code>DefaultEngine.ini</code> and construct an <code>FAssetRegistrySerializationOptions</code> structure to store the settings, which will be used in subsequent <code>Serialize</code> functions to control what part of the data is serialized into the <code>AssetRegistry</code>.</p>
<figure class="highlight cpp"><figcaption><span>Runtime/AssetRegistry/Private/AssetRegistry.cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">UAssetRegistryImpl::InitializeSerializationOptionsFromIni</span><span class="params">(FAssetRegistrySerializationOptions&amp; Options, <span class="type">const</span> FString&amp; PlatformIniName)</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  FConfigFile* EngineIni = <span class="literal">nullptr</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> WITH_EDITOR</span></span><br><span class="line">  <span class="comment">// Use passed in platform, or current platform if empty</span></span><br><span class="line">  FConfigFile PlatformEngineIni;</span><br><span class="line">  FConfigCacheIni::<span class="built_in">LoadLocalIniFile</span>(PlatformEngineIni, <span class="built_in">TEXT</span>(<span class="string">&quot;Engine&quot;</span>), <span class="literal">true</span>, (!PlatformIniName.<span class="built_in">IsEmpty</span>() ? *PlatformIniName : <span class="built_in">ANSI_TO_TCHAR</span>(FPlatformProperties::<span class="built_in">IniPlatformName</span>())));</span><br><span class="line">  EngineIni = &amp;PlatformEngineIni;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">  <span class="comment">// In cooked builds, always use the normal engine INI</span></span><br><span class="line">  EngineIni = GConfig-&gt;<span class="built_in">FindConfigFile</span>(GEngineIni);</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">  EngineIni-&gt;<span class="built_in">GetBool</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;AssetRegistry&quot;</span>), <span class="built_in">TEXT</span>(<span class="string">&quot;bSerializeAssetRegistry&quot;</span>), Options.bSerializeAssetRegistry);</span><br><span class="line">  EngineIni-&gt;<span class="built_in">GetBool</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;AssetRegistry&quot;</span>), <span class="built_in">TEXT</span>(<span class="string">&quot;bSerializeDependencies&quot;</span>), Options.bSerializeDependencies);</span><br><span class="line">  EngineIni-&gt;<span class="built_in">GetBool</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;AssetRegistry&quot;</span>), <span class="built_in">TEXT</span>(<span class="string">&quot;bSerializeNameDependencies&quot;</span>), Options.bSerializeSearchableNameDependencies);</span><br><span class="line">  EngineIni-&gt;<span class="built_in">GetBool</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;AssetRegistry&quot;</span>), <span class="built_in">TEXT</span>(<span class="string">&quot;bSerializeManageDependencies&quot;</span>), Options.bSerializeManageDependencies);</span><br><span class="line">  EngineIni-&gt;<span class="built_in">GetBool</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;AssetRegistry&quot;</span>), <span class="built_in">TEXT</span>(<span class="string">&quot;bSerializePackageData&quot;</span>), Options.bSerializePackageData);</span><br><span class="line">  EngineIni-&gt;<span class="built_in">GetBool</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;AssetRegistry&quot;</span>), <span class="built_in">TEXT</span>(<span class="string">&quot;bUseAssetRegistryTagsWhitelistInsteadOfBlacklist&quot;</span>), Options.bUseAssetRegistryTagsWhitelistInsteadOfBlacklist);</span><br><span class="line">  EngineIni-&gt;<span class="built_in">GetBool</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;AssetRegistry&quot;</span>), <span class="built_in">TEXT</span>(<span class="string">&quot;bFilterAssetDataWithNoTags&quot;</span>), Options.bFilterAssetDataWithNoTags);</span><br><span class="line">  EngineIni-&gt;<span class="built_in">GetBool</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;AssetRegistry&quot;</span>), <span class="built_in">TEXT</span>(<span class="string">&quot;bFilterDependenciesWithNoTags&quot;</span>), Options.bFilterDependenciesWithNoTags);</span><br><span class="line">  EngineIni-&gt;<span class="built_in">GetBool</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;AssetRegistry&quot;</span>), <span class="built_in">TEXT</span>(<span class="string">&quot;bFilterSearchableNames&quot;</span>), Options.bFilterSearchableNames);</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This control method can regulate whether to create <code>AssetRegistry.bin</code> at packaging and control which AssetRegistry data to deserialize at runtime (it will not impact <code>DevelopmentAssetRegistry.bin</code>, which can be used for asset auditing).</p>
<p>The deserialization process is as follows:</p>
<ol>
<li>Check <code>bSerializeAssetRegistry</code>; if true, load <code>AssetRegistry.bin</code> in binary form into memory.</li>
<li>Use the <code>Serialize</code> function to deserialize the binary data.</li>
<li>Release the memory occupied by loading <code>AssetRegistry.bin</code>.</li>
</ol>
<p>Therefore, the memory consumption of AssetRegistry is based on the serialized data, and <code>FAssetRegistrySerializationOptions</code> controls which data gets serialized.</p>
<figure class="highlight cpp"><figcaption><span>Runtime/AssetRegistry/Public/AssetRegistryState.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** Load/Save options used to modify how the cache is serialized. These are read out of the AssetRegistry section of Engine.ini and can be changed per platform. */</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">FAssetRegistrySerializationOptions</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">/** True rather to load/save registry at all */</span></span><br><span class="line">  <span class="type">bool</span> bSerializeAssetRegistry;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** True rather to load/save dependency info. If true this will handle hard and soft package references */</span></span><br><span class="line">  <span class="type">bool</span> bSerializeDependencies;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** True rather to load/save dependency info for Name references, */</span></span><br><span class="line">  <span class="type">bool</span> bSerializeSearchableNameDependencies;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** True rather to load/save dependency info for Manage references, */</span></span><br><span class="line">  <span class="type">bool</span> bSerializeManageDependencies;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** If true will read/write FAssetPackageData */</span></span><br><span class="line">  <span class="type">bool</span> bSerializePackageData;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** True if CookFilterlistTagsByClass is a whitelist. False if it is a blacklist. */</span></span><br><span class="line">  <span class="type">bool</span> bUseAssetRegistryTagsWhitelistInsteadOfBlacklist;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** True if we want to only write out asset data if it has valid tags. This saves memory by not saving data for things like textures */</span></span><br><span class="line">  <span class="type">bool</span> bFilterAssetDataWithNoTags;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** True if we also want to filter out dependency data for assets that have no tags. Only filters if bFilterAssetDataWithNoTags is also true */</span></span><br><span class="line">  <span class="type">bool</span> bFilterDependenciesWithNoTags;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** Filter out searchable names from dependency data */</span></span><br><span class="line">  <span class="type">bool</span> bFilterSearchableNames;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** The map of classname to tag set of tags that are allowed in cooked builds. This is either a whitelist or blacklist depending on bUseAssetRegistryTagsWhitelistInsteadOfBlacklist */</span></span><br><span class="line">  TMap&lt;FName, TSet&lt;FName&gt;&gt; CookFilterlistTagsByClass;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">FAssetRegistrySerializationOptions</span>()</span><br><span class="line">    : <span class="built_in">bSerializeAssetRegistry</span>(<span class="literal">false</span>)</span><br><span class="line">    , <span class="built_in">bSerializeDependencies</span>(<span class="literal">false</span>)</span><br><span class="line">    , <span class="built_in">bSerializeSearchableNameDependencies</span>(<span class="literal">false</span>)</span><br><span class="line">    , <span class="built_in">bSerializeManageDependencies</span>(<span class="literal">false</span>)</span><br><span class="line">    , <span class="built_in">bSerializePackageData</span>(<span class="literal">false</span>)</span><br><span class="line">    , <span class="built_in">bUseAssetRegistryTagsWhitelistInsteadOfBlacklist</span>(<span class="literal">false</span>)</span><br><span class="line">    , <span class="built_in">bFilterAssetDataWithNoTags</span>(<span class="literal">false</span>)</span><br><span class="line">    , <span class="built_in">bFilterDependenciesWithNoTags</span>(<span class="literal">false</span>)</span><br><span class="line">    , <span class="built_in">bFilterSearchableNames</span>(<span class="literal">false</span>)</span><br><span class="line">  &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** Options used to read/write the DevelopmentAssetRegistry, which includes all data */</span></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">ModifyForDevelopment</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    bSerializeAssetRegistry = bSerializeDependencies = bSerializeSearchableNameDependencies = bSerializeManageDependencies = bSerializePackageData = <span class="literal">true</span>;</span><br><span class="line">    <span class="built_in">DisableFilters</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** Disable all filters */</span></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">DisableFilters</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    bFilterAssetDataWithNoTags = <span class="literal">false</span>;</span><br><span class="line">    bFilterDependenciesWithNoTags = <span class="literal">false</span>;</span><br><span class="line">    bFilterSearchableNames = <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>The configuration reading occurs in the following code:</p>
<figure class="highlight cpp"><figcaption><span>Runtime/AssetRegistry/Private/AssetRegistry.cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">UAssetRegistryImpl::InitializeSerializationOptionsFromIni</span><span class="params">(FAssetRegistrySerializationOptions&amp; Options, <span class="type">const</span> FString&amp; PlatformIniName)</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  FConfigFile* EngineIni = <span class="literal">nullptr</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> WITH_EDITOR</span></span><br><span class="line">  <span class="comment">// Use passed in platform, or current platform if empty</span></span><br><span class="line">  FConfigFile PlatformEngineIni;</span><br><span class="line">  FConfigCacheIni::<span class="built_in">LoadLocalIniFile</span>(PlatformEngineIni, <span class="built_in">TEXT</span>(<span class="string">&quot;Engine&quot;</span>), <span class="literal">true</span>, (!PlatformIniName.<span class="built_in">IsEmpty</span>() ? *PlatformIniName : <span class="built_in">ANSI_TO_TCHAR</span>(FPlatformProperties::<span class="built_in">IniPlatformName</span>())));</span><br><span class="line">  EngineIni = &amp;PlatformEngineIni;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">  <span class="comment">// In cooked builds, always use the normal engine INI</span></span><br><span class="line">  EngineIni = GConfig-&gt;<span class="built_in">FindConfigFile</span>(GEngineIni);</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">  EngineIni-&gt;<span class="built_in">GetBool</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;AssetRegistry&quot;</span>), <span class="built_in">TEXT</span>(<span class="string">&quot;bSerializeAssetRegistry&quot;</span>), Options.bSerializeAssetRegistry);</span><br><span class="line">  EngineIni-&gt;<span class="built_in">GetBool</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;AssetRegistry&quot;</span>), <span class="built_in">TEXT</span>(<span class="string">&quot;bSerializeDependencies&quot;</span>), Options.bSerializeDependencies);</span><br><span class="line">  EngineIni-&gt;<span class="built_in">GetBool</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;AssetRegistry&quot;</span>), <span class="built_in">TEXT</span>(<span class="string">&quot;bSerializeNameDependencies&quot;</span>), Options.bSerializeSearchableNameDependencies);</span><br><span class="line">  EngineIni-&gt;<span class="built_in">GetBool</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;AssetRegistry&quot;</span>), <span class="built_in">TEXT</span>(<span class="string">&quot;bSerializeManageDependencies&quot;</span>), Options.bSerializeManageDependencies);</span><br><span class="line">  EngineIni-&gt;<span class="built_in">GetBool</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;AssetRegistry&quot;</span>), <span class="built_in">TEXT</span>(<span class="string">&quot;bSerializePackageData&quot;</span>), Options.bSerializePackageData);</span><br><span class="line">  EngineIni-&gt;<span class="built_in">GetBool</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;AssetRegistry&quot;</span>), <span class="built_in">TEXT</span>(<span class="string">&quot;bUseAssetRegistryTagsWhitelistInsteadOfBlacklist&quot;</span>), Options.bUseAssetRegistryTagsWhitelistInsteadOfBlacklist);</span><br><span class="line">  EngineIni-&gt;<span class="built_in">GetBool</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;AssetRegistry&quot;</span>), <span class="built_in">TEXT</span>(<span class="string">&quot;bFilterAssetDataWithNoTags&quot;</span>), Options.bFilterAssetDataWithNoTags);</span><br><span class="line">  EngineIni-&gt;<span class="built_in">GetBool</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;AssetRegistry&quot;</span>), <span class="built_in">TEXT</span>(<span class="string">&quot;bFilterDependenciesWithNoTags&quot;</span>), Options.bFilterDependenciesWithNoTags);</span><br><span class="line">  EngineIni-&gt;<span class="built_in">GetBool</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;AssetRegistry&quot;</span>), <span class="built_in">TEXT</span>(<span class="string">&quot;bFilterSearchableNames&quot;</span>), Options.bFilterSearchableNames);</span><br><span class="line"></span><br><span class="line">  TArray&lt;FString&gt; FilterlistItems;</span><br><span class="line">  <span class="keyword">if</span> (Options.bUseAssetRegistryTagsWhitelistInsteadOfBlacklist)</span><br><span class="line">  &#123;</span><br><span class="line">    EngineIni-&gt;<span class="built_in">GetArray</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;AssetRegistry&quot;</span>), <span class="built_in">TEXT</span>(<span class="string">&quot;CookedTagsWhitelist&quot;</span>), FilterlistItems);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    EngineIni-&gt;<span class="built_in">GetArray</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;AssetRegistry&quot;</span>), <span class="built_in">TEXT</span>(<span class="string">&quot;CookedTagsBlacklist&quot;</span>), FilterlistItems);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// This only needs to be done once, and only on builds using USE_COMPACT_ASSET_REGISTRY</span></span><br><span class="line">    TArray&lt;FString&gt; AsFName;</span><br><span class="line">    EngineIni-&gt;<span class="built_in">GetArray</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;AssetRegistry&quot;</span>), <span class="built_in">TEXT</span>(<span class="string">&quot;CookedTagsAsFName&quot;</span>), AsFName);</span><br><span class="line">    TArray&lt;FString&gt; AsPathName;</span><br><span class="line">    EngineIni-&gt;<span class="built_in">GetArray</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;AssetRegistry&quot;</span>), <span class="built_in">TEXT</span>(<span class="string">&quot;CookedTagsAsPathName&quot;</span>), AsPathName);</span><br><span class="line">    TArray&lt;FString&gt; AsLocText;</span><br><span class="line">    EngineIni-&gt;<span class="built_in">GetArray</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;AssetRegistry&quot;</span>), <span class="built_in">TEXT</span>(<span class="string">&quot;CookedTagsAsLocText&quot;</span>), AsLocText);</span><br><span class="line">    FAssetRegistryState::<span class="built_in">IngestIniSettingsForCompact</span>(AsFName, AsPathName, AsLocText);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>In <code>Config/DefaultEngine.ini</code>, creating an <code>AssetRegistry</code> section using the above names can control the serialization of AssetRegistry, which reduces the package size and memory consumption at packaging (the AssetRegistry is loaded into memory when the engine starts).</p>
<figure class="highlight ini"><figcaption><span>DefaultEngine.ini</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[AssetRegistry]</span></span><br><span class="line"><span class="attr">bSerializeAssetRegistry</span>=<span class="literal">false</span></span><br><span class="line"><span class="attr">bSerializeDependencies</span>=<span class="literal">false</span></span><br><span class="line"><span class="attr">bSerializeNameDependencies</span>=<span class="literal">false</span></span><br><span class="line"><span class="attr">bSerializeManageDependencies</span>=<span class="literal">false</span></span><br><span class="line"><span class="attr">bSerializePackageData</span>=<span class="literal">false</span></span><br></pre></td></tr></table></figure>
<p>You can also specify settings for individual platforms by modifying the platform-specific ini files:</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Config/Windows/WindowsEngine.ini</span><br><span class="line">Config/Android/AndroidEngine.ini</span><br><span class="line">Config/IOS/IOSEngine.ini</span><br></pre></td></tr></table></figure>

<h3 id="Load-Only-the-Shader-Quality-Levels-Needed"><a href="#Load-Only-the-Shader-Quality-Levels-Needed" class="headerlink" title="Load Only the Shader Quality Levels Needed"></a>Load Only the Shader Quality Levels Needed</h3><p>By default, the engine loads all quality level shaders into memory. If there is no need to implement quality switching, unnecessary quality levels can be avoided to reduce shader memory usage.</p>
<p>In <code>Project Settings</code> - <code>Engine</code> - <code>Rendering</code> - <code>Materials</code> - <code>Game Discards Unused Material Quality Levels</code>:</p>
<p><img data-src="https://img.imzlp.com/imgs/zlp/blog/notes/ue/index/2021/20210324154036.webp"></p>
<p>Alternatively, you can add the following configuration to <code>DefaultEngine.ini</code>:</p>
<figure class="highlight ini"><figcaption><span>DefaultEngine.ini</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[/Script/Engine.RendererSettings]</span></span><br><span class="line"><span class="attr">r.DiscardUnusedQuality</span>=<span class="literal">True</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>When running in game mode, whether to keep shaders for all quality levels in memory or only those needed for the current quality level.</p>
</blockquote>
<ul>
<li>Unchecked: Keep all quality levels in memory allowing a runtime quality level change.(default)</li>
<li>Checked: Discard unused quality levels when loading content for the game, saving some memory.</li>
</ul>
<h3 id="Reduce-Shader-Variants"><a href="#Reduce-Shader-Variants" class="headerlink" title="Reduce Shader Variants"></a>Reduce Shader Variants</h3><p>You can reduce the number of parent materials and enable the following options in <code>Project Settings</code> - <code>Engine</code> - <code>Rendering</code>:</p>
<p><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/19135/20210330152835.webp"></p>
<h3 id="Share-Material-Shader-Code"><a href="#Share-Material-Shader-Code" class="headerlink" title="Share Material Shader Code"></a>Share Material Shader Code</h3><p>In the packaging settings of <code>Project Settings</code> - <code>Packaging</code>, you can set <code>Share Material Shader Code</code> and <code>Shared Material Native Libraries</code> to reduce the size of the package and memory usage (which increases loading time).</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * By default shader code gets saved inline inside material assets, </span></span><br><span class="line"><span class="comment"> * enabling this option will store only shader code once as individual files</span></span><br><span class="line"><span class="comment"> * This will reduce overall package size but might increase loading time</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">UPROPERTY</span>(config, EditAnywhere, Category=Packaging)</span><br><span class="line"><span class="type">bool</span> bShareMaterialShaderCode;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * By default shader shader code gets saved into individual platform agnostic files,</span></span><br><span class="line"><span class="comment"> * enabling this option will use the platform-specific library format if and only if one is available</span></span><br><span class="line"><span class="comment"> * This will reduce overall package size but might increase loading time</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">UPROPERTY</span>(config, EditAnywhere, Category=Packaging, meta = (EditCondition = <span class="string">&quot;bShareMaterialShaderCode&quot;</span>, ConfigRestartRequired = <span class="literal">true</span>))</span><br><span class="line"><span class="type">bool</span> bSharedMaterialNativeLibraries;</span><br></pre></td></tr></table></figure>
<p>After enabling this, the packaged output will generate the following files:</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ShaderArchive-Blank425-PCD3D_SM5.ushaderbytecode</span><br><span class="line">ShaderCode-Global-PCD3D_SM5.ushaderbytecode</span><br></pre></td></tr></table></figure>
<p>However, if subsequent cook resource shader changes occur while the base package still contains old ShaderBytecode information, it may lead to material loss.<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/notes/ue/index/2021/pak-shadercode-error-in-ue425.webp"></p>
<p>There are three solutions:</p>
<ol>
<li>Package the Shaderbytecode files in the pak during subsequent packaging and load them at mount time;</li>
<li>During cooked hot updates, package the Shaderbytecode within the resource;</li>
<li>Create a ShaderPatch for loading after hot updates.</li>
</ol>
<p>For a more specific implementation process regarding hot updating Shaderbytecode, you can refer to my previous article <a target="_blank" rel="noopener" href="https://imzlp.com/posts/5867/">UE4 Hot Update: Create Shader Patch</a>.</p>
<h3 id="Disable-UMG-Template-Creation"><a href="#Disable-UMG-Template-Creation" class="headerlink" title="Disable UMG Template Creation"></a>Disable UMG Template Creation</h3><p>The engine has a feature to cache blueprint controls for accelerated creation, but it can lead to memory wastage. This can be configured to be disabled:</p>
<p><img data-src="https://img.imzlp.com/imgs/zlp/blog/notes/ue/index/2021/20210324153016.webp"></p>
<p>You can also directly modify the engine’s code to provide default values through class initialization:</p>
<figure class="highlight cpp"><figcaption><span>Source\Editor\UMGEditor\Public\WidgetBlueprint.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UPROPERTY</span>(EditAnywhere, AdvancedDisplay, Category=WidgetBlueprintOptions, AssetRegistrySearchable)</span><br><span class="line"><span class="type">bool</span> bForceSlowConstructionPath;</span><br></pre></td></tr></table></figure>
<p>This variable is checked in the following code:</p>
<figure class="highlight cpp"><figcaption><span>Source\Editor\UMGEditor\Private\WidgetBlueprintCompiler.cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">FWidgetBlueprintCompilerContext::CanAllowTemplate</span><span class="params">(FCompilerResultsLog&amp; MessageLog, UWidgetBlueprintGeneratedClass* InClass)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="comment">// If this widget forces the slow construction path, we can&#x27;t template it.</span></span><br><span class="line">  <span class="keyword">if</span> ( WidgetBP-&gt;bForceSlowConstructionPath )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">GetDefault</span>&lt;UUMGEditorProjectSettings&gt;()-&gt;<span class="built_in">CompilerOption_CookSlowConstructionWidgetTree</span>(WidgetBP))</span><br><span class="line">    &#123;</span><br><span class="line">      MessageLog.<span class="built_in">Note</span>(*<span class="built_in">LOCTEXT</span>(<span class="string">&quot;ForceSlowConstruction&quot;</span>, <span class="string">&quot;Fast Templating Disabled By User.&quot;</span>).<span class="built_in">ToString</span>());</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      MessageLog.<span class="built_in">Error</span>(*<span class="built_in">LOCTEXT</span>(<span class="string">&quot;UnableToForceSlowConstruction&quot;</span>, <span class="string">&quot;This project has [Cook Slow Construction Widget Tree] disabled, so [Force Slow Construction Path] is no longer allowed.&quot;</span>).<span class="built_in">ToString</span>());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Disable-PakCache"><a href="#Disable-PakCache" class="headerlink" title="Disable PakCache"></a>Disable PakCache</h3><p>The engine has PakCache enabled by default. When reading files from a Pak, it will read additional memory for caching, which can be a considerable memory usage (viewed through <code>stat memory</code>):</p>
<p><img data-src="https://img.imzlp.com/imgs/zlp/blog/notes/ue/index/2021/20210318202827.webp"></p>
<p>At game startup, PakCache logs will show:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[2021.03.23-10.49.21:354][445]LogPakFile: Precache HighWater 16MB</span><br><span class="line">[2021.03.23-10.49.21:382][447]LogPakFile: Precache HighWater 32MB</span><br><span class="line">[2021.03.23-10.49.21:442][450]LogPakFile: Precache HighWater 48MB</span><br><span class="line">[2021.03.23-10.49.21:470][452]LogPakFile: Precache HighWater 64MB</span><br></pre></td></tr></table></figure>

<p>You can configure it to disable with:</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[ConsoleVariables]</span></span><br><span class="line"><span class="attr">pakcache.Enable</span>=<span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>Disabling PakCache may lead to frequent I/O issues, but the specific performance impact details will need to be analyzed when there is more time.</p>
<h3 id="Unload-Pak-Entry-Filenames"><a href="#Unload-Pak-Entry-Filenames" class="headerlink" title="Unload Pak Entry Filenames"></a>Unload Pak Entry Filenames</h3><p>Starting from UE4.23, the engine provides memory optimization configurations for mounting PakFiles:</p>
<figure class="highlight ini"><figcaption><span>DefaultEngine.ini</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Pak]</span></span><br><span class="line"><span class="attr">UnloadPakEntryFilenamesIfPossible</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">DirectoryRootsToKeepInMemoryWhenUnloadingPakEntryFilenames</span>=<span class="string">&quot;*/Config/Tags/&quot;</span></span><br><span class="line">+<span class="attr">DirectoryRootsToKeepInMemoryWhenUnloadingPakEntryFilenames</span>=<span class="string">&quot;*/Content/Localization/*&quot;</span></span><br><span class="line"><span class="attr">ShrinkPakEntriesMemoryUsage</span>=<span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>When <code>FPakPlatformFile</code> executes <code>Initialize</code>, it binds to <code>FCoreDelegates::OnOptimizeMemoryUsageForMountedPaks</code>, and this delegate can be invoked to notify <code>PakPlatformFile</code> to optimize memory for mounted Paks.</p>
<figure class="highlight cpp"><figcaption><span>Runtime\PakFile\Private\IPlatformFilePak.cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">FPakPlatformFile::OptimizeMemoryUsageForMountedPaks</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> !(IS_PROGRAM || WITH_EDITOR)</span></span><br><span class="line">	FSlowHeartBeatScope SuspendHeartBeat;</span><br><span class="line">	<span class="type">bool</span> bUnloadPakEntryFilenamesIfPossible = FParse::<span class="built_in">Param</span>(FCommandLine::<span class="built_in">Get</span>(), <span class="built_in">TEXT</span>(<span class="string">&quot;unloadpakentryfilenames&quot;</span>));</span><br><span class="line">	GConfig-&gt;<span class="built_in">GetBool</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;Pak&quot;</span>), <span class="built_in">TEXT</span>(<span class="string">&quot;UnloadPakEntryFilenamesIfPossible&quot;</span>), bUnloadPakEntryFilenamesIfPossible, GEngineIni);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> ((bUnloadPakEntryFilenamesIfPossible &amp;&amp; !FParse::<span class="built_in">Param</span>(FCommandLine::<span class="built_in">Get</span>(), <span class="built_in">TEXT</span>(<span class="string">&quot;nounloadpakentries&quot;</span>))) || FParse::<span class="built_in">Param</span>(FCommandLine::<span class="built_in">Get</span>(), <span class="built_in">TEXT</span>(<span class="string">&quot;unloadpakentries&quot;</span>)))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// With [Pak] UnloadPakEntryFilenamesIfPossible enabled, [Pak] DirectoryRootsToKeepInMemoryWhenUnloadingPakEntryFilenames</span></span><br><span class="line">		<span class="comment">// can contain pak entry directory wildcards of which the entire recursive directory structure of filenames underneath a</span></span><br><span class="line">		<span class="comment">// matching wildcard will be kept.</span></span><br><span class="line">		<span class="comment">//</span></span><br><span class="line">		<span class="comment">// Example:</span></span><br><span class="line">		<span class="comment">//   [Pak]</span></span><br><span class="line">		<span class="comment">//   DirectoryRootsToKeepInMemoryWhenUnloadingPakEntryFilenames=&quot;*/Config/Tags/&quot;</span></span><br><span class="line">		<span class="comment">//   +DirectoryRootsToKeepInMemoryWhenUnloadingPakEntryFilenames=&quot;*/Content/Localization/*&quot;</span></span><br><span class="line">		TArray&lt;FString&gt; DirectoryRootsToKeep;</span><br><span class="line">		GConfig-&gt;<span class="built_in">GetArray</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;Pak&quot;</span>), <span class="built_in">TEXT</span>(<span class="string">&quot;DirectoryRootsToKeepInMemoryWhenUnloadingPakEntryFilenames&quot;</span>), DirectoryRootsToKeep, GEngineIni);</span><br><span class="line"></span><br><span class="line">		FPakPlatformFile* PakPlatformFile = (FPakPlatformFile*)(FPlatformFileManager::<span class="built_in">Get</span>().<span class="built_in">FindPlatformFile</span>(FPakPlatformFile::<span class="built_in">GetTypeName</span>()));</span><br><span class="line">		PakPlatformFile-&gt;<span class="built_in">UnloadPakEntryFilenames</span>(&amp;DirectoryRootsToKeep);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="type">bool</span> bShrinkPakEntriesMemoryUsage = FParse::<span class="built_in">Param</span>(FCommandLine::<span class="built_in">Get</span>(), <span class="built_in">TEXT</span>(<span class="string">&quot;shrinkpakentries&quot;</span>));</span><br><span class="line">	GConfig-&gt;<span class="built_in">GetBool</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;Pak&quot;</span>), <span class="built_in">TEXT</span>(<span class="string">&quot;ShrinkPakEntriesMemoryUsage&quot;</span>), bShrinkPakEntriesMemoryUsage, GEngineIni);</span><br><span class="line">	<span class="keyword">if</span> (bShrinkPakEntriesMemoryUsage)</span><br><span class="line">	&#123;</span><br><span class="line">		FPakPlatformFile* PakPlatformFile = (FPakPlatformFile*)(FPlatformFileManager::<span class="built_in">Get</span>().<span class="built_in">FindPlatformFile</span>(FPakPlatformFile::<span class="built_in">GetTypeName</span>()));</span><br><span class="line">		PakPlatformFile-&gt;<span class="built_in">ShrinkPakEntriesMemoryUsage</span>();</span><br><span class="line">	&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>UnloadPakEntryFilenamesIfPossible: Allows unloading memory occupied by PakEntry filenames.</li>
<li>DirectoryRootsToKeepInMemoryWhenUnloadingPakEntryFilenames: Directories to retain in memory when unloading PakEntry filenames.</li>
<li>bShrinkPakEntriesMemoryUsage: Reduces the memory occupied by PakEntry.</li>
</ul>
<p>After the call, if <code>UnloadPakEntryFilenamesIfPossible</code> is enabled, it will save memory by hashing the list of filenames in the Pak. However, after unloading the Pak entry filenames, wildcard matching paths will no longer be usable.</p>
<figure class="highlight cpp"><figcaption><span>Runtime\PakFile\Public\IPlatformFilePak.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** Iterator class used to iterate over all files in pak. */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FFileIterator</span></span><br><span class="line">&#123;</span><br><span class="line">  	<span class="comment">// ...</span></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Saves memory by hashing the filenames, if possible. After this process,</span></span><br><span class="line"><span class="comment">	 * wildcard scanning of pak entries can no longer be performed. Returns TRUE</span></span><br><span class="line"><span class="comment">	 * if the process successfully unloaded filenames from this pak</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * @param CrossPakCollisionChecker A map of hash-&gt;fileentry records encountered during filename unloading on other pak files. Used to detect collisions with entries in other pak files.</span></span><br><span class="line"><span class="comment">	 * @param DirectoryRootsToKeep An array of strings in wildcard format that specify whole directory structures of filenames to keep in memory for directory iteration to work.</span></span><br><span class="line"><span class="comment">	 * @param bAllowRetries If a collision is encountered, change the intial seed and try again a fixed number of times before failing</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="type">bool</span> <span class="title">UnloadPakEntryFilenames</span><span class="params">(TMap&lt;uint64, FPakEntry&gt;&amp; CrossPakCollisionChecker, TArray&lt;FString&gt;* DirectoryRootsToKeep = <span class="literal">nullptr</span>, <span class="type">bool</span> bAllowRetries = <span class="literal">true</span>)</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="Compress-Textures"><a href="#Compress-Textures" class="headerlink" title="Compress Textures"></a>Compress Textures</h3><p>Texture compression is a lossy process that can reduce both package size and memory size when loaded. Although it is lossy, the reduction in quality on mobile platforms is often negligible, and settings can be adjusted based on project circumstances.</p>
<p>In previous notes, it was mentioned that the default asset quality and size level can be set in <code>Project Settings</code> - <code>Cooker</code> - <code>Texture</code> - <code>ASTC Compression vs Size</code>:</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">0=12x12 </span><br><span class="line">1=10x10 </span><br><span class="line">2=8x8 </span><br><span class="line">3=6x6 </span><br><span class="line">4=4x4 </span><br></pre></td></tr></table></figure>
<p>You can also set it individually for a specific Texture in the texture asset editor:</p>
<p><img data-src="https://img.imzlp.com/imgs/zlp/blog/notes/ue/index/2020/20210112154624.webp">  </p>
<p>Lowest-&gt;Highest corresponds to values <code>0-4</code>, using Default will apply the project’s settings.  </p>
<p>Additionally, setting the <code>Compression Settings</code> type will also influence the type of compression applied; Default uses the project’s settings parameter, setting it to NormalMap type will lead to <code>ASTC_4x4</code>. </p>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.nvidia.com/astc-texture-compression-for-game-assets#_Toc398571904">Using ASTC Texture Compression for Game Assets</a> </li>
<li><a target="_blank" rel="noopener" href="https://docs.unrealengine.com/en-US/RenderingAndGraphics/Textures/TextureCompressionSettings/index.html">Texture Compression Settings</a> </li>
</ul>
<script src="https://gist.github.com/imzlp/a76e3efd1ff6b7ea69da006823504cf7.js"></script>

    </div>

    
    
        
        
          
            <blockquote class="blockquote-center">
              
                本篇文章会持续更新，欢迎交流。
              
            <br/>
            
                <div class="qr-code" onclick="return false">
                    <script src="/js/qrcode.min.js"></script>
                    <div id="qrcode">
                      
                        <img src="https://imzlp.com/images/wechat-qrcode.webp">
                      
                    <p>Scan the QR code on WeChat and follow me.</p>
                    </div>
                </div>
            
            </blockquote>
          
        

        
          <div class="postCopyright" style="clear:both;">
             <span>Title:</span><a href="/posts/19135/" target="_blank">UE Performance Analysis: Memory Optimization</a><br/>
             <span>Author:</span><a href="/about" target="_blank" title="查看 LIPENGZHA 的资料">LIPENGZHA</a><br/>
             <span>Publish Date:</span>2021/03/30 10:59<br/>
             
             <span>Word Count:</span><span class="page-count">10k Words</span><br/>
             
             <span>Link:</span><a href="/posts/19135/" target="_blank" title="UE Performance Analysis: Memory Optimization">https://en.imzlp.com/posts/19135/</a>
             <span class="copy-path" data-clipboard-text="Link: https://en.imzlp.com/posts/19135/ Author: LIPENGZHA" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
             <script src="/js/jquery.min.js"></script>
             <script src="/js/clipboard.min.js"></script>
             <script> var clipboard = new Clipboard('.copy-path'); </script>
             <br/>
             
             <span>License:</span><i class="fab fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" title="Attribution-NonCommercial-ShareAlike 4.0 International">CC BY-NC-SA 4.0</a><br/>
             
             <span>Reprinting of the full article is prohibited.</span>
          </div>
        
    

        
  <div class="reward-container">
    <div>Your donation will encourage me to keep creating!</div>
    <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
      Donate
    </button>
    <div id="qr" style="display: none;">
        
        <div style="display: inline-block;">
          <img src="/images/reward/wechatpay.webp" alt="LIPENGZHA WeChat Pay">
          <p>WeChat Pay</p>
        </div>

    </div>
  </div>



      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/UnrealEngine/" rel="tag"># UnrealEngine</a>
              <a href="/tags/Profiling/" rel="tag"># Profiling</a>
              <a href="/tags/%E5%86%85%E5%AD%98%E4%BC%98%E5%8C%96/" rel="tag"># 内存优化</a>
              <a href="/tags/Memory/" rel="tag"># Memory</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/posts/17996/" rel="prev" title="UE Development Notes: Android">
      <i class="fa fa-chevron-left"></i> UE Development Notes: Android
    </a></div>
      <div class="post-nav-item">
    <a href="/posts/16895/" rel="next" title="UE Hot update: Questions & Answers">
      UE Hot update: Questions & Answers <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
      <div class="tabs tabs-comment">
        <ul class="nav-tabs">
            <li class="tab"><a href="#comment-utteranc">utteranc</a></li>
            <li class="tab"><a href="#comment-valine">valine</a></li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane utteranc" id="comment-utteranc">
              
  
  <div class="comments">
  <script src="https://utteranc.es/client.js" repo="hxhb/blog-comments" issue-term="pathname" theme="github-light" crossorigin="anonymous" async></script>
  </div>
  
  
            </div>
            <div class="tab-pane valine" id="comment-valine">
              <div class="comments" id="valine-comments"></div>
            </div>
        </div>
      </div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Memory-Analysis-Tools"><span class="nav-number">1.</span> <span class="nav-text">Memory Analysis Tools</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Memory-Optimization-Solutions"><span class="nav-number">2.</span> <span class="nav-text">Memory Optimization Solutions</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Disable-Unnecessary-Feature-Support"><span class="nav-number">2.1.</span> <span class="nav-text">Disable Unnecessary Feature Support</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Control-AssetRegistry-Serialization"><span class="nav-number">2.2.</span> <span class="nav-text">Control AssetRegistry Serialization</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Load-Only-the-Shader-Quality-Levels-Needed"><span class="nav-number">2.3.</span> <span class="nav-text">Load Only the Shader Quality Levels Needed</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Reduce-Shader-Variants"><span class="nav-number">2.4.</span> <span class="nav-text">Reduce Shader Variants</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Share-Material-Shader-Code"><span class="nav-number">2.5.</span> <span class="nav-text">Share Material Shader Code</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Disable-UMG-Template-Creation"><span class="nav-number">2.6.</span> <span class="nav-text">Disable UMG Template Creation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Disable-PakCache"><span class="nav-number">2.7.</span> <span class="nav-text">Disable PakCache</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Unload-Pak-Entry-Filenames"><span class="nav-number">2.8.</span> <span class="nav-text">Unload Pak Entry Filenames</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Compress-Textures"><span class="nav-number">2.9.</span> <span class="nav-text">Compress Textures</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person" oncontextmenu="return false" οndragstart="return false">
    <img class="site-author-image" itemprop="image" alt="LIPENGZHA"
      src="https://img.imzlp.com/imgs/zlp/picgo/2023/202304152112902.webp">
  <p class="site-author-name" itemprop="name">LIPENGZHA</p>
  <div class="site-description" itemprop="description">"I think, therefore I am"</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
             
          <span class="site-state-item-count">190</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">95</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">190</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/hxhb" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;hxhb" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://linkedin.com/in/lipengzha" title="Linkedin → https:&#x2F;&#x2F;linkedin.com&#x2F;in&#x2F;lipengzha" rel="noopener" target="_blank"><i class="fab fa-linkedin fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/imzlp" title="知乎 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;imzlp" rel="noopener" target="_blank"><i class="fa fa-custom zhihu fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/images/wechat-qrcode-offical.webp" title="微信公众号 → &#x2F;images&#x2F;wechat-qrcode-offical.webp"><i class="fab fa-weixin fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:imzlp@foxmail.com" title="E-Mail → mailto:imzlp@foxmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-rss fa-fw"></i></a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://consolehelp.imzlp.com/" title="https:&#x2F;&#x2F;consolehelp.imzlp.com&#x2F;" rel="noopener" target="_blank">UE Console Help</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://imzlp.com/opensource/" title="https:&#x2F;&#x2F;imzlp.com&#x2F;opensource&#x2F;" rel="noopener" target="_blank">Open Source Projects</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://imzlp.com/posts/11515/" title="https:&#x2F;&#x2F;imzlp.com&#x2F;posts&#x2F;11515&#x2F;" rel="noopener" target="_blank">UE C++ API Dash Documents</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://ue5wiki.com/" title="https:&#x2F;&#x2F;ue5wiki.com&#x2F;" rel="noopener" target="_blank">Unreal Engine Wiki</a>
        </li>
    </ul>
  </div>

      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2014 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">LIPENGZHA</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="Symbols count total">1.5m</span>
</div>
  <div class="powered-by-other">
    
	    <center>Github Pages | Actions | NeXT | Cloudflare | Hexo Deploy</center>
      
  </div>

<script>
function checkWebp(callback) {
    var img = new Image();
    img.onload = function () { callback((img.width > 0) && (img.height > 0)); };
    img.onerror = function () { callback(false); };
    img.src = 'data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA';
}
function showImage(useWebp) {
    var imgs = [].slice.call(document.querySelectorAll('img'));
    imgs.forEach(function (e) {
        if (!useWebp) {
            var src = e.getAttribute('data-src')
            src = src.replace(/\.webp$/, '.png');
            e.setAttribute('data-src', src);
        }
    });
}
checkWebp(showImage);
</script>

        








      </div>
    </footer>
  </div>

  
  <script src="//lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/animejs/3.2.1/anime.min.js"></script>
  <script src="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/jquery/3.5.1/jquery.min.js"></script>
  <script src="//lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/fancybox/3.5.7/jquery.fancybox.min.js"></script>
  <script src="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/lozad.js/1.16.0/lozad.min.js"></script>
  <script src="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/pangu/4.0.7/pangu.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>



<script src="/js/code-unfold.js"></script>

  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>




  
<script src="/js/local-search.js"></script>









<script>
document.querySelectorAll('.pdfobject-container').forEach(element => {
  let url = element.dataset.target;
  let pdfOpenParams = {
    navpanes : 0,
    toolbar  : 0,
    statusbar: 0,
    pagemode : 'thumbs',
    view     : 'FitH'
  };
  let pdfOpenFragment = '#' + Object.entries(pdfOpenParams).map(([key, value]) => `${key}=${encodeURIComponent(value)}`).join('&');
  let fullURL = `/lib/pdf/web/viewer.html?file=${encodeURIComponent(url)}${pdfOpenFragment}`;

  if (NexT.utils.supportsPDFs()) {
    element.innerHTML = `<embed class="pdfobject" src="${url + pdfOpenFragment}" type="application/pdf" style="height: ${element.dataset.height};">`;
  } else {
    element.innerHTML = `<iframe src="${fullURL}" style="height: ${element.dataset.height};" frameborder="0"></iframe>`;
  }
});
</script>


<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


  

  

  
  <script src="//img.imzlp.com/imgs/zlp/picgo/2021/quicklink.umd.js"></script>
  <script>
      window.addEventListener('load', () => {
      quicklink({
        timeout : 3000,
        priority: true,
        ignores : [uri => uri.includes('#'),uri => uri === 'https://en.imzlp.com/posts/19135/',]
      });
      });
  </script>


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/valine/1.4.14/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    var requiredFields = 'nick';
    requiredFields = requiredFields.split(',');
    
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'oCE6RMVkVoi5MgUhvFsn1EvV-gzGzoHsz',
      appKey     : 'K9SOaNYJ8PV6xaoFggWG5xvv',
      placeholder: "Leave something behind~",
      avatar     : 'robohash',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : 'en' || 'zh-cn',
      path       : location.pathname,
      recordIP   : true,
      serverURLs : '',
      requiredFields: requiredFields
    });
  }, window.Valine);
});
</script>

</body>
</html>
