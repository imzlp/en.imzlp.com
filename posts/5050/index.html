<!DOCTYPE html>
<html lang="en,default">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon-32x32-tilt-brush.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-tilt-brush.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-tilt-brush.png">
  <link rel="mask-icon" href="/images/favicon-32x32-tilt-brush.png" color="#222">
  <meta name="google-site-verification" content="ttIkhAIFZQM9Huj8roB0l95ePN2Tv2zv2wRFksi09WA">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noto Serif SC:300,300italic,400,400italic,700,700italic|Pacifico:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Roboto Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="//lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/5.15.2/css/all.min.css">
  <link rel="stylesheet" href="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/fancybox/3.5.7/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"en.imzlp.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false,"width":280},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"manual"},"fancybox":true,"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":false,"nav":null,"activeClass":"valine"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"code_unfold":{"enable":true,"CODE_MAX_HEIGHT":600},"path":"search.xml"};
  </script>

  <meta name="description" content="Recently, I thought about a Raspberry Pi gathering dust, so today I experimented with frp for internal network penetration, allowing my Raspberry Pi at home to be accessed via the Internet.">
<meta property="og:type" content="article">
<meta property="og:title" content="Use frp to penetrate the intranet">
<meta property="og:url" content="https://en.imzlp.com/posts/5050/index.html">
<meta property="og:site_name" content="Z&#39;s Blog">
<meta property="og:description" content="Recently, I thought about a Raspberry Pi gathering dust, so today I experimented with frp for internal network penetration, allowing my Raspberry Pi at home to be accessed via the Internet.">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/blog/posts/5050/start-frps.webp">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/blog/posts/5050/server-autostart-frps.webp">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/blog/posts/5050/start-frpc.webp">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/blog/posts/5050/link-to-raspberry-pi-by-internet.webp">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/blog/posts/5050/autostart-client-frpc.webp">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/blog/posts/5050/local-mstsc-link-to-raspberry-pi.webp">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/blog/posts/5050/remote-mstsc-link-to-raspberry-pi-login.webp">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/blog/posts/5050/remote-mstsc-link-to-raspberry-pi-login2.webp">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/blog/posts/5050/remote-mstsc-link-to-raspberry-pi-login-successed.webp">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/blog/posts/5050/use-frp-rdp-link-to-my-home-computer.webp">
<meta property="article:published_time" content="2018-06-09T11:40:09.000Z">
<meta property="article:modified_time" content="2018-11-10T16:19:17.000Z">
<meta property="article:author" content="LIPENGZHA">
<meta property="article:tag" content="树莓派">
<meta property="article:tag" content="frp">
<meta property="article:tag" content="内网穿透">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img.imzlp.com/imgs/zlp/blog/posts/5050/start-frps.webp">

<link rel="canonical" href="https://en.imzlp.com/posts/5050/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>Use frp to penetrate the intranet | Z's Blog</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FDCJ41EFP5"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-FDCJ41EFP5');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.staticfile.org/lxgw-wenkai-screen-webfont/1.7.0/style.min.css" /><!-- hexo injector head_end end --><link rel="alternate" href="/atom.xml" title="Z's Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Z's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        
            
  <li class="menu-item menu-item-notes">

    <a href="/notes/" rel="section"><i class="fa fa-edit fa-fw"></i>Notes</a>

  </li>


      
        
            
  <li class="menu-item menu-item-essay">

    <a href="/essay/" rel="section"><i class="fas fa-feather-alt fa-fw"></i>Essay</a>

  </li>


      
        
            
  <li class="menu-item menu-item-resources">

    <a href="/resources/" rel="section"><i class="fa fa-inbox fa-fw"></i>Resources</a>

  </li>


      
        <li class="menu-item menu-item-friends">

    <a href="/friends/" rel="section"><i class="fas fa-link fa-fw"></i>Friends</a>

  </li>
        
            
  <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About Me</a>

  </li>


      
        <li class="menu-item menu-item-showcase">

    <a href="/showcase/" rel="section"><i class="fa fa-solid fa-trophy fa-fw"></i>ShowCase</a>

  </li>
        <li class="menu-item menu-item-changelog">

    <a href="/changelog/" rel="section"><i class="fa fa-history fa-fw"></i>Site Log</a>

  </li>
        <li class="menu-item menu-item-opensource">

    <a href="/opensource/" rel="section"><i class="fas fa-code-branch fa-fw"></i>Open Source</a>

  </li>
        <li class="menu-item menu-item-uewiki">

    <a href="https://ue5wiki.com/" rel="noopener" target="_blank"><i class="fab fa-wikipedia-w fa-fw"></i>Unreal Wiki</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>



<script type="text/javascript">
  let domain='en.imzlp.com';
  let domain_str = atob(domain);
  let pathname = location.pathname;
  if (domain_str!= location.host.toLowerCase()){
        console.log(`this host is not safe,jump to https://${domain_str}${pathname}`);
        location.href=`https://${domain_str}${pathname}`;
  }
</script>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>
  <div class="l10n-header-widget">
    <script>
      // 获取当前页面的 URL
      const currentUrl = window.location.href;
      // 替换 URL 中的部分内容
      const jumpToL10nLink = currentUrl.replace('en.imzlp.com', 'imzlp.com');
      // 将 jumpToL10nLink 绑定到一个全局变量
      window.jumpToL10nLink = jumpToL10nLink;
    </script>

    <a href="#" class="post-l10n-link" title="切换至中文版本" style="float: left;border-bottom: none;" rel="noopener" target="_blank" onclick="window.open(window.jumpToL10nLink, '_blank'); return false;">
      <i class="fa fa-solid fa-language"></i>
    </a>
  </div>



    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en"
  >
    <link itemprop="mainEntityOfPage" href="https://en.imzlp.com/posts/5050/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://img.imzlp.com/imgs/zlp/picgo/2023/202304152112902.webp">
      <meta itemprop="name" content="LIPENGZHA">
      <meta itemprop="description" content=""I think, therefore I am"">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Z's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Use frp to penetrate the intranet<a href="https://github.com/imzlp/blog-md/blob/en/_posts/2018-06-09-5050.md" class="post-edit-link" title="Edit this post" style="float: right;border-bottom: 0px;" rel="noopener" target="_blank"><i class="fa fa-pen-nib"></i></a><a href="https://imzlp.com/posts/5050/" class="post-l10n-link" title="切换至中文版本" style="float: left;border-bottom: 0px;" rel="noopener" target="_blank"><i class="fa fa-solid fa-language"></i></a>
        </h1>

        
          <div class="post-subtitle" style="text-align: center;line-height: 1;">
            <sub text-align="center" style="font-size: 15px;align-content: center;font-style: italic;bottom: 0em;">使用frp进行内网穿透</sub>
          </div>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-06-09 11:40 11:40:09:40" itemprop="dateCreated datePublished" datetime="2018-06-09T11:40:09+00:00">2018-06-09 11:40</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2018-11-10 16:19 16:19:17:19" itemprop="dateModified" datetime="2018-11-10T16:19:17+00:00">2018-11-10 16:19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/" itemprop="url" rel="index"><span itemprop="name">折腾记录</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/" itemprop="url" rel="index"><span itemprop="name">内网穿透</span></a>
                </span>
            </span>

          
            <span id="/posts/5050/" class="post-meta-item leancloud_visitors" data-flag-title="Use frp to penetrate the intranet" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>7.2k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>18 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>Recently, I thought about a Raspberry Pi gathering dust, so today I experimented with <a target="_blank" rel="noopener" href="https://github.com/fatedier/frp">frp</a> for internal network penetration, allowing my Raspberry Pi at home to be accessed via the Internet.</p>
<span id="more"></span>
<p>Prerequisites:</p>
<ol>
<li>One machine with a public IP address (either a broadband connection with a public IP or a VPS)</li>
<li>A domain name (optional)</li>
</ol>
<h2 id="Environment-Introduction"><a href="#Environment-Introduction" class="headerlink" title="Environment Introduction"></a>Environment Introduction</h2><p>First, we need to configure and start the <a target="_blank" rel="noopener" href="https://github.com/fatedier/frp">frp</a> server on a machine with a public IP. I used my own VPS, and all operations related to the frp server were executed on my VPS. The system environment is as follows:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@visionsmile:~<span class="comment"># lsb_release -a</span></span><br><span class="line">No LSB modules are available.</span><br><span class="line">Distributor ID:	Debian</span><br><span class="line">Description:	Debian GNU/Linux 8.9 (jessie)</span><br><span class="line">Release:	8.9</span><br><span class="line">Codename:	jessie</span><br></pre></td></tr></table></figure>

<h2 id="Download-frp"><a href="#Download-frp" class="headerlink" title="Download frp"></a>Download frp</h2><p>Next, download <a target="_blank" rel="noopener" href="https://github.com/fatedier/frp">frp</a>. The <a target="_blank" rel="noopener" href="https://github.com/fatedier/frp">frp</a> project provides binary programs for many platforms, which can be downloaded as needed <a target="_blank" rel="noopener" href="https://github.com/fatedier/frp/releases">here</a>.<br>I need to download the amd64 version:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ wget https://github.com/fatedier/frp/releases/download/v0.20.0/frp_0.20.0_linux_amd64.tar.gz</span><br></pre></td></tr></table></figure>
<p>After downloading, extract it:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ tar -xvzf frp_0.20.0_linux_amd64.tar.gz</span><br><span class="line">$ <span class="built_in">cd</span> frp_0.20.0_linux_amd64</span><br></pre></td></tr></table></figure>

<h2 id="frp-Configuration-and-Startup"><a href="#frp-Configuration-and-Startup" class="headerlink" title="frp Configuration and Startup"></a>frp Configuration and Startup</h2><p>At this point, the directory structure looks like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root:~/downloads/frp_0.20.0_linux_amd64<span class="comment"># ls</span></span><br><span class="line">frpc  frpc_full.ini  frpc.ini  frps  frps_full.ini  frps.ini  LICENSE</span><br></pre></td></tr></table></figure>
<p>frps is the server program for frp, and frps.ini is the configuration for the server. All configuration options for frps.ini can be found here: <a target="_blank" rel="noopener" href="https://github.com/fatedier/frp/blob/master/conf/frps_full.ini">frps_full.ini</a>.<br>The default configuration for the current version of frps.ini is as follows:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> frps.ini</span><br><span class="line">[common]</span><br><span class="line">bind_port = 7000</span><br></pre></td></tr></table></figure>
<p>Here, <code>bind_port</code> is the port that we will use to connect frpc (the frp client) to the server, so please ensure that this port is allowed through the firewall (iptables).</p>
<blockquote>
<p>Note: If it is an Alibaba Cloud server, you need to set the port to be allowed in the web security group; using ufw or iptables directly on the server will not work.</p>
</blockquote>
<p>I won’t write anything too complicated here; the default settings are sufficient. For more features, you can read the project’s <a target="_blank" rel="noopener" href="https://github.com/fatedier/frp/blob/master/README_zh.md">frp/README</a>.</p>
<p>Then you can start frp:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./frps -c frps.ini</span><br></pre></td></tr></table></figure>
<p>After execution, it appears as follows:<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/5050/start-frps.webp"></p>
<h2 id="Configure-frps-to-Start-on-Boot"><a href="#Configure-frps-to-Start-on-Boot" class="headerlink" title="Configure frps to Start on Boot"></a>Configure frps to Start on Boot</h2><p>There are two ways to configure startup on Linux: one is to add the startup command to <code>/etc/ec.local</code>, and the other is to use <code>systemd</code> to create a service. Here, I will introduce both methods, but I recommend using systemd.</p>
<p>First, copy frp to the <code>/etc</code> directory on the server:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo <span class="built_in">mkdir</span> /etc/frp</span><br><span class="line"><span class="comment"># Execute in the directory where frp is extracted</span></span><br><span class="line">$ sudo <span class="built_in">cp</span> * /etc/frp</span><br></pre></td></tr></table></figure>

<h3 id="Using-systemd"><a href="#Using-systemd" class="headerlink" title="Using systemd"></a>Using systemd</h3><p>Next, create a service for startup. I am using systemd to start the frps service:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo <span class="built_in">cd</span> /etc/systemd/system</span><br><span class="line">$ sudo nano frps.service</span><br></pre></td></tr></table></figure>
<p>Fill in the following content:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=frps daemon</span><br><span class="line">[Service]</span><br><span class="line">Type=idle</span><br><span class="line">ExecStart=/usr/bin/frp/frps -c /usr/bin/frp/frps.ini</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>
<p>Save and exit, then modify permissions:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo <span class="built_in">chmod</span> 755 frps.service</span><br></pre></td></tr></table></figure>
<p>Now you can start it:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl start frps</span><br><span class="line"><span class="comment"># Set frps service to auto-start</span></span><br><span class="line">$ sudo systemctl <span class="built_in">enable</span> frps</span><br></pre></td></tr></table></figure>

<h3 id="Using-etc-rc-local"><a href="#Using-etc-rc-local" class="headerlink" title="Using /etc/rc.local"></a>Using /etc/rc.local</h3><p>Since the server actively receives connections and does not need to depend on the startup sequence of other services, you can also directly write it to <code>/etc/rc.local</code>. The client is a bit different; I will explain that later.<br>Add the startup command (after moving the frp directory to <code>/etc/frp</code>):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo nano /etc/rc.local</span><br><span class="line"><span class="comment"># Add the following content before exit 0</span></span><br><span class="line"><span class="comment"># Start frps at boot</span></span><br><span class="line"><span class="built_in">nohup</span> /etc/frp/frps -c /etc/frp/frps.ini &gt;/dev/null 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>
<p><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/5050/server-autostart-frps.webp"></p>
<h2 id="Use-Domain-Name-to-Resolve-Server-Address-Optional"><a href="#Use-Domain-Name-to-Resolve-Server-Address-Optional" class="headerlink" title="Use Domain Name to Resolve Server Address (Optional)"></a>Use Domain Name to Resolve Server Address (Optional)</h2><p>The reason for using a domain name is that if our server encounters issues, the client will also be of no use. However, I want to be able to use a different server without changing the client if this server goes down.<br>If we directly fill in the server’s IP address in frpc, we won’t be able to achieve that, so I thought of using a domain name that resolves to the server address I want to connect to.<br>So, we use a domain name (or subdomain) that resolves to the server address we want to connect to: for instance, I used dnspod to resolve <code>frp.imzlp.com</code> to the server <code>XXX.XXX.XXX.XXX</code>. After making the changes, don’t forget to <code>ping</code> to check if it’s reachable.</p>
<p><strong>Using the same method as downloading the frp server, download the frp client. Note that the following commands are executed on the client machine (Raspberry Pi).</strong></p>
<p>The default configuration for the frp client is as follows:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ cat frpc.ini</span><br><span class="line">[common]</span><br><span class="line">server_addr = 127.0.0.1</span><br><span class="line">server_port = 7000</span><br><span class="line"></span><br><span class="line">[ssh]</span><br><span class="line">type = tcp</span><br><span class="line">local_ip = 127.0.0.1</span><br><span class="line">local_port = 22</span><br><span class="line">remote_port = 6000</span><br></pre></td></tr></table></figure>
<p>The only thing that needs to be modified temporarily is <code>server_addr</code> and <code>server_port</code>. Since I used the default port above, I only need to change <code>server_addr</code> here.<br>Change it to my custom domain name (if you don’t have a domain name, you can directly specify the server’s IP address), as follows:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ cat frpc.ini</span><br><span class="line">[common]</span><br><span class="line">server_addr = frp.imzlp.com</span><br><span class="line">server_port = 7000</span><br><span class="line"></span><br><span class="line">[ssh]</span><br><span class="line">type = tcp</span><br><span class="line">local_ip = 127.0.0.1</span><br><span class="line">local_port = 22</span><br><span class="line">remote_port = 6000</span><br></pre></td></tr></table></figure>
<p>In the <code>[ssh]</code> label, the <code>local_port</code> on the client forwards to the server’s <code>remote_port</code>. Ensure that the <code>remote_port</code> is allowed through the firewall on the server; otherwise, the connection will fail.<br>Then you can start <code>frpc</code> on the client:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./frpc -c frpc.ini</span><br></pre></td></tr></table></figure>
<p><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/5050/start-frpc.webp"></p>
<h2 id="Try-to-Connect-to-Internal-SSH"><a href="#Try-to-Connect-to-Internal-SSH" class="headerlink" title="Try to Connect to Internal SSH"></a>Try to Connect to Internal SSH</h2><p>With the above operations, both frps and frpc have been started. We can try to connect to the Raspberry Pi’s SSH via the Internet. Since I used domain name resolution, I can use the domain name directly:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh -oPort=6000 pi@frp.imzlp.com</span><br></pre></td></tr></table></figure>
<p>Note: Be sure to specify the port for the SSH connection on the server (i.e. the <code>remote_port</code> parameter in frpc.ini). If all goes well, the connection should succeed, as shown below:<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/5050/link-to-raspberry-pi-by-internet.webp"></p>
<h2 id="Configure-frpc-to-Start-on-Boot-on-the-Client"><a href="#Configure-frpc-to-Start-on-Boot-on-the-Client" class="headerlink" title="Configure frpc to Start on Boot on the Client"></a>Configure frpc to Start on Boot on the Client</h2><blockquote>
<p>Note: This is for Linux; scripts for Windows will be introduced later.</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Execute in the frp_0.20.0_linux_arm directory (configuration files have been changed)</span></span><br><span class="line">$ sudo <span class="built_in">mkdir</span> /etc/frp</span><br><span class="line">$ sudo <span class="built_in">cp</span> * /etc/frp</span><br></pre></td></tr></table></figure>

<p>For client bootup, I am using <code>systemd</code> services:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo <span class="built_in">cd</span> /etc/systemd/system</span><br><span class="line">$ sudo nano frpc.service</span><br></pre></td></tr></table></figure>
<p>Fill in the following content:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=frpc daemon</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=idle</span><br><span class="line">ExecStartPre=/bin/sleep 5</span><br><span class="line">ExecStart=/etc/frp/frpc -c /etc/frp/frpc.ini</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>
<p>Pay special attention to these two lines in the script above:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Type=idle</span><br><span class="line">ExecStartPre=/bin/sleep 5</span><br></pre></td></tr></table></figure>
<p>The purpose of these two statements is to wait for system initialization to complete. If frp starts at boot, it may fail due to the inability to connect to the network (if using a domain name, it might fail due to DNS resolution issues).<br><strong>Note:</strong> If you do not want to wait, you can remove <code>ExecStartPre</code>, but you are required to set <code>login_fail_exit</code> to <code>false</code> in the frpc configuration.</p>
<p>Start frpc and set it to start on boot:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl start frpc</span><br><span class="line">$ systemctl <span class="built_in">enable</span> frpc</span><br></pre></td></tr></table></figure>
<p><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/5050/autostart-client-frpc.webp"></p>
<h2 id="Use-kcp-Protocol"><a href="#Use-kcp-Protocol" class="headerlink" title="Use kcp Protocol"></a>Use kcp Protocol</h2><p>If you have used kcp to accelerate ss, you will know that kcp acceleration brings higher transmission efficiency and reduces latency.<br>The current version of frp (&gt;v0.12.0) supports kcp at the underlying communication protocol level and can be manually enabled in the configuration file:<br><strong>Server:</strong><br>Enable kcp protocol support in the frps.ini on the server, specifying a UDP port to receive client requests:</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># frps.ini</span><br><span class="line">[common]</span><br><span class="line">bind_port = 7000</span><br><span class="line"># kcp binds the udp port, it can be the same as bind_port</span><br><span class="line">kcp_bind_port = 7000</span><br></pre></td></tr></table></figure>

<p><strong>Client:</strong><br>Specify the protocol type to be used in frpc.ini, which currently only supports tcp and kcp. Other proxy configurations do not need to change:</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># frpc.ini</span><br><span class="line">[common]</span><br><span class="line">server_addr = x.x.x.x</span><br><span class="line"># server_port should be set to frps&#x27;s kcp_bind_port</span><br><span class="line">server_port = 7000</span><br><span class="line">protocol = kcp</span><br></pre></td></tr></table></figure>

<h2 id="Enable-Encryption-and-Traffic-Compression"><a href="#Enable-Encryption-and-Traffic-Compression" class="headerlink" title="Enable Encryption and Traffic Compression"></a>Enable Encryption and Traffic Compression</h2><p>Some local area networks may perform traffic feature recognition and interception, so frp also offers traffic encryption and compression (add to frpc.ini):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">use_encryption = <span class="literal">true</span></span><br><span class="line">use_compression = <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h2 id="Use-Mstsc-for-Remote-Connection"><a href="#Use-Mstsc-for-Remote-Connection" class="headerlink" title="Use Mstsc for Remote Connection"></a>Use Mstsc for Remote Connection</h2><p>In my previous article, <a target="_blank" rel="noopener" href="https://imzlp.com/posts/15989">Transforming Raspberry Pi into a Portable Linux Compilation Environment</a>, I mentioned that you can install <code>xrdp</code> on the Raspberry Pi so it can be connected via Windows mstsc.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Install xrdp to allow mstsc connections</span></span><br><span class="line">$ sudo apt-get install xrdp</span><br></pre></td></tr></table></figure>
<p>When connecting via LAN, it looks like this:<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/5050/local-mstsc-link-to-raspberry-pi.webp"></p>
<p>Since mstsc defaults to port 3389, when we want to access via the Internet, we need to map the Raspberry Pi (client) port 3389 to the server port.<br>The specific operation is as follows:<br>Edit the client frpc.ini and add a label:</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[xvnc]</span><br><span class="line">type=tcp</span><br><span class="line">local_ip=127.0.0.1</span><br><span class="line">local_port=3389</span><br><span class="line">remote_port=6001</span><br></pre></td></tr></table></figure>
<p>This means mapping the local 3389 port to the server’s 6001 port. Save the changes and restart the frpc service:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl restart frpc</span><br></pre></td></tr></table></figure>
<p><strong>Note:</strong> As mentioned above, ensure that the server’s 6001 port is not blocked by the firewall.<br>Once completed, you can use Mstsc to connect to the external network (again, I used the domain name):<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/5050/remote-mstsc-link-to-raspberry-pi-login.webp"><br>After connecting, it is just like connecting through the local network:<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/5050/remote-mstsc-link-to-raspberry-pi-login2.webp"><br>After logging in:<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/5050/remote-mstsc-link-to-raspberry-pi-login-successed.webp"></p>
<p>The same method can also be used for remote connections on Windows clients, which is much stronger than anydesk or teamviewer.<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/5050/use-frp-rdp-link-to-my-home-computer.webp"><br>It’s incredibly smooth, just like operating a local computer.<br>You can also use <a target="_blank" rel="noopener" href="https://github.com/stascorp/rdpwrap">rdpwrap</a> so that remote connections do not log out the local account when accessing other accounts (equivalent to Windows Server functionality).</p>
<h2 id="Reload-Configuration"><a href="#Reload-Configuration" class="headerlink" title="Reload Configuration"></a>Reload Configuration</h2><p>frp provides a way to read changes from modified configuration files and apply new proxy updates (so you don’t have to stop and restart).<br>Add the following parameters to <code>frpc.ini</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># frpc.ini</span></span><br><span class="line">admin_addr = 127.0.0.1</span><br><span class="line">admin_port = 7400</span><br></pre></td></tr></table></figure>
<p>The command to reload is:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frpc reload -c ./frpc.ini</span><br></pre></td></tr></table></figure>
<p><strong>Note:</strong> The current version of frp (v0.20.0) will only reload the contents in <code>start</code>, such as <code>server_addr</code>, etc., so if <code>server_addr</code> has changed in <code>frpc.ini</code>, using <code>reload</code> will not reconnect to the new server.</p>
<h2 id="My-frp-Configuration-Files"><a href="#My-frp-Configuration-Files" class="headerlink" title="My frp Configuration Files"></a>My frp Configuration Files</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#frps.ini</span></span><br><span class="line">[common]</span><br><span class="line">bind_port = 7000</span><br><span class="line">kcp_bind_port = 7000</span><br><span class="line">token = xxxxxxx</span><br><span class="line">authentication_timeout = 900</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#frpc.ini</span></span><br><span class="line">[common]</span><br><span class="line">server_addr = frp.imzlp.com</span><br><span class="line">server_port = 7000</span><br><span class="line">protocol = kcp</span><br><span class="line">token = xxxxxxx</span><br><span class="line">login_fail_exit = <span class="literal">false</span></span><br><span class="line"><span class="comment"># To avoid connection failures caused by the same proxy name on multiple clients, each client should have a different userName</span></span><br><span class="line">user = imzlp</span><br><span class="line"></span><br><span class="line">admin_addr = 127.0.0.1</span><br><span class="line">admin_port = 7400</span><br><span class="line"></span><br><span class="line">[SSH]</span><br><span class="line"><span class="built_in">type</span> = tcp</span><br><span class="line">local_ip = 127.0.0.1</span><br><span class="line">local_port = 22</span><br><span class="line">remote_port = 6000</span><br><span class="line">use_encryption = <span class="literal">true</span></span><br><span class="line">use_compression = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">[XVNC]</span><br><span class="line"><span class="built_in">type</span>=tcp</span><br><span class="line">local_ip=127.0.0.1</span><br><span class="line">local_port=3389</span><br><span class="line">remote_port=6001</span><br><span class="line">use_encryption = <span class="literal">true</span></span><br><span class="line">use_compression = <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>I wrote a Python script to detect DNS updates for my domain. If there’s an update, it restarts the client’s frpc service:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Note: This script cannot be used on Windows.</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">initFrp</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;starting frpc service.&quot;</span>)</span><br><span class="line">    os.system(<span class="string">&quot;sudo systemctl restart frpc.service&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gethostbyname</span>(<span class="params">url=<span class="string">&quot;frp.imzlp.com&quot;</span></span>):</span><br><span class="line">    <span class="comment"># print(url)</span></span><br><span class="line">    ip=socket.gethostbyname(url)</span><br><span class="line">    <span class="comment"># print(ip)</span></span><br><span class="line">    <span class="keyword">return</span> ip</span><br><span class="line"></span><br><span class="line">url=<span class="string">&quot;frp.imzlp.com&quot;</span></span><br><span class="line">ip=gethostbyname(url)</span><br><span class="line">initFrp()</span><br><span class="line">ExecCommandIndex=<span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">if</span>(ip != gethostbyname(url)):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Restarting frpc service.&quot;</span>)</span><br><span class="line">        os.system(<span class="string">&quot;sudo systemctl restart frpc.service&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;frpc service is restarted.&quot;</span>)</span><br><span class="line">        ip = gethostbyname(url)</span><br><span class="line">        ExecCommandIndex += <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Domain frp.imzlp.com DNS IP is&quot;</span>, ip)</span><br><span class="line">    time.sleep(<span class="number">10</span>)</span><br></pre></td></tr></table></figure>
<p>Similarly, I added it to the <code>systemctl</code> for startup:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /etc/systemd/system/syncfrpcdns.service</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=Sync frpc Domain Server daemon</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=idle</span><br><span class="line">ExecStartPre=/bin/sleep 10</span><br><span class="line">ExecStart=/usr/bin/python3.4 /etc/frp/SyncFrpServerHost.py</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>
<p>It is also set to start on boot:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl <span class="built_in">enable</span> syncfrpcdns.service</span><br></pre></td></tr></table></figure>
<p>The above script can only run on Linux; I also wrote a similar one that can run on Windows:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># SyncFrpServerHost.py</span></span><br><span class="line"><span class="comment"># Usable on Windows</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">GetHotsByName</span>(<span class="params">url=<span class="string">&quot;frp.imzlp.com&quot;</span></span>):</span><br><span class="line">  ip=socket.gethostbyname(url)</span><br><span class="line">  <span class="keyword">return</span> ip</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">FrpcIsRuning</span>():</span><br><span class="line">  findTaskProcess=os.popen(<span class="string">&#x27;tasklist|find &quot;frpc.exe&quot;&#x27;</span>)</span><br><span class="line">  findTaskOut=findTaskProcess.read()</span><br><span class="line">  <span class="keyword">return</span> findTaskOut.find(<span class="string">&quot;frpc.exe&quot;</span>) != -<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">StartFrp</span>(<span class="params">frpcDir,frpcIniDir,FrpcStartUpInfo</span>):</span><br><span class="line">  frpProcess=subprocess.Popen([frpcDir,<span class="string">&quot;-c&quot;</span>,frpcIniDir],stdout = subprocess.PIPE,startupinfo=FrpcStartUpInfo)</span><br><span class="line">  <span class="keyword">while</span> <span class="keyword">not</span> FrpcIsRuning():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Starting Frpc Process Again...&quot;</span>)</span><br><span class="line">    frpProcess=subprocess.Popen([frpcDir,<span class="string">&quot;-c&quot;</span>,frpcIniDir],stdout = subprocess.PIPE,startupinfo=FrpcStartUpInfo)</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&quot;Frpc Process is starting.&quot;</span>)</span><br><span class="line">  <span class="keyword">return</span> frpProcess</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">  frpcDir=<span class="string">&quot;C:\\Program Files\\BuildPath\\UserTools\\frp\\frpc.exe&quot;</span></span><br><span class="line">  frpcIniDir=<span class="string">&quot;C:\\Program Files\\BuildPath\\UserTools\\frp\\frpc.ini&quot;</span></span><br><span class="line">  frpcDomainUrl=<span class="string">&quot;frp.imzlp.com&quot;</span></span><br><span class="line">  UpdateSleepTime=<span class="number">10</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Hide the fcp window</span></span><br><span class="line">  FrpcStartUpInfo=subprocess.STARTUPINFO()</span><br><span class="line">  FrpcStartUpInfo.dwFlags = subprocess.CREATE_NEW_CONSOLE | subprocess.STARTF_USESHOWWINDOW</span><br><span class="line">  FrpcStartUpInfo.wShowWindow=subprocess.SW_HIDE</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> FrpcIsRuning():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Restarting Frpc Process...&quot;</span>)</span><br><span class="line">    os.system(<span class="string">&quot;taskkill /f /t /im frpc.exe&quot;</span>)</span><br><span class="line">  frpProcess=StartFrp(frpcDir,frpcIniDir,FrpcStartUpInfo)</span><br><span class="line">  ip=GetHotsByName(frpcDomainUrl)</span><br><span class="line">  ExecCommandIndex=<span class="number">0</span></span><br><span class="line">  <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> FrpcIsRuning():</span><br><span class="line">      frpProcess=StartFrp(frpcDir,frpcIniDir,FrpcStartUpInfo)</span><br><span class="line">    <span class="keyword">if</span>(ip != GetHotsByName(frpcDomainUrl)):</span><br><span class="line">      frpProcess.kill()</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&quot;Restarting frpc service.&quot;</span>)</span><br><span class="line">      frpProcess=StartFrp(frpcDir,frpcIniDir,FrpcStartUpInfo)</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&quot;frpc service is restarted.&quot;</span>)</span><br><span class="line">      ip=GetHotsByName(frpcDomainUrl)</span><br><span class="line">      ExecCommandIndex += <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&quot;Domain frp.imzlp.com DNS IP is&quot;</span>, ip)</span><br><span class="line">    time.sleep(UpdateSleepTime)</span><br><span class="line"></span><br><span class="line">main()</span><br></pre></td></tr></table></figure>
<p><strong>Note:</strong> This script can act as the frpc startup program without needing to set frpc to start separately. It’s best to set <code>login_fail_exit</code> to <code>false</code> in <code>frpc.ini</code>.<br>You can create a simple VBS to hide the window when starting, or you can use <code>pythonw</code>:</p>
<figure class="highlight vbs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DIM</span> objShell</span><br><span class="line"><span class="keyword">set</span> objShell=wscript.<span class="built_in">createObject</span>(<span class="string">&quot;wscript.shell&quot;</span>)</span><br><span class="line">iReturn=objShell.Run(<span class="string">&quot;python SyncFrpServerHost.py&quot;</span>, <span class="number">0</span>, <span class="literal">TRUE</span>)</span><br></pre></td></tr></table></figure>
<p>Place its shortcut in <code>C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp</code>.</p>
<p>This way, when I switch the server for <code>frp.imzlp.me</code>, the client will detect DNS changes and update the connection to the new server.</p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>The most important thing during the operation is to check if the port is allowed through the firewall. If you cannot connect, it’s very likely that the port is blocked rather than a problem with the frp configuration.<br>For more ways to use frp, check here: <a target="_blank" rel="noopener" href="https://github.com/fatedier/frp/blob/master/README_zh.md">frp/README</a>.</p>
<h2 id="Update"><a href="#Update" class="headerlink" title="Update"></a>Update</h2><p><strong>2018.11.10 16:19</strong></p>
<ul>
<li>Added the use of systemd to start frps on the server.</li>
<li>Revised some wording.</li>
<li>Added information about Alibaba Cloud security groups.</li>
</ul>

    </div>

    
    
        
        
          
            <blockquote class="blockquote-center">
              
                The article is finished. If you have any questions, please comment and communicate.
              
            <br/>
            
                <div class="qr-code" onclick="return false">
                    <script src="/js/qrcode.min.js"></script>
                    <div id="qrcode">
                      
                        <img src="https://imzlp.com/images/wechat-qrcode.webp">
                      
                    <p>Scan the QR code on WeChat and follow me.</p>
                    </div>
                </div>
            
            </blockquote>
          
        

        
          <div class="postCopyright" style="clear:both;">
             <span>Title:</span><a href="/posts/5050/" target="_blank">Use frp to penetrate the intranet</a><br/>
             <span>Author:</span><a href="/about" target="_blank" title="查看 LIPENGZHA 的资料">LIPENGZHA</a><br/>
             <span>Publish Date:</span>2018/06/09 11:40<br/>
             
              <span>Update Date:</span>2018/11/10 16:19<br/>
             
             <span>Word Count:</span><span class="page-count">7.2k Words</span><br/>
             
             <span>Link:</span><a href="/posts/5050/" target="_blank" title="Use frp to penetrate the intranet">https://en.imzlp.com/posts/5050/</a>
             <span class="copy-path" data-clipboard-text="Link: https://en.imzlp.com/posts/5050/ Author: LIPENGZHA" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
             <script src="/js/jquery.min.js"></script>
             <script src="/js/clipboard.min.js"></script>
             <script> var clipboard = new Clipboard('.copy-path'); </script>
             <br/>
             
             <span>License:</span><i class="fab fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" title="Attribution-NonCommercial-ShareAlike 4.0 International">CC BY-NC-SA 4.0</a><br/>
             
             <span>Reprinting of the full article is prohibited.</span>
          </div>
        
    

        
  <div class="reward-container">
    <div>Your donation will encourage me to keep creating!</div>
    <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
      Donate
    </button>
    <div id="qr" style="display: none;">
        
        <div style="display: inline-block;">
          <img src="/images/reward/wechatpay.webp" alt="LIPENGZHA WeChat Pay">
          <p>WeChat Pay</p>
        </div>

    </div>
  </div>



      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E6%A0%91%E8%8E%93%E6%B4%BE/" rel="tag"># 树莓派</a>
              <a href="/tags/frp/" rel="tag"># frp</a>
              <a href="/tags/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/" rel="tag"># 内网穿透</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/posts/11515/" rel="prev" title="Crawl UE API and generate Dash documents with indexes">
      <i class="fa fa-chevron-left"></i> Crawl UE API and generate Dash documents with indexes
    </a></div>
      <div class="post-nav-item">
    <a href="/posts/3380/" rel="next" title="UE and VR Development Technical Notes">
      UE and VR Development Technical Notes <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
      <div class="tabs tabs-comment">
        <ul class="nav-tabs">
            <li class="tab"><a href="#comment-utteranc">utteranc</a></li>
            <li class="tab"><a href="#comment-valine">valine</a></li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane utteranc" id="comment-utteranc">
              
  
  <div class="comments">
  <script src="https://utteranc.es/client.js" repo="hxhb/blog-comments" issue-term="pathname" theme="github-light" crossorigin="anonymous" async></script>
  </div>
  
  
            </div>
            <div class="tab-pane valine" id="comment-valine">
              <div class="comments" id="valine-comments"></div>
            </div>
        </div>
      </div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Environment-Introduction"><span class="nav-number">1.</span> <span class="nav-text">Environment Introduction</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Download-frp"><span class="nav-number">2.</span> <span class="nav-text">Download frp</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#frp-Configuration-and-Startup"><span class="nav-number">3.</span> <span class="nav-text">frp Configuration and Startup</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Configure-frps-to-Start-on-Boot"><span class="nav-number">4.</span> <span class="nav-text">Configure frps to Start on Boot</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Using-systemd"><span class="nav-number">4.1.</span> <span class="nav-text">Using systemd</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Using-etc-rc-local"><span class="nav-number">4.2.</span> <span class="nav-text">Using &#x2F;etc&#x2F;rc.local</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Use-Domain-Name-to-Resolve-Server-Address-Optional"><span class="nav-number">5.</span> <span class="nav-text">Use Domain Name to Resolve Server Address (Optional)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Try-to-Connect-to-Internal-SSH"><span class="nav-number">6.</span> <span class="nav-text">Try to Connect to Internal SSH</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Configure-frpc-to-Start-on-Boot-on-the-Client"><span class="nav-number">7.</span> <span class="nav-text">Configure frpc to Start on Boot on the Client</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Use-kcp-Protocol"><span class="nav-number">8.</span> <span class="nav-text">Use kcp Protocol</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Enable-Encryption-and-Traffic-Compression"><span class="nav-number">9.</span> <span class="nav-text">Enable Encryption and Traffic Compression</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Use-Mstsc-for-Remote-Connection"><span class="nav-number">10.</span> <span class="nav-text">Use Mstsc for Remote Connection</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Reload-Configuration"><span class="nav-number">11.</span> <span class="nav-text">Reload Configuration</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#My-frp-Configuration-Files"><span class="nav-number">12.</span> <span class="nav-text">My frp Configuration Files</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Conclusion"><span class="nav-number">13.</span> <span class="nav-text">Conclusion</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Update"><span class="nav-number">14.</span> <span class="nav-text">Update</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person" oncontextmenu="return false" οndragstart="return false">
    <img class="site-author-image" itemprop="image" alt="LIPENGZHA"
      src="https://img.imzlp.com/imgs/zlp/picgo/2023/202304152112902.webp">
  <p class="site-author-name" itemprop="name">LIPENGZHA</p>
  <div class="site-description" itemprop="description">"I think, therefore I am"</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
             
          <span class="site-state-item-count">190</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">95</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">190</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/hxhb" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;hxhb" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://linkedin.com/in/lipengzha" title="Linkedin → https:&#x2F;&#x2F;linkedin.com&#x2F;in&#x2F;lipengzha" rel="noopener" target="_blank"><i class="fab fa-linkedin fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/imzlp" title="知乎 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;imzlp" rel="noopener" target="_blank"><i class="fa fa-custom zhihu fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/images/wechat-qrcode-offical.webp" title="微信公众号 → &#x2F;images&#x2F;wechat-qrcode-offical.webp"><i class="fab fa-weixin fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:imzlp@foxmail.com" title="E-Mail → mailto:imzlp@foxmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-rss fa-fw"></i></a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://consolehelp.imzlp.com/" title="https:&#x2F;&#x2F;consolehelp.imzlp.com&#x2F;" rel="noopener" target="_blank">UE Console Help</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://imzlp.com/opensource/" title="https:&#x2F;&#x2F;imzlp.com&#x2F;opensource&#x2F;" rel="noopener" target="_blank">Open Source Projects</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://imzlp.com/posts/11515/" title="https:&#x2F;&#x2F;imzlp.com&#x2F;posts&#x2F;11515&#x2F;" rel="noopener" target="_blank">UE C++ API Dash Documents</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://ue5wiki.com/" title="https:&#x2F;&#x2F;ue5wiki.com&#x2F;" rel="noopener" target="_blank">Unreal Engine Wiki</a>
        </li>
    </ul>
  </div>

      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2014 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">LIPENGZHA</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="Symbols count total">1.5m</span>
</div>
  <div class="powered-by-other">
    
	    <center>Github Pages | Actions | NeXT | Cloudflare | Hexo Deploy</center>
      
  </div>

<script>
function checkWebp(callback) {
    var img = new Image();
    img.onload = function () { callback((img.width > 0) && (img.height > 0)); };
    img.onerror = function () { callback(false); };
    img.src = 'data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA';
}
function showImage(useWebp) {
    var imgs = [].slice.call(document.querySelectorAll('img'));
    imgs.forEach(function (e) {
        if (!useWebp) {
            var src = e.getAttribute('data-src')
            src = src.replace(/\.webp$/, '.png');
            e.setAttribute('data-src', src);
        }
    });
}
checkWebp(showImage);
</script>

        








      </div>
    </footer>
  </div>

  
  <script src="//lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/animejs/3.2.1/anime.min.js"></script>
  <script src="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/jquery/3.5.1/jquery.min.js"></script>
  <script src="//lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/fancybox/3.5.7/jquery.fancybox.min.js"></script>
  <script src="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/lozad.js/1.16.0/lozad.min.js"></script>
  <script src="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/pangu/4.0.7/pangu.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>



<script src="/js/code-unfold.js"></script>

  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>




  
<script src="/js/local-search.js"></script>









<script>
document.querySelectorAll('.pdfobject-container').forEach(element => {
  let url = element.dataset.target;
  let pdfOpenParams = {
    navpanes : 0,
    toolbar  : 0,
    statusbar: 0,
    pagemode : 'thumbs',
    view     : 'FitH'
  };
  let pdfOpenFragment = '#' + Object.entries(pdfOpenParams).map(([key, value]) => `${key}=${encodeURIComponent(value)}`).join('&');
  let fullURL = `/lib/pdf/web/viewer.html?file=${encodeURIComponent(url)}${pdfOpenFragment}`;

  if (NexT.utils.supportsPDFs()) {
    element.innerHTML = `<embed class="pdfobject" src="${url + pdfOpenFragment}" type="application/pdf" style="height: ${element.dataset.height};">`;
  } else {
    element.innerHTML = `<iframe src="${fullURL}" style="height: ${element.dataset.height};" frameborder="0"></iframe>`;
  }
});
</script>


<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


  

  

  
  <script src="//img.imzlp.com/imgs/zlp/picgo/2021/quicklink.umd.js"></script>
  <script>
      window.addEventListener('load', () => {
      quicklink({
        timeout : 3000,
        priority: true,
        ignores : [uri => uri.includes('#'),uri => uri === 'https://en.imzlp.com/posts/5050/',]
      });
      });
  </script>


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/valine/1.4.14/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    var requiredFields = 'nick';
    requiredFields = requiredFields.split(',');
    
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'oCE6RMVkVoi5MgUhvFsn1EvV-gzGzoHsz',
      appKey     : 'K9SOaNYJ8PV6xaoFggWG5xvv',
      placeholder: "Leave something behind~",
      avatar     : 'robohash',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : 'en' || 'zh-cn',
      path       : location.pathname,
      recordIP   : true,
      serverURLs : '',
      requiredFields: requiredFields
    });
  }, window.Valine);
});
</script>

</body>
</html>
