<!DOCTYPE html>
<html lang="en,default">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon-32x32-tilt-brush.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-tilt-brush.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-tilt-brush.png">
  <link rel="mask-icon" href="/images/favicon-32x32-tilt-brush.png" color="#222">
  <meta name="google-site-verification" content="ttIkhAIFZQM9Huj8roB0l95ePN2Tv2zv2wRFksi09WA">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noto Serif SC:300,300italic,400,400italic,700,700italic|Pacifico:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Roboto Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="//lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/5.15.2/css/all.min.css">
  <link rel="stylesheet" href="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/fancybox/3.5.7/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"en.imzlp.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false,"width":280},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"manual"},"fancybox":true,"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":false,"nav":null,"activeClass":"valine"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"code_unfold":{"enable":true,"CODE_MAX_HEIGHT":600},"path":"search.xml"};
  </script>

  <meta name="description" content="When using the Unreal Engine development tool, a significant number of tasks involve resource processing and data export needs. These tasks need to be performed frequently and automatically, often int">
<meta property="og:type" content="article">
<meta property="og:title" content="UE plug-in and tool development:Commandlet">
<meta property="og:url" content="https://en.imzlp.com/posts/27475/index.html">
<meta property="og:site_name" content="Z&#39;s Blog">
<meta property="og:description" content="When using the Unreal Engine development tool, a significant number of tasks involve resource processing and data export needs. These tasks need to be performed frequently and automatically, often int">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/picgo/2023/20230322104253.webp">
<meta property="article:published_time" content="2023-03-23T13:46:03.000Z">
<meta property="article:modified_time" content="2023-03-23T13:46:03.000Z">
<meta property="article:author" content="LIPENGZHA">
<meta property="article:tag" content="UnrealEngine">
<meta property="article:tag" content="插件开发">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img.imzlp.com/imgs/zlp/picgo/2023/20230322104253.webp">

<link rel="canonical" href="https://en.imzlp.com/posts/27475/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>UE plug-in and tool development:Commandlet | Z's Blog</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FDCJ41EFP5"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-FDCJ41EFP5');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.staticfile.org/lxgw-wenkai-screen-webfont/1.7.0/style.min.css" /><!-- hexo injector head_end end --><link rel="alternate" href="/atom.xml" title="Z's Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Z's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        
            
  <li class="menu-item menu-item-notes">

    <a href="/notes/" rel="section"><i class="fa fa-edit fa-fw"></i>Notes</a>

  </li>


      
        
            
  <li class="menu-item menu-item-essay">

    <a href="/essay/" rel="section"><i class="fas fa-feather-alt fa-fw"></i>Essay</a>

  </li>


      
        
            
  <li class="menu-item menu-item-resources">

    <a href="/resources/" rel="section"><i class="fa fa-inbox fa-fw"></i>Resources</a>

  </li>


      
        <li class="menu-item menu-item-friends">

    <a href="/friends/" rel="section"><i class="fas fa-link fa-fw"></i>Friends</a>

  </li>
        
            
  <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About Me</a>

  </li>


      
        <li class="menu-item menu-item-showcase">

    <a href="/showcase/" rel="section"><i class="fa fa-solid fa-trophy fa-fw"></i>ShowCase</a>

  </li>
        <li class="menu-item menu-item-changelog">

    <a href="/changelog/" rel="section"><i class="fa fa-history fa-fw"></i>Site Log</a>

  </li>
        <li class="menu-item menu-item-opensource">

    <a href="/opensource/" rel="section"><i class="fas fa-code-branch fa-fw"></i>Open Source</a>

  </li>
        <li class="menu-item menu-item-uewiki">

    <a href="https://ue5wiki.com/" rel="noopener" target="_blank"><i class="fab fa-wikipedia-w fa-fw"></i>Unreal Wiki</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>



<script type="text/javascript">
  let domain='en.imzlp.com';
  let domain_str = atob(domain);
  let pathname = location.pathname;
  if (domain_str!= location.host.toLowerCase()){
        console.log(`this host is not safe,jump to https://${domain_str}${pathname}`);
        location.href=`https://${domain_str}${pathname}`;
  }
</script>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>
  <div class="l10n-header-widget">
    <script>
      // 获取当前页面的 URL
      const currentUrl = window.location.href;
      // 替换 URL 中的部分内容
      const jumpToL10nLink = currentUrl.replace('en.imzlp.com', 'imzlp.com');
      // 将 jumpToL10nLink 绑定到一个全局变量
      window.jumpToL10nLink = jumpToL10nLink;
    </script>

    <a href="#" class="post-l10n-link" title="切换至中文版本" style="float: left;border-bottom: none;" rel="noopener" target="_blank" onclick="window.open(window.jumpToL10nLink, '_blank'); return false;">
      <i class="fa fa-solid fa-language"></i>
    </a>
  </div>



    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en"
  >
    <link itemprop="mainEntityOfPage" href="https://en.imzlp.com/posts/27475/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://img.imzlp.com/imgs/zlp/picgo/2023/202304152112902.webp">
      <meta itemprop="name" content="LIPENGZHA">
      <meta itemprop="description" content=""I think, therefore I am"">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Z's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          UE plug-in and tool development:Commandlet<a href="https://github.com/imzlp/blog-md/blob/en/_posts/2023-03-23-27475.md" class="post-edit-link" title="Edit this post" style="float: right;border-bottom: 0px;" rel="noopener" target="_blank"><i class="fa fa-pen-nib"></i></a><a href="https://imzlp.com/posts/27475/" class="post-l10n-link" title="切换至中文版本" style="float: left;border-bottom: 0px;" rel="noopener" target="_blank"><i class="fa fa-solid fa-language"></i></a>
        </h1>

        
          <div class="post-subtitle" style="text-align: center;line-height: 1;">
            <sub text-align="center" style="font-size: 15px;align-content: center;font-style: italic;bottom: 0em;">UE插件与工具开发：Commandlet</sub>
          </div>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-03-23 13:46 13:46:03:46" itemprop="dateCreated datePublished" datetime="2023-03-23T13:46:03+00:00">2023-03-23 13:46</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/UnrealEngine/" itemprop="url" rel="index"><span itemprop="name">UnrealEngine</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/UnrealEngine/%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">插件开发</span></a>
                </span>
            </span>

          
            <span id="/posts/27475/" class="post-meta-item leancloud_visitors" data-flag-title="UE plug-in and tool development:Commandlet" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>8.6k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>22 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>When using the Unreal Engine development tool, a significant number of tasks involve resource processing and data export needs. These tasks need to be performed frequently and automatically, often integrated into a CI/CD system.</p>
<p>In the specific implementation, the <code>Commandlet</code> mechanism of UE is utilized to drive the engine in a command-line manner, performing custom behaviors.</p>
<p>Taking the Commandlet features supported in the plugin I developed as an example:</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://imzlp.com/posts/10938/">HotPatcher</a>: Export basic package information, pack patches</li>
<li><a target="_blank" rel="noopener" href="https://imzlp.com/posts/22655/">ResScannerUE</a>: Incremental scanning of changed resources</li>
<li><a target="_blank" rel="noopener" href="https://imzlp.com/posts/24350/">HotChunker</a>: Standalone packaging of Chunk</li>
<li><a target="_blank" rel="noopener" href="https://imzlp.com/posts/26943/">libZSTD</a>: Training Shader dictionaries</li>
<li><a target="_blank" rel="noopener" href="https://imzlp.com/posts/20203/">ExportNavMesh</a>: Export NavMesh data</li>
</ol>
<p>Commandlet allows for easier integration into CI/CD to achieve automation.</p>
<p>In this article, I will primarily introduce the Commandlet mechanism of UE, analyze its implementation principles, and provide some development tips and insights from my development process.</p>
<p>Additionally, this is the second article in my <a target="_blank" rel="noopener" href="https://imzlp.com/categories/UnrealEngine/%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/">UE Plugin and Tool Development</a> series, which will continue to be updated, so stay tuned.</p>
<span id="more"></span>

<h2 id="What-is-Commandlet"><a href="#What-is-Commandlet" class="headerlink" title="What is Commandlet"></a>What is Commandlet</h2><p>The UE Commandlet is a mechanism that allows driving the engine via command line, similar to traditional CLI programs:</p>
<figure class="highlight cpp"><figcaption><span>arg_printer.cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc,<span class="type">char</span>* agrv[])</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; argc; i++)&#123;</span><br><span class="line">        cout &lt;&lt; argv[i] &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This can be invoked via the command line, with parameters provided:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./arg_printer -test1 -test2</span><br></pre></td></tr></table></figure>

<p>Commandlet provides such a calling mechanism. However, the program that needs to be invoked is the engine, and it is necessary to pass the uproject file path and other parameters.</p>
<p>Taking the Cook Commandlet as an example:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UE4Editor-cmd.exe D:\Client\FGame.uproject -run=cook</span><br></pre></td></tr></table></figure>
<p>This form starts the command-line engine without launching the Editor, instead executing the defined behavior.</p>
<h2 id="Creating-Commandlet"><a href="#Creating-Commandlet" class="headerlink" title="Creating Commandlet"></a>Creating Commandlet</h2><p>To create a Commandlet for a project or plugin, it is usually added in a Module with the type <code>Editor</code>, as the logic for executing Commandlet rarely involves runtime; it is executed in the engine environment.</p>
<p>To create a custom Commandlet, a UObject class derived from <code>UCommandlet</code> must be created:</p>
<figure class="highlight cpp"><figcaption><span>ResScannerCommandlet.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once  </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Commandlets/Commandlet.h&quot;</span>  </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ResScannerCommandlet.generated.h&quot;</span>  </span></span><br><span class="line">  </span><br><span class="line"><span class="built_in">DECLARE_LOG_CATEGORY_EXTERN</span>(LogResScannerCommandlet, All, All);  </span><br><span class="line">  </span><br><span class="line"><span class="built_in">UCLASS</span>()  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RESSCANNER_API</span> UResScannerCommandlet : <span class="keyword">public</span> UCommandlet  </span><br><span class="line">&#123;  </span><br><span class="line">   <span class="built_in">GENERATED_BODY</span>()  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span>:  </span><br><span class="line">   <span class="function"><span class="keyword">virtual</span> int32 <span class="title">Main</span><span class="params">(<span class="type">const</span> FString&amp; Params)</span> <span class="keyword">override</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>The <code>Main</code> function is executed when the Commandlet is started via the <code>-run=</code> command, similar to the main function in pure C++.</p>
<p>However, it should be noted that since Commandlet is essentially a complete engine environment, it will invoke the startup of registered modules during execution, which means that a lot of pre-logic needs to be executed, and by the time it reaches the <code>Main</code> function, it will be in a complete engine state.</p>
<p>Custom operations can be performed within this function; at this point, it has the complete engine environment to handle data export or resource processing.</p>
<h2 id="Running-Commandlet"><a href="#Running-Commandlet" class="headerlink" title="Running Commandlet"></a>Running Commandlet</h2><p>As mentioned earlier, running a Commandlet needs to be done using the following command format:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UE4Editor-cmd.exe PROJECT_NAME.uproject -run=CMDLET_NAME</span><br></pre></td></tr></table></figure>

<p>When starting a Commandlet in a project, the project path must be specified as it is needed to load the project’s and plugin’s modules.</p>
<p>The <code>-run=</code> parameter specifies the name of the Commandlet to execute, which is directly related to the name of the previously created class derived from <code>UCommandlet</code>: for example, <code>UResScannerCommandlet</code> has a Commandlet name of <code>ResScanner</code>, following the rule of removing the leading <code>U</code> and trailing <code>Commandlet</code>.</p>
<p>When the engine receives the <code>-run=</code> parameter, it searches for the UClass and automatically appends the <code>Commandlet</code> suffix:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Token -- XXXXCommandlet</span></span><br><span class="line">CommandletClass = <span class="built_in">FindObject</span>&lt;UClass&gt;(ANY_PACKAGE, *Token, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure>

<p><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2023/20230323095348.webp"></p>
<p>After obtaining the UClass, an instance is created, and its Main function is called:</p>
<figure class="highlight cpp"><figcaption><span>Runtime\Launch\Private\LaunchEngineLoop.cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">UCommandlet* Commandlet = <span class="built_in">NewObject</span>&lt;UCommandlet&gt;(<span class="built_in">GetTransientPackage</span>(), CommandletClass);</span><br><span class="line"><span class="built_in">check</span>(Commandlet);</span><br><span class="line">Commandlet-&gt;<span class="built_in">AddToRoot</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Execute the commandlet.</span></span><br><span class="line"><span class="type">double</span> CommandletExecutionStartTime = FPlatformTime::<span class="built_in">Seconds</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Commandlets don&#x27;t always handle -run= properly in the command line so we&#x27;ll provide them</span></span><br><span class="line"><span class="comment">// with a custom version that doesn&#x27;t have it.</span></span><br><span class="line">Commandlet-&gt;<span class="built_in">ParseParms</span>(CommandletCommandLine);</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> STATS</span></span><br><span class="line"><span class="comment">// We have to close the scope, otherwise we will end with broken stats.</span></span><br><span class="line">CycleCount_AfterStats.<span class="built_in">StopAndResetStatId</span>();</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// STATS</span></span></span><br><span class="line">FStats::<span class="built_in">TickCommandletStats</span>();</span><br><span class="line">int32 ErrorLevel = Commandlet-&gt;<span class="built_in">Main</span>(CommandletCommandLine);</span><br><span class="line">FStats::<span class="built_in">TickCommandletStats</span>();</span><br><span class="line"></span><br><span class="line"><span class="built_in">RequestEngineExit</span>(FString::<span class="built_in">Printf</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;Commandlet %s finished execution (result %d)&quot;</span>), *Commandlet-&gt;<span class="built_in">GetName</span>(), ErrorLevel));</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note that all modules are started before entering the Commandlet’s Main function, meaning the module’s <code>StartupModule</code> is executed before Main.</p>
</blockquote>
<p>The call stack for the engine’s execution of the Commandlet Main function:</p>
<p><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2023/20230322173536.webp"></p>
<h2 id="Context"><a href="#Context" class="headerlink" title="Context"></a>Context</h2><h3 id="Detecting-Commandlet"><a href="#Detecting-Commandlet" class="headerlink" title="Detecting Commandlet"></a>Detecting Commandlet</h3><p>From the above content, it is important to remember two key points:</p>
<ol>
<li>Commandlet is located within the Editor module.</li>
<li>After entering Main, Commandlet has the complete engine environment.</li>
</ol>
<p>Since Commandlet is located in the Editor module, it may invoke other functions within the module. To distinguish between Editor startup and Commandlet startup, the following function can be used for detection:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (::<span class="built_in">IsRunningCommandlet</span>())</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// do something</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Receiving-Parameters"><a href="#Receiving-Parameters" class="headerlink" title="Receiving Parameters"></a>Receiving Parameters</h3><p>The prototype of the Commandlet function is:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">int32 <span class="title">Main</span><span class="params">(<span class="type">const</span> FString&amp; Params)</span></span></span><br></pre></td></tr></table></figure>
<p>The parameters passed in do not include the engine path and project path.</p>
<p>For example, running the command:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UE4Editor-cmd.exe G:\Client\FGame.uproject -skipcompile -run=HotChunker -TargetPlatform=IOS</span><br></pre></td></tr></table></figure>
<p>The received parameters would be:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-skipcompile -run=HotChunker -TargetPlatform=IOS</span><br></pre></td></tr></table></figure>
<p><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2023/20230323125710.webp"></p>
<p>By parsing these command-line parameters, special behaviors can be executed in Commandlet. Taking HotPatcher as an example, a configuration file can be specified via <code>-config=</code>, which will be read in Commandlet and executed according to the configuration file.</p>
<h2 id="Driving-Tick"><a href="#Driving-Tick" class="headerlink" title="Driving Tick"></a>Driving Tick</h2><p>Commandlet is, by default, an independent procedural behavior and does not drive the engine Tick; it behaves like a regular function. Once all code execution is complete, it requests to exit the engine.</p>
<figure class="highlight cpp"><figcaption><span>Runtime\Launch\Private\LaunchEngineLoop.cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">int32 ErrorLevel = Commandlet-&gt;<span class="built_in">Main</span>(CommandletCommandLine);  </span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="built_in">RequestEngineExit</span>(FString::<span class="built_in">Printf</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;Commandlet %s finished execution (result %d)&quot;</span>), *Commandlet-&gt;<span class="built_in">GetName</span>(), ErrorLevel));</span><br></pre></td></tr></table></figure>
<p>However, some needs require Tick to be driven in Commandlet to execute logic, such as frame-sharing cooking in HotPatcher, to avoid processing too many resources within a single frame, all of which need to be executed in a complete engine Tick environment.</p>
<p>To meet this need, I encapsulated a function that drives Tick within Commandlet:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CommandletHelper::MainTick</span><span class="params">(TFunction&lt;<span class="type">bool</span>()&gt; IsRequestExit)</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">   GIsRunning = <span class="literal">true</span>;  </span><br><span class="line"> </span><br><span class="line">   FDateTime LastConnectionTime = FDateTime::<span class="built_in">UtcNow</span>();  </span><br><span class="line">  </span><br><span class="line">   <span class="keyword">while</span> (GIsRunning &amp;&amp;  </span><br><span class="line">      <span class="comment">// !IsRequestingExit() &amp;&amp;  </span></span><br><span class="line">      !<span class="built_in">IsRequestExit</span>())  </span><br><span class="line">   &#123;      </span><br><span class="line">      GEngine-&gt;<span class="built_in">UpdateTimeAndHandleMaxTickRate</span>();  </span><br><span class="line">      GEngine-&gt;<span class="built_in">Tick</span>(FApp::<span class="built_in">GetDeltaTime</span>(), <span class="literal">false</span>);  </span><br><span class="line">  </span><br><span class="line">      <span class="comment">// Update task graph  </span></span><br><span class="line">      FTaskGraphInterface::<span class="built_in">Get</span>().<span class="built_in">ProcessThreadUntilIdle</span>(ENamedThreads::GameThread);  </span><br><span class="line">  </span><br><span class="line">      <span class="comment">// Execute deferred commands  </span></span><br><span class="line">      <span class="keyword">for</span> (int32 DeferredCommandsIndex = <span class="number">0</span>; DeferredCommandsIndex &lt; GEngine-&gt;DeferredCommands.<span class="built_in">Num</span>(); DeferredCommandsIndex++)  </span><br><span class="line">      &#123;         </span><br><span class="line">         GEngine-&gt;<span class="built_in">Exec</span>(GWorld, *GEngine-&gt;DeferredCommands[DeferredCommandsIndex], *GLog);  </span><br><span class="line">      &#125;  </span><br><span class="line">      GEngine-&gt;DeferredCommands.<span class="built_in">Empty</span>();  </span><br><span class="line">  </span><br><span class="line">      <span class="comment">// Flush log  </span></span><br><span class="line">      GLog-&gt;<span class="built_in">FlushThreadedLogs</span>();  </span><br><span class="line">  </span><br><span class="line"><span class="meta">#<span class="keyword">if</span> PLATFORM_WINDOWS  </span></span><br><span class="line">      <span class="keyword">if</span> (ComWrapperShutdownEvent-&gt;<span class="built_in">Wait</span>(<span class="number">0</span>))  </span><br><span class="line">      &#123;         </span><br><span class="line">         <span class="built_in">RequestEngineExit</span>();  </span><br><span class="line">      &#125;  </span><br><span class="line"><span class="meta">#<span class="keyword">endif</span>  </span></span><br><span class="line">   &#125;  </span><br><span class="line">   <span class="comment">//@todo abstract properly or delete   </span></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> PLATFORM_WINDOWS  </span></span><br><span class="line">   FPlatformProcess::<span class="built_in">ReturnSynchEventToPool</span>(ComWrapperShutdownEvent);  </span><br><span class="line">   ComWrapperShutdownEvent = <span class="literal">nullptr</span>;  </span><br><span class="line"><span class="meta">#<span class="keyword">endif</span>  </span></span><br><span class="line">  </span><br><span class="line">   GIsRunning = <span class="literal">false</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This function is called in the Main function and a callback is passed to request to exit Tick logic each time Tick is requested:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">IsRunningCommandlet</span>())  </span><br><span class="line">&#123;   </span><br><span class="line">   CommandletHelper::<span class="built_in">MainTick</span>([&amp;]() -&gt; <span class="type">bool</span>  </span><br><span class="line">   &#123;  </span><br><span class="line">      <span class="type">bool</span> bIsFinished = <span class="literal">true</span>;  </span><br><span class="line">      <span class="comment">// State control</span></span><br><span class="line">      <span class="keyword">return</span> bIsFinished;  </span><br><span class="line">   &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In HotChunker, I implemented a mechanism to package Chunk in frames using this feature.</p>
<p><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2023/20230323121609.webp"></p>
<blockquote>
<p>Note that in older engine versions, driving the engine within Commandlet has bugs, causing crashes in FSlateApplication, as Commandlet is a complete engine environment but does not include Editor related aspects. When the engine is driven within Commandlet, it triggers execution of FSlateApplication, leading to null access.</p>
</blockquote>
<h3 id="Fixing-FSlateApplication-Bugs"><a href="#Fixing-FSlateApplication-Bugs" class="headerlink" title="Fixing FSlateApplication Bugs"></a>Fixing FSlateApplication Bugs</h3><p>In Commandlet situations, FSlateApplication is not initialized, so checks need to be performed in modules used.</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Engine/Source/Editor/UnrealEd/Private/EditorEngine.cpp</span><br><span class="line">Engine/Source/Editor/UnrealEd/Private/AssetThumbnail.cpp</span><br></pre></td></tr></table></figure>

<p><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2021/image-20220428113631286.webp"></p>
<figure class="highlight cpp"><figcaption><span>UnrealEd/Private/EditorEngine.cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">FAssetThumbnailPool::Tick</span><span class="params">(<span class="type">float</span> DeltaTime)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// ++[lipengzha] fix commandlet tick crash</span></span><br><span class="line">	<span class="keyword">if</span> (!FSlateApplication::<span class="built_in">IsInitialized</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// --[lipengzha]</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2021/image-20220428113705410.webp"></p>
<figure class="highlight cpp"><figcaption><span>UnrealEd/Private/AssetThumbnail.cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">UEditorEngine::AreAllWindowsHidden</span><span class="params">()</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// ++[lipengzha] fix commandlet tick crash</span></span><br><span class="line">	<span class="keyword">if</span> (!FSlateApplication::<span class="built_in">IsInitialized</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// --[lipengzha]</span></span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>After making these modifications, it is possible to drive the engine Tick normally within Commandlet.</p>
<h2 id="Accelerating-Startup"><a href="#Accelerating-Startup" class="headerlink" title="Accelerating Startup"></a>Accelerating Startup</h2><p>As mentioned earlier, starting a Commandlet in UE essentially loads the engine and the dependent modules of the project and executes <code>StartupModule</code>. However, in some instances, certain features may not be needed and could be time-consuming, so they can be disabled on-demand.</p>
<p>The startup time of each module’s <code>StartupModule</code> can be analyzed to identify and dynamically toggle modules that take a long time to initialize based on command-line parameters. </p>
<p>I detailed how to analyze the loading times of modules in the article <a target="_blank" rel="noopener" href="https://imzlp.com/posts/22655">UE Multi-phase Automated Resource Inspection Scheme</a>, writing optimization strategies targeting time-consuming <code>LiveCoding</code>/<code>AssetRegistry</code>.</p>
<p>Taking the resource scanning of ResScanner as an example, the overall startup time of the Commandlet engine can be reduced to approximately 20 seconds, and the resource scanning process can be completed in less than 20 seconds, making the perceived time for executing Commandlet during submission in git hook scenarios insignificant.</p>
<p><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2022/20220905202831.webp"></p>
<h2 id="Intervening-in-a-Commandlet-Process"><a href="#Intervening-in-a-Commandlet-Process" class="headerlink" title="Intervening in a Commandlet Process"></a>Intervening in a Commandlet Process</h2><p>Taking Cook as an example, it invokes a CookCommandlet to execute. By default, the engine does not provide hooks for us to intervene in the various phases of Cook. If modifications are needed during the packaging process, one would have to manipulate UAT to break down the build process and maintain each phase independently.</p>
<p>However, this approach can be cumbersome considering the following needs:</p>
<ul>
<li>Train Shader dictionaries after Cook is completed and replace the original ShaderLibrary with the one compressed using the dictionary.</li>
</ul>
<p>Under default circumstances, achieving this would require stopping the packaging process after Cook, handling the custom process first, and then proceeding to the UnrealPak phase. </p>
<p>This process is quite tedious; if we want to automatically execute commands after Cook, we can use another method to intervene in the Commandlet execution process.</p>
<p>From earlier discussions, we know that Commandlet execution also involves the execution of module <code>StartupModule</code> and <code>ShutdownModule</code>. To intervene in the Commandlet execution, we can utilize this feature.</p>
<p>Taking the custom processing flow invoked by the engine after Cook as an example, this requirement can be broken down as follows:</p>
<ol>
<li>Determine whether to run in CookCommandlet.</li>
<li>Execute the processing before the engine exit after Cook is completed.</li>
</ol>
<p>Regarding the first point, we can parse the startup command line parameters and check if the <code>-run=</code> token is <code>Cook</code>, enabling us to ascertain whether we are in <code>CookCommandlet</code>:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">CommandletHelper::GetCommandletArg</span><span class="params">(<span class="type">const</span> FString&amp; Token, FString&amp; OutValue)</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">   OutValue.<span class="built_in">Empty</span>();  </span><br><span class="line">   FString Value;  </span><br><span class="line">   <span class="type">bool</span> bHasToken = FParse::<span class="built_in">Value</span>(FCommandLine::<span class="built_in">Get</span>(), *Token, Value);  </span><br><span class="line">   <span class="keyword">if</span> (bHasToken &amp;&amp; !Value.<span class="built_in">IsEmpty</span>())  </span><br><span class="line">   &#123;      </span><br><span class="line">      OutValue = Value;  </span><br><span class="line">   &#125;   </span><br><span class="line">   <span class="keyword">return</span> bHasToken &amp;&amp; !OutValue.<span class="built_in">IsEmpty</span>();  </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">CommandletHelper::IsCookCommandlet</span><span class="params">()</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">   <span class="type">bool</span> bIsCookCommandlet = <span class="literal">false</span>;  </span><br><span class="line">  </span><br><span class="line">   <span class="keyword">if</span> (::<span class="built_in">IsRunningCommandlet</span>())  </span><br><span class="line">   &#123;      </span><br><span class="line">      FString CommandletName;  </span><br><span class="line">      <span class="type">bool</span> bIsCommandlet = CommandletHelper::<span class="built_in">GetCommandletArg</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;-run=&quot;</span>), CommandletName); </span><br><span class="line">      <span class="keyword">if</span> (bIsCommandlet &amp;&amp; !CommandletName.<span class="built_in">IsEmpty</span>())  </span><br><span class="line">      &#123;         </span><br><span class="line">         bIsCookCommandlet = CommandletName.<span class="built_in">Equals</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;cook&quot;</span>), ESearchCase::IgnoreCase);  </span><br><span class="line">      &#125;   </span><br><span class="line">   &#125;   </span><br><span class="line">   <span class="keyword">return</span> bIsCookCommandlet;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>For the second point, we can register a callback for <code>OnPreEngineExit</code> in the StartupModule of the engine, and we avoid using <code>ShutdownModule</code> since this is executed after the engine has entered the exit state, at which point several modules have already been shut down, and executing in this flow could cause various issues.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">FlibZSTDEditorModule::StartupModule</span><span class="params">()</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line"><span class="meta">#<span class="keyword">if</span> ENGINE_MAJOR_VERSION &gt; 4 || (ENGINE_MAJOR_VERSION == 4 &amp;&amp; ENGINE_MINOR_VERSION &gt; 24)  </span></span><br><span class="line">	FCoreDelegates::OnEnginePreExit.<span class="built_in">AddRaw</span>(<span class="keyword">this</span>, &amp;FlibZSTDEditorModule::OnPreEngineExit_Commandlet);  </span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>After the engine requests to exit, this callback will trigger automatically, and we can perform checks and execute within it:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">FlibZSTDEditorModule::OnPreEngineExit_Commandlet</span><span class="params">()</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">   FCoreUObjectDelegates::PackageCreatedForLoad.<span class="built_in">Clear</span>();  </span><br><span class="line">  </span><br><span class="line"><span class="meta">#<span class="keyword">if</span> ENGINE_MAJOR_VERSION &gt; 4  </span></span><br><span class="line">   FScopeRAII ScopeRAII;  </span><br><span class="line"><span class="meta">#<span class="keyword">endif</span>  </span></span><br><span class="line">	<span class="keyword">if</span> (CommandletHelper::<span class="built_in">IsCookCommandlet</span>())  </span><br><span class="line">	&#123;</span><br><span class="line">	 <span class="comment">// do something</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note that this callback will be triggered during engine exit for both Editor and Commandlet startups, so checks should be performed to determine if it is executing in the correct environment.</p>
</blockquote>
<p>This approach allows for intervention in any Commandlet without modifying the engine. It is not limited to engine exit timings; by combining the Module’s <code>LoadingPhase</code>, many types of insertion flows can be achieved, allowing for extended creativity.</p>
<p>In my previous articles, <a target="_blank" rel="noopener" href="https://imzlp.com/posts/24350/">A Flexible and Non-intrusive Basic Package Split Scheme</a> and <a target="_blank" rel="noopener" href="https://imzlp.com/posts/37036/">Resource Management: Reshaping the UE Package Split Scheme</a>, the <code>HotChunker</code> was also implemented using this method, automatically invoking HotChunker to package chunks after CookOnTheFlyServer execution, all performed non-intrusively to the engine.</p>
<p><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2022/202210231032930.webp"></p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>This article explored the creation, running, environmental detection, engine Tick driving, analysis of time consumption, startup acceleration, and intervention in Commandlet processes.</p>
<p>Commandlet is a technology widely used in tool development, and its appropriate application can easily integrate into CI/CD systems to achieve automation, reduce manual intervention, and improve efficiency.</p>

    </div>

    
    
        
        
          
            <blockquote class="blockquote-center">
              
                The article is finished. If you have any questions, please comment and communicate.
              
            <br/>
            
                <div class="qr-code" onclick="return false">
                    <script src="/js/qrcode.min.js"></script>
                    <div id="qrcode">
                      
                        <img src="https://imzlp.com/images/wechat-qrcode.webp">
                      
                    <p>Scan the QR code on WeChat and follow me.</p>
                    </div>
                </div>
            
            </blockquote>
          
        

        
          <div class="postCopyright" style="clear:both;">
             <span>Title:</span><a href="/posts/27475/" target="_blank">UE plug-in and tool development:Commandlet</a><br/>
             <span>Author:</span><a href="/about" target="_blank" title="查看 LIPENGZHA 的资料">LIPENGZHA</a><br/>
             <span>Publish Date:</span>2023/03/23 13:46<br/>
             
             <span>Word Count:</span><span class="page-count">8.6k Words</span><br/>
             
             <span>Link:</span><a href="/posts/27475/" target="_blank" title="UE plug-in and tool development:Commandlet">https://en.imzlp.com/posts/27475/</a>
             <span class="copy-path" data-clipboard-text="Link: https://en.imzlp.com/posts/27475/ Author: LIPENGZHA" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
             <script src="/js/jquery.min.js"></script>
             <script src="/js/clipboard.min.js"></script>
             <script> var clipboard = new Clipboard('.copy-path'); </script>
             <br/>
             
             <span>License:</span><i class="fab fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" title="Attribution-NonCommercial-ShareAlike 4.0 International">CC BY-NC-SA 4.0</a><br/>
             
             <span>Reprinting of the full article is prohibited.</span>
          </div>
        
    

        
  <div class="reward-container">
    <div>Your donation will encourage me to keep creating!</div>
    <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
      Donate
    </button>
    <div id="qr" style="display: none;">
        
        <div style="display: inline-block;">
          <img src="/images/reward/wechatpay.webp" alt="LIPENGZHA WeChat Pay">
          <p>WeChat Pay</p>
        </div>

    </div>
  </div>



      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/UnrealEngine/" rel="tag"># UnrealEngine</a>
              <a href="/tags/%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/" rel="tag"># 插件开发</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/posts/32412/" rel="prev" title="Unreal Resource Management: A raw uasset Encryption Scheme">
      <i class="fa fa-chevron-left"></i> Unreal Resource Management: A raw uasset Encryption Scheme
    </a></div>
      <div class="post-nav-item">
    <a href="/posts/37036/" rel="next" title="Resource Management: Reshaping UnrealEngine Subcontracting Solution">
      Resource Management: Reshaping UnrealEngine Subcontracting Solution <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
      <div class="tabs tabs-comment">
        <ul class="nav-tabs">
            <li class="tab"><a href="#comment-utteranc">utteranc</a></li>
            <li class="tab"><a href="#comment-valine">valine</a></li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane utteranc" id="comment-utteranc">
              
  
  <div class="comments">
  <script src="https://utteranc.es/client.js" repo="hxhb/blog-comments" issue-term="pathname" theme="github-light" crossorigin="anonymous" async></script>
  </div>
  
  
            </div>
            <div class="tab-pane valine" id="comment-valine">
              <div class="comments" id="valine-comments"></div>
            </div>
        </div>
      </div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#What-is-Commandlet"><span class="nav-number">1.</span> <span class="nav-text">What is Commandlet</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Creating-Commandlet"><span class="nav-number">2.</span> <span class="nav-text">Creating Commandlet</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Running-Commandlet"><span class="nav-number">3.</span> <span class="nav-text">Running Commandlet</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Context"><span class="nav-number">4.</span> <span class="nav-text">Context</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Detecting-Commandlet"><span class="nav-number">4.1.</span> <span class="nav-text">Detecting Commandlet</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Receiving-Parameters"><span class="nav-number">4.2.</span> <span class="nav-text">Receiving Parameters</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Driving-Tick"><span class="nav-number">5.</span> <span class="nav-text">Driving Tick</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Fixing-FSlateApplication-Bugs"><span class="nav-number">5.1.</span> <span class="nav-text">Fixing FSlateApplication Bugs</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Accelerating-Startup"><span class="nav-number">6.</span> <span class="nav-text">Accelerating Startup</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Intervening-in-a-Commandlet-Process"><span class="nav-number">7.</span> <span class="nav-text">Intervening in a Commandlet Process</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Conclusion"><span class="nav-number">8.</span> <span class="nav-text">Conclusion</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person" oncontextmenu="return false" οndragstart="return false">
    <img class="site-author-image" itemprop="image" alt="LIPENGZHA"
      src="https://img.imzlp.com/imgs/zlp/picgo/2023/202304152112902.webp">
  <p class="site-author-name" itemprop="name">LIPENGZHA</p>
  <div class="site-description" itemprop="description">"I think, therefore I am"</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
             
          <span class="site-state-item-count">190</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">95</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">190</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/hxhb" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;hxhb" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://linkedin.com/in/lipengzha" title="Linkedin → https:&#x2F;&#x2F;linkedin.com&#x2F;in&#x2F;lipengzha" rel="noopener" target="_blank"><i class="fab fa-linkedin fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/imzlp" title="知乎 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;imzlp" rel="noopener" target="_blank"><i class="fa fa-custom zhihu fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/images/wechat-qrcode-offical.webp" title="微信公众号 → &#x2F;images&#x2F;wechat-qrcode-offical.webp"><i class="fab fa-weixin fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:imzlp@foxmail.com" title="E-Mail → mailto:imzlp@foxmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-rss fa-fw"></i></a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://consolehelp.imzlp.com/" title="https:&#x2F;&#x2F;consolehelp.imzlp.com&#x2F;" rel="noopener" target="_blank">UE Console Help</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://imzlp.com/opensource/" title="https:&#x2F;&#x2F;imzlp.com&#x2F;opensource&#x2F;" rel="noopener" target="_blank">Open Source Projects</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://imzlp.com/posts/11515/" title="https:&#x2F;&#x2F;imzlp.com&#x2F;posts&#x2F;11515&#x2F;" rel="noopener" target="_blank">UE C++ API Dash Documents</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://ue5wiki.com/" title="https:&#x2F;&#x2F;ue5wiki.com&#x2F;" rel="noopener" target="_blank">Unreal Engine Wiki</a>
        </li>
    </ul>
  </div>

      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2014 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">LIPENGZHA</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="Symbols count total">1.5m</span>
</div>
  <div class="powered-by-other">
    
	    <center>Github Pages | Actions | NeXT | Cloudflare | Hexo Deploy</center>
      
  </div>

<script>
function checkWebp(callback) {
    var img = new Image();
    img.onload = function () { callback((img.width > 0) && (img.height > 0)); };
    img.onerror = function () { callback(false); };
    img.src = 'data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA';
}
function showImage(useWebp) {
    var imgs = [].slice.call(document.querySelectorAll('img'));
    imgs.forEach(function (e) {
        if (!useWebp) {
            var src = e.getAttribute('data-src')
            src = src.replace(/\.webp$/, '.png');
            e.setAttribute('data-src', src);
        }
    });
}
checkWebp(showImage);
</script>

        








      </div>
    </footer>
  </div>

  
  <script src="//lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/animejs/3.2.1/anime.min.js"></script>
  <script src="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/jquery/3.5.1/jquery.min.js"></script>
  <script src="//lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/fancybox/3.5.7/jquery.fancybox.min.js"></script>
  <script src="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/lozad.js/1.16.0/lozad.min.js"></script>
  <script src="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/pangu/4.0.7/pangu.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>



<script src="/js/code-unfold.js"></script>

  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>




  
<script src="/js/local-search.js"></script>









<script>
document.querySelectorAll('.pdfobject-container').forEach(element => {
  let url = element.dataset.target;
  let pdfOpenParams = {
    navpanes : 0,
    toolbar  : 0,
    statusbar: 0,
    pagemode : 'thumbs',
    view     : 'FitH'
  };
  let pdfOpenFragment = '#' + Object.entries(pdfOpenParams).map(([key, value]) => `${key}=${encodeURIComponent(value)}`).join('&');
  let fullURL = `/lib/pdf/web/viewer.html?file=${encodeURIComponent(url)}${pdfOpenFragment}`;

  if (NexT.utils.supportsPDFs()) {
    element.innerHTML = `<embed class="pdfobject" src="${url + pdfOpenFragment}" type="application/pdf" style="height: ${element.dataset.height};">`;
  } else {
    element.innerHTML = `<iframe src="${fullURL}" style="height: ${element.dataset.height};" frameborder="0"></iframe>`;
  }
});
</script>


<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


  

  

  
  <script src="//img.imzlp.com/imgs/zlp/picgo/2021/quicklink.umd.js"></script>
  <script>
      window.addEventListener('load', () => {
      quicklink({
        timeout : 3000,
        priority: true,
        ignores : [uri => uri.includes('#'),uri => uri === 'https://en.imzlp.com/posts/27475/',]
      });
      });
  </script>


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/valine/1.4.14/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    var requiredFields = 'nick';
    requiredFields = requiredFields.split(',');
    
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'oCE6RMVkVoi5MgUhvFsn1EvV-gzGzoHsz',
      appKey     : 'K9SOaNYJ8PV6xaoFggWG5xvv',
      placeholder: "Leave something behind~",
      avatar     : 'robohash',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : 'en' || 'zh-cn',
      path       : location.pathname,
      recordIP   : true,
      serverURLs : '',
      requiredFields: requiredFields
    });
  }, window.Valine);
});
</script>

</body>
</html>
