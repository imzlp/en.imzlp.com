<!DOCTYPE html>
<html lang="en,default">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon-32x32-tilt-brush.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-tilt-brush.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-tilt-brush.png">
  <link rel="mask-icon" href="/images/favicon-32x32-tilt-brush.png" color="#222">
  <meta name="google-site-verification" content="ttIkhAIFZQM9Huj8roB0l95ePN2Tv2zv2wRFksi09WA">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noto Serif SC:300,300italic,400,400italic,700,700italic|Pacifico:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Roboto Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="//lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/5.15.2/css/all.min.css">
  <link rel="stylesheet" href="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/fancybox/3.5.7/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"en.imzlp.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false,"width":280},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"manual"},"fancybox":true,"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":false,"nav":null,"activeClass":"valine"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"code_unfold":{"enable":true,"CODE_MAX_HEIGHT":600},"path":"search.xml"};
  </script>

  <meta name="description" content="POSIX Threads (English: POSIX Threads, commonly abbreviated as Pthreads) is the POSIX thread standard that defines a set of APIs for creating and manipulating threads.">
<meta property="og:type" content="article">
<meta property="og:title" content="Pthread multithreaded programming">
<meta property="og:url" content="https://en.imzlp.com/posts/58408/index.html">
<meta property="og:site_name" content="Z&#39;s Blog">
<meta property="og:description" content="POSIX Threads (English: POSIX Threads, commonly abbreviated as Pthreads) is the POSIX thread standard that defines a set of APIs for creating and manipulating threads.">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/blog/posts/58408/01.webp">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/blog/posts/58408/02.webp">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/blog/posts/58408/03.webp">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/blog/posts/58408/04.webp">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/blog/posts/58408/05.webp">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/blog/posts/58408/06.webp">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/blog/posts/58408/05.webp">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/blog/posts/58408/08.webp">
<meta property="article:published_time" content="2016-06-04T17:08:48.000Z">
<meta property="article:modified_time" content="2016-06-04T17:08:48.000Z">
<meta property="article:author" content="LIPENGZHA">
<meta property="article:tag" content="编程笔记">
<meta property="article:tag" content="多线程">
<meta property="article:tag" content="Pthread">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img.imzlp.com/imgs/zlp/blog/posts/58408/01.webp">

<link rel="canonical" href="https://en.imzlp.com/posts/58408/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>Pthread multithreaded programming | Z's Blog</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FDCJ41EFP5"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-FDCJ41EFP5');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.staticfile.org/lxgw-wenkai-screen-webfont/1.7.0/style.min.css" /><!-- hexo injector head_end end --><link rel="alternate" href="/atom.xml" title="Z's Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Z's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        
            
  <li class="menu-item menu-item-notes">

    <a href="/notes/" rel="section"><i class="fa fa-edit fa-fw"></i>Notes</a>

  </li>


      
        
            
  <li class="menu-item menu-item-essay">

    <a href="/essay/" rel="section"><i class="fas fa-feather-alt fa-fw"></i>Essay</a>

  </li>


      
        
            
  <li class="menu-item menu-item-resources">

    <a href="/resources/" rel="section"><i class="fa fa-inbox fa-fw"></i>Resources</a>

  </li>


      
        <li class="menu-item menu-item-friends">

    <a href="/friends/" rel="section"><i class="fas fa-link fa-fw"></i>Friends</a>

  </li>
        
            
  <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About Me</a>

  </li>


      
        <li class="menu-item menu-item-showcase">

    <a href="/showcase/" rel="section"><i class="fa fa-solid fa-trophy fa-fw"></i>ShowCase</a>

  </li>
        <li class="menu-item menu-item-changelog">

    <a href="/changelog/" rel="section"><i class="fa fa-history fa-fw"></i>Site Log</a>

  </li>
        <li class="menu-item menu-item-opensource">

    <a href="/opensource/" rel="section"><i class="fas fa-code-branch fa-fw"></i>Open Source</a>

  </li>
        <li class="menu-item menu-item-uewiki">

    <a href="https://ue5wiki.com/" rel="noopener" target="_blank"><i class="fab fa-wikipedia-w fa-fw"></i>Unreal Wiki</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>



<script type="text/javascript">
  let domain='en.imzlp.com';
  let domain_str = atob(domain);
  let pathname = location.pathname;
  if (domain_str!= location.host.toLowerCase()){
        console.log(`this host is not safe,jump to https://${domain_str}${pathname}`);
        location.href=`https://${domain_str}${pathname}`;
  }
</script>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>
  <div class="l10n-header-widget">
    <script>
      // 获取当前页面的 URL
      const currentUrl = window.location.href;
      // 替换 URL 中的部分内容
      const jumpToL10nLink = currentUrl.replace('en.imzlp.com', 'imzlp.com');
      // 将 jumpToL10nLink 绑定到一个全局变量
      window.jumpToL10nLink = jumpToL10nLink;
    </script>

    <a href="#" class="post-l10n-link" title="切换至中文版本" style="float: left;border-bottom: none;" rel="noopener" target="_blank" onclick="window.open(window.jumpToL10nLink, '_blank'); return false;">
      <i class="fa fa-solid fa-language"></i>
    </a>
  </div>



    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en"
  >
    <link itemprop="mainEntityOfPage" href="https://en.imzlp.com/posts/58408/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://img.imzlp.com/imgs/zlp/picgo/2023/202304152112902.webp">
      <meta itemprop="name" content="LIPENGZHA">
      <meta itemprop="description" content=""I think, therefore I am"">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Z's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Pthread multithreaded programming<a href="https://github.com/imzlp/blog-md/blob/en/_posts/2016-06-04-58408.md" class="post-edit-link" title="Edit this post" style="float: right;border-bottom: 0px;" rel="noopener" target="_blank"><i class="fa fa-pen-nib"></i></a><a href="https://imzlp.com/posts/58408/" class="post-l10n-link" title="切换至中文版本" style="float: left;border-bottom: 0px;" rel="noopener" target="_blank"><i class="fa fa-solid fa-language"></i></a>
        </h1>

        
          <div class="post-subtitle" style="text-align: center;line-height: 1;">
            <sub text-align="center" style="font-size: 15px;align-content: center;font-style: italic;bottom: 0em;">Pthread多线程编程</sub>
          </div>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-06-04 17:08 17:08:48:08" itemprop="dateCreated datePublished" datetime="2016-06-04T17:08:48+00:00">2016-06-04 17:08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/UNIX/" itemprop="url" rel="index"><span itemprop="name">UNIX</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/UNIX/POSIX/" itemprop="url" rel="index"><span itemprop="name">POSIX</span></a>
                </span>
            </span>

          
            <span id="/posts/58408/" class="post-meta-item leancloud_visitors" data-flag-title="Pthread multithreaded programming" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>5.6k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>14 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/POSIX%E7%BA%BF%E7%A8%8B">POSIX Threads</a> (English: POSIX Threads, commonly abbreviated as Pthreads) is the POSIX thread standard that defines a set of APIs for creating and manipulating threads.</p>
<span id="more"></span>

<p>In the pthread thread library, we commonly use the following:</p>
<p>Prototype for the function that creates a thread in the Pthread library:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">pthread_create</span><span class="params">(<span class="type">pthread_t</span> *thread,<span class="type">pthread_attr_t</span> *attr,<span class="type">void</span> *(*func)(<span class="type">void</span>*),<span class="type">void</span> *arg)</span></span></span><br></pre></td></tr></table></figure>

<p>Here is a simple multithreading code. I will gradually summarize the knowledge used in multithreading by analyzing several pieces of code.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> NUM 5</span></span><br><span class="line"><span class="function"><span class="type">void</span> *<span class="title">print</span><span class="params">(<span class="type">void</span> *m)</span></span>&#123;</span><br><span class="line">	<span class="type">char</span> *cp=(<span class="type">char</span>*)m;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;NUM;++i)&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,cp);</span><br><span class="line">		<span class="comment">// Clear the input buffer</span></span><br><span class="line">		<span class="built_in">fflush</span>(stdout);</span><br><span class="line">		<span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc,<span class="type">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">pthread_t</span> t1,t2;</span><br><span class="line">	<span class="built_in">pthread_create</span>(&amp;t1, <span class="literal">NULL</span>, print, (<span class="type">void</span> *)<span class="string">&quot;t1 thread&quot;</span>);</span><br><span class="line">	<span class="built_in">pthread_create</span>(&amp;t2, <span class="literal">NULL</span>, print, (<span class="type">void</span> *)<span class="string">&quot;t2 thread&quot;</span>);</span><br><span class="line">	<span class="built_in">pthread_join</span>(t1, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="built_in">pthread_join</span>(t2, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note: The <code>-lpthread</code> parameter must be used when compiling. For example: <code>clang++ -o pthread.exe pthread.cc -lpthread</code></p>
</blockquote>
<p>Using a <code>makefile</code> is more convenient, here is the <code>makefile</code> I used:</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># compile pthread.c</span></span><br><span class="line">CC=clang</span><br><span class="line">CBSJ=pthread.c</span><br><span class="line">EXXX=pthread.exe</span><br><span class="line">CANSHU=-std=c99</span><br><span class="line">LPTHREAD=-lpthread</span><br><span class="line">WARING=-W</span><br><span class="line"></span><br><span class="line"><span class="section">start:<span class="variable">$(OBJS)</span></span></span><br><span class="line">	<span class="variable">$(CC)</span> -o <span class="variable">$(EXXX)</span> <span class="variable">$(CBSJ)</span> <span class="variable">$(CANSHU)</span> <span class="variable">$(LPTHREAD)</span> <span class="variable">$(WARING)</span></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">	rm -f <span class="variable">$(EXXX)</span></span><br></pre></td></tr></table></figure>

<p>The compilation result is:<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/58408/01.webp"></p>
<p>Next, let’s analyze several functions used from the pthread thread library:</p>
<table>
<thead>
<tr>
<th align="center">pthread_create</th>
<th>Create a new thread</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Header File</td>
<td><strong>pthread.h</strong></td>
</tr>
<tr>
<td align="center">Function Prototype</td>
<td>int pthread_create(<strong>pthread_t</strong> thread,<strong>pthread_attr_t</strong> attr,<strong>void *(*func)(void*)</strong>,<strong>void</strong> *arg)</td>
</tr>
<tr>
<td align="center">Parameter Analysis</td>
<td><strong>thread</strong>——Pointer to a pthread_t type variable<br/><strong>attr</strong>——Pointer to a pthread_attr_t type variable, or NULL<br/><strong>func</strong>——Pointer to the function to be run by the new thread<br/><strong>arg</strong>——Argument passed to func</td>
</tr>
<tr>
<td align="center">Return Value</td>
<td>0——Successful return<br/>errcode (non-zero error code)——Error</td>
</tr>
</tbody></table>
<p>The <code>pthread_create</code> function creates a new execution thread, which calls func(arg) within the new thread. The new thread’s attributes can be specified by the attr parameter. If attr is NULL, the thread uses default attributes. func is a function that takes a pointer as an argument and returns a pointer upon completion. The parameters and return values are defined as pointers of type void, allowing them to point to any type of value.</p>
<table>
<thead>
<tr>
<th align="center">pthread_join</th>
<th>Wait for a thread to terminate</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Header File</td>
<td><strong>pthread.h</strong></td>
</tr>
<tr>
<td align="center">Function Prototype</td>
<td>int pthread_join(<strong>pthread_t</strong> thread,<strong>void</strong> **retval)</td>
</tr>
<tr>
<td align="center">Parameters</td>
<td>thread——The thread to wait for<br/>retval——Pointer to a variable to store the thread’s return value</td>
</tr>
<tr>
<td align="center">Return Value</td>
<td>0——Successful return<br/>errcode (non-zero error code)——Error</td>
</tr>
</tbody></table>
<p><code>pthread_join</code> causes the calling thread to suspend until the thread specified by the thread parameter terminates. If retval is not NULL, the return value of the thread will be stored in the variable pointed to by retval.</p>
<p>When the thread terminates, the pthread_join function returns 0. If an error occurs, a non-zero error code is returned. It will result in an error code if a thread tries to wait for a non-existent thread, multiple threads try to wait for the same thread, or a thread tries to wait for itself.</p>
<blockquote>
<p>Inter-process communication can occur via <code>pipes</code>, <code>sockets</code>, <code>signals</code>, <code>exits</code>, and the runtime environment. Inter-thread communication is also straightforward. Multiple threads run in a single process and share global variables; therefore, they can communicate by setting and reading those global variables. However, accessing shared memory can be both useful and dangerous for threads.</p>
</blockquote>
<p>Consider the following code, where two threads operate on a global variable:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> NUM 5</span></span><br><span class="line"><span class="comment">// Create a global variable for multiple threads to access</span></span><br><span class="line"><span class="type">int</span> counter=<span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="type">void</span> *<span class="title">print_counter</span><span class="params">(<span class="type">void</span>* m)</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; NUM; ++i)&#123;</span><br><span class="line">		<span class="comment">// Output the value of counter</span></span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;count = %d\n&quot;</span>,counter);</span><br><span class="line">		<span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc,<span class="type">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">pthread_t</span> t1;</span><br><span class="line">  	<span class="comment">// Create a thread that calls print_counter function without passing a meaningful value</span></span><br><span class="line">	<span class="built_in">pthread_create</span>(&amp;t1, <span class="literal">NULL</span>, print_counter, <span class="literal">NULL</span>);</span><br><span class="line">  	<span class="comment">// Access to counter in the main thread</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; NUM; ++i)&#123;</span><br><span class="line">      	<span class="comment">// Increment counter</span></span><br><span class="line">		counter++;</span><br><span class="line">		<span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">pthread_join</span>(t1, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>In the code above, two threads are used. The main thread executes a loop to increment the counter by 1 every second. Before entering the loop, the main thread creates a new thread, which runs a function to print the value of the counter. The main function and print_counter run in the same process, thus both have access to the counter.</p>
<p>The order of execution of the threads is unpredictable. This can be seen from the output results.</p>
<p><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/58408/02.webp"></p>
<p>It can be observed that sometimes it executes in the expected way, but other times it does not.</p>
<p>This is because the scheduling between threads does not guarantee that the main thread will execute before the created thread. It is possible that we may execute the created thread t1 multiple times before the main thread starts, or after the main thread has entered its loop, hence the output order is not certain.</p>
<p><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/58408/03.webp"></p>
<p>When not using sleep, the execution result looks like this:</p>
<p><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/58408/04.webp"></p>
<p>Here is another piece of code that uses two threads to count the number of words in two files:</p>
<p>Sample statistics:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// test1.txt is 14 words</span></span><br><span class="line">I need to follow my heart.</span><br><span class="line">In order to see more of the world.</span><br><span class="line"><span class="comment">// test2.txt is 4 words</span></span><br><span class="line">My name is zhalipeng.</span><br></pre></td></tr></table></figure>

<p>The code is as follows:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctype.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="title">count_words</span><span class="params">(<span class="type">void</span> *f)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Counter</span></span><br><span class="line"><span class="type">int</span> total_words=<span class="number">0</span>;</span><br><span class="line"><span class="comment">// Create a mutex to ensure total_words is safely read and written by both threads.</span></span><br><span class="line"><span class="type">pthread_mutex_t</span> counter_lock=PTHREAD_MUTEX_INITIALIZER;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc,<span class="type">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">pthread_t</span> t1,t2;</span><br><span class="line">	<span class="keyword">if</span>(argc!=<span class="number">3</span>)&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;usage:%s file1 file2\n&quot;</span>,argv[<span class="number">0</span>]);</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">pthread_create</span>(&amp;t1, <span class="literal">NULL</span>, count_words,(<span class="type">void</span>*)argv[<span class="number">1</span>]);</span><br><span class="line">	<span class="built_in">pthread_create</span>(&amp;t2,<span class="literal">NULL</span>,count_words,(<span class="type">void</span>*)argv[<span class="number">2</span>]);</span><br><span class="line">	<span class="built_in">pthread_join</span>(t1, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="built_in">pthread_join</span>(t2,<span class="literal">NULL</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%5d total words\n&quot;</span>,total_words);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="title">count_words</span><span class="params">(<span class="type">void</span> *f)</span></span>&#123;</span><br><span class="line">	<span class="type">char</span> *filename=(<span class="type">char</span>*)f;</span><br><span class="line">	FILE *fp;</span><br><span class="line">	<span class="type">int</span> c,prevc=<span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">	<span class="keyword">if</span>((fp=<span class="built_in">fopen</span>(filename, <span class="string">&quot;r&quot;</span>))!=<span class="literal">NULL</span>)&#123;</span><br><span class="line">		<span class="keyword">while</span>((c=<span class="built_in">getc</span>(fp))!=EOF)&#123;</span><br><span class="line">			<span class="comment">// Encountering non-letter and non-digit characters after letters and numbers treats this letter or number as the end of a word</span></span><br><span class="line">			<span class="keyword">if</span>(!<span class="built_in">isalnum</span>(c) &amp;&amp; <span class="built_in">isalnum</span>(prevc))&#123;</span><br><span class="line">				<span class="built_in">pthread_mutex_lock</span>(&amp;counter_lock);</span><br><span class="line">				total_words++;</span><br><span class="line">				<span class="built_in">pthread_mutex_unlock</span>(&amp;counter_lock);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">// printf(&quot;%c&quot;,c);</span></span><br><span class="line">			prevc=c;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">fclose</span>(fp);</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="built_in">perror</span>(filename);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// printf(&quot;\n&quot;);</span></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The running result:</p>
<p><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/58408/05.webp"></p>
<p>You can also add data to test1.txt or test2.txt:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// test2.txt is 11 words</span></span><br><span class="line">My name is zhalipeng.</span><br><span class="line">I love my family.</span><br><span class="line">I love programming!</span><br></pre></td></tr></table></figure>

<p><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/58408/06.webp"></p>
<p>If you output the order in which threads read the two files, similar to the previous code, it will also be unordered, haha. Why do I keep paying attention to these things.</p>
<p><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/58408/05.webp"></p>
<p>In the code above, several new pthread interfaces are used: <code>pthread_mutex_lock</code> and <code>pthread_mutex_unlock</code>, to ensure that the shared global variable can be read and written by one thread at a time.</p>
<blockquote>
<p>A simple example: In an airport or bus station’s public storage locker, it remains unlocked unless someone is storing something inside. When someone stores something and takes the key, no one else can open that locker until that person returns the key and unlocks it. Similarly, if two threads need to safely share a common counter, they also need a method to lock the variable, so only one thread can read from or write to the counter at any time.</p>
<p>The threading system contains a variable known as a <code>mutex</code>, which allows better cooperation between threads and avoids conflicts in accessing variables, functions, and resources.</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">pthread_mutex_lock</th>
<th>Wait for the mutex to unlock and then lock the mutex</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>pthread_mutex_unlock</strong></td>
<td><strong>Unlock the mutex</strong></td>
</tr>
<tr>
<td align="center">Header File</td>
<td><strong>pthread.h</strong></td>
</tr>
<tr>
<td align="center">Function Prototype</td>
<td>int pthread_mutex_lock(<strong>pthread_mutex_t</strong> *mutex)<br/>int pthread_mutex_unlock(<strong>pthread_mutex_t</strong> *mutex)</td>
</tr>
<tr>
<td align="center">Parameters</td>
<td><strong>mutex</strong>: Pointer to the mutex object</td>
</tr>
<tr>
<td align="center">Return Value</td>
<td>0: Successful return<br/>errcode (non-zero error code): Error</td>
</tr>
</tbody></table>
<p>Firstly, define a global variable of type <code>pthread_mutex_t</code> called counter_lock, and assign it an initial value. Then, operations on the global counter <code>total_words</code> can be wrapped between calls to <code>pthread_mutex_lock</code> and <code>pthread_mutex_unlock</code>.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">pthread_mutex_lock</span>(&amp;counter_lock);</span><br><span class="line">total_words++;</span><br><span class="line"><span class="built_in">pthread_mutex_unlock</span>(&amp;counter_lock);</span><br></pre></td></tr></table></figure>

<p>Now two threads can safely share the counter. When one thread calls <code>pthread_mutex_lock</code>, if another thread has already locked this mutex, that thread will be blocked waiting for the lock to be released before it can operate on the counter. Each thread unlocks the mutex after manipulating the counter so the shared data can be operated on by other threads.</p>
<p>Any number of threads can be suspended waiting for the mutex to unlock. When a thread unlocks the mutex, the system grants control to one of the waiting threads.</p>
<p><strong>Upgrade code:</strong></p>
<ul>
<li>Can accept an arbitrary number of files</li>
<li>Determines how many threads and struct objects (to store file information) to create based on the number of arguments obtained via arg</li>
<li>Uses struct to record the number of words in each individual file (each file has its own separate counter)</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctype.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="title">count_words</span><span class="params">(<span class="type">void</span> *f)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a struct to store file information</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">arg_set</span>&#123;</span><br><span class="line">	<span class="comment">// Store filename and counter</span></span><br><span class="line">	<span class="type">char</span> *filename;</span><br><span class="line">	<span class="type">int</span> total_words;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">pthread_mutex_t</span> counter_lock=PTHREAD_MUTEX_INITIALIZER;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc,<span class="type">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">const</span> <span class="type">int</span> NUM=argc<span class="number">-1</span>; <span class="comment">// Number of files accepted</span></span><br><span class="line">	<span class="comment">// Create NUM threads (number of files received)</span></span><br><span class="line">	<span class="type">pthread_t</span> thread[NUM];</span><br><span class="line">	<span class="comment">// Create NUM struct objects for the received files</span></span><br><span class="line">	<span class="keyword">struct</span> <span class="title class_">arg_set</span> argSet[NUM];</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; NUM; ++i)&#123;</span><br><span class="line">		argSet[i].filename=argv[i+<span class="number">1</span>];</span><br><span class="line">		argSet[i].total_words=<span class="number">0</span>;</span><br><span class="line">		<span class="built_in">pthread_create</span>(&amp;thread[i], <span class="literal">NULL</span>, count_words,(<span class="type">void</span>*)&amp;argSet[i]);</span><br><span class="line">		<span class="built_in">pthread_join</span>(thread[i],<span class="literal">NULL</span>);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;File %s in %d words\n&quot;</span>,argSet[i].filename,argSet[i].total_words);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> sumWords=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; NUM; ++i)&#123;</span><br><span class="line">		sumWords+=argSet[i].total_words;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;The total word count is %d\n&quot;</span>,sumWords);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="title">count_words</span><span class="params">(<span class="type">void</span> *f)</span></span>&#123;</span><br><span class="line">	<span class="keyword">struct</span> <span class="title class_">arg_set</span> *args=(<span class="keyword">struct</span> arg_set*)f;</span><br><span class="line">	FILE *fp;</span><br><span class="line">	<span class="type">int</span> c,prevc=<span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">	<span class="keyword">if</span>((fp=<span class="built_in">fopen</span>(args-&gt;filename, <span class="string">&quot;r&quot;</span>))!=<span class="literal">NULL</span>)&#123;</span><br><span class="line">		<span class="keyword">while</span>((c=<span class="built_in">getc</span>(fp))!=EOF)&#123;</span><br><span class="line">			<span class="comment">// Encountering non-letter and non-digit characters after letters and numbers treats this letter or number as the end of a word</span></span><br><span class="line">			<span class="keyword">if</span>(!<span class="built_in">isalnum</span>(c)&amp;&amp;<span class="built_in">isalnum</span>(prevc))&#123;</span><br><span class="line">				<span class="built_in">pthread_mutex_lock</span>(&amp;counter_lock);</span><br><span class="line">				args-&gt;total_words++;</span><br><span class="line">				<span class="built_in">pthread_mutex_unlock</span>(&amp;counter_lock);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">// printf(&quot;%c&quot;,c);</span></span><br><span class="line">			prevc=c;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">fclose</span>(fp);</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="built_in">perror</span>(args-&gt;filename);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// printf(&quot;\n&quot;);</span></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Let’s test it:</p>
<p>Here, we use four files as parameters for the program, the contents of test1.txt and test2.txt are the same as above, and the contents of test3.txt and test4.txt are as follows:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// test3.txt is 10 words</span></span><br><span class="line">commitment to excellence.</span><br><span class="line">Courage is holding on to your dream.</span><br><span class="line"><span class="comment">// test4.txt is 3 words</span></span><br><span class="line">Just <span class="keyword">for</span> fun!</span><br></pre></td></tr></table></figure>

<p><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/58408/08.webp"></p>

    </div>

    
    
        
        
          
            <blockquote class="blockquote-center">
              
                The article is finished. If you have any questions, please comment and communicate.
              
            <br/>
            
                <div class="qr-code" onclick="return false">
                    <script src="/js/qrcode.min.js"></script>
                    <div id="qrcode">
                      
                        <img src="https://imzlp.com/images/wechat-qrcode.webp">
                      
                    <p>Scan the QR code on WeChat and follow me.</p>
                    </div>
                </div>
            
            </blockquote>
          
        

        
          <div class="postCopyright" style="clear:both;">
             <span>Title:</span><a href="/posts/58408/" target="_blank">Pthread multithreaded programming</a><br/>
             <span>Author:</span><a href="/about" target="_blank" title="查看 LIPENGZHA 的资料">LIPENGZHA</a><br/>
             <span>Publish Date:</span>2016/06/04 17:08<br/>
             
             <span>Word Count:</span><span class="page-count">5.6k Words</span><br/>
             
             <span>Link:</span><a href="/posts/58408/" target="_blank" title="Pthread multithreaded programming">https://en.imzlp.com/posts/58408/</a>
             <span class="copy-path" data-clipboard-text="Link: https://en.imzlp.com/posts/58408/ Author: LIPENGZHA" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
             <script src="/js/jquery.min.js"></script>
             <script src="/js/clipboard.min.js"></script>
             <script> var clipboard = new Clipboard('.copy-path'); </script>
             <br/>
             
             <span>License:</span><i class="fab fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" title="Attribution-NonCommercial-ShareAlike 4.0 International">CC BY-NC-SA 4.0</a><br/>
             
             <span>Reprinting of the full article is prohibited.</span>
          </div>
        
    

        
  <div class="reward-container">
    <div>Your donation will encourage me to keep creating!</div>
    <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
      Donate
    </button>
    <div id="qr" style="display: none;">
        
        <div style="display: inline-block;">
          <img src="/images/reward/wechatpay.webp" alt="LIPENGZHA WeChat Pay">
          <p>WeChat Pay</p>
        </div>

    </div>
  </div>



      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E7%BC%96%E7%A8%8B%E7%AC%94%E8%AE%B0/" rel="tag"># 编程笔记</a>
              <a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" rel="tag"># 多线程</a>
              <a href="/tags/Pthread/" rel="tag"># Pthread</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/posts/27665/" rel="prev" title="Talk about the college entrance examination">
      <i class="fa fa-chevron-left"></i> Talk about the college entrance examination
    </a></div>
      <div class="post-nav-item">
    <a href="/posts/6978/" rel="next" title="Memory leak caused by deleting void* pointer">
      Memory leak caused by deleting void* pointer <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
      <div class="tabs tabs-comment">
        <ul class="nav-tabs">
            <li class="tab"><a href="#comment-utteranc">utteranc</a></li>
            <li class="tab"><a href="#comment-valine">valine</a></li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane utteranc" id="comment-utteranc">
              
  
  <div class="comments">
  <script src="https://utteranc.es/client.js" repo="hxhb/blog-comments" issue-term="pathname" theme="github-light" crossorigin="anonymous" async></script>
  </div>
  
  
            </div>
            <div class="tab-pane valine" id="comment-valine">
              <div class="comments" id="valine-comments"></div>
            </div>
        </div>
      </div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person" oncontextmenu="return false" οndragstart="return false">
    <img class="site-author-image" itemprop="image" alt="LIPENGZHA"
      src="https://img.imzlp.com/imgs/zlp/picgo/2023/202304152112902.webp">
  <p class="site-author-name" itemprop="name">LIPENGZHA</p>
  <div class="site-description" itemprop="description">"I think, therefore I am"</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
             
          <span class="site-state-item-count">190</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">95</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">190</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/hxhb" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;hxhb" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://linkedin.com/in/lipengzha" title="Linkedin → https:&#x2F;&#x2F;linkedin.com&#x2F;in&#x2F;lipengzha" rel="noopener" target="_blank"><i class="fab fa-linkedin fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/imzlp" title="知乎 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;imzlp" rel="noopener" target="_blank"><i class="fa fa-custom zhihu fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/images/wechat-qrcode-offical.webp" title="微信公众号 → &#x2F;images&#x2F;wechat-qrcode-offical.webp"><i class="fab fa-weixin fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:imzlp@foxmail.com" title="E-Mail → mailto:imzlp@foxmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-rss fa-fw"></i></a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://consolehelp.imzlp.com/" title="https:&#x2F;&#x2F;consolehelp.imzlp.com&#x2F;" rel="noopener" target="_blank">UE Console Help</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://imzlp.com/opensource/" title="https:&#x2F;&#x2F;imzlp.com&#x2F;opensource&#x2F;" rel="noopener" target="_blank">Open Source Projects</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://imzlp.com/posts/11515/" title="https:&#x2F;&#x2F;imzlp.com&#x2F;posts&#x2F;11515&#x2F;" rel="noopener" target="_blank">UE C++ API Dash Documents</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://ue5wiki.com/" title="https:&#x2F;&#x2F;ue5wiki.com&#x2F;" rel="noopener" target="_blank">Unreal Engine Wiki</a>
        </li>
    </ul>
  </div>

      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2014 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">LIPENGZHA</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="Symbols count total">1.5m</span>
</div>
  <div class="powered-by-other">
    
	    <center>Github Pages | Actions | NeXT | Cloudflare | Hexo Deploy</center>
      
  </div>

<script>
function checkWebp(callback) {
    var img = new Image();
    img.onload = function () { callback((img.width > 0) && (img.height > 0)); };
    img.onerror = function () { callback(false); };
    img.src = 'data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA';
}
function showImage(useWebp) {
    var imgs = [].slice.call(document.querySelectorAll('img'));
    imgs.forEach(function (e) {
        if (!useWebp) {
            var src = e.getAttribute('data-src')
            src = src.replace(/\.webp$/, '.png');
            e.setAttribute('data-src', src);
        }
    });
}
checkWebp(showImage);
</script>

        








      </div>
    </footer>
  </div>

  
  <script src="//lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/animejs/3.2.1/anime.min.js"></script>
  <script src="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/jquery/3.5.1/jquery.min.js"></script>
  <script src="//lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/fancybox/3.5.7/jquery.fancybox.min.js"></script>
  <script src="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/lozad.js/1.16.0/lozad.min.js"></script>
  <script src="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/pangu/4.0.7/pangu.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>



<script src="/js/code-unfold.js"></script>

  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>




  
<script src="/js/local-search.js"></script>









<script>
document.querySelectorAll('.pdfobject-container').forEach(element => {
  let url = element.dataset.target;
  let pdfOpenParams = {
    navpanes : 0,
    toolbar  : 0,
    statusbar: 0,
    pagemode : 'thumbs',
    view     : 'FitH'
  };
  let pdfOpenFragment = '#' + Object.entries(pdfOpenParams).map(([key, value]) => `${key}=${encodeURIComponent(value)}`).join('&');
  let fullURL = `/lib/pdf/web/viewer.html?file=${encodeURIComponent(url)}${pdfOpenFragment}`;

  if (NexT.utils.supportsPDFs()) {
    element.innerHTML = `<embed class="pdfobject" src="${url + pdfOpenFragment}" type="application/pdf" style="height: ${element.dataset.height};">`;
  } else {
    element.innerHTML = `<iframe src="${fullURL}" style="height: ${element.dataset.height};" frameborder="0"></iframe>`;
  }
});
</script>


<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


  

  

  
  <script src="//img.imzlp.com/imgs/zlp/picgo/2021/quicklink.umd.js"></script>
  <script>
      window.addEventListener('load', () => {
      quicklink({
        timeout : 3000,
        priority: true,
        ignores : [uri => uri.includes('#'),uri => uri === 'https://en.imzlp.com/posts/58408/',]
      });
      });
  </script>


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/valine/1.4.14/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    var requiredFields = 'nick';
    requiredFields = requiredFields.split(',');
    
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'oCE6RMVkVoi5MgUhvFsn1EvV-gzGzoHsz',
      appKey     : 'K9SOaNYJ8PV6xaoFggWG5xvv',
      placeholder: "Leave something behind~",
      avatar     : 'robohash',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : 'en' || 'zh-cn',
      path       : location.pathname,
      recordIP   : true,
      serverURLs : '',
      requiredFields: requiredFields
    });
  }, window.Valine);
});
</script>

</body>
</html>
