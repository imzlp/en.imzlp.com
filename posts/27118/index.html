<!DOCTYPE html>
<html lang="en,default">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon-32x32-tilt-brush.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-tilt-brush.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-tilt-brush.png">
  <link rel="mask-icon" href="/images/favicon-32x32-tilt-brush.png" color="#222">
  <meta name="google-site-verification" content="ttIkhAIFZQM9Huj8roB0l95ePN2Tv2zv2wRFksi09WA">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noto Serif SC:300,300italic,400,400italic,700,700italic|Pacifico:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Roboto Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="//lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/5.15.2/css/all.min.css">
  <link rel="stylesheet" href="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/fancybox/3.5.7/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"en.imzlp.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false,"width":280},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"manual"},"fancybox":true,"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":false,"nav":null,"activeClass":"valine"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"code_unfold":{"enable":true,"CODE_MAX_HEIGHT":600},"path":"search.xml"};
  </script>

  <meta name="description" content="C and C++ both use separate compilation to support a multi-source file modular mechanism, but why this is done and how it is achieved is a topic worth exploring. This article is not about the syntacti">
<meta property="og:type" content="article">
<meta property="og:title" content="C&#x2F;C++ compilation and linking model analysis">
<meta property="og:url" content="https://en.imzlp.com/posts/27118/index.html">
<meta property="og:site_name" content="Z&#39;s Blog">
<meta property="og:description" content="C and C++ both use separate compilation to support a multi-source file modular mechanism, but why this is done and how it is achieved is a topic worth exploring. This article is not about the syntacti">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/blog/posts/27118/gcc-compiler-linkage.webp">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/blog/posts/27118/linkage-draft.webp">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/blog/posts/27118/linkage-error.webp">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/blog/posts/27118/mulitDefineError.webp">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/blog/posts/27118/mulitDefineError-1.webp">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/blog/posts/27118/mulitDefineSymbol.webp">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/blog/posts/27118/mulitDefineJusyReferenceHeader.webp">
<meta property="article:published_time" content="2017-04-10T23:05:44.000Z">
<meta property="article:modified_time" content="2017-07-02T00:18:53.000Z">
<meta property="article:author" content="LIPENGZHA">
<meta property="article:tag" content="C++">
<meta property="article:tag" content="技术笔记">
<meta property="article:tag" content="C语言">
<meta property="article:tag" content="编程笔记">
<meta property="article:tag" content="编译模型">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img.imzlp.com/imgs/zlp/blog/posts/27118/gcc-compiler-linkage.webp">

<link rel="canonical" href="https://en.imzlp.com/posts/27118/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>C/C++ compilation and linking model analysis | Z's Blog</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FDCJ41EFP5"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-FDCJ41EFP5');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.staticfile.org/lxgw-wenkai-screen-webfont/1.7.0/style.min.css" /><!-- hexo injector head_end end --><link rel="alternate" href="/atom.xml" title="Z's Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Z's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        
            
  <li class="menu-item menu-item-notes">

    <a href="/notes/" rel="section"><i class="fa fa-edit fa-fw"></i>Notes</a>

  </li>


      
        
            
  <li class="menu-item menu-item-essay">

    <a href="/essay/" rel="section"><i class="fas fa-feather-alt fa-fw"></i>Essay</a>

  </li>


      
        
            
  <li class="menu-item menu-item-resources">

    <a href="/resources/" rel="section"><i class="fa fa-inbox fa-fw"></i>Resources</a>

  </li>


      
        <li class="menu-item menu-item-friends">

    <a href="/friends/" rel="section"><i class="fas fa-link fa-fw"></i>Friends</a>

  </li>
        
            
  <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About Me</a>

  </li>


      
        <li class="menu-item menu-item-showcase">

    <a href="/showcase/" rel="section"><i class="fa fa-solid fa-trophy fa-fw"></i>ShowCase</a>

  </li>
        <li class="menu-item menu-item-changelog">

    <a href="/changelog/" rel="section"><i class="fa fa-history fa-fw"></i>Site Log</a>

  </li>
        <li class="menu-item menu-item-opensource">

    <a href="/opensource/" rel="section"><i class="fas fa-code-branch fa-fw"></i>Open Source</a>

  </li>
        <li class="menu-item menu-item-uewiki">

    <a href="https://ue5wiki.com/" rel="noopener" target="_blank"><i class="fab fa-wikipedia-w fa-fw"></i>Unreal Wiki</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>



<script type="text/javascript">
  let domain='en.imzlp.com';
  let domain_str = atob(domain);
  let pathname = location.pathname;
  if (domain_str!= location.host.toLowerCase()){
        console.log(`this host is not safe,jump to https://${domain_str}${pathname}`);
        location.href=`https://${domain_str}${pathname}`;
  }
</script>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>
  <div class="l10n-header-widget">
    <script>
      // 获取当前页面的 URL
      const currentUrl = window.location.href;
      // 替换 URL 中的部分内容
      const jumpToL10nLink = currentUrl.replace('en.imzlp.com', 'imzlp.com');
      // 将 jumpToL10nLink 绑定到一个全局变量
      window.jumpToL10nLink = jumpToL10nLink;
    </script>

    <a href="#" class="post-l10n-link" title="切换至中文版本" style="float: left;border-bottom: none;" rel="noopener" target="_blank" onclick="window.open(window.jumpToL10nLink, '_blank'); return false;">
      <i class="fa fa-solid fa-language"></i>
    </a>
  </div>



    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en"
  >
    <link itemprop="mainEntityOfPage" href="https://en.imzlp.com/posts/27118/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://img.imzlp.com/imgs/zlp/picgo/2023/202304152112902.webp">
      <meta itemprop="name" content="LIPENGZHA">
      <meta itemprop="description" content=""I think, therefore I am"">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Z's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          C/C++ compilation and linking model analysis<a href="https://github.com/imzlp/blog-md/blob/en/_posts/2017-04-10-27118.md" class="post-edit-link" title="Edit this post" style="float: right;border-bottom: 0px;" rel="noopener" target="_blank"><i class="fa fa-pen-nib"></i></a><a href="https://imzlp.com/posts/27118/" class="post-l10n-link" title="切换至中文版本" style="float: left;border-bottom: 0px;" rel="noopener" target="_blank"><i class="fa fa-solid fa-language"></i></a>
        </h1>

        
          <div class="post-subtitle" style="text-align: center;line-height: 1;">
            <sub text-align="center" style="font-size: 15px;align-content: center;font-style: italic;bottom: 0em;">C/C++编译和链接模型分析</sub>
          </div>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-04-10 23:05 23:05:44:05" itemprop="dateCreated datePublished" datetime="2017-04-10T23:05:44+00:00">2017-04-10 23:05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2017-07-02 00:18 00:18:53:18" itemprop="dateModified" datetime="2017-07-02T00:18:53+00:00">2017-07-02 00:18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">技术笔记</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF%E7%AC%94%E8%AE%B0/%E7%BC%96%E8%AF%91%E5%92%8C%E9%93%BE%E6%8E%A5/" itemprop="url" rel="index"><span itemprop="name">编译和链接</span></a>
                </span>
            </span>

          
            <span id="/posts/27118/" class="post-meta-item leancloud_visitors" data-flag-title="C/C++ compilation and linking model analysis" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>11k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>28 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>C and C++ both use separate compilation to support a multi-source file modular mechanism, but why this is done and how it is achieved is a topic worth exploring. This article is not about the syntactic rules that create different linking in C and C++, but rather analyzes how C/C++ compilers implement the compilation and linking model.</p>
<span id="more"></span>
<p>Before introducing the following content, let’s first understand the concept of the <code>Translation environment</code>:</p>
<blockquote>
<p><strong>[ISO/IEC 9899:1999]</strong> A C program need not all be translated at the same time. The text of the program is kept in units called <strong>source files</strong>, (or <strong>preprocessing files</strong>) in this International Standard. A source file together with all the headers and source files included via the preprocessing directive <code>#include</code> is known as a <strong>preprocessing translation unit</strong>. After preprocessing, a preprocessing translation unit is called a <strong>translation unit</strong>.<br>Previously translated translation units may be preserved individually or in libraries. The separate translation units of a program communicate by (for example) calls to functions whose identifiers have external linkage, manipulation of objects whose identifiers have external linkage, or manipulation of data files. Translation units may be separately translated and then later linked to produce an executable program.</p>
</blockquote>
<p>The key concept to understand is <code>translation unit</code>, which refers to the code generated after a source file is processed by the preprocessor (all <code>#define</code> macros are replaced, conditional compilation <code>#ifndef/#endif</code>, and files included by <code>#include</code> are incorporated).<br>For example:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.c</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;helloworld!\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>After preprocessing:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">### Separate Compilation</span></span><br><span class="line"></span><br><span class="line">In C and C++, <span class="built_in">source</span> code is not compiled directly into the operating system executable **executable object file** <span class="keyword">in</span> one step, but rather through several steps to achieve **separate compilation** — multiple <span class="built_in">source</span> files are individually compiled into several separate modules (a program has multiple translation units), and finally these modules are unified and pieced together (**linkage**) to form an executable binary. (The reasons <span class="keyword">for</span> separating declaration and definition will be discussed later.)</span><br><span class="line"></span><br><span class="line">C++ uses the same compilation model, inherited from C, primarily because one of C++<span class="string">&#x27;s design goals was to be **compatible with C** (along with **zero overhead** (if certain features of the language are not used, there should not be additional costs) and **value semantics** (objects become independent after being copied from the source object)), for more details see the works of C++&#x27;</span>s creator, Bjarne, <span class="keyword">in</span> [The Design and Evolution of C++](https://book.douban.com/subject/1456860/).</span><br><span class="line"></span><br><span class="line">&gt; The meaning of <span class="string">&quot;compatible with C&quot;</span> is rich; it not only pertains to syntactical compatibility but also, more importantly, to the compatibility of C<span class="string">&#x27;s compilation model and runtime model — that is, being able to directly use C language files and libraries. — Chen Shuo, Linux Multithreaded Server Programming: Using the muduo C++ Network Library</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">In fact, the compilation model in C++ is much more complex than in C. This article aims to provide a concept and method of separate compilation, with more specific content to be covered in future articles.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Early C language compilers were not standalone programs (many of today&#x27;</span>s compilers are also composed of separate functional program modules <span class="keyword">in</span> a compilation toolchain). **Dennis Ritchie**’s C language compiler, written <span class="keyword">for</span> the **PDP-11**, consisted of seven executable files: **cc**/**cpp**/**as**/**ld**/**c0**/**c1**/**c2**.</span><br><span class="line"></span><br><span class="line"><span class="comment">### Why Do This?</span></span><br><span class="line"></span><br><span class="line">The main reason is that early computer performance was quite limited, and the aforementioned **Dennis Ritchie** initially used [**PDP-11**](https://en.wikipedia.org/wiki/PDP-11), <span class="built_in">which</span> had only 24KB of memory, of <span class="built_in">which</span> 16KB ran the operating system and 8KB ran user code. Therefore, due to performance limitations, the compiler could not fully represent the abstract syntax tree of a single <span class="built_in">source</span> file <span class="keyword">in</span> memory, <span class="built_in">let</span> alone run the entire compiler <span class="keyword">in</span> memory. Thus, due to memory constraints, the C language employs separate compilation to compile multiple <span class="built_in">source</span> files independently, generating multiple object files, and <span class="keyword">then</span> some method is employed to combine them (linking), allowing a complete executable file to be compiled within the limited memory.</span><br><span class="line"></span><br><span class="line"><span class="comment">### GCC Compiler</span></span><br><span class="line"></span><br><span class="line">Modern compilers (GCC/Clang) are typically composed of four parts: **preprocessor**, **compiler**, **assembler**, and **linker**. Relevant compilation parameters and their meanings can be seen <span class="keyword">in</span> GCC<span class="string">&#x27;s `gcc --help`:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">|         Parameter       |                    Meaning                    |</span></span><br><span class="line"><span class="string">| :---------------------: | :------------------------------------------: |</span></span><br><span class="line"><span class="string">|         -E              | Preprocess only; do not compile, assemble or link. |</span></span><br><span class="line"><span class="string">|         -S              |  Compile only; do not assemble or link.    |</span></span><br><span class="line"><span class="string">|         -c              |  Compile and assemble, but do not link.    |</span></span><br><span class="line"><span class="string">|      -o &amp;lt;file&amp;gt;    |   Place the output into &amp;lt;file&amp;gt;.      |</span></span><br><span class="line"><span class="string">|        -pie             | Create a position independent executable.   |</span></span><br><span class="line"><span class="string">|       -shared           |         Create a shared library.            |</span></span><br><span class="line"><span class="string">| -x &amp;lt;language&amp;gt;     | Specify the language of the following input files.&lt;br/&gt;Permissible languages include: c c++ assembler none, where &#x27;</span>none<span class="string">&#x27; means it will revert to default behavior of guessing the language based on the file&#x27;</span>s extension. |</span><br><span class="line">| -Wl,&amp;lt;options&amp;gt;     | Pass comma-separated &amp;lt;options&amp;gt; to the linker.&lt;br/&gt; When generating a dynamic <span class="built_in">link</span> library, parameters can be sent to the linker to generate an import library. |</span><br><span class="line"></span><br><span class="line">**ld** (linker) parameters (`ld --<span class="built_in">help</span>`):</span><br><span class="line"></span><br><span class="line">|        Parameter         | Meaning |</span><br><span class="line">| :-----------------------: | :------: |</span><br><span class="line">| --out-implib &amp;lt;file&amp;gt; |   Generate import library&lt;br/&gt;Generate import library <span class="keyword">for</span> shared library   |</span><br><span class="line"></span><br><span class="line">&gt; Note: Dynamic <span class="built_in">link</span> libraries generally require an import library to facilitate the linking of dynamic <span class="built_in">link</span> libraries during static program compilation, otherwise, you would need to load the DLL file using LoadLibrary yourself and use GetProcAddress to obtain the corresponding <span class="keyword">function</span> pointer (DLL).</span><br><span class="line">&gt;</span><br><span class="line">&gt; With the import library, you just need to <span class="built_in">link</span> it during the code compilation, and you can directly call the <span class="built_in">functions</span> of the dynamic <span class="built_in">link</span> library <span class="keyword">in</span> the code after including the header file.</span><br><span class="line"></span><br><span class="line">**ldd**: Outputs the shared libraries that a program depends on, usage:</span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line">$ ldd main.exe</span><br><span class="line">  ntdll.dll =&gt; /c/WINDOWS/SYSTEM32/ntdll.dll (0x7ffa14b80000)</span><br><span class="line">  KERNEL32.DLL =&gt; /c/WINDOWS/System32/KERNEL32.DLL (0x7ffa12b00000)</span><br><span class="line">  KERNELBASE.dll =&gt; /c/WINDOWS/System32/KERNELBASE.dll (0x7ffa11d90000)</span><br><span class="line">  msvcrt.dll =&gt; /c/WINDOWS/System32/msvcrt.dll (0x7ffa128a0000)</span><br><span class="line">  dynamicLib.dll =&gt; /c/Users/visionsmile/Desktop/a/dynamicLib.dll (0x64740000)</span><br><span class="line">  libstdc++-6.dll =&gt; /mingw64/bin/libstdc++-6.dll (0x6fc40000)</span><br><span class="line">  USER32.dll =&gt; /c/WINDOWS/System32/USER32.dll (0x7ffa14060000)</span><br><span class="line">  win32u.dll =&gt; /c/WINDOWS/System32/win32u.dll (0x7ffa11730000)</span><br><span class="line">  GDI32.dll =&gt; /c/WINDOWS/System32/GDI32.dll (0x7ffa12bc0000)</span><br><span class="line">  gdi32full.dll =&gt; /c/WINDOWS/System32/gdi32full.dll (0x7ffa117b0000)</span><br><span class="line">  msvcp_win.dll =&gt; /c/WINDOWS/System32/msvcp_win.dll (0x7ffa11950000)</span><br><span class="line">  libwinpthread-1.dll =&gt; /mingw64/bin/libwinpthread-1.dll (0x64940000)</span><br><span class="line">  ucrtbase.dll =&gt; /c/WINDOWS/System32/ucrtbase.dll (0x7ffa11c90000)</span><br><span class="line">  libgcc_s_seh-1.dll =&gt; /mingw64/bin/libgcc_s_seh-1.dll (0x61440000)</span><br></pre></td></tr></table></figure>

<p><strong>In Simple Terms</strong>, compiling a source file in gcc requires four steps:</p>
<ol>
<li>Preprocess (-E)</li>
<li>Compile (-S)</li>
<li>Object file (-c)</li>
<li>Link (no parameters)</li>
</ol>
<p>What has been presented above may seem convoluted, but in simple terms, the concept of allowing separate compilation lies in a multi-source file modular mechanism. This means I can use code from other source files within my current module source file without having to place all the code into a single source file. It is akin to cross-referencing in books; I indicate which chapter and section of another book discusses a particular subject, and I am referencing a concept defined in it, which you need to consult to understand what it represents.</p>
<p>In TCPL, the introduction of internal and external linkage during linking:</p>
<blockquote>
<p>Within a translation unit, all declarations of the same object or function identifier with internal linkage refer to the same thing, and the object or function is unique to that translation unit. All declarations for the same object or function identifier with external linkage refer to the same thing, and the object or function is shared by the entire program.</p>
</blockquote>
<p>Note that in the C language, a function declaration (that does not specify linkage) has implicit external linkage.</p>
<blockquote>
<p><strong>[ISO/IEC 9899:1999]</strong> If no prior declaration is visible, or if the prior declaration specifies no linkage, then the identifier has external linkage.</p>
</blockquote>
<p>This means:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">extern</span> <span class="type">int</span> <span class="title">max</span><span class="params">(<span class="type">int</span>,<span class="type">int</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">max</span><span class="params">(<span class="type">int</span>,<span class="type">int</span>)</span></span>;</span><br></pre></td></tr></table></figure>
<p>Both have the same meaning.</p>
<blockquote>
<p>If you want to explicitly specify an identifier as having internal linkage, you can declare it as <code>static</code>.<br><strong>[ISO/IEC 9899:1999]</strong> A function declaration can contain the storage-class specifier static only if it is at file scope;</p>
</blockquote>
<h3 id="Compilation-and-Linking-Example"><a href="#Compilation-and-Linking-Example" class="headerlink" title="Compilation and Linking Example"></a>Compilation and Linking Example</h3><p>In C, the <code>extern</code> keyword is used to specify that a name has external linkage:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.c</span></span><br><span class="line"><span class="keyword">extern</span> <span class="type">int</span> <span class="title function_">max</span><span class="params">(<span class="type">int</span>,<span class="type">int</span>)</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line">    max(<span class="number">11</span>,<span class="number">12</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The function <code>int max(int,int)</code> is defined in another file:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// maxDefine.c</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">max</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;=y?x:y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Using the four steps mentioned earlier, let’s manually compile and link these two source files using <strong>separate compilation</strong>.</p>
<p>First, preprocess one of the source files (<strong>#include/conditional compilation/macro expansion</strong>):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Preprocessed file goes to main.i</span></span><br><span class="line">$ gcc -E main.c -o main.i</span><br></pre></td></tr></table></figure>

<p>Next, execute <strong>compilation</strong> (generate assembly code from the preprocessed file):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Compiled result goes to main.s</span></span><br><span class="line">$ gcc -S main.i -o main.s</span><br></pre></td></tr></table></figure>

<p>Use <code>-c</code> to generate an object file (from assembly code):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Saving object file as main.o</span></span><br><span class="line">$ gcc -c main.s -o main.o</span><br></pre></td></tr></table></figure>

<p>We can see that three files: main.i, main.s, and main.o have been generated.<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/27118/gcc-compiler-linkage.webp" alt="gcc-compiler-linkage"></p>
<p>Then we also perform the same process for <code>maxDefine.c</code>, which will similarly generate maxDefine.o. Next, let’s try linking:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Default gcc/g++ performs linking for object files</span></span><br><span class="line">$ gcc main.o maxDefine.o</span><br></pre></td></tr></table></figure>

<p>As expected, an <code>a.exe</code> will be generated in the current directory, which is the executable program we need.</p>
<h3 id="What-is-the-Linking-Behavior"><a href="#What-is-the-Linking-Behavior" class="headerlink" title="What is the Linking Behavior?"></a>What is the Linking Behavior?</h3><p>However, what happens in between? Why does <code>main.c</code> correctly find the definition of <code>max</code> in <code>maxDefine.c</code> without defining <code>max</code>?</p>
<p>I illustrate with a simple diagram:<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/27118/linkage-draft.webp"></p>
<p>Using <code>extern int max(int,int)</code> in <code>main.c</code> effectively creates a slot called <code>max</code> in its object file, while the definition of <code>max</code> in <code>maxDefine.c</code> acts as the key corresponding to that <code>max</code> slot. If we only use <code>main.o</code> for linking, an <code>undefined reference</code> error will occur (indeed, many errors in C/C++ programming are not compile errors but linking errors).</p>
<p>If we link <code>main.o</code> without specifying <code>maxDefine.o</code>, an error will occur:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ gcc main.o</span><br><span class="line"><span class="comment"># main.o:main.c:(.text+0x1f): undefined reference to `max&#x27;</span></span><br></pre></td></tr></table></figure>

<p><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/27118/linkage-error.webp" alt="linkage-error"></p>
<p>This is akin to trying to open a door without a key, resulting in an error.</p>
<p>Note that the function prototype and definition in <strong>different translation units</strong> do not need to precisely match in C and can still link successfully. For instance, if the definition of <code>max</code> in <code>maxDefine.c</code> is changed to <code>int max(int x,double y)</code>, it will still link and run successfully (C language has integer promotion and implicit conversion; during the call to <code>max</code> within <code>main</code>, the second parameter is implicitly converted to <code>double</code>, with a matching return type). This is because the function symbols in the object files do not depend on parameter types, but solely on function identifiers. Hence, despite differing types in <code>main.c</code> and <code>maxDefine.c</code>, the symbol information for the function <code>max</code> in their object files remains as <code>max</code>, allowing for a successful symbol match. This characteristic of the C language embodies its belief in programmers, which is often cited as one of the reasons why C is considered more free and less safe compared to C++.</p>
<p>However, this issue would be an error in C++, owing to the fact that the <code>max</code> declared in <code>main.c</code> is defined as <code>int max(int,int)</code>. As mentioned earlier, the symbol information within C++ object files is dependent on both the function names and parameter types for name mangling, so <code>int max(int,int)</code> and <code>int max(int,double)</code> become two distinct symbols in the object files, leading to an undefined symbol error.</p>
<h3 id="GCC-Toolchain-Compilation-and-Linking-Parameters"><a href="#GCC-Toolchain-Compilation-and-Linking-Parameters" class="headerlink" title="GCC Toolchain Compilation and Linking Parameters"></a>GCC Toolchain Compilation and Linking Parameters</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Preprocessing: #include and macro definitions and conditional compilation</span></span><br><span class="line">$ cpp main.cc main.i</span><br><span class="line">$ g++ -E main.cc -o main.i</span><br><span class="line"><span class="comment"># Compile to assembly code</span></span><br><span class="line">$ g++ -S main.i -o main.s</span><br><span class="line"><span class="comment"># Generate object file from assembly code</span></span><br><span class="line">$ g++ -c main.s -o main.o</span><br><span class="line"><span class="comment"># Directly generate object file from source file</span></span><br><span class="line">$ g++ -c main.cc</span><br><span class="line"><span class="comment"># View symbols in .o</span></span><br><span class="line">$ nm main.o</span><br><span class="line"><span class="comment"># Convert name mangled symbols back to original symbols</span></span><br><span class="line">$ c++filt _Z3maxii</span><br><span class="line"></span><br><span class="line"><span class="comment"># From source file generate static link library</span></span><br><span class="line"><span class="comment"># First need to generate the object file</span></span><br><span class="line">$ g++ -c slib.cc -o slib.o</span><br><span class="line"><span class="comment"># Then use ar to create a lib.a</span></span><br><span class="line">$ ar rcs libslib.a slib.o</span><br><span class="line"><span class="comment"># The locally produced libslib.a is the static link library created from our source file</span></span><br><span class="line"><span class="comment"># Usage</span></span><br><span class="line"><span class="comment"># -L specifies the directory of the link library (here it&#x27;s the current directory), -l shows gcc&#x27;s linking method which will automatically match to libxxx.a such a link library</span></span><br><span class="line"><span class="comment"># For example, -L. -lslib will link the libslib.a file in the current directory</span></span><br><span class="line">$ g++ -o main.exe main.cc -L. -llib</span><br><span class="line"></span><br><span class="line"><span class="comment"># Compiling dynamic link library from source file</span></span><br><span class="line"><span class="comment"># Generate object file with -fPIC/-fpic parameter</span></span><br><span class="line"><span class="comment"># -fPIC parameter declares that the code segment of the library is shareable</span></span><br><span class="line">$ gcc -c -fpic dylib.c -o dylib.o</span><br><span class="line"><span class="comment"># Use -shared parameter to generate dynamic link library .so</span></span><br><span class="line">$ gcc -shared -fpic dylib.o -o dylib.so</span><br><span class="line"><span class="comment"># Generate DLL and an import library; symbols in the dynamic link library can be imported through this import library during linkage</span></span><br><span class="line">$ g++ dylib.cpp -shared -o dylib.dll -Wl,--out-implib,impdylib.lib</span><br><span class="line"></span><br><span class="line"><span class="comment"># View binary-dependent symbols</span></span><br><span class="line">$ ldd main.exe</span><br><span class="line"></span><br><span class="line"><span class="comment"># nm can also be used to view symbol information in static and dynamic libraries, as well as executable programs</span></span><br><span class="line">$ nm slib.a</span><br><span class="line">$ nm sylib.so</span><br><span class="line">$ nm main.exe</span><br><span class="line"></span><br><span class="line"><span class="comment"># ldd can view external linkage information in the executable program</span></span><br><span class="line">$ ldd main.exe</span><br><span class="line">ntdll.dll =&gt; /c/Windows/SYSTEM32/ntdll.dll (0x7ffb24f80000)</span><br><span class="line">KERNEL32.DLL =&gt; /c/Windows/System32/KERNEL32.DLL (0x7ffb22d40000)</span><br><span class="line">KERNELBASE.dll =&gt; /c/Windows/System32/KERNELBASE.dll (0x7ffb218a0000)</span><br><span class="line">msvcrt.dll =&gt; /c/Windows/System32/msvcrt.dll (0x7ffb22e50000)</span><br></pre></td></tr></table></figure>
<p><strong>Common Symbol Types in Object Files:</strong></p>
<ul>
<li>A This symbol’s value will not change in further linking;</li>
<li>B This symbol is in the BSS segment, typically representing uninitialized global variables;</li>
<li>D This symbol is in the data segment, typically representing initialized global variables;</li>
<li>T This symbol is in the code segment, typically representing global non-static functions;</li>
<li>U This symbol is undefined and needs to be linked from other object files;</li>
<li>W Weakly linked symbols that are not explicitly specified; if there are definitions for it in other linked object files, use that; otherwise, use a system-defined default value.</li>
<li>R The symbol is located in the read-only data area, such as a <code>const int</code> with file scope in C (which differs from C++).</li>
</ul>
<p>For more information about the symbol format in object files, refer to this article: <a target="_blank" rel="noopener" href="http://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/nm.html">nm Object File Format Analysis</a>.</p>
<h3 id="Why-Separate-Declaration-and-Definition"><a href="#Why-Separate-Declaration-and-Definition" class="headerlink" title="Why Separate Declaration and Definition?"></a>Why Separate Declaration and Definition?</h3><p>As mentioned before, the role and implementation of “separate compilation” have been discussed, but what do C/C++’s common “separation of declaration and implementation” mean? It mainly serves to prevent multiple definitions caused when multiple source files simultaneously include the same source file.<br>Suppose we have three source files <code>customMax.cpp</code>, <code>libMin.cpp</code>, and <code>main.cpp</code>:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// customMax.cpp</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __CUSTOM_MAX_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __CUSTOM_MAX_H__</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">customMax</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;=y?x:y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>

<p>In another file <code>libMin.cpp</code>, <code>#include</code> for <code>customMax.cpp</code>:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// libMin.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __LIB_MIN_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __LIB_MIN_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;customMax.cpp&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="type">int</span> <span class="title">customMax</span><span class="params">(<span class="type">int</span>,<span class="type">int</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">libMin</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">customMax</span>(x,y)==x?y:x; <span class="comment">// Just an example</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>

<p>In the third file <code>main.cpp</code>, we include <code>customMax.cpp</code>, but specify the symbol <code>libMin</code> from <code>libMin.cpp</code> via external linkage:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;customMax.cpp&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="type">int</span> <span class="title">libMin</span><span class="params">(<span class="type">int</span>,<span class="type">int</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span></span>&#123;</span><br><span class="line">    <span class="built_in">customMax</span>(<span class="number">11</span>,<span class="number">12</span>);</span><br><span class="line">    <span class="built_in">libMin</span>(<span class="number">11</span>,<span class="number">12</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>When linking the <code>main.cpp</code> code with <code>libMin.cpp</code>, a <strong>multiple definition</strong> error will occur:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ g++ -o main main.cc libMin.cpp</span><br><span class="line">...multiple definition of `customMax(int, int)<span class="string">&#x27;</span></span><br></pre></td></tr></table></figure>

<p><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/27118/mulitDefineError.webp"></p>
<p>This occurs because the definition and implementation of <code>int customMax(int,int)</code> are combined, but <code>customMax.cpp</code> is included in both <code>libMin.cpp</code> and <code>main.cpp</code>, where <code>main.cpp</code> and <code>libMin.cpp</code> are two separate translation units. This is analogous to:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ g++ -c main.cpp -o main.o</span><br><span class="line">$ g++ -c libMin.cpp -o libMin.o</span><br><span class="line">$ g++ main.o libMin.o</span><br><span class="line">...multiple definition of `customMax(int, int)<span class="string">&#x27;</span></span><br></pre></td></tr></table></figure>

<p><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/27118/mulitDefineError-1.webp"></p>
<p>Let’s check the symbol information in the two object files, <code>main.o</code> and <code>libMin.o</code>:<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/27118/mulitDefineSymbol.webp"></p>
<p>You can see that the part marked in red indicates that T represents that the <code>customMax</code> symbol is defined in both object files, hence the linking will yield a redefinition error.</p>
<p>To resolve this issue, the solution is to maintain a single implementation and only include the declaration when used. Therefore, we employ a declaration and implementation separation mechanism.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// customMax.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __CUSTOM_MAX_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __CUSTOM_MAX_H__</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">customMax</span><span class="params">(<span class="type">int</span>,<span class="type">int</span>)</span></span>;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>

<p>Being defined elsewhere:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// customMax.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __CUSTOM_MAX_D__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __CUSTOM_MAX_D__</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;customMax.h&quot;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">customMax</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;=y?x:y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>

<p>Then, in other source files, only include <code>customMax.h</code>:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;customMax.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="type">int</span> <span class="title">libMin</span><span class="params">(<span class="type">int</span>,<span class="type">int</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span></span>&#123;</span><br><span class="line">    <span class="built_in">customMax</span>(<span class="number">11</span>,<span class="number">12</span>);</span><br><span class="line">    <span class="built_in">libMin</span>(<span class="number">11</span>,<span class="number">12</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>And in <code>libMin.cpp</code>, also just include <code>customMax.h</code>:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __LIB_MIN_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __LIB_MIN_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;customMax.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="type">int</span> <span class="title">customMax</span><span class="params">(<span class="type">int</span>,<span class="type">int</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">libMin</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">customMax</span>(x,y)==x?y:x; <span class="comment">// Just an example</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>

<p>When we compile these two translation units separately and check their symbols:</p>
<p><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/27118/mulitDefineJusyReferenceHeader.webp"></p>
<p>We can see that both object files now have undefined symbols for <code>customMax</code>. This allows us to specify the symbol <code>customMax</code> during compilation to be used by both translation units:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Generate the object file for customMax</span></span><br><span class="line">$ g++ -c customMax.cpp -o customMax.o</span><br></pre></td></tr></table></figure>

<p>Then, we link <code>main.o</code>, <code>libMin.o</code>, and <code>customMax.o</code> together:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ g++ main.o libMin.o customMax.o -o main.exe</span><br></pre></td></tr></table></figure>

<p>Of course, the previous separated operations are quite cumbersome (just for demonstration), so we can execute all of these operations in one line:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># In multiple translation units, only include declarations, and this will not yield linking errors</span></span><br><span class="line">$ g++ main.cpp libMin.cpp customMax.cpp -o main.exe</span><br></pre></td></tr></table></figure>

<p>In summary: The separation of implementation and definition was introduced to allow multiple translation units to use the same symbol information without generating multiple definition errors.</p>
<blockquote>
<p>Note: In C++, the declaration and definition of templates must be together; this is another pitfall that will not be discussed for now.</p>
</blockquote>
<h3 id="C-Template-Linking"><a href="#C-Template-Linking" class="headerlink" title="C++ Template Linking"></a>C++ Template Linking</h3><p>Because C++ templates require the instantiation of relevant objects at compile time, the code for templates must be distributed in source code form; shared implementations must expose this part of the code. From a source code perspective, template code and inline code are similar (even though templates do not necessarily need to be declared as inline): All code for a template must be fully visible to the client code that uses it. This is known as the inclusion model, as we effectively need to include all the template definition code in the template header file.</p>
<p>Let’s look at an example where multiple translation units include the same (symbol) implementation:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// max.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> MAX_HPP_</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_HPP_</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">max</span><span class="params">(<span class="type">const</span> <span class="type">int</span>&amp; a,<span class="type">const</span> <span class="type">int</span>&amp; b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a&gt;b?a:b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;max.cpp&quot;</span></span></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="type">int</span> <span class="title">delegateMax</span><span class="params">(<span class="type">const</span> <span class="type">int</span>&amp;,<span class="type">const</span> <span class="type">int</span>&amp;)</span></span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> imax=<span class="built_in">max</span>(<span class="number">123</span>,<span class="number">456</span>);</span><br><span class="line">    <span class="type">int</span> imaxCopy=<span class="built_in">delegateMax</span>(<span class="number">123</span>, <span class="number">456</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// delegateMax.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> DELEGATE_MAX_HPP_</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DELEGATE_MAX_HPP_</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;max.cpp&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">delegateMax</span><span class="params">(<span class="type">const</span> <span class="type">int</span>&amp; a,<span class="type">const</span> <span class="type">int</span>&amp; b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">max</span>(a,b);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>

<p>The primary issue arises with the two translation units <code>main.cpp</code> and <code>delegateMax.cpp</code>. Let’s compile and link them:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ clang++ -c main.cpp -o main.o</span><br><span class="line">$ clang++ -c delegateMax.cpp -o delegateMax.o</span><br><span class="line">$ llvm-nm main.o</span><br><span class="line">-------- U _Z11delegateMaxRKiS0_</span><br><span class="line">00000000 T _Z3maxRKiS0_</span><br><span class="line">-------- U __main</span><br><span class="line">00000050 T main</span><br><span class="line">$ llvm-nm delegateMax.o</span><br><span class="line">00000050 T _Z11delegateMaxRKiS0_</span><br><span class="line">00000000 T _Z3maxRKiS0_</span><br><span class="line">$ clang++ main.o delegateMax.o -o main.exe</span><br><span class="line">delegateMax.o:(.text+0x0): multiple definition of `max(int const&amp;, int const&amp;)` main.o:(.text+0x0): first defined here</span><br><span class="line">clang++.exe: error: linker <span class="built_in">command</span> failed with <span class="built_in">exit</span> code 1 (use -v to see invocation)</span><br></pre></td></tr></table></figure>

<p>This generates a symbol <code>max(const int&amp;,const int&amp;)</code> redefinition error. However, if we modify the implementation of <code>max(const int&amp;,const int&amp;)</code> to be a template or inline implementation:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> MAX_HPP_</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_HPP_</span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function">T <span class="title">max</span><span class="params">(<span class="type">const</span> T&amp; a,<span class="type">const</span> T&amp; b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a&gt;b?a:b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>

<p>Compiling and linking again:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ clang++ -c main.cpp -o main.o</span><br><span class="line">$ clang++ -c delegateMax.cpp -o delegateMax.o</span><br><span class="line">$ llvm-nm main.o</span><br><span class="line">-------- U _Z11delegateMaxRKiS0_</span><br><span class="line">00000000 T _Z3maxIiET_RKS0_S2_</span><br><span class="line">-------- U __main</span><br><span class="line">00000000 T main</span><br><span class="line">$ llvm-nm delegateMax.o</span><br><span class="line">00000000 T _Z11delegateMaxRKiS0_</span><br><span class="line">00000000 T _Z3maxIiET_RKS0_S2_</span><br><span class="line">$ clang++ main.o delegateMax.o -o main.exe</span><br></pre></td></tr></table></figure>

<p>Now it links through with no redefinition error occurring.</p>
<p>Comparing the symbol information between the two attempts, there appears to be no difference in <code>main.o</code> and <code>delegateMax.o</code> symbols. Why does this yield different linking outcomes?</p>
<p>This is due to the fact that non-member function templates in C++ allow for linking in a manner distinct from normal functions:<br>The C++ standard describes linkage for names declared at global scope:</p>
<blockquote>
<p><strong>[ISO/IEE 14882:2011]</strong> A name declared in a namespace scope without a storage-class-specifier has external linkage unless it has internal linkage because of a previous declaration and provided it is not declared const. Objects declared const and not explicitly declared extern have internal linkage.</p>
</blockquote>
<p>So the initial declaration of <code>max(const int&amp;,const int&amp;)</code> possesses external linkage, and since both <code>main.o</code> and <code>delegateMax.o</code> include its implementation, they effectively contain the same symbol for <code>max(const int&amp;,const int&amp;)</code>, leading to a redefinition error during linkage.</p>
<p>However, the linkage for non-member function templates differs from normal function linkage in C++:</p>
<blockquote>
<p><strong>[ISO/IEE 14882:2014]</strong> A template name has linkage (3.5). A non-member function template can have internal linkage; any other template name shall have external linkage. Specializations (explicit or implicit) of a template that has internal linkage are distinct from all specializations in other translation units.</p>
</blockquote>
<p>Thus, the <code>max(const T&amp;,const T&amp;)</code> implemented via templates has internal linkage, which means during linking, calls to <code>max</code> in <code>main.o</code> and <code>delegateMax.o</code> can only locate their own symbol names (internal linkage is not visible externally), thus allowing for successful linking.</p>
<p>Moreover, this is precisely why template code needs to be distributed in source form; to prevent identical symbols with external visibility from being created across different compilation units, resulting in redefinition linking errors.</p>
<h3 id="External-References"><a href="#External-References" class="headerlink" title="External References"></a>External References</h3><ul>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/1436811/">Linkers and Loaders</a></li>
<li><a target="_blank" rel="noopener" href="http://doc.imzlp.com/viewer.html?file=docs/standard/isoc99.pdf">ISO/IEC 9899:1999</a></li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/26344642/">Computer System: A Programmer’s Perspective, 2e</a></li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/20471211/">Linux Multithreaded Server Programming: Using the muduo C++ Network Library</a></li>
</ul>
<h3 id="Update-Log"><a href="#Update-Log" class="headerlink" title="Update Log"></a>Update Log</h3><p><strong>2017.04.11</strong></p>
<ul>
<li>Optimized phrasing and corrected punctuation errors.</li>
<li>Added more examples.</li>
</ul>
<p><strong>2017.04.14</strong></p>
<ul>
<li>Added <strong>GCC toolchain compilation and linking parameters</strong>.</li>
</ul>
<p><strong>2017.04.16</strong></p>
<ul>
<li>Optimized phrasing and added more examples.</li>
<li>Referenced the <strong>C99 standard</strong> in the concept of <strong>Translation environment</strong>.</li>
<li>Added “Why should declaration be separated from definition?”</li>
</ul>
<p><strong>2017.04.17</strong></p>
<ul>
<li>Further elaborated on <code>translation unit</code> and the preprocessor.</li>
<li>Corrected potentially ambiguous descriptions and provided more examples for clarity.</li>
</ul>
<p><strong>2017.07.01</strong></p>
<ul>
<li>Added the section on <strong>C++ template linking</strong>.</li>
</ul>

    </div>

    
    
        
        
          
            <blockquote class="blockquote-center">
              
                The article is finished. If you have any questions, please comment and communicate.
              
            <br/>
            
                <div class="qr-code" onclick="return false">
                    <script src="/js/qrcode.min.js"></script>
                    <div id="qrcode">
                      
                        <img src="https://imzlp.com/images/wechat-qrcode.webp">
                      
                    <p>Scan the QR code on WeChat and follow me.</p>
                    </div>
                </div>
            
            </blockquote>
          
        

        
          <div class="postCopyright" style="clear:both;">
             <span>Title:</span><a href="/posts/27118/" target="_blank">C/C++ compilation and linking model analysis</a><br/>
             <span>Author:</span><a href="/about" target="_blank" title="查看 LIPENGZHA 的资料">LIPENGZHA</a><br/>
             <span>Publish Date:</span>2017/04/10 23:05<br/>
             
              <span>Update Date:</span>2017/07/02 00:18<br/>
             
             <span>Word Count:</span><span class="page-count">11k Words</span><br/>
             
             <span>Link:</span><a href="/posts/27118/" target="_blank" title="C/C++ compilation and linking model analysis">https://en.imzlp.com/posts/27118/</a>
             <span class="copy-path" data-clipboard-text="Link: https://en.imzlp.com/posts/27118/ Author: LIPENGZHA" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
             <script src="/js/jquery.min.js"></script>
             <script src="/js/clipboard.min.js"></script>
             <script> var clipboard = new Clipboard('.copy-path'); </script>
             <br/>
             
             <span>License:</span><i class="fab fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" title="Attribution-NonCommercial-ShareAlike 4.0 International">CC BY-NC-SA 4.0</a><br/>
             
             <span>Reprinting of the full article is prohibited.</span>
          </div>
        
    

        
  <div class="reward-container">
    <div>Your donation will encourage me to keep creating!</div>
    <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
      Donate
    </button>
    <div id="qr" style="display: none;">
        
        <div style="display: inline-block;">
          <img src="/images/reward/wechatpay.webp" alt="LIPENGZHA WeChat Pay">
          <p>WeChat Pay</p>
        </div>

    </div>
  </div>



      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/C/" rel="tag"># C++</a>
              <a href="/tags/%E6%8A%80%E6%9C%AF%E7%AC%94%E8%AE%B0/" rel="tag"># 技术笔记</a>
              <a href="/tags/C%E8%AF%AD%E8%A8%80/" rel="tag"># C语言</a>
              <a href="/tags/%E7%BC%96%E7%A8%8B%E7%AC%94%E8%AE%B0/" rel="tag"># 编程笔记</a>
              <a href="/tags/%E7%BC%96%E8%AF%91%E6%A8%A1%E5%9E%8B/" rel="tag"># 编译模型</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/posts/5392/" rel="prev" title="Why is extern "C" needed?">
      <i class="fa fa-chevron-left"></i> Why is extern "C" needed?
    </a></div>
      <div class="post-nav-item">
    <a href="/posts/21095/" rel="next" title="Array of length zero">
      Array of length zero <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
      <div class="tabs tabs-comment">
        <ul class="nav-tabs">
            <li class="tab"><a href="#comment-utteranc">utteranc</a></li>
            <li class="tab"><a href="#comment-valine">valine</a></li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane utteranc" id="comment-utteranc">
              
  
  <div class="comments">
  <script src="https://utteranc.es/client.js" repo="hxhb/blog-comments" issue-term="pathname" theme="github-light" crossorigin="anonymous" async></script>
  </div>
  
  
            </div>
            <div class="tab-pane valine" id="comment-valine">
              <div class="comments" id="valine-comments"></div>
            </div>
        </div>
      </div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Compilation-and-Linking-Example"><span class="nav-number">1.</span> <span class="nav-text">Compilation and Linking Example</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#What-is-the-Linking-Behavior"><span class="nav-number">2.</span> <span class="nav-text">What is the Linking Behavior?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#GCC-Toolchain-Compilation-and-Linking-Parameters"><span class="nav-number">3.</span> <span class="nav-text">GCC Toolchain Compilation and Linking Parameters</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Why-Separate-Declaration-and-Definition"><span class="nav-number">4.</span> <span class="nav-text">Why Separate Declaration and Definition?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#C-Template-Linking"><span class="nav-number">5.</span> <span class="nav-text">C++ Template Linking</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#External-References"><span class="nav-number">6.</span> <span class="nav-text">External References</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Update-Log"><span class="nav-number">7.</span> <span class="nav-text">Update Log</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person" oncontextmenu="return false" οndragstart="return false">
    <img class="site-author-image" itemprop="image" alt="LIPENGZHA"
      src="https://img.imzlp.com/imgs/zlp/picgo/2023/202304152112902.webp">
  <p class="site-author-name" itemprop="name">LIPENGZHA</p>
  <div class="site-description" itemprop="description">"I think, therefore I am"</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
             
          <span class="site-state-item-count">190</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">95</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">190</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/hxhb" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;hxhb" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://linkedin.com/in/lipengzha" title="Linkedin → https:&#x2F;&#x2F;linkedin.com&#x2F;in&#x2F;lipengzha" rel="noopener" target="_blank"><i class="fab fa-linkedin fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/imzlp" title="知乎 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;imzlp" rel="noopener" target="_blank"><i class="fa fa-custom zhihu fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/images/wechat-qrcode-offical.webp" title="微信公众号 → &#x2F;images&#x2F;wechat-qrcode-offical.webp"><i class="fab fa-weixin fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:imzlp@foxmail.com" title="E-Mail → mailto:imzlp@foxmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-rss fa-fw"></i></a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://consolehelp.imzlp.com/" title="https:&#x2F;&#x2F;consolehelp.imzlp.com&#x2F;" rel="noopener" target="_blank">UE Console Help</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://imzlp.com/opensource/" title="https:&#x2F;&#x2F;imzlp.com&#x2F;opensource&#x2F;" rel="noopener" target="_blank">Open Source Projects</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://imzlp.com/posts/11515/" title="https:&#x2F;&#x2F;imzlp.com&#x2F;posts&#x2F;11515&#x2F;" rel="noopener" target="_blank">UE C++ API Dash Documents</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://ue5wiki.com/" title="https:&#x2F;&#x2F;ue5wiki.com&#x2F;" rel="noopener" target="_blank">Unreal Engine Wiki</a>
        </li>
    </ul>
  </div>

      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2014 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">LIPENGZHA</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="Symbols count total">1.5m</span>
</div>
  <div class="powered-by-other">
    
	    <center>Github Pages | Actions | NeXT | Cloudflare | Hexo Deploy</center>
      
  </div>

<script>
function checkWebp(callback) {
    var img = new Image();
    img.onload = function () { callback((img.width > 0) && (img.height > 0)); };
    img.onerror = function () { callback(false); };
    img.src = 'data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA';
}
function showImage(useWebp) {
    var imgs = [].slice.call(document.querySelectorAll('img'));
    imgs.forEach(function (e) {
        if (!useWebp) {
            var src = e.getAttribute('data-src')
            src = src.replace(/\.webp$/, '.png');
            e.setAttribute('data-src', src);
        }
    });
}
checkWebp(showImage);
</script>

        








      </div>
    </footer>
  </div>

  
  <script src="//lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/animejs/3.2.1/anime.min.js"></script>
  <script src="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/jquery/3.5.1/jquery.min.js"></script>
  <script src="//lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/fancybox/3.5.7/jquery.fancybox.min.js"></script>
  <script src="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/lozad.js/1.16.0/lozad.min.js"></script>
  <script src="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/pangu/4.0.7/pangu.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>



<script src="/js/code-unfold.js"></script>

  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>




  
<script src="/js/local-search.js"></script>









<script>
document.querySelectorAll('.pdfobject-container').forEach(element => {
  let url = element.dataset.target;
  let pdfOpenParams = {
    navpanes : 0,
    toolbar  : 0,
    statusbar: 0,
    pagemode : 'thumbs',
    view     : 'FitH'
  };
  let pdfOpenFragment = '#' + Object.entries(pdfOpenParams).map(([key, value]) => `${key}=${encodeURIComponent(value)}`).join('&');
  let fullURL = `/lib/pdf/web/viewer.html?file=${encodeURIComponent(url)}${pdfOpenFragment}`;

  if (NexT.utils.supportsPDFs()) {
    element.innerHTML = `<embed class="pdfobject" src="${url + pdfOpenFragment}" type="application/pdf" style="height: ${element.dataset.height};">`;
  } else {
    element.innerHTML = `<iframe src="${fullURL}" style="height: ${element.dataset.height};" frameborder="0"></iframe>`;
  }
});
</script>


<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


  

  

  
  <script src="//img.imzlp.com/imgs/zlp/picgo/2021/quicklink.umd.js"></script>
  <script>
      window.addEventListener('load', () => {
      quicklink({
        timeout : 3000,
        priority: true,
        ignores : [uri => uri.includes('#'),uri => uri === 'https://en.imzlp.com/posts/27118/',]
      });
      });
  </script>


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/valine/1.4.14/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    var requiredFields = 'nick';
    requiredFields = requiredFields.split(',');
    
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'oCE6RMVkVoi5MgUhvFsn1EvV-gzGzoHsz',
      appKey     : 'K9SOaNYJ8PV6xaoFggWG5xvv',
      placeholder: "Leave something behind~",
      avatar     : 'robohash',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : 'en' || 'zh-cn',
      path       : location.pathname,
      recordIP   : true,
      serverURLs : '',
      requiredFields: requiredFields
    });
  }, window.Valine);
});
</script>

</body>
</html>
