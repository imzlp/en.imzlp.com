<!DOCTYPE html>
<html lang="en,default">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon-32x32-tilt-brush.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-tilt-brush.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-tilt-brush.png">
  <link rel="mask-icon" href="/images/favicon-32x32-tilt-brush.png" color="#222">
  <meta name="google-site-verification" content="ttIkhAIFZQM9Huj8roB0l95ePN2Tv2zv2wRFksi09WA">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noto Serif SC:300,300italic,400,400italic,700,700italic|Pacifico:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Roboto Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="//lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/5.15.2/css/all.min.css">
  <link rel="stylesheet" href="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/fancybox/3.5.7/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"en.imzlp.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false,"width":280},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"manual"},"fancybox":true,"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":false,"nav":null,"activeClass":"valine"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"code_unfold":{"enable":true,"CODE_MAX_HEIGHT":600},"path":"search.xml"};
  </script>

  <meta name="description" content="It is well known that class members in C++ can have three access specifiers: public, protected, and private:[ISO&#x2F;IEC 14882:2014] A member of a class can be  private: that is, its name can be used only">
<meta property="og:type" content="article">
<meta property="og:title" content="Breaking through the access control mechanism of C++ classes">
<meta property="og:url" content="https://en.imzlp.com/posts/12080/index.html">
<meta property="og:site_name" content="Z&#39;s Blog">
<meta property="og:description" content="It is well known that class members in C++ can have three access specifiers: public, protected, and private:[ISO&#x2F;IEC 14882:2014] A member of a class can be  private: that is, its name can be used only">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/picgo/2021/20210524172617.webp">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/picgo/2021/20210524172617.webp">
<meta property="article:published_time" content="2017-05-12T11:58:05.000Z">
<meta property="article:modified_time" content="2021-05-24T17:28:06.000Z">
<meta property="article:author" content="LIPENGZHA">
<meta property="article:tag" content="C++">
<meta property="article:tag" content="技术笔记">
<meta property="article:tag" content="编程笔记">
<meta property="article:tag" content="C++标准">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img.imzlp.com/imgs/zlp/picgo/2021/20210524172617.webp">

<link rel="canonical" href="https://en.imzlp.com/posts/12080/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>Breaking through the access control mechanism of C++ classes | Z's Blog</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FDCJ41EFP5"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-FDCJ41EFP5');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.staticfile.org/lxgw-wenkai-screen-webfont/1.7.0/style.min.css" /><!-- hexo injector head_end end --><link rel="alternate" href="/atom.xml" title="Z's Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Z's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        
            
  <li class="menu-item menu-item-notes">

    <a href="/notes/" rel="section"><i class="fa fa-edit fa-fw"></i>Notes</a>

  </li>


      
        
            
  <li class="menu-item menu-item-essay">

    <a href="/essay/" rel="section"><i class="fas fa-feather-alt fa-fw"></i>Essay</a>

  </li>


      
        
            
  <li class="menu-item menu-item-resources">

    <a href="/resources/" rel="section"><i class="fa fa-inbox fa-fw"></i>Resources</a>

  </li>


      
        <li class="menu-item menu-item-friends">

    <a href="/friends/" rel="section"><i class="fas fa-link fa-fw"></i>Friends</a>

  </li>
        
            
  <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About Me</a>

  </li>


      
        <li class="menu-item menu-item-showcase">

    <a href="/showcase/" rel="section"><i class="fa fa-solid fa-trophy fa-fw"></i>ShowCase</a>

  </li>
        <li class="menu-item menu-item-changelog">

    <a href="/changelog/" rel="section"><i class="fa fa-history fa-fw"></i>Site Log</a>

  </li>
        <li class="menu-item menu-item-opensource">

    <a href="/opensource/" rel="section"><i class="fas fa-code-branch fa-fw"></i>Open Source</a>

  </li>
        <li class="menu-item menu-item-uewiki">

    <a href="https://ue5wiki.com/" rel="noopener" target="_blank"><i class="fab fa-wikipedia-w fa-fw"></i>Unreal Wiki</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>



<script type="text/javascript">
  let domain='en.imzlp.com';
  let domain_str = atob(domain);
  let pathname = location.pathname;
  if (domain_str!= location.host.toLowerCase()){
        console.log(`this host is not safe,jump to https://${domain_str}${pathname}`);
        location.href=`https://${domain_str}${pathname}`;
  }
</script>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>
  <div class="l10n-header-widget">
    <script>
      // 获取当前页面的 URL
      const currentUrl = window.location.href;
      // 替换 URL 中的部分内容
      const jumpToL10nLink = currentUrl.replace('en.imzlp.com', 'imzlp.com');
      // 将 jumpToL10nLink 绑定到一个全局变量
      window.jumpToL10nLink = jumpToL10nLink;
    </script>

    <a href="#" class="post-l10n-link" title="切换至中文版本" style="float: left;border-bottom: none;" rel="noopener" target="_blank" onclick="window.open(window.jumpToL10nLink, '_blank'); return false;">
      <i class="fa fa-solid fa-language"></i>
    </a>
  </div>



    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en"
  >
    <link itemprop="mainEntityOfPage" href="https://en.imzlp.com/posts/12080/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://img.imzlp.com/imgs/zlp/picgo/2023/202304152112902.webp">
      <meta itemprop="name" content="LIPENGZHA">
      <meta itemprop="description" content=""I think, therefore I am"">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Z's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Breaking through the access control mechanism of C++ classes<a href="https://github.com/imzlp/blog-md/blob/en/_posts/2017-05-12-12080.md" class="post-edit-link" title="Edit this post" style="float: right;border-bottom: 0px;" rel="noopener" target="_blank"><i class="fa fa-pen-nib"></i></a><a href="https://imzlp.com/posts/12080/" class="post-l10n-link" title="切换至中文版本" style="float: left;border-bottom: 0px;" rel="noopener" target="_blank"><i class="fa fa-solid fa-language"></i></a>
        </h1>

        
          <div class="post-subtitle" style="text-align: center;line-height: 1;">
            <sub text-align="center" style="font-size: 15px;align-content: center;font-style: italic;bottom: 0em;">突破C++类的访问控制机制</sub>
          </div>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-05-12 11:58 11:58:05:58" itemprop="dateCreated datePublished" datetime="2017-05-12T11:58:05+00:00">2017-05-12 11:58</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-05-24 17:28 17:28:06:28" itemprop="dateModified" datetime="2021-05-24T17:28:06+00:00">2021-05-24 17:28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">技术笔记</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF%E7%AC%94%E8%AE%B0/C/" itemprop="url" rel="index"><span itemprop="name">C++</span></a>
                </span>
            </span>

          
            <span id="/posts/12080/" class="post-meta-item leancloud_visitors" data-flag-title="Breaking through the access control mechanism of C++ classes" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>11k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>27 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>It is well known that class members in C++ can have three access specifiers: <code>public</code>, <code>protected</code>, and <code>private</code>:<br>[ISO/IEC 14882:2014] A member of a class can be</p>
<ul>
<li><strong>private</strong>: that is, its name can be used only by members and friends of the class in which it is declared.</li>
<li><strong>protected</strong>: that is, its name can be used only by members and friends of the class in which it is declared, by classes derived from that class, and by their friends (see 11.4).</li>
<li><strong>public</strong>: that is, its name can be used anywhere without access restriction.</li>
</ul>
<p>From the standard’s intention, it aims to hide implementation details and underlying data of a class, which is <strong>encapsulation</strong>. However, we can also bypass access restrictions through some special means.</p>
<span id="more"></span>
<p>First, let’s correct a misconception: in C++, class access control restricts the <strong>access permissions</strong> of members, not their <strong>visibility</strong>.</p>
<blockquote>
<p>[ISO/IEC 14882:2014] It should be noted that it is access to members and base classes that is controlled, not their visibility.</p>
</blockquote>
<p>Any member of a class is <strong>visible</strong> to any code that can see its class implementation; the issue is <strong>whether it can be accessed</strong>. When you directly access a member’s name (identifier) inside a class, it will check whether you have permission to access that member. If you mark it as <code>private</code> and access it from outside the class definition or a friend, it will prompt a compilation error. For a specific description of visibility and accessibility in access control, please refer to my other article: <a target="_blank" rel="noopener" href="https://imzlp.com/posts/17586">Visibility and Accessibility in Access Control Mechanisms</a>.<br>Thus, we can access class members without triggering the access control mechanism by not using member names. One way to access class members without using class member names is through pointers to class members. For detailed content on <strong>pointers to class members in C++</strong>, please check my previous article: <a target="_blank" rel="noopener" href="https://imzlp.com/posts/27615">Pointers to Class Members Are Not Pointers</a>.</p>
<p>From an <strong>invasive</strong> implementation perspective, we can <strong>actively provide</strong> methods to access class <code>private</code> members through class member functions.<br>A common way is to return a reference to the <code>private</code> data member or return a <a target="_blank" rel="noopener" href="https://imzlp.com/posts/27615">pointer to class members</a>. I prefer returning a pointer to members since if a reference is returned, only a specific object’s members can be accessed later, whereas a function pointer can access members of any object of that class.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">A</span>(<span class="type">int</span> x=<span class="number">0</span>):<span class="built_in">private_</span>(x)&#123;&#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">()</span></span>&#123; std::cout&lt;&lt;private_&lt;&lt;std::endl; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">auto</span> <span class="title">retPrivateVal</span><span class="params">()</span></span>&#123; <span class="keyword">return</span> &amp;A::private_; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">auto</span> <span class="title">retPrivateFunc</span><span class="params">()</span></span>&#123; <span class="keyword">return</span> &amp;A::privateFunc; &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">privateFunc</span><span class="params">()</span></span>&#123; std::cout&lt;&lt;<span class="string">&quot;A::privateFunc()&quot;</span>&lt;&lt;std::endl; &#125;</span><br><span class="line">    <span class="type">int</span> private_;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>Since what we get here is the address of the object (data member/function object), it can be accessed externally through an object of the class or a pointer to the class object, as accessing the pointer to class members is actually calculating the offset of that member through <code>this</code>, so it won’t trigger any name lookup or accessibility checks:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">A <span class="title">example</span><span class="params">(<span class="number">456</span>)</span></span>;</span><br><span class="line">example.<span class="built_in">print</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> memPtr=example.<span class="built_in">retPrivateVal</span>();</span><br><span class="line">example.*memPtr=<span class="number">123</span>;</span><br><span class="line">example.<span class="built_in">print</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> memFuncPtr=example.<span class="built_in">retPrivateFunc</span>();</span><br><span class="line">(example.*memFuncPtr)();</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">output:</span></span><br><span class="line"><span class="comment">456</span></span><br><span class="line"><span class="comment">123</span></span><br><span class="line"><span class="comment">A::privateFunc()</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>As we can see, the <code>private</code> data member of class A was modified externally, and its <code>private</code> member function was also callable externally. This approach can be combined into STL’s operator library to perform certain operations on class objects in bulk.<br>However, this is based on the prerequisite that <strong>the class implementer actively provides access permissions</strong>.</p>
<p>Sometimes, for various reasons, we do not wish to manually modify class code (adding or removing class interfaces), but still have a need to access <code>private</code> members. In this case, we can use the following two methods.<br>Assuming we have the following class:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">A</span>(<span class="type">int</span> x=<span class="number">0</span>):<span class="built_in">private_</span>(x)&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function">    <span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">const</span> T&amp; x)</span></span>&#123;<span class="comment">/* something...*/</span>&#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">()</span></span>&#123;cout&lt;&lt;private_&lt;&lt;endl;&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> private_;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>Because it has a template member function, we can break through the class access permissions through this template member function.<br>The method is to add a specialized version of this member function externally, because it is a specialization of the class member, and it also has permission to access all members inside the class:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">ZZZ</span>&#123;</span><br><span class="line">        <span class="built_in">ZZZ</span>(<span class="type">int</span> i):<span class="built_in">ival</span>(i)&#123;&#125;</span><br><span class="line">        <span class="type">int</span> ival;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span>&lt;&gt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">A::func</span><span class="params">(<span class="type">const</span> ZZZ&amp; z)</span></span>&#123;</span><br><span class="line">    private_=z.ival;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Here, when we use <code>ZZZ</code> as a parameter to call <code>A::func</code> member function, we can access the private member, thereby breaking the access restrictions of the C++ class. Whether directly manipulating <code>private</code> inside or passing out member pointers (to incoming objects), the private members of class A can be accessed externally.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">A <span class="title">example</span><span class="params">(<span class="number">456</span>)</span></span>;</span><br><span class="line">example.<span class="built_in">print</span>();</span><br><span class="line"></span><br><span class="line">example.<span class="built_in">func</span>(<span class="built_in">ZZZ</span>(<span class="number">123</span>));</span><br><span class="line">example.<span class="built_in">print</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">output:</span></span><br><span class="line"><span class="comment">456</span></span><br><span class="line"><span class="comment">123</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>If a class has a friend template, the same behavior can also be achieved, and this method is <strong>fully compliant with the C++ standard</strong>.</p>
<p>Next, I’ll discuss a method to bypass access permissions <strong>dependent on compiler implementation</strong>:<br>Similarly using class A as the target for breaking through.<br>We can mimic a class with the same layout as the target, but change the access specifier of the corresponding <code>private</code> member to <code>public</code> or <code>protected</code>, or other more relaxed access permissions (this actually depends on the implementation).</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The only difference is that private_ is public in class B</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">B</span>(<span class="type">int</span> x=<span class="number">0</span>):<span class="built_in">private_</span>(x)&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function">    <span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">const</span> T&amp; x)</span></span>&#123;<span class="comment">/* something...*/</span>&#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">()</span></span>&#123;cout&lt;&lt;private_&lt;&lt;endl;&#125;</span><br><span class="line">    <span class="type">int</span> private_;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>Then it can be used to manipulate:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">A <span class="title">example</span><span class="params">(<span class="number">456</span>)</span></span>;</span><br><span class="line">example.<span class="built_in">print</span>();</span><br><span class="line"></span><br><span class="line">(<span class="built_in">reinterpret_cast</span>&lt;B&amp;&gt;(example)).private_=<span class="number">123</span>;</span><br><span class="line"></span><br><span class="line">example.<span class="built_in">print</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">output:</span></span><br><span class="line"><span class="comment">456</span></span><br><span class="line"><span class="comment">123</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>The core idea here is <code>reinterpret_cast&lt;B&amp;&gt;(example)</code>, which forces the compiler to interpret an object of class A as an object of class B, then access the public member <code>private_</code> in class B, but actually modifies class A’s <code>private</code> member <code>private_</code>. However, this also relies on the compiler’s implementation since we assume that the modified class B and class A have identical layouts, which is not guaranteed (this works in G++).</p>
<blockquote>
<p>[TC++PL4th] A compiler may reorder sections of a class with separate access specifiers.</p>
</blockquote>
<p>We can also place objects of class <code>A</code> and class <code>B</code> in a <code>union</code>, storing in A’s way and reading in B’s way:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">union</span> <span class="title class_">U</span>&#123;</span><br><span class="line">    A aobj;</span><br><span class="line">    B bobj;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    U uobj&#123;<span class="number">456</span>&#125;;</span><br><span class="line">    uobj.aobj.<span class="built_in">print</span>();</span><br><span class="line">    uobj.bobj.private_=<span class="number">123</span>;</span><br><span class="line">    uobj.aobj.<span class="built_in">print</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">output:</span></span><br><span class="line"><span class="comment">456</span></span><br><span class="line"><span class="comment">123</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>Another trick to access a class’s private members is shown in the code below (the latest code will be placed on gist: <a target="_blank" rel="noopener" href="https://gist.github.com/hxhb/c1802a7477733655c76fbfe68f2e5b80">hack-private-data-member.cpp</a>):</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">namespace</span> Hacker</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> Tag, <span class="keyword">typename</span> Tag::MemType M&gt;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">PrivateMemberStealer</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// define friend function GetPrivate, return class member pointer</span></span><br><span class="line">        <span class="function"><span class="keyword">friend</span> <span class="keyword">typename</span> Tag::MemType <span class="title">GetPrivate</span><span class="params">(Tag)</span> </span>&#123; <span class="keyword">return</span> M; &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DECL_HACK_PRIVATE_DATA(ClassName,DataType,DataName) namespace Hacker&#123;\</span></span><br><span class="line"><span class="meta">                                                              struct ClassName##_##DataName\</span></span><br><span class="line"><span class="meta">                                                              &#123;\</span></span><br><span class="line"><span class="meta">                                                                typedef DataType ClassName::*MemType;\</span></span><br><span class="line"><span class="meta">                                                                friend MemType GetPrivate(ClassName##_##DataName);\</span></span><br><span class="line"><span class="meta">                                                              &#125;;\</span></span><br><span class="line"><span class="meta">                                                              template struct PrivateMemberStealer<span class="string">&lt;ClassName##_##DataName, &amp;ClassName::DataName&gt;</span>;\</span></span><br><span class="line"><span class="meta">                                                            &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DECL_HACK_PRIVATE_STATIC_DATA(ClassName,DataType,DataName) namespace Hacker&#123;\</span></span><br><span class="line"><span class="meta">                                                              struct ClassName##_##DataName\</span></span><br><span class="line"><span class="meta">                                                              &#123;\</span></span><br><span class="line"><span class="meta">                                                                typedef DataType* MemType;\</span></span><br><span class="line"><span class="meta">                                                                friend MemType GetPrivate(ClassName##_##DataName);\</span></span><br><span class="line"><span class="meta">                                                              &#125;;\</span></span><br><span class="line"><span class="meta">                                                              template struct PrivateMemberStealer<span class="string">&lt;ClassName##_##DataName, &amp;ClassName::DataName&gt;</span>;\</span></span><br><span class="line"><span class="meta">                                                            &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DECL_HACK_PRIVATE_STATIC_FUNCTION(ClassName,MemberName,ReturnType,...) \</span></span><br><span class="line"><span class="meta">		namespace Hacker&#123;\</span></span><br><span class="line"><span class="meta">			struct ClassName##_##MemberName \</span></span><br><span class="line"><span class="meta">			&#123;\</span></span><br><span class="line"><span class="meta">				typedef ReturnType (*MemType)(__VA_ARGS__);\</span></span><br><span class="line"><span class="meta">				friend MemType GetPrivate(ClassName##_##MemberName);\</span></span><br><span class="line"><span class="meta">			&#125;;\</span></span><br><span class="line"><span class="meta">			template struct PrivateMemberStealer<span class="string">&lt;ClassName##_##MemberName, &amp;ClassName::MemberName&gt;</span>;\</span></span><br><span class="line"><span class="meta">		&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DECL_HACK_PRIVATE_NOCONST_FUNCTION(ClassName,MemberName,ReturnType,...) \</span></span><br><span class="line"><span class="meta">		namespace Hacker&#123;\</span></span><br><span class="line"><span class="meta">			struct ClassName##_##MemberName \</span></span><br><span class="line"><span class="meta">			&#123;\</span></span><br><span class="line"><span class="meta">				typedef ReturnType (ClassName::*MemType)(__VA_ARGS__);\</span></span><br><span class="line"><span class="meta">				friend MemType GetPrivate(ClassName##_##MemberName);\</span></span><br><span class="line"><span class="meta">			&#125;;\</span></span><br><span class="line"><span class="meta">			template struct PrivateMemberStealer<span class="string">&lt;ClassName##_##MemberName, &amp;ClassName::MemberName&gt;</span>;\</span></span><br><span class="line"><span class="meta">		&#125;</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DECL_HACK_PRIVATE_CONST_FUNCTION(ClassName,MemberName,ReturnType,...) \</span></span><br><span class="line"><span class="meta">		namespace Hacker&#123;\</span></span><br><span class="line"><span class="meta">			struct ClassName##_##MemberName \</span></span><br><span class="line"><span class="meta">			&#123;\</span></span><br><span class="line"><span class="meta">				typedef ReturnType (ClassName::*MemType)(__VA_ARGS__)const;\</span></span><br><span class="line"><span class="meta">				friend MemType GetPrivate(ClassName##_##MemberName);\</span></span><br><span class="line"><span class="meta">			&#125;;\</span></span><br><span class="line"><span class="meta">			template struct PrivateMemberStealer<span class="string">&lt;ClassName##_##MemberName, &amp;ClassName::MemberName&gt;</span>;\</span></span><br><span class="line"><span class="meta">		&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GET_VAR_PRIVATE_DATA_MEMBER(ClassInstancePointer,ClassName,DataName)	ClassInstancePointer-&gt;*GetPrivate(::Hacker::ClassName##_##DataName())</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GET_REF_PRIVATE_DATA_MEMBER(RefName,ClassInstancePointer,ClassName,DataName)	auto&amp; RefName = ClassInstancePointer-&gt;*GetPrivate(::Hacker::ClassName##_##DataName())</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GET_PRIVATE_STATIC_DATA_MEMBER_PTR(PtrName,ClassName,DataName)	auto PtrName = GetPrivate(::Hacker::ClassName##_##DataName())</span></span><br><span class="line"><span class="comment">// using ADL found to ::Hacker::Getprivate</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GET_PRIVATE_MEMBER_FUNCTION(ClassName,MemberName) GetPrivate(::Hacker::ClassName##_##MemberName())</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CALL_MEMBER_FUNCTION(ClassPointer,MemberFuncPointer,...) (ClassPointer-&gt;*MemberFuncPointer)(__VA_ARGS__)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">A</span>(<span class="type">int</span> ivalp=<span class="number">0</span>):ival&#123;ivalp&#125;&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">printStaticIval2</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,A::static_ival2);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">func</span><span class="params">(<span class="type">int</span> ival)</span><span class="type">const</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;A::func(int)\t%d\n&quot;</span>,ival);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;ival is %d\n&quot;</span>,ival);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> ival;</span><br><span class="line"></span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> static_ival2;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// private member data </span></span><br><span class="line"><span class="built_in">DECL_HACK_PRIVATE_DATA</span>(A,<span class="type">int</span>,ival)</span><br><span class="line"><span class="comment">// private member function</span></span><br><span class="line"><span class="built_in">DECL_HACK_PRIVATE_CONST_FUNCTION</span>(A, func, <span class="type">int</span>, <span class="type">int</span>)</span><br><span class="line"><span class="comment">// private static member</span></span><br><span class="line"><span class="built_in">DECL_HACK_PRIVATE_STATIC_DATA</span>(A,<span class="type">int</span>,static_ival2)</span><br><span class="line"><span class="comment">// private static member function</span></span><br><span class="line"><span class="built_in">DECL_HACK_PRIVATE_STATIC_FUNCTION</span>(A,printStaticIval2,<span class="type">void</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> A::static_ival2 = <span class="number">666</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">A <span class="title">aobj</span><span class="params">(<span class="number">789</span>)</span></span>;</span><br><span class="line">    <span class="comment">// get private non-static data member</span></span><br><span class="line">    <span class="built_in">GET_REF_PRIVATE_DATA_MEMBER</span>(ref_ival, &amp;aobj, A, ival);</span><br><span class="line">    ref_ival=<span class="number">456</span>;</span><br><span class="line">    std::cout&lt;&lt;<span class="built_in">GET_VAR_PRIVATE_DATA_MEMBER</span>(&amp;aobj, A, ival)&lt;&lt;endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// call private non-static member function</span></span><br><span class="line">    <span class="keyword">auto</span> A_func=<span class="built_in">GET_PRIVATE_MEMBER_FUNCTION</span>(A, func);</span><br><span class="line">    std::cout&lt;&lt;<span class="built_in">CALL_MEMBER_FUNCTION</span>(&amp;aobj, A_func, <span class="number">123</span>)&lt;&lt;std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// get private static data member</span></span><br><span class="line">    <span class="built_in">GET_PRIVATE_STATIC_DATA_MEMBER_PTR</span>(A_static_ival2, A, static_ival2);</span><br><span class="line">    std::cout&lt;&lt;*A_static_ival2&lt;&lt;std::endl;</span><br><span class="line">    *A_static_ival2 = <span class="number">123456</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// call private static function member</span></span><br><span class="line">    <span class="keyword">auto</span> A_printStaticIval2_func_ptr = <span class="built_in">GET_PRIVATE_MEMBER_FUNCTION</span>(A,printStaticIval2);</span><br><span class="line">    <span class="built_in">A_printStaticIval2_func_ptr</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<!-- <script src="//gist.github.com/c1802a7477733655c76fbfe68f2e5b80.js"></script> -->

<!-- Find time to analyze this in detail later. -->
<p>The implementation of the above code utilizes templates to acquire pointers to member functions, resulting in the following expansion:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>&#123;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;A::func\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T,<span class="keyword">typename</span> T::MemType M&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PrivateMemberHacker</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">friend</span> <span class="keyword">typename</span> T::MemType <span class="title">GetPrivate</span><span class="params">(T)</span></span>&#123;<span class="keyword">return</span> M;&#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">A_func</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">typedef</span> <span class="title">void</span> <span class="params">(A::*MemType)</span><span class="params">(<span class="type">void</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">friend</span> MemType <span class="title">GetPrivate</span><span class="params">(A_func)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">template</span> <span class="keyword">struct</span> <span class="title class_">PrivateMemberHacker</span>&lt;A_func,&amp;A::func&gt;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">void</span> (A::*MemType)(<span class="type">void</span>)=<span class="built_in">GetPrivate</span>(<span class="built_in">A_func</span>());</span><br><span class="line">    A aobj;</span><br><span class="line">    (&amp;aobj-&gt;*MemType)();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The reason for using templates is to bypass access permission checks at compile time.<br>Since we need to acquire the address of <code>A::func</code>, there would be access permission checks at runtime when calling <code>&amp;A::func</code>, which will not compile, thus necessitating the use of a template for early execution.<br>Hence, we define a new class where the type of the member we want to acquire is represented as a <code>typedef</code> (MemType). This transforms the inaccessible member type <code>A::func</code> into accessible member type <code>A_func::MemType</code>, and importantly, it passes the template parameter (<code>&amp;A::func</code>) to it (<code>T::MemType M</code>) to break through access control of the class.</p>
<p>Moreover, polymorphism is also supported:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">A</span>()=<span class="keyword">default</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">virtualfunc</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;A::virtualfunc\n&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d %d\n&quot;</span>,ival,ival2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> ival = <span class="number">123</span>;</span><br><span class="line">    <span class="type">int</span> ival2 = <span class="number">456</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span>:<span class="keyword">public</span> A</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">virtualfunc</span><span class="params">()</span><span class="keyword">override</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;B::virtualfunc\n&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ival3);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> ival3 = <span class="number">789</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// private member function</span></span><br><span class="line"><span class="built_in">DECL_HACK_PRIVATE_NOCONST_FUNCTION</span>(A, virtualfunc,<span class="type">void</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    B bobj;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> A_virtualfunc=<span class="built_in">GET_PRIVATE_MEMBER_FUNCTION</span>(A, virtualfunc);</span><br><span class="line">    <span class="built_in">CALL_MEMBER_FUNCTION</span>(&amp;bobj, A_virtualfunc);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2021/20210524172617.webp"></p>
<p>Conclusion: From the first method of bypassing class access control, one can see the influence of member function templates on class access control. It can be done by using member templates to bypass access control mechanisms. Importantly, this approach is portable and allows for code upgrades (as long as member names do not change). However, any attempts to circumvent member access restrictions are not recommended.<br>It is well known that in C++, class members can have three types of access control: <code>public</code> / <code>protected</code> / <code>private</code>:<br>[ISO/IEC 14882:2014] A member of a class can be</p>
<ul>
<li><strong>private</strong>: that is, its name can be used only by members and friends of the class in which it is declared.</li>
<li><strong>protected</strong>: that is, its name can be used only by members and friends of the class in which it is declared, by classes derived from that class, and by their friends (see 11.4).</li>
<li><strong>public</strong>: that is, its name can be used anywhere without access restriction.</li>
</ul>
<p>From the perspective of the standard’s intent, it aims to hide the implementation details and underlying data of the class, which is <strong>encapsulation</strong>. However, we can also break through the access control restrictions through some special means.</p>
<!-- more -->
<p>First, let’s correct a misconception: the access control of class in C++ restricts the <strong>access permission</strong> of members, not their <strong>visibility</strong>.</p>
<blockquote>
<p>[ISO/IEC 14882:2014] It should be noted that it is access to members and base classes that is controlled, not their visibility.</p>
</blockquote>
<p>Any member in a class is <strong>visible</strong> to any code that can see the implementation of that class; the issue is <strong>whether it can be accessed</strong>. That is, when you directly access the name (identifier) of a member in a class, it will check whether you have the right to access that member. If you mark it as <code>private</code> and attempt to access it from outside the class definition or outside a friend, a compilation error will be raised. For a detailed description of the visibility and accessibility of access control, please refer to my other article: <a target="_blank" rel="noopener" href="https://imzlp.com/posts/17586">Visibility and Accessibility of Access Control Mechanisms</a>.<br>So we can bypass the access control mechanism by not using the member’s name. A way to access class members without using the class member names is—pointers to the class members. For specific content on <strong>pointers to class members in C++</strong>, you can refer to my previous article: <a target="_blank" rel="noopener" href="https://imzlp.com/posts/27615">Pointers to Class Members in C++ are Not Pointers</a>.</p>
<p>From the perspective of <strong>intrusive</strong> implementation, we can actively provide access to class <code>private</code> members through class member functions.<br>A common method is to return a reference to the <code>private</code> data member or return <a target="_blank" rel="noopener" href="https://imzlp.com/posts/27615">pointers to class members</a>. I prefer returning a pointer to the member, because if you return a reference, the accessible member later can only be that of a specific object, while a function pointer can access any member of that class object.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">A</span>(<span class="type">int</span> x=<span class="number">0</span>):<span class="built_in">private_</span>(x)&#123;&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">()</span></span>&#123; std::cout&lt;&lt;private_&lt;&lt;std::endl; &#125;</span><br><span class="line">	<span class="function"><span class="keyword">auto</span> <span class="title">retPrivateVal</span><span class="params">()</span></span>&#123; <span class="keyword">return</span> &amp;A::private_; &#125;</span><br><span class="line">	<span class="function"><span class="keyword">auto</span> <span class="title">retPrivateFunc</span><span class="params">()</span></span>&#123; <span class="keyword">return</span> &amp;A::privateFunc; &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">privateFunc</span><span class="params">()</span></span>&#123; std::cout&lt;&lt;<span class="string">&quot;A::privateFunc()&quot;</span>&lt;&lt;std::endl; &#125;</span><br><span class="line">	<span class="type">int</span> private_;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>Since what we obtain here is the object address (data member/function object), it can be accessed externally through a class object or a pointer to a class object. This is because the access to class member pointers is essentially calculated through <code>this</code> to determine the offset of that member, thus not triggering any name lookup or accessibility checks:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">A <span class="title">example</span><span class="params">(<span class="number">456</span>)</span></span>;</span><br><span class="line">example.<span class="built_in">print</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> memPtr=example.<span class="built_in">retPrivateVal</span>();</span><br><span class="line">example.*memPtr=<span class="number">123</span>;</span><br><span class="line">example.<span class="built_in">print</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> memFuncPtr=example.<span class="built_in">retPrivateFunc</span>();</span><br><span class="line">(example.*memFuncPtr)();</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">output:</span></span><br><span class="line"><span class="comment">456</span></span><br><span class="line"><span class="comment">123</span></span><br><span class="line"><span class="comment">A::privateFunc()</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>As can be seen, the <code>private</code> data member of class A has been modified externally, and we can also call its <code>private</code> member function from outside. They can also be combined with the STL operator library to perform certain operations on a batch of class objects.<br>However, this is based on the premise of <strong>the class implementer proactively providing access rights</strong>.</p>
<p>There are also cases where, for some reasons, we may not want to manually modify the class code (add or delete class interfaces), yet still require access to <code>private</code> members. In such cases, there are two approaches we can use.<br>Assuming we have the following class:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">A</span>(<span class="type">int</span> x=<span class="number">0</span>):<span class="built_in">private_</span>(x)&#123;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function">	<span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">const</span> T&amp; x)</span></span>&#123;<span class="comment">/* something...*/</span>&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">()</span></span>&#123;cout&lt;&lt;private_&lt;&lt;endl;&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="type">int</span> private_;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>Since it has a template member function, we can use this template member function to break through the class’s access permissions. The method is to add a specialization of this member function from outside because it is a specialization of the class member and it has access to all members of the class:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">	<span class="keyword">struct</span> <span class="title class_">ZZZ</span>&#123;</span><br><span class="line">		<span class="built_in">ZZZ</span>(<span class="type">int</span> i):<span class="built_in">ival</span>(i)&#123;&#125;</span><br><span class="line">		<span class="type">int</span> ival;</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span>&lt;&gt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">A::func</span><span class="params">(<span class="type">const</span> ZZZ&amp; z)</span></span>&#123;</span><br><span class="line">	private_=z.ival;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Here, when we use <code>ZZZ</code> as a parameter to call the <code>A::func</code> member function, we can access the <code>private</code> member, thus breaking the access limitations of the C++ class. We can either directly manipulate the <code>private</code> member or pass out the member pointer (to the incoming object), and we can access class A’s <code>private</code> member externally.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">A <span class="title">example</span><span class="params">(<span class="number">456</span>)</span></span>;</span><br><span class="line">example.<span class="built_in">print</span>();</span><br><span class="line"></span><br><span class="line">example.<span class="built_in">func</span>(<span class="built_in">ZZZ</span>(<span class="number">123</span>));</span><br><span class="line">example.<span class="built_in">print</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">output:</span></span><br><span class="line"><span class="comment">456</span></span><br><span class="line"><span class="comment">123</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>If a class has friend templates, the same behavior can also be achieved, and this method is <strong>fully compliant with the C++ standard</strong>.</p>
<p>Next, let’s discuss a method for breaking access permissions that <strong>depends on the compiler implementation</strong>:<br>Using the above class A as the target for the breakthrough.<br>We can create a class that mimics the same layout as the target class but changes the access specifiers for corresponding <code>private</code> members to <code>public</code> or <code>protected</code> and other more lenient access privileges (this is actually implementation-dependent).</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The only difference is that private_ is public in class B</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">B</span>(<span class="type">int</span> x=<span class="number">0</span>):<span class="built_in">private_</span>(x)&#123;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function">	<span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">const</span> T&amp; x)</span></span>&#123;<span class="comment">/* something...*/</span>&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">()</span></span>&#123;cout&lt;&lt;private_&lt;&lt;endl;&#125;</span><br><span class="line">	<span class="type">int</span> private_;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>Then it can be used to manipulate:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">A <span class="title">example</span><span class="params">(<span class="number">456</span>)</span></span>;</span><br><span class="line">example.<span class="built_in">print</span>();</span><br><span class="line"></span><br><span class="line">(<span class="built_in">reinterpret_cast</span>&lt;B&amp;&gt;(example)).private_=<span class="number">123</span>;</span><br><span class="line"></span><br><span class="line">example.<span class="built_in">print</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">output:</span></span><br><span class="line"><span class="comment">456</span></span><br><span class="line"><span class="comment">123</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>The core of this is <code>reinterpret_cast&lt;B&amp;&gt;(example)</code>, which forces the compiler to interpret an object of class A as an object of class B, allowing access to the public member <code>private_</code> in class B, but actually modifying the <code>private</code> member <code>private_</code> of class A.<br>However, this also relies on the compiler’s implementation because we assume that the layout of the modified class B and class A is exactly the same, which is not guaranteed (works in G++).</p>
<blockquote>
<p>[TC++PL4th] A compiler may reorder sections of a class with separate access specifiers.</p>
</blockquote>
<p>We can also place the objects of class <code>A</code> and class <code>B</code> in a <code>union</code>, storing them as A’s type and reading them as B’s type:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">union</span> <span class="title class_">U</span>&#123;</span><br><span class="line">	A aobj;</span><br><span class="line">	B bobj;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	U uobj&#123;<span class="number">456</span>&#125;;</span><br><span class="line">	uobj.aobj.<span class="built_in">print</span>();</span><br><span class="line">	uobj.bobj.private_=<span class="number">123</span>;</span><br><span class="line">	uobj.aobj.<span class="built_in">print</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">output:</span></span><br><span class="line"><span class="comment">456</span></span><br><span class="line"><span class="comment">123</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>Another clever trick to access class private members is shown directly in the code below (the latest code will be placed on gist: <a target="_blank" rel="noopener" href="https://gist.github.com/hxhb/c1802a7477733655c76fbfe68f2e5b80">hack-private-data-member.cpp</a>):</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">namespace</span> Hacker</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">template</span>&lt;<span class="keyword">typename</span> Tag, <span class="keyword">typename</span> Tag::MemType M&gt;</span><br><span class="line">	<span class="keyword">struct</span> <span class="title class_">PrivateMemberStealer</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// define friend function GetPrivate, return class member pointer</span></span><br><span class="line">		<span class="function"><span class="keyword">friend</span> <span class="keyword">typename</span> Tag::MemType <span class="title">GetPrivate</span><span class="params">(Tag)</span> </span>&#123; <span class="keyword">return</span> M; &#125;</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DECL_HACK_PRIVATE_DATA(ClassName,DataType,DataName) namespace Hacker&#123;\</span></span><br><span class="line"><span class="meta">                                                              struct ClassName##_##DataName\</span></span><br><span class="line"><span class="meta">                                                              &#123;\</span></span><br><span class="line"><span class="meta">                                                                typedef DataType ClassName::*MemType;\</span></span><br><span class="line"><span class="meta">                                                                friend MemType GetPrivate(ClassName##_##DataName);\</span></span><br><span class="line"><span class="meta">                                                              &#125;;\</span></span><br><span class="line"><span class="meta">                                                              template struct PrivateMemberStealer<span class="string">&lt;ClassName##_##DataName, &amp;ClassName::DataName&gt;</span>;\</span></span><br><span class="line"><span class="meta">                                                            &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DECL_HACK_PRIVATE_STATIC_DATA(ClassName,DataType,DataName) namespace Hacker&#123;\</span></span><br><span class="line"><span class="meta">                                                              struct ClassName##_##DataName\</span></span><br><span class="line"><span class="meta">                                                              &#123;\</span></span><br><span class="line"><span class="meta">                                                                typedef DataType* MemType;\</span></span><br><span class="line"><span class="meta">                                                                friend MemType GetPrivate(ClassName##_##DataName);\</span></span><br><span class="line"><span class="meta">                                                              &#125;;\</span></span><br><span class="line"><span class="meta">                                                              template struct PrivateMemberStealer<span class="string">&lt;ClassName##_##DataName, &amp;ClassName::DataName&gt;</span>;\</span></span><br><span class="line"><span class="meta">                                                            &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DECL_HACK_PRIVATE_STATIC_FUNCTION(ClassName,MemberName,ReturnType,...) \</span></span><br><span class="line"><span class="meta">		namespace Hacker&#123;\</span></span><br><span class="line"><span class="meta">			struct ClassName##_##MemberName \</span></span><br><span class="line"><span class="meta">			&#123;\</span></span><br><span class="line"><span class="meta">				typedef ReturnType (*MemType)(__VA_ARGS__);\</span></span><br><span class="line"><span class="meta">				friend MemType GetPrivate(ClassName##_##MemberName);\</span></span><br><span class="line"><span class="meta">			&#125;;\</span></span><br><span class="line"><span class="meta">			template struct PrivateMemberStealer<span class="string">&lt;ClassName##_##MemberName, &amp;ClassName::MemberName&gt;</span>;\</span></span><br><span class="line"><span class="meta">		&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DECL_HACK_PRIVATE_NOCONST_FUNCTION(ClassName,MemberName,ReturnType,...) \</span></span><br><span class="line"><span class="meta">		namespace Hacker&#123;\</span></span><br><span class="line"><span class="meta">			struct ClassName##_##MemberName \</span></span><br><span class="line"><span class="meta">			&#123;\</span></span><br><span class="line"><span class="meta">				typedef ReturnType (ClassName::*MemType)(__VA_ARGS__);\</span></span><br><span class="line"><span class="meta">				friend MemType GetPrivate(ClassName##_##MemberName);\</span></span><br><span class="line"><span class="meta">			&#125;;\</span></span><br><span class="line"><span class="meta">			template struct PrivateMemberStealer<span class="string">&lt;ClassName##_##MemberName, &amp;ClassName::MemberName&gt;</span>;\</span></span><br><span class="line"><span class="meta">		&#125;</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DECL_HACK_PRIVATE_CONST_FUNCTION(ClassName,MemberName,ReturnType,...) \</span></span><br><span class="line"><span class="meta">		namespace Hacker&#123;\</span></span><br><span class="line"><span class="meta">			struct ClassName##_##MemberName \</span></span><br><span class="line"><span class="meta">			&#123;\</span></span><br><span class="line"><span class="meta">				typedef ReturnType (ClassName::*MemType)(__VA_ARGS__)const;\</span></span><br><span class="line"><span class="meta">				friend MemType GetPrivate(ClassName##_##MemberName);\</span></span><br><span class="line"><span class="meta">			&#125;;\</span></span><br><span class="line"><span class="meta">			template struct PrivateMemberStealer<span class="string">&lt;ClassName##_##MemberName, &amp;ClassName::MemberName&gt;</span>;\</span></span><br><span class="line"><span class="meta">		&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GET_VAR_PRIVATE_DATA_MEMBER(ClassInstancePointer,ClassName,DataName)	ClassInstancePointer-&gt;*GetPrivate(::Hacker::ClassName##_##DataName())</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GET_REF_PRIVATE_DATA_MEMBER(RefName,ClassInstancePointer,ClassName,DataName)	auto&amp; RefName = ClassInstancePointer-&gt;*GetPrivate(::Hacker::ClassName##_##DataName())</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GET_PRIVATE_STATIC_DATA_MEMBER_PTR(PtrName,ClassName,DataName)	auto PtrName = GetPrivate(::Hacker::ClassName##_##DataName())</span></span><br><span class="line"><span class="comment">// using ADL found to ::Hacker::Getprivate</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GET_PRIVATE_MEMBER_FUNCTION(ClassName,MemberName) GetPrivate(::Hacker::ClassName##_##MemberName())</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CALL_MEMBER_FUNCTION(ClassPointer,MemberFuncPointer,...) (ClassPointer-&gt;*MemberFuncPointer)(__VA_ARGS__)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">A</span>(<span class="type">int</span> ivalp=<span class="number">0</span>):ival&#123;ivalp&#125;&#123;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">printStaticIval2</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,A::static_ival2);</span><br><span class="line">	&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">func</span><span class="params">(<span class="type">int</span> ival)</span><span class="type">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;A::func(int)\t%d\n&quot;</span>,ival);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;ival is %d\n&quot;</span>,ival);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> ival;</span><br><span class="line"></span><br><span class="line">	<span class="type">static</span> <span class="type">int</span> static_ival2;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// private member data </span></span><br><span class="line"><span class="built_in">DECL_HACK_PRIVATE_DATA</span>(A,<span class="type">int</span>,ival)</span><br><span class="line"><span class="comment">// private member function</span></span><br><span class="line"><span class="built_in">DECL_HACK_PRIVATE_CONST_FUNCTION</span>(A, func, <span class="type">int</span>, <span class="type">int</span>)</span><br><span class="line"><span class="comment">// private static member</span></span><br><span class="line"><span class="built_in">DECL_HACK_PRIVATE_STATIC_DATA</span>(A,<span class="type">int</span>,static_ival2)</span><br><span class="line"><span class="comment">// private static member function</span></span><br><span class="line"><span class="built_in">DECL_HACK_PRIVATE_STATIC_FUNCTION</span>(A,printStaticIval2,<span class="type">void</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> A::static_ival2 = <span class="number">666</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="function">A <span class="title">aobj</span><span class="params">(<span class="number">789</span>)</span></span>;</span><br><span class="line">	<span class="comment">// get private non-static data member</span></span><br><span class="line">	<span class="built_in">GET_REF_PRIVATE_DATA_MEMBER</span>(ref_ival, &amp;aobj, A, ival);</span><br><span class="line">	ref_ival=<span class="number">456</span>;</span><br><span class="line">	std::cout&lt;&lt;<span class="built_in">GET_VAR_PRIVATE_DATA_MEMBER</span>(&amp;aobj, A, ival)&lt;&lt;endl;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// call private non-static member function</span></span><br><span class="line">	<span class="keyword">auto</span> A_func=<span class="built_in">GET_PRIVATE_MEMBER_FUNCTION</span>(A, func);</span><br><span class="line">	std::cout&lt;&lt;<span class="built_in">CALL_MEMBER_FUNCTION</span>(&amp;aobj, A_func, <span class="number">123</span>)&lt;&lt;std::endl;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// get private static data member</span></span><br><span class="line">	<span class="built_in">GET_PRIVATE_STATIC_DATA_MEMBER_PTR</span>(A_static_ival2, A, static_ival2);</span><br><span class="line">	std::cout&lt;&lt;*A_static_ival2&lt;&lt;std::endl;</span><br><span class="line">	*A_static_ival2 = <span class="number">123456</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// call private static function member</span></span><br><span class="line">	<span class="keyword">auto</span> A_printStaticIval2_func_ptr = <span class="built_in">GET_PRIVATE_MEMBER_FUNCTION</span>(A,printStaticIval2);</span><br><span class="line">	<span class="built_in">A_printStaticIval2_func_ptr</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<!-- <script src="//gist.github.com/c1802a7477733655c76fbfe68f2e5b80.js"></script> -->

<!-- Find a time to analyze it in detail later. -->
<p>The implementation above utilizes templates to obtain pointers to member functions, and it unfolds as follows:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>&#123;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A::func\n&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T,<span class="keyword">typename</span> T::MemType M&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PrivateMemberHacker</span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">friend</span> <span class="keyword">typename</span> T::MemType <span class="title">GetPrivate</span><span class="params">(T)</span></span>&#123;<span class="keyword">return</span> M;&#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">A_func</span></span><br><span class="line">&#123;</span><br><span class="line"> <span class="function"><span class="keyword">typedef</span> <span class="title">void</span> <span class="params">(A::*MemType)</span><span class="params">(<span class="type">void</span>)</span></span>;</span><br><span class="line"> <span class="function"><span class="keyword">friend</span> MemType <span class="title">GetPrivate</span><span class="params">(A_func)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">template</span> <span class="keyword">struct</span> <span class="title class_">PrivateMemberHacker</span>&lt;A_func,&amp;A::func&gt;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="built_in">void</span> (A::*MemType)(<span class="type">void</span>)=<span class="built_in">GetPrivate</span>(<span class="built_in">A_func</span>());</span><br><span class="line">  A aobj;</span><br><span class="line">  (&amp;aobj-&gt;*MemType)();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The reason for using templates is to bypass access permission checks at compile time. Since what we want to obtain is the address of <code>A::func</code>, the access permission check for <code>&amp;A::func</code> occurs at runtime and cannot be compiled. Therefore, we need templates to perform early execution. Thus, we create a class definition, using a <code>typedef</code> (MemType) for the member type we wish to acquire and turning the non-accessible member type <code>A::func</code> into the accessible member type <code>A_func::MemType</code>. The key is passing the template’s actual parameter (<code>&amp;A::func</code>) to it (<code>T::MemType M</code>) to break through the access control of the class.</p>
<p>Moreover, polymorphism is also supported:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">A</span>()=<span class="keyword">default</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">virtualfunc</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;A::virtualfunc\n&quot;</span>);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%d %d\n&quot;</span>,ival,ival2);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> ival = <span class="number">123</span>;</span><br><span class="line">	<span class="type">int</span> ival2 = <span class="number">456</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span>:<span class="keyword">public</span> A</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">virtualfunc</span><span class="params">()</span><span class="keyword">override</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;B::virtualfunc\n&quot;</span>);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ival3);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> ival3 = <span class="number">789</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// private member function</span></span><br><span class="line"><span class="built_in">DECL_HACK_PRIVATE_NOCONST_FUNCTION</span>(A, virtualfunc,<span class="type">void</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	B bobj;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">auto</span> A_virtualfunc=<span class="built_in">GET_PRIVATE_MEMBER_FUNCTION</span>(A, virtualfunc);</span><br><span class="line">	<span class="built_in">CALL_MEMBER_FUNCTION</span>(&amp;bobj, A_virtualfunc);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img data-src="https://img.imzlp.com/imgs/zlp/picgo/2021/20210524172617.webp"></p>
<p>Conclusion: We can see from the first method of breaking class access control that member function templates influence access control mechanisms, allowing access control to be bypassed through member templates. Most importantly, this approach is portable and can be code-upgradeable (as long as the member names do not change). However, any behavior that breaks member access restrictions is not recommended.</p>

    </div>

    
    
        
        
          
            <blockquote class="blockquote-center">
              
                The article is finished. If you have any questions, please comment and communicate.
              
            <br/>
            
                <div class="qr-code" onclick="return false">
                    <script src="/js/qrcode.min.js"></script>
                    <div id="qrcode">
                      
                        <img src="https://imzlp.com/images/wechat-qrcode.webp">
                      
                    <p>Scan the QR code on WeChat and follow me.</p>
                    </div>
                </div>
            
            </blockquote>
          
        

        
          <div class="postCopyright" style="clear:both;">
             <span>Title:</span><a href="/posts/12080/" target="_blank">Breaking through the access control mechanism of C++ classes</a><br/>
             <span>Author:</span><a href="/about" target="_blank" title="查看 LIPENGZHA 的资料">LIPENGZHA</a><br/>
             <span>Publish Date:</span>2017/05/12 11:58<br/>
             
              <span>Update Date:</span>2021/05/24 17:28<br/>
             
             <span>Word Count:</span><span class="page-count">11k Words</span><br/>
             
             <span>Link:</span><a href="/posts/12080/" target="_blank" title="Breaking through the access control mechanism of C++ classes">https://en.imzlp.com/posts/12080/</a>
             <span class="copy-path" data-clipboard-text="Link: https://en.imzlp.com/posts/12080/ Author: LIPENGZHA" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
             <script src="/js/jquery.min.js"></script>
             <script src="/js/clipboard.min.js"></script>
             <script> var clipboard = new Clipboard('.copy-path'); </script>
             <br/>
             
             <span>License:</span><i class="fab fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" title="Attribution-NonCommercial-ShareAlike 4.0 International">CC BY-NC-SA 4.0</a><br/>
             
             <span>Reprinting of the full article is prohibited.</span>
          </div>
        
    

        
  <div class="reward-container">
    <div>Your donation will encourage me to keep creating!</div>
    <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
      Donate
    </button>
    <div id="qr" style="display: none;">
        
        <div style="display: inline-block;">
          <img src="/images/reward/wechatpay.webp" alt="LIPENGZHA WeChat Pay">
          <p>WeChat Pay</p>
        </div>

    </div>
  </div>



      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/C/" rel="tag"># C++</a>
              <a href="/tags/%E6%8A%80%E6%9C%AF%E7%AC%94%E8%AE%B0/" rel="tag"># 技术笔记</a>
              <a href="/tags/%E7%BC%96%E7%A8%8B%E7%AC%94%E8%AE%B0/" rel="tag"># 编程笔记</a>
              <a href="/tags/C-%E6%A0%87%E5%87%86/" rel="tag"># C++标准</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/posts/17586/" rel="prev" title="Visibility and accessibility of access control mechanisms">
      <i class="fa fa-chevron-left"></i> Visibility and accessibility of access control mechanisms
    </a></div>
      <div class="post-nav-item">
    <a href="/posts/15564/" rel="next" title="C++ Technical Book Reviews Summary">
      C++ Technical Book Reviews Summary <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
      <div class="tabs tabs-comment">
        <ul class="nav-tabs">
            <li class="tab"><a href="#comment-utteranc">utteranc</a></li>
            <li class="tab"><a href="#comment-valine">valine</a></li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane utteranc" id="comment-utteranc">
              
  
  <div class="comments">
  <script src="https://utteranc.es/client.js" repo="hxhb/blog-comments" issue-term="pathname" theme="github-light" crossorigin="anonymous" async></script>
  </div>
  
  
            </div>
            <div class="tab-pane valine" id="comment-valine">
              <div class="comments" id="valine-comments"></div>
            </div>
        </div>
      </div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person" oncontextmenu="return false" οndragstart="return false">
    <img class="site-author-image" itemprop="image" alt="LIPENGZHA"
      src="https://img.imzlp.com/imgs/zlp/picgo/2023/202304152112902.webp">
  <p class="site-author-name" itemprop="name">LIPENGZHA</p>
  <div class="site-description" itemprop="description">"I think, therefore I am"</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
             
          <span class="site-state-item-count">190</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">95</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">190</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/hxhb" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;hxhb" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://linkedin.com/in/lipengzha" title="Linkedin → https:&#x2F;&#x2F;linkedin.com&#x2F;in&#x2F;lipengzha" rel="noopener" target="_blank"><i class="fab fa-linkedin fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/imzlp" title="知乎 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;imzlp" rel="noopener" target="_blank"><i class="fa fa-custom zhihu fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/images/wechat-qrcode-offical.webp" title="微信公众号 → &#x2F;images&#x2F;wechat-qrcode-offical.webp"><i class="fab fa-weixin fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:imzlp@foxmail.com" title="E-Mail → mailto:imzlp@foxmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-rss fa-fw"></i></a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://consolehelp.imzlp.com/" title="https:&#x2F;&#x2F;consolehelp.imzlp.com&#x2F;" rel="noopener" target="_blank">UE Console Help</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://imzlp.com/opensource/" title="https:&#x2F;&#x2F;imzlp.com&#x2F;opensource&#x2F;" rel="noopener" target="_blank">Open Source Projects</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://imzlp.com/posts/11515/" title="https:&#x2F;&#x2F;imzlp.com&#x2F;posts&#x2F;11515&#x2F;" rel="noopener" target="_blank">UE C++ API Dash Documents</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://ue5wiki.com/" title="https:&#x2F;&#x2F;ue5wiki.com&#x2F;" rel="noopener" target="_blank">Unreal Engine Wiki</a>
        </li>
    </ul>
  </div>

      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2014 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">LIPENGZHA</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="Symbols count total">1.5m</span>
</div>
  <div class="powered-by-other">
    
	    <center>Github Pages | Actions | NeXT | Cloudflare | Hexo Deploy</center>
      
  </div>

<script>
function checkWebp(callback) {
    var img = new Image();
    img.onload = function () { callback((img.width > 0) && (img.height > 0)); };
    img.onerror = function () { callback(false); };
    img.src = 'data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA';
}
function showImage(useWebp) {
    var imgs = [].slice.call(document.querySelectorAll('img'));
    imgs.forEach(function (e) {
        if (!useWebp) {
            var src = e.getAttribute('data-src')
            src = src.replace(/\.webp$/, '.png');
            e.setAttribute('data-src', src);
        }
    });
}
checkWebp(showImage);
</script>

        








      </div>
    </footer>
  </div>

  
  <script src="//lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/animejs/3.2.1/anime.min.js"></script>
  <script src="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/jquery/3.5.1/jquery.min.js"></script>
  <script src="//lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/fancybox/3.5.7/jquery.fancybox.min.js"></script>
  <script src="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/lozad.js/1.16.0/lozad.min.js"></script>
  <script src="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/pangu/4.0.7/pangu.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>



<script src="/js/code-unfold.js"></script>

  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>




  
<script src="/js/local-search.js"></script>









<script>
document.querySelectorAll('.pdfobject-container').forEach(element => {
  let url = element.dataset.target;
  let pdfOpenParams = {
    navpanes : 0,
    toolbar  : 0,
    statusbar: 0,
    pagemode : 'thumbs',
    view     : 'FitH'
  };
  let pdfOpenFragment = '#' + Object.entries(pdfOpenParams).map(([key, value]) => `${key}=${encodeURIComponent(value)}`).join('&');
  let fullURL = `/lib/pdf/web/viewer.html?file=${encodeURIComponent(url)}${pdfOpenFragment}`;

  if (NexT.utils.supportsPDFs()) {
    element.innerHTML = `<embed class="pdfobject" src="${url + pdfOpenFragment}" type="application/pdf" style="height: ${element.dataset.height};">`;
  } else {
    element.innerHTML = `<iframe src="${fullURL}" style="height: ${element.dataset.height};" frameborder="0"></iframe>`;
  }
});
</script>


<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


  

  

  
  <script src="//img.imzlp.com/imgs/zlp/picgo/2021/quicklink.umd.js"></script>
  <script>
      window.addEventListener('load', () => {
      quicklink({
        timeout : 3000,
        priority: true,
        ignores : [uri => uri.includes('#'),uri => uri === 'https://en.imzlp.com/posts/12080/',]
      });
      });
  </script>


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/valine/1.4.14/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    var requiredFields = 'nick';
    requiredFields = requiredFields.split(',');
    
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'oCE6RMVkVoi5MgUhvFsn1EvV-gzGzoHsz',
      appKey     : 'K9SOaNYJ8PV6xaoFggWG5xvv',
      placeholder: "Leave something behind~",
      avatar     : 'robohash',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : 'en' || 'zh-cn',
      path       : location.pathname,
      recordIP   : true,
      serverURLs : '',
      requiredFields: requiredFields
    });
  }, window.Valine);
});
</script>

</body>
</html>
